// Generated by OrchestKit Claude Plugin
// Created: 2026-02-18

/**
 * Skill Nudge — UserPromptSubmit Hook
 * Issue #705: Contextual nudges for zero-use skills
 *
 * Detects GitHub issue URLs in user prompt → suggests /ork:fix-issue
 *
 * Hook: UserPromptSubmit — sync, returns additionalContext
 * Wired into prompt/unified-dispatcher registry
 */

import type { HookInput, HookResult } from '../types.js';
import { outputPromptContext, outputSilentSuccess, logHook } from '../lib/common.js';

const HOOK_NAME = 'skill-nudge-prompt';

/** Match github.com/<owner>/<repo>/issues/<number> — anchored so sub-paths like /comments don't match */
const ISSUE_URL_RE = /https?:\/\/github\.com\/[\w.-]+\/[\w.-]+\/issues\/\d+(?=[/?#]|$)/;

/**
 * Detect GitHub issue URL in user prompt and nudge fix-issue skill
 */
export function skillNudgePrompt(input: HookInput): HookResult {
  const prompt = input.prompt || '';

  if (ISSUE_URL_RE.test(prompt)) {
    logHook(HOOK_NAME, 'Nudge: fix-issue for GitHub issue URL in prompt');
    return outputPromptContext(
      'Tip: Use `/ork:fix-issue` to fix this issue with parallel analysis, automatic branch creation, and structured PR.'
    );
  }

  return outputSilentSuccess();
}
