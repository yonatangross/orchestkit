// Generated by OrchestKit Claude Plugin
// Created: 2026-02-18

/**
 * Skill Nudge â€” PostToolUse Bash Hook
 * Issue #705: Contextual nudges for zero-use skills
 *
 * Detects:
 * 1. Successful `git push` â†’ suggests /ork:create-pr
 *
 * Note: /ork:remember nudge is handled by memory-capture.ts (Stop hook) â€” not duplicated here.
 *
 * Hook: PostToolUse (Bash) â€” sync, returns additionalContext
 */

import type { HookInput, HookResult } from '../types.js';
import { outputSilentSuccess, outputWithContext, logHook } from '../lib/common.js';

const HOOK_NAME = 'skill-nudge';

/**
 * Detect successful git push from Bash tool output
 */
function isGitPushSuccess(input: HookInput): boolean {
  const command = input.tool_input?.command || '';
  if (!/\bgit\s+push\b/.test(command)) return false;

  if (input.exit_code !== undefined && input.exit_code !== 0) return false;

  if (/--dry-run/.test(command)) return false;
  // exit_code 0 is sufficient â€” output checks are unreliable (git push writes to stderr)
  return true;
}

/**
 * Skill nudge hook â€” PostToolUse Bash (sync)
 */
export function skillNudge(input: HookInput): HookResult {
  // Nudge: git push success â†’ create-pr
  if (isGitPushSuccess(input)) {
    logHook(HOOK_NAME, 'Nudge: create-pr after git push');
    return outputWithContext('ðŸ’¡ /ork:create-pr â€” open a PR with validation and auto-filled description.');
  }

  return outputSilentSuccess();
}
