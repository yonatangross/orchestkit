// Generated by OrchestKit Claude Plugin
// Created: 2026-02-06

/**
 * Team Member Start - PostToolUse[Task] Hook
 *
 * Links spawned teammates to the team activity log after successful spawn.
 * Only fires for team-scoped Task spawns (tool_input.team_name present).
 *
 * @hook PostToolUse[Task]
 * @since CC 2.1.33
 */

import type { HookInput, HookResult } from '../../types.js';
import { outputSilentSuccess, outputWithContext, logHook } from '../../lib/common.js';
import { appendEventLog } from '../../lib/event-logger.js';
import { appendAnalytics, hashProject } from '../../lib/analytics.js';

export function teamMemberStart(input: HookInput): HookResult {
  const toolInput = input.tool_input || {};

  // Only track team spawns
  const teamName = toolInput.team_name as string | undefined;
  if (!teamName) {
    return outputSilentSuccess();
  }

  const memberName = (toolInput.name as string) || 'unnamed-teammate';
  const subagentType = (toolInput.subagent_type as string) || 'unknown';
  const model = (toolInput.model as string) || 'default';
  const description = (toolInput.description as string) || '';

  logHook('team-member-start', `Team "${teamName}": member "${memberName}" (${subagentType}) started`);

  appendEventLog('teammate-activity.jsonl', {
    timestamp: new Date().toISOString(),
    event: 'team_member_start',
    team_name: teamName,
    member_name: memberName,
    subagent_type: subagentType,
    model,
    description,
    session_id: input.session_id,
  });

  // Cross-project team activity analytics (Issue #459)
  appendAnalytics('team-activity.jsonl', {
    ts: new Date().toISOString(),
    pid: hashProject(process.env.CLAUDE_PROJECT_DIR || ''),
    event: 'spawn',
    agent: subagentType,
    member: memberName,
    model,
    team: teamName,
  });

  return outputWithContext(
    `Team "${teamName}": teammate "${memberName}" (${subagentType}, model=${model}) spawned.`,
  );
}
