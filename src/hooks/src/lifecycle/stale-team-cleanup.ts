// Generated by OrchestKit Claude Plugin
// Created: 2026-02-09

/**
 * Stale Team Cleanup â€” SessionStart Hook
 * Issue #447: Remove orphaned team directories from crashed/interrupted sessions
 */
import type { HookInput, HookResult } from '../types.js';
import { logHook, outputSilentSuccess } from '../lib/common.js';
import { listAllTeams, isStaleTeam, cleanupTeam } from '../lib/agent-teams.js';

const MAX_AGE_HOURS = 4;

export function staleTeamCleanup(_input: HookInput): HookResult {
  const teams = listAllTeams();
  if (teams.length === 0) return outputSilentSuccess();

  let cleaned = 0;
  for (const name of teams) {
    if (isStaleTeam(name, MAX_AGE_HOURS)) {
      if (cleanupTeam(name)) cleaned++;
      else logHook('stale-team-cleanup', `Failed to clean team "${name}"`);
    }
  }

  if (cleaned > 0) {
    logHook('stale-team-cleanup', `Cleaned ${cleaned} stale team(s)`);
  }
  return outputSilentSuccess();
}
