// Generated by OrchestKit Claude Plugin
// Created: 2026-02-18

/**
 * Shared session metrics utilities.
 * Provides getTotalTools() used by session-cleanup and memory-capture.
 */

import { existsSync, readFileSync } from 'node:fs';
import { getMetricsFile } from './paths.js';

interface SessionMetrics {
  tools?: Record<string, number>;
  [key: string]: unknown;
}

/**
 * Get total tool invocations from the session metrics file.
 * Returns 0 if the file does not exist or cannot be parsed.
 */
export function getTotalTools(): number {
  const metricsFile = getMetricsFile();
  if (!existsSync(metricsFile)) {
    return 0;
  }

  try {
    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));
    const tools = metrics.tools || {};
    return Object.values(tools).reduce((sum, count) => sum + count, 0);
  } catch {
    return 0;
  }
}
