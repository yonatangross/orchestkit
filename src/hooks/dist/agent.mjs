// OrchestKit Hooks - agent bundle
// Generated: 2026-02-07T12:00:52.354Z

var N=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function St(t){return typeof t.command=="string"}function Et(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function Rt(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function yt(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as R,existsSync as y,statSync as et,renameSync as ot,mkdirSync as nt,readSync as rt}from"node:fs";import{execSync as st}from"node:child_process";import L from"node:os";import l from"node:path";function $(){return process.env.HOME||process.env.USERPROFILE||L.homedir()}function g(){return process.env.CLAUDE_PROJECT_DIR||"."}function _(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function h(){return process.env.CLAUDE_PLUGIN_ROOT?l.join($(),".claude","logs","ork"):l.join(g(),".claude","logs")}var Dt=l.join,Ot=l.sep;import{execSync as U}from"node:child_process";import{createHash as M}from"node:crypto";import{existsSync as x,readFileSync as j,writeFileSync as B,mkdirSync as F}from"node:fs";import{join as f,basename as G}from"node:path";var W=20,J=15,K=/[^a-z0-9-]/g;function z(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=G(e);return S(o,W)}function V(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let o=U("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),n=S(o||"detached",J);return process.env.ORCHESTKIT_SESSION_BRANCH=n,n}catch{return"nobranch"}}function q(t){let e=t||new Date,o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${o}${n}`}function X(t){let e=t||new Date,o=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${o}${n}`}function Z(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return M("sha256").update(t).digest("hex").slice(0,4)}function S(t,e){return t.toLowerCase().replace(K,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function Q(t,e){let o=z(t),n=V(t),s=q(e),i=X(e),c=Z();return`${o}-${n}-${s}-${i}-${c}`}function Y(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=f(e,".instance","session-id.json");if(x(o))try{let n=JSON.parse(j(o,"utf8"));if(n.session_id&&n.created_at){let s=Date.now()-new Date(n.created_at).getTime(),i=1440*60*1e3;if(s<i)return n.session_id}}catch{}}function tt(t,e){let o=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=f(o,".instance"),s=f(n,"session-id.json");try{x(n)||F(n,{recursive:!0}),B(s,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function E(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=Y(t);if(e)return e;let o=Q(t);return tt(o,t),o}function I(){return h()}function m(){return g()}function it(){return _()}function Mt(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${it()}/.claude/.instance_env`}function p(){return E()}function jt(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=st("git branch --show-current",{cwd:t||m(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function ut(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function Bt(t){return t.replace(/\r\n/g,`
`)}function ct(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(ut())}function r(){return{continue:!0,suppressOutput:!0}}function Ft(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function Gt(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function a(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function pt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function Wt(t,e){let o={continue:!0,suppressOutput:!0};return t&&(o.systemMessage=t),e&&(o.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),o}function Jt(t,e){let o={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?o.systemMessage=e:o.suppressOutput=!0,o}function Kt(t){return{continue:!0,systemMessage:t}}function zt(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function u(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function Vt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var at=200*1024,lt=100*1024;function H(t,e){if(y(t))try{if(et(t).size>e){let n=`${t}.old.${Date.now()}`;ot(t,n)}}catch{}}function T(t){y(t)||nt(t,{recursive:!0})}function dt(t,e,o="debug"){if(!ct(o))return;let n=I(),s=`${n}/hooks.log`;try{T(n),H(s,at);let i=new Date().toISOString().replace("T"," ").slice(0,19);R(s,`[${i}] [${o.toUpperCase()}] [${t}] ${e}
`)}catch{}}function qt(t,e,o){let n=I(),s=`${n}/permission-feedback.log`;try{T(n),H(s,lt);let i=new Date().toISOString(),c=o?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",d=o?.session_id||p();R(s,`${i} | ${t} | ${e} | tool=${c} | session=${d}
`)}catch{}}function gt(t){if(!t)return 0;let n=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/n)}function Xt(t,e,o,n,s){let i=gt(t);return n&&n.isOverBudget(o)?(dt(e,`Budget exhausted for ${o}, suppressing ${i}t`),r()):(s&&s.trackTokenUsage(e,o,i),pt(t))}function Zt(){try{let t=[],o=Buffer.allocUnsafe(256),n,s=0;for(;;)try{if(n=rt(s,o,0,256,null),n===0)break;t.push(Buffer.from(o.subarray(0,n)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:p(),tool_input:{}}}catch{return{tool_name:"",session_id:p(),tool_input:{}}}}function Qt(t,e){let o=e.replace(/^\./,"").split("."),n=t;for(let s of o){if(n==null)return;n=n[s]}return n}function Yt(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function te(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function D(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function se(t){return e=>t(e)?null:r()}function k(t,...e){let o=t.tool_input.file_path;if(!o)return r();let n=o.split(".").pop()?.toLowerCase()||"";return e.map(i=>i.toLowerCase().replace(/^\./,"")).includes(n)?null:r()}function ie(t){return k(t,"py","ts","tsx","js","jsx","go","rs","java")}function ue(t){return k(t,"py")}function ce(t){return k(t,"ts","tsx","js","jsx")}function pe(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(n=>n.test(e))?null:r():r()}function ae(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(n=>n.test(e))?r():null}function le(t,...e){let o=t.tool_input.file_path;if(!o)return r();for(let n of e)if(typeof n=="string"){if(new RegExp(n.replace(/\*/g,".*").replace(/\?/g,".")).test(o))return null}else if(n.test(o))return null;return r()}function O(t,...e){let o=t.tool_name;return o?e.includes(o)?null:r():r()}function de(t){return O(t,"Write","Edit")}function ge(t){return O(t,"Bash")}function fe(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(n=>n.test(e))?r():null}function me(t){return(t.tool_input.command||"").startsWith("git")?null:r()}function ke(t){if(D())return r();let o=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:n}=N("node:fs");if(n(o))return null}catch{}return r()}function _e(t,...e){for(let o of e){let n=o(t);if(n!==null)return n}return null}function he(t){return t.permissionMode==="dontAsk"}function C(t){let e=t.tool_name,o=process.env.CLAUDE_AGENT_ID||"unknown";return["Write","Edit","MultiEdit","NotebookEdit"].includes(e)?u(`BLOCKED: Agent '${o}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`):r()}var ft=[/force.*push/i,/push.*--force/i,/--force-with-lease/i,/workflow_dispatch/i,/delete.*workflow/i,/gh\s+secret\s+delete/i,/gh\s+variable\s+delete/i,/rm.*-rf.*\.github/i];function v(t){let e=t.tool_input.command||"";for(let o of ft)if(o.test(e))return u(`BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${o.source}'. This requires explicit user approval.`);return/deploy|release|publish/i.test(e)?a("CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place."):r()}var mt=[/\bprod\b/i,/production/i,/--env.*prod/i,/ENV=prod/i,/ENVIRONMENT=prod/i,/deploy.*main/i,/deploy.*master/i];function P(t){let e=t.tool_input.command||"";for(let o of mt)if(o.test(e))return u(`BLOCKED: Production deployment detected. Pattern: '${o.source}'. Production deployments require explicit user approval and should go through proper release processes.`);return/rollback|revert|downgrade/i.test(e)?a("Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed."):/terraform|kubectl|helm|docker.*push/i.test(e)?a("Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment."):r()}var kt=[/DROP\s+TABLE/i,/DROP\s+DATABASE/i,/TRUNCATE/i,/DELETE\s+FROM.*WHERE\s+1/i,/DELETE\s+FROM\s+[^W]*$/i,/--force/i,/alembic\s+downgrade/i];function b(t){if(t.tool_name!=="Bash")return r();let o=t.tool_input.command||"";for(let n of kt)if(n.test(o))return u(`BLOCKED: Potentially destructive database command detected. Pattern: '${n.source}'. Please confirm this operation is intentional before proceeding.`);return r()}import{mkdirSync as _t,appendFileSync as ht}from"node:fs";function A(t){let e=process.env.CLAUDE_AGENT_ID||"unknown",o=t.tool_name,n=t.session_id||p(),s=t.project_dir||m(),i=`${s}/.claude/logs/security-audit.log`;if(o!=="Bash")return r();let c=t.tool_input.command||"",d=new Date().toISOString();if(c)try{_t(`${s}/.claude/logs`,{recursive:!0}),ht(i,`[${d}] [${n}] [${e}] CMD: ${c}
`)}catch{}return r()}var w={"agent/block-writes":C,"agent/ci-safety-check":v,"agent/deployment-safety-check":P,"agent/migration-safety-check":b,"agent/security-command-audit":A};function Le(t){return w[t]}function $e(){return Object.keys(w)}export{se as createGuard,te as escapeRegex,gt as estimateTokenCount,jt as getCachedBranch,Mt as getEnvFile,Qt as getField,Le as getHook,I as getLogDir,ut as getLogLevel,it as getPluginRoot,m as getProjectDir,p as getSessionId,ge as guardBash,ie as guardCodeFiles,k as guardFileExtension,me as guardGitCommand,ke as guardMultiInstance,fe as guardNontrivialBash,le as guardPathPattern,ue as guardPythonFiles,ae as guardSkipInternal,pe as guardTestFiles,O as guardTool,ce as guardTypescriptFiles,de as guardWriteEdit,w as hooks,St as isBashInput,he as isDontAskMode,Rt as isEditInput,yt as isReadInput,Et as isWriteInput,$e as listHooks,dt as logHook,qt as logPermissionFeedback,Yt as normalizeCommand,Bt as normalizeLineEndings,Jt as outputAllowWithContext,Gt as outputBlock,u as outputDeny,Kt as outputError,pt as outputPromptContext,Xt as outputPromptContextBudgeted,Ft as outputSilentAllow,r as outputSilentSuccess,zt as outputWarning,a as outputWithContext,Wt as outputWithNotification,Vt as outputWithUpdatedInput,Zt as readHookInput,_e as runGuards,ct as shouldLog};
//# sourceMappingURL=agent.mjs.map
