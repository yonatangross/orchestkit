// OrchestKit Hooks - agent bundle
// Generated: 2026-02-28T13:40:06.928Z

var V=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Kt(t){return typeof t.command=="string"}function Jt(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function qt(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Vt(t){return typeof t.file_path=="string"&&t.content===void 0}import{existsSync as S,statSync as Et,renameSync as St,mkdirSync as N,readSync as yt,readFileSync as _t,writeFileSync as Rt}from"node:fs";import{join as It}from"node:path";import{appendFileSync as X,mkdirSync as Z}from"node:fs";import{dirname as Q}from"node:path";var x=[],_=!1,D=!1;function g(t,e){x.push({filePath:t,content:e}),Y()}function R(){if(_||x.length===0)return;_=!0;let t=new Map;for(let e of x){let n=t.get(e.filePath);n?n.push(e.content):t.set(e.filePath,[e.content])}for(let[e,n]of t)try{Z(Q(e),{recursive:!0}),X(e,n.join(""))}catch{}x.length=0,_=!1}function Y(){D||(D=!0,process.on("exit",R),process.on("SIGTERM",()=>{R(),process.exit(0)}),process.on("SIGINT",()=>{R(),process.exit(0)}))}import{execSync as Ct}from"node:child_process";import tt from"node:os";import E from"node:path";function et(){return process.env.HOME||process.env.USERPROFILE||tt.homedir()}function I(){return process.env.CLAUDE_PROJECT_DIR||"."}function O(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function v(){return process.env.CLAUDE_PLUGIN_ROOT?E.join(et(),".claude","logs","ork"):E.join(I(),".claude","logs")}var ne=E.join,oe=E.sep;import{execSync as nt}from"node:child_process";import{createHash as ot}from"node:crypto";import{existsSync as w,readFileSync as rt,writeFileSync as st,mkdirSync as it}from"node:fs";import{join as C,basename as ut}from"node:path";var ct=20,at=15,pt=/[^a-z0-9-]/g;function lt(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=ut(e);return P(n,ct)}function dt(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=nt("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=P(n||"detached",at);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function gt(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function ft(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function mt(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return ot("sha256").update(t).digest("hex").slice(0,4)}function P(t,e){return t.toLowerCase().replace(pt,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function ht(t,e){let n=lt(t),o=dt(t),r=gt(e),i=ft(e),c=mt();return`${n}-${o}-${r}-${i}-${c}`}function kt(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=C(e,".instance","session-id.json");if(w(n))try{let o=JSON.parse(rt(n,"utf8"));if(o.session_id&&o.created_at){let r=Date.now()-new Date(o.created_at).getTime(),i=1440*60*1e3;if(r<i)return o.session_id}}catch{}}function xt(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=C(n,".instance"),r=C(o,"session-id.json");try{w(o)||it(o,{recursive:!0}),st(r,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function A(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=kt(t);if(e)return e;let n=ht(t);return xt(n,t),n}function $(){return v()}function b(){return I()}function bt(){return O()}function he(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${bt()}/.claude/.instance_env`}function f(){return A()}function ke(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=Ct("git branch --show-current",{cwd:t||b(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function Tt(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function xe(t){return t.replace(/\r\n/g,`
`)}function Ht(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(Tt())}function s(){return{continue:!0,suppressOutput:!0}}function Ee(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function Se(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function m(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function Dt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function ye(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function _e(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function Re(t){return{continue:!0,systemMessage:t}}function Ie(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function Ce(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function u(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function be(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var Ot=200*1024,vt=100*1024;function F(t,e){if(S(t))try{if(Et(t).size>e){let o=`${t}.old.${Date.now()}`;St(t,o)}}catch{}}function M(t){S(t)||N(t,{recursive:!0})}function p(t,e,n="debug"){if(!Ht(n))return;let o=$(),r=`${o}/hooks.log`;try{M(o),F(r,Ot);let i=new Date().toISOString().replace("T"," ").slice(0,19);g(r,`[${i}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function y(t,e,n){let o=$(),r=`${o}/permission-feedback.log`;try{M(o),F(r,vt);let i=new Date().toISOString(),c=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=n?.session_id||f();g(r,`${i} | ${t} | ${e} | tool=${c} | session=${a}
`)}catch{}}function Te(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function wt(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function He(t,e,n,o,r){let i=wt(t);return o?.isOverBudget(n)?(p(e,`Budget exhausted for ${n}, suppressing ${i}t`),s()):(r&&r.trackTokenUsage(e,n,i),Dt(t))}function L(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e=Math.imul(e,16777619);return(e>>>0).toString(16).padStart(8,"0")}function De(t,e,n,o){let r=It(t,e);if(S(r))try{let i=_t(r,"utf8");if(L(i)===L(n))return p(o,`Rules file ${e} unchanged, skipping write`),!1}catch{}return S(t)||N(t,{recursive:!0}),Rt(r,n,"utf8"),p(o,`Wrote rules file: ${r}`),!0}function Oe(){try{let t=[],n=Buffer.allocUnsafe(256),o,r=0;for(;;)try{if(o=yt(r,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:f(),tool_input:{}}}catch{return{tool_name:"",session_id:f(),tool_input:{}}}}function ve(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let r of n){if(o==null)return;o=o[r]}return o}function we(t,...e){return t.split(`
`).some(n=>e.every(o=>n.includes(o)))}function h(t,...e){return t.split(`
`).some(n=>{let o=n.toLowerCase();return e.every(r=>o.includes(r.toLowerCase()))})}function Pe(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function Ae(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function U(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function Pt(t,e){let n=t.split("*"),o=0;for(let r of n){if(r==="")continue;let i=r;if(i.indexOf("?")>=0){let a=!1;for(let k=o;k<=e.length-i.length;k++){let H=!0;for(let d=0;d<i.length;d++)if(i[d]!=="?"&&i[d]!==e[k+d]){H=!1;break}if(H){o=k+i.length,a=!0;break}}if(!a)return!1}else{let a=e.indexOf(i,o);if(a===-1)return!1;o=a+i.length}}return!0}function Me(t){return e=>t(e)?null:s()}function T(t,...e){let n=t.tool_input.file_path;if(!n)return s();let o=n.split(".").pop()?.toLowerCase()||"";return e.map(i=>i.toLowerCase().replace(/^\./,"")).includes(o)?null:s()}function Ue(t){return T(t,"py","ts","tsx","js","jsx","go","rs","java")}function je(t){return T(t,"py")}function Be(t){return T(t,"ts","tsx","js","jsx")}function Ge(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(o=>o.test(e))?null:s():s()}function We(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(o=>o.test(e))?s():null}function ze(t,...e){let n=t.tool_input.file_path;if(!n)return s();for(let o of e)if(typeof o=="string"){if(Pt(o,n))return null}else if(o.test(n))return null;return s()}function j(t,...e){let n=t.tool_name;return n?e.includes(n)?null:s():s()}function Ke(t){return j(t,"Write","Edit")}function Je(t){return j(t,"Bash")}function qe(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(o=>o.test(e))?s():null}function Ve(t){return(t.tool_input.command||"").startsWith("git")?null:s()}function Xe(t){if(U())return s();let n=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:o}=V("node:fs");if(o(n))return null}catch{}return s()}function Ze(t,...e){for(let n of e){let o=n(t);if(o!==null)return o}return null}function Qe(t){return t.permissionMode==="dontAsk"}function B(t){let e=t.tool_name,n=process.env.CLAUDE_AGENT_ID||"unknown";return["Write","Edit","MultiEdit","NotebookEdit"].includes(e)?u(`BLOCKED: Agent '${n}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`):s()}function At(t){return t.replace(/\\x([0-9a-fA-F]{2})/g,(e,n)=>String.fromCharCode(parseInt(n,16)))}function Lt(t){return t.replace(/\\([0-7]{3})/g,(e,n)=>String.fromCharCode(parseInt(n,8)))}function Nt(t){return t.replace(/\\([^\s])/g,"$1")}function $t(t){let e=t;return e=e.replace(/"([^"]*)"/g,"$1"),e=e.replace(/'([^']*)'/g,"$1"),e}function l(t){let e=t;return e=At(e),e=Lt(e),e=Nt(e),e=$t(e),e=e.replace(/\\\s*[\r\n]+/g," "),e=e.replace(/\n/g," "),e=e.replace(/\s+/g," "),e.trim()}var Ft=["git status","git log","git diff","git branch","git show","git fetch","git remote","git tag","git rev-parse","git describe","git ls-files","git blame","npm run test","npm run lint","npm test","npm run typecheck","gh issue list","gh issue view","gh issue comment","gh pr list","gh pr view","gh pr checks","gh pr diff","gh api","ls","cat","head","tail","wc","grep","rg","find","fd","jq","yq","docker ps","docker images","docker logs","docker inspect","pwd","date","echo","which","env","printenv","node -e","node --eval","python -c","python3 -c"],Mt=["&&","||","|",";"];function Ut(t){return Mt.some(e=>t.includes(e))}function G(t){let e=t.tool_input.command||"",n=process.env.CLAUDE_AGENT_ID||"unknown";if(!e.trim())return s();if(Ut(e))return y("deny",`Compound command blocked for read-only agent ${n}`,t),p("restrict-bash",`BLOCKED compound: ${e.substring(0,80)}`),u(`BLOCKED: Compound commands (&&, ||, |, ;) are not permitted for read-only agents.

Agent '${n}' has restricted Bash access. Run commands individually.`);let o=l(e).trim(),r=o.toLowerCase();return Ft.some(c=>r.startsWith(c))?(y("allow",`Allowed command for ${n}: ${o.substring(0,60)}`,t),s()):(y("deny",`Command not in allowlist for ${n}: ${e.substring(0,60)}`,t),p("restrict-bash",`BLOCKED: ${e.substring(0,80)}`),u(`BLOCKED: Command not permitted for read-only agent '${n}'.

Only read-only commands are allowed: git (status/log/diff/show), npm test/lint,
gh issue/pr list/view, ls, cat, head, tail, grep, rg, find, jq, docker inspect.

This agent investigates and reports \u2014 it does not modify the system.`))}var jt=[{test:t=>h(t,"force","push"),source:"force push"},{test:t=>h(t,"push","--force"),source:"push --force"},{test:t=>t.includes("--force-with-lease"),source:"--force-with-lease"},{test:t=>t.toLowerCase().includes("workflow_dispatch"),source:"workflow_dispatch"},{test:t=>h(t,"delete","workflow"),source:"delete workflow"},{test:t=>/gh\s+secret\s+delete/i.test(t),source:"gh secret delete"},{test:t=>/gh\s+variable\s+delete/i.test(t),source:"gh variable delete"},{test:t=>h(t,"rm","-rf",".github"),source:"rm -rf .github"}];function W(t){let e=t.tool_input.command||"",n=e?l(e):"";for(let o of jt)if(o.test(n))return u(`BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${o.source}'. This requires explicit user approval.`);return/deploy|release|publish/i.test(n)?m("CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place."):s()}var Bt=[{test:t=>/\bprod\b/i.test(t),source:"prod"},{test:t=>/production/i.test(t),source:"production"},{test:t=>t.includes("--env")&&/prod/i.test(t),source:"--env.*prod"},{test:t=>t.includes("ENV=prod"),source:"ENV=prod"},{test:t=>t.includes("ENVIRONMENT=prod"),source:"ENVIRONMENT=prod"},{test:t=>t.toLowerCase().includes("deploy")&&t.toLowerCase().includes("main"),source:"deploy.*main"},{test:t=>t.toLowerCase().includes("deploy")&&t.toLowerCase().includes("master"),source:"deploy.*master"}];function z(t){let e=t.tool_input.command||"";for(let n of Bt)if(n.test(e))return u(`BLOCKED: Production deployment detected. Pattern: '${n.source}'. Production deployments require explicit user approval and should go through proper release processes.`);return/rollback|revert|downgrade/i.test(e)?m("Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed."):/terraform|kubectl|helm/i.test(e)||e.toLowerCase().includes("docker")&&e.toLowerCase().includes("push")?m("Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment."):s()}var Gt=[{test:t=>/DROP\s+TABLE/i.test(t),source:"DROP TABLE"},{test:t=>/DROP\s+DATABASE/i.test(t),source:"DROP DATABASE"},{test:t=>/TRUNCATE/i.test(t),source:"TRUNCATE"},{test:t=>/DELETE\s+FROM/i.test(t)&&/WHERE\s+1/i.test(t),source:"DELETE FROM...WHERE 1"},{test:t=>/DELETE\s+FROM/i.test(t)&&!/WHERE/i.test(t),source:"DELETE FROM (no WHERE)"},{test:t=>t.includes("--force"),source:"--force"},{test:t=>/alembic\s+downgrade/i.test(t),source:"alembic downgrade"}];function K(t){if(t.tool_name!=="Bash")return s();let n=t.tool_input.command||"",o=n?l(n):"";for(let r of Gt)if(r.test(o))return u(`BLOCKED: Potentially destructive database command detected. Pattern: '${r.source}'. Please confirm this operation is intentional before proceeding.`);return s()}import{mkdirSync as Wt}from"node:fs";function J(t){let e=process.env.CLAUDE_AGENT_ID||"unknown",n=t.tool_name,o=t.session_id||f(),r=t.project_dir||b(),i=`${r}/.claude/logs/security-audit.log`;if(n!=="Bash")return s();let c=t.tool_input.command||"",a=new Date().toISOString();if(c)try{Wt(`${r}/.claude/logs`,{recursive:!0}),g(i,`[${a}] [${o}] [${e}] CMD: ${c}
`)}catch{}return s()}var q={"agent/block-writes":B,"agent/restrict-bash":G,"agent/ci-safety-check":W,"agent/deployment-safety-check":z,"agent/migration-safety-check":K,"agent/security-command-audit":J};function Cn(t){return q[t]}function bn(){return Object.keys(q)}export{Me as createGuard,Ae as escapeRegex,wt as estimateTokenCount,Te as extractContext,L as fnv1aHash,ke as getCachedBranch,he as getEnvFile,ve as getField,Cn as getHook,$ as getLogDir,Tt as getLogLevel,bt as getPluginRoot,b as getProjectDir,f as getSessionId,Je as guardBash,Ue as guardCodeFiles,T as guardFileExtension,Ve as guardGitCommand,Xe as guardMultiInstance,qe as guardNontrivialBash,ze as guardPathPattern,je as guardPythonFiles,We as guardSkipInternal,Ge as guardTestFiles,j as guardTool,Be as guardTypescriptFiles,Ke as guardWriteEdit,q as hooks,Kt as isBashInput,Qe as isDontAskMode,qt as isEditInput,Vt as isReadInput,Jt as isWriteInput,we as lineContainsAll,h as lineContainsAllCI,bn as listHooks,p as logHook,y as logPermissionFeedback,Pe as normalizeCommand,xe as normalizeLineEndings,_e as outputAllowWithContext,Se as outputBlock,u as outputDeny,Re as outputError,Dt as outputPromptContext,He as outputPromptContextBudgeted,Ee as outputSilentAllow,s as outputSilentSuccess,Ce as outputStderrWarning,Ie as outputWarning,m as outputWithContext,ye as outputWithNotification,be as outputWithUpdatedInput,Oe as readHookInput,Ze as runGuards,Ht as shouldLog,De as writeRulesFile};
//# sourceMappingURL=agent.mjs.map
