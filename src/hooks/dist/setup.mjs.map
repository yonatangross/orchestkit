{
  "version": 3,
  "sources": ["../src/types.ts", "../src/lib/common.ts", "../src/lib/analytics-buffer.ts", "../src/lib/paths.ts", "../src/lib/session-id-generator.ts", "../src/lifecycle/dependency-version-check.ts", "../src/setup/unified-dispatcher.ts", "../src/setup/first-run-setup.ts", "../src/setup/monorepo-detector.ts", "../src/setup/setup-check.ts", "../src/setup/setup-maintenance.ts", "../src/lib/agent-teams.ts", "../src/setup/setup-repair.ts", "../src/setup/sync-setup-dispatcher.ts", "../src/entries/setup.ts"],
  "sourcesContent": ["/**\n * TypeScript type definitions for Claude Code hooks\n * CC 2.1.9 compliant with additionalContext support\n */\n\n/**\n * Hook events supported by Claude Code\n */\nexport type HookEvent =\n  | 'PreToolUse'\n  | 'PostToolUse'\n  | 'PostToolUseFailure'\n  | 'PermissionRequest'\n  | 'UserPromptSubmit'\n  | 'SessionStart'\n  | 'SessionEnd'\n  | 'Stop'\n  | 'SubagentStart'\n  | 'SubagentStop'\n  | 'Setup'\n  | 'Notification'\n  | 'PreCompact'\n  | 'TeammateIdle'\n  | 'TaskCompleted'\n  | 'WorktreeCreate'\n  | 'WorktreeRemove'\n  | 'ConfigChange';\n\n/**\n * Hook input envelope from Claude Code (sent via stdin as JSON)\n */\nexport interface HookInput {\n  /** The hook event type */\n  hook_event?: HookEvent;\n  /** The tool being invoked */\n  tool_name: string;\n  /** Session ID (CC 2.1.9 guarantees availability) */\n  session_id: string;\n  /** Tool-specific input parameters */\n  tool_input: ToolInput;\n  /** Tool output (PostToolUse only) */\n  tool_output?: unknown;\n  /** Tool error message if any */\n  tool_error?: string;\n  /** Tool exit code */\n  exit_code?: number;\n  /** Whether a stop hook is currently active (prevents re-entry) */\n  stop_hook_active?: boolean;\n  /** Permission mode (CC 2.1.25: dontAsk mode makes quality gates warn-only) */\n  permissionMode?: 'default' | 'acceptEdits' | 'dontAsk';\n  /** User prompt (UserPromptSubmit only) */\n  prompt?: string;\n  /** Project directory */\n  project_dir?: string;\n\n  // SubagentStart/SubagentStop specific fields\n  /** Agent type for subagent hooks */\n  subagent_type?: string;\n  /** Agent type (alternative field name) */\n  agent_type?: string;\n  /** Agent ID */\n  agent_id?: string;\n  /** Agent output (SubagentStop) */\n  agent_output?: string;\n  /** Output (alternative field name) */\n  output?: string;\n  /** Error from subagent */\n  error?: string;\n  /** Duration in milliseconds */\n  duration_ms?: number;\n  /** Tool result \u2014 string from most hooks, object from Skill PostToolUse */\n  tool_result?: string | { is_error?: boolean; content?: string };\n\n  // TeammateIdle specific fields (CC 2.1.33)\n  /** Teammate agent ID */\n  teammate_id?: string;\n  /** Teammate agent type */\n  teammate_type?: string;\n  /** How long the teammate has been idle (ms) */\n  idle_duration_ms?: number;\n\n  // TaskCompleted specific fields (CC 2.1.33)\n  /** Completed task ID */\n  task_id?: string;\n  /** Task subject */\n  task_subject?: string;\n  /** Task result status */\n  task_status?: string;\n  /** Token count consumed by the task (CC 2.1.30) */\n  token_count?: number;\n  /** Number of tool invocations in the task (CC 2.1.30) */\n  tool_uses?: number;\n\n  // Notification specific fields\n  /** Notification message */\n  message?: string;\n  /** Notification type */\n  notification_type?: string;\n\n  // Stop/SubagentStop specific fields (CC 2.1.47)\n  /** The final assistant message text (Stop and SubagentStop, CC 2.1.47+) */\n  last_assistant_message?: string;\n\n  // Workspace/statusline fields (CC 2.1.47)\n  /** Directories added via /add-dir, from statusline workspace section (CC 2.1.47+) */\n  added_dirs?: string[];\n}\n\n/**\n * Tool input types - union of all tool inputs\n */\nexport interface ToolInput {\n  /** Bash command (Bash tool) */\n  command?: string;\n  /** Timeout in ms (Bash tool) */\n  timeout?: number;\n  /** File path (Write/Edit/Read tools) */\n  file_path?: string;\n  /** File content (Write tool) */\n  content?: string;\n  /** Old text to replace (Edit tool) */\n  old_string?: string;\n  /** New text (Edit tool) */\n  new_string?: string;\n  /** Pattern (Glob/Grep tools) */\n  pattern?: string;\n  /** Allow additional properties */\n  [key: string]: unknown;\n}\n\n/**\n * Hook-specific output for CC 2.1.9\n */\nexport interface HookSpecificOutput {\n  /** Hook event name for context */\n  hookEventName?: 'PreToolUse' | 'PostToolUse' | 'PostToolUseFailure' | 'PermissionRequest' | 'UserPromptSubmit';\n  /** Permission decision (PermissionRequest hooks) */\n  permissionDecision?: 'allow' | 'deny';\n  /** Reason for permission decision */\n  permissionDecisionReason?: string;\n  /** Additional context injected before tool execution (CC 2.1.9) */\n  additionalContext?: string;\n  /** Modified tool input (CC 2.1.25: canonical way to modify tool inputs) */\n  updatedInput?: Record<string, unknown>;\n}\n\n/**\n * Hook result - output JSON to stdout\n * CC 2.1.7+ compliant\n */\nexport interface HookResult {\n  /** Whether to continue execution */\n  continue: boolean;\n  /** Suppress hook output from user */\n  suppressOutput?: boolean;\n  /** System message shown to user */\n  systemMessage?: string;\n  /** Reason for stopping (when continue is false) */\n  stopReason?: string;\n  /** Hook-specific output fields */\n  hookSpecificOutput?: HookSpecificOutput;\n}\n\n/**\n * Hook function signature\n */\nexport type HookFn = (input: HookInput) => Promise<HookResult> | HookResult;\n\n/**\n * Hook metadata for auto-discovery and governance\n * Co-export alongside hook functions for single-source-of-truth registration\n */\nexport interface HookMeta {\n  /** Full hook name path (e.g., 'pretool/bash/dangerous-command-blocker') */\n  name: string;\n  /** Human-readable description */\n  description: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher patterns for hooks.json (e.g., 'Bash', 'Write|Edit') */\n  matchers?: string[];\n  /** Run asynchronously (non-blocking) */\n  async?: boolean;\n  /** Only run once per session */\n  once?: boolean;\n  /** Timeout in seconds (async hooks only) */\n  timeout?: number;\n  /** Risk category for prioritization */\n  tier?: 'security-critical' | 'data-loss' | 'quality-gate' | 'standard';\n}\n\n/**\n * Hook overrides configuration for per-project toggle/customization\n * Stored at .claude/hook-overrides.json (gitignored)\n */\nexport interface HookOverrides {\n  /** Hook names to disable entirely */\n  disabled?: string[];\n  /** Per-hook timeout overrides (seconds) */\n  timeouts?: Record<string, number>;\n}\n\n/**\n * Hook registration entry\n */\nexport interface HookRegistration {\n  /** Hook name (e.g., 'permission/auto-approve-readonly') */\n  name: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher (string pattern or regex) */\n  matcher?: string | RegExp;\n  /** Hook implementation function */\n  fn: HookFn;\n}\n\n/**\n * Bash tool input (type guard helper)\n */\nexport interface BashToolInput extends ToolInput {\n  command: string;\n  timeout?: number;\n}\n\n/**\n * Write tool input (type guard helper)\n */\nexport interface WriteToolInput extends ToolInput {\n  file_path: string;\n  content: string;\n}\n\n/**\n * Edit tool input (type guard helper)\n */\nexport interface EditToolInput extends ToolInput {\n  file_path: string;\n  old_string: string;\n  new_string: string;\n}\n\n/**\n * Read tool input (type guard helper)\n */\nexport interface ReadToolInput extends ToolInput {\n  file_path: string;\n  offset?: number;\n  limit?: number;\n}\n\n/**\n * Type guards for tool inputs\n */\nexport function isBashInput(input: ToolInput): input is BashToolInput {\n  return typeof input.command === 'string';\n}\n\nexport function isWriteInput(input: ToolInput): input is WriteToolInput {\n  return typeof input.file_path === 'string' && typeof input.content === 'string';\n}\n\nexport function isEditInput(input: ToolInput): input is EditToolInput {\n  return (\n    typeof input.file_path === 'string' &&\n    typeof input.old_string === 'string' &&\n    typeof input.new_string === 'string'\n  );\n}\n\nexport function isReadInput(input: ToolInput): input is ReadToolInput {\n  return typeof input.file_path === 'string' && input.content === undefined;\n}\n", "/**\n * Common utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh\n */\n\nimport { existsSync, statSync, renameSync, mkdirSync, readSync } from 'node:fs';\nimport { bufferWrite } from './analytics-buffer.js';\nimport { execSync } from 'node:child_process';\nimport type { HookResult, HookInput } from '../types.js';\nimport {\n  getLogDir as getLogDirFromPaths,\n  getProjectDir as getProjectDirFromPaths,\n  getPluginRoot as getPluginRootFromPaths,\n} from './paths.js';\nimport { getOrGenerateSessionId } from './session-id-generator.js';\n\n// -----------------------------------------------------------------------------\n// Environment and Paths\n// All functions read env vars dynamically to support testing\n// Re-export from paths.ts for cross-platform compatibility\n// -----------------------------------------------------------------------------\n\n/**\n * Get the log directory path (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getLogDir(): string {\n  return getLogDirFromPaths();\n}\n\n/**\n * Get the project directory (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getProjectDir(): string {\n  return getProjectDirFromPaths();\n}\n\n/**\n * Get the plugin root directory (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getPluginRoot(): string {\n  return getPluginRootFromPaths();\n}\n\n/**\n * Get the environment file path (CC 2.1.25: CLAUDE_ENV_FILE support)\n * Falls back to .instance_env for backward compatibility\n */\nexport function getEnvFile(): string {\n  if (process.env.CLAUDE_ENV_FILE) {\n    return process.env.CLAUDE_ENV_FILE;\n  }\n  // Fallback to legacy .instance_env\n  const pluginRoot = getPluginRoot();\n  return `${pluginRoot}/.claude/.instance_env`;\n}\n\n/**\n * Get the session ID\n *\n * Resolution order:\n * 1. CLAUDE_SESSION_ID env var (from CC runtime - preferred)\n * 2. Cached session ID (from .instance/session-id.json)\n * 3. Generate smart session ID: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n *\n * Example smart ID: \"orchestkit-main-0130-1745-a3f2\"\n *\n * The old fallback format \"fallback-{pid}-{timestamp}\" was confusing and unhelpful.\n * Smart IDs are human-readable, showing project, branch, and time context.\n */\nexport function getSessionId(): string {\n  return getOrGenerateSessionId();\n}\n\n/**\n * Get cached git branch (set at session start or first call)\n * Caches result in process.env to avoid repeated execSync calls\n */\nexport function getCachedBranch(projectDir?: string): string {\n  if (process.env.ORCHESTKIT_BRANCH) {\n    return process.env.ORCHESTKIT_BRANCH;\n  }\n\n  try {\n    const branch = execSync('git branch --show-current', {\n      cwd: projectDir || getProjectDir(),\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n    process.env.ORCHESTKIT_BRANCH = branch;\n    return branch;\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Get log level (debug|info|warn|error, default: warn)\n */\nexport function getLogLevel(): string {\n  return process.env.ORCHESTKIT_LOG_LEVEL || 'warn';\n}\n\n/**\n * Normalize line endings from CRLF to LF for cross-platform compatibility.\n * Windows uses \\r\\n (CRLF) while Unix uses \\n (LF).\n * This is critical for parsing YAML frontmatter where we match '---' exactly.\n */\nexport function normalizeLineEndings(content: string): string {\n  return content.replace(/\\r\\n/g, '\\n');\n}\n\n/**\n * Check if should log at given level\n */\nexport function shouldLog(level: 'debug' | 'info' | 'warn' | 'error'): boolean {\n  const levels = ['debug', 'info', 'warn', 'error'];\n  return levels.indexOf(level) >= levels.indexOf(getLogLevel());\n}\n\n// -----------------------------------------------------------------------------\n// Output Helpers (CC 2.1.7+ compliant)\n// -----------------------------------------------------------------------------\n\n/**\n * Output silent success - hook completed without errors, no user-visible output\n */\nexport function outputSilentSuccess(): HookResult {\n  return { continue: true, suppressOutput: true };\n}\n\n/**\n * Output silent allow - permission hook approves silently\n */\nexport function outputSilentAllow(): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: { permissionDecision: 'allow' },\n  };\n}\n\n/**\n * Output block - stops the operation with an error\n */\nexport function outputBlock(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with additionalContext - injects context before tool execution (CC 2.1.9)\n * For PostToolUse hooks (hookEventName optional)\n */\nexport function outputWithContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PostToolUse',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with additionalContext for UserPromptSubmit hooks (CC 2.1.9)\n * hookEventName is REQUIRED for UserPromptSubmit\n */\nexport function outputPromptContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with user notification + Claude context (CC 2.1.9+)\n * Issue #278: Dual-channel output for three-tier UX\n *\n * @param userMessage - Brief message shown to user via systemMessage (optional)\n * @param claudeContext - Full context for Claude via additionalContext (optional)\n * @returns HookResult with appropriate channels set\n *\n * Usage:\n * - Both set: User sees notification, Claude gets context\n * - Only claudeContext: Silent injection (Claude-only)\n * - Only userMessage: User notification without context\n */\nexport function outputWithNotification(\n  userMessage: string | undefined,\n  claudeContext: string | undefined\n): HookResult {\n  const result: HookResult = {\n    continue: true,\n    suppressOutput: true,\n  };\n\n  if (userMessage) {\n    result.systemMessage = userMessage;\n  }\n\n  if (claudeContext) {\n    result.hookSpecificOutput = {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: claudeContext,\n    };\n  }\n\n  return result;\n}\n\n/**\n * Output allow with additionalContext - permission hook approves with context (CC 2.1.9)\n */\nexport function outputAllowWithContext(ctx: string, systemMessage?: string): HookResult {\n  const result: HookResult = {\n    continue: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      additionalContext: ctx,\n      permissionDecision: 'allow',\n    },\n  };\n\n  if (systemMessage) {\n    result.systemMessage = systemMessage;\n  } else {\n    result.suppressOutput = true;\n  }\n\n  return result;\n}\n\n/**\n * Output error message - only use when there's an actual problem\n */\nexport function outputError(message: string): HookResult {\n  return { continue: true, systemMessage: message };\n}\n\n/**\n * Output warning message via JSON stdout \u2014 visible to both user and Claude (CC 2.1.7+).\n * Use this when Claude needs to see and act on the warning (e.g., cost advice, quality gates).\n * For user-only warnings where Claude should NOT see the message, use outputStderrWarning.\n */\nexport function outputWarning(message: string): HookResult {\n  return { continue: true, systemMessage: `\\u26a0 ${message}` };\n}\n\n/**\n * Output warning via stderr + exit(2) \u2014 visible to user only, Claude does NOT see it (CC 2.1.39).\n * Use this for informational warnings that should not influence Claude's behavior\n * (e.g., deprecation notices, non-actionable advisories).\n *\n * IMPORTANT: This function calls process.exit(2) and never returns.\n * Do NOT use inside unified dispatchers \u2014 it will crash the dispatcher process.\n * Only use in standalone hook entry points.\n */\nexport function outputStderrWarning(message: string): never {\n  process.stderr.write(`\\u26a0 ${message}\\n`);\n  process.exit(2);\n}\n\n/**\n * Output deny with feedback logging (CC 2.1.7)\n */\nexport function outputDeny(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with updatedInput - modifies tool input before execution (CC 2.1.25)\n * Canonical way to modify tool inputs from PreToolUse hooks\n */\nexport function outputWithUpdatedInput(updatedInput: Record<string, unknown>): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      updatedInput,\n    },\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Logging (with log level guard for performance)\n// -----------------------------------------------------------------------------\n\nconst LOG_ROTATION_MAX_SIZE = 200 * 1024; // 200KB\nconst PERMISSION_LOG_MAX_SIZE = 100 * 1024; // 100KB\n\n/**\n * Rotate log file if it exceeds size limit\n */\nfunction rotateLogFile(logFile: string, maxSize: number): void {\n  if (!existsSync(logFile)) return;\n\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > maxSize) {\n      const rotated = `${logFile}.old.${Date.now()}`;\n      renameSync(logFile, rotated);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n}\n\n/**\n * Log to hook log file with automatic rotation\n * Respects ORCHESTKIT_LOG_LEVEL (default: warn, skips debug logs in production)\n */\nexport function logHook(hookName: string, message: string, level: 'debug' | 'info' | 'warn' | 'error' = 'debug'): void {\n  // Skip if below log level threshold (big perf win - avoids I/O)\n  if (!shouldLog(level)) {\n    return;\n  }\n\n  const logDir = getLogDir();\n  const logFile = `${logDir}/hooks.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, LOG_ROTATION_MAX_SIZE);\n\n    const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n    bufferWrite(logFile, `[${timestamp}] [${level.toUpperCase()}] [${hookName}] ${message}\\n`);\n  } catch {\n    // Ignore logging errors - don't block hook execution\n  }\n}\n\n/**\n * Log permission decision for audit trail (CC 2.1.7 feature)\n * Always logs (security audit trail) - not affected by log level\n */\nexport function logPermissionFeedback(\n  decision: 'allow' | 'deny' | 'warn',\n  reason: string,\n  input?: HookInput | Record<string, unknown>\n): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/permission-feedback.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, PERMISSION_LOG_MAX_SIZE);\n\n    const timestamp = new Date().toISOString();\n    const toolName = (input as HookInput)?.tool_name || process.env.HOOK_TOOL_NAME || 'unknown';\n    const sessionId = (input as HookInput)?.session_id || getSessionId();\n\n    bufferWrite(\n      logFile,\n      `${timestamp} | ${decision} | ${reason} | tool=${toolName} | session=${sessionId}\\n`\n    );\n  } catch {\n    // Ignore logging errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Context Extraction (shared by all sync dispatchers)\n// -----------------------------------------------------------------------------\n\n/**\n * Extract additionalContext from a hook result.\n * Handles both the correct hookSpecificOutput.additionalContext format\n * and the legacy bare systemMessage format.\n *\n * Issue #682: Deduplicated from 5 dispatchers into shared utility.\n */\nexport function extractContext(result: HookResult): string | null {\n  // Standard format: hookSpecificOutput.additionalContext\n  if (result.hookSpecificOutput?.additionalContext) {\n    return result.hookSpecificOutput.additionalContext as string;\n  }\n\n  // Legacy format: bare systemMessage (antipattern-detector bug)\n  if (result.systemMessage && typeof result.systemMessage === 'string') {\n    return result.systemMessage;\n  }\n\n  return null;\n}\n\n// -----------------------------------------------------------------------------\n// Token Estimation\n// -----------------------------------------------------------------------------\n\n/**\n * Content-aware token estimation (~80% accuracy without external tokenizer).\n * Code-heavy content averages ~2.8 chars/token; prose ~3.5 chars/token.\n */\nexport function estimateTokenCount(content: string): number {\n  if (!content) return 0;\n  const codeIndicators = (content.match(/[{};()=><]/g) || []).length;\n  const codeRatio = codeIndicators / content.length;\n  const charsPerToken = codeRatio > 0.03 ? 2.8 : 3.5;\n  return Math.ceil(content.length / charsPerToken);\n}\n\n// -----------------------------------------------------------------------------\n// Budgeted Output Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Output prompt context with token budget awareness.\n * Checks if the category is over budget before injecting.\n * Falls back to silent success when budget exhausted.\n *\n * Accepts budget checker and tracker as parameters to avoid circular deps.\n * If not provided, falls back to unchecked injection.\n */\nexport function outputPromptContextBudgeted(\n  ctx: string,\n  hookName: string,\n  category: string,\n  budgetChecker?: { isOverBudget: (cat: string) => boolean },\n  tokenTracker?: { trackTokenUsage: (hook: string, cat: string, tokens: number) => void },\n): HookResult {\n  const tokens = estimateTokenCount(ctx);\n\n  if (budgetChecker?.isOverBudget(category)) {\n    logHook(hookName, `Budget exhausted for ${category}, suppressing ${tokens}t`);\n    return outputSilentSuccess();\n  }\n\n  if (tokenTracker) {\n    tokenTracker.trackTokenUsage(hookName, category, tokens);\n  }\n\n  return outputPromptContext(ctx);\n}\n\n// -----------------------------------------------------------------------------\n// Input Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Read hook input from stdin synchronously\n * Returns parsed JSON or empty object on failure\n */\nexport function readHookInput(): HookInput {\n  try {\n    // Read from stdin synchronously\n    const chunks: Buffer[] = [];\n    const BUFSIZE = 256;\n    const buf = Buffer.allocUnsafe(BUFSIZE);\n\n    let bytesRead: number;\n    const fd = 0; // stdin\n\n    while (true) {\n      try {\n        bytesRead = readSync(fd, buf, 0, BUFSIZE, null);\n        if (bytesRead === 0) break;\n        chunks.push(Buffer.from(buf.subarray(0, bytesRead)));\n      } catch {\n        break;\n      }\n    }\n\n    const input = Buffer.concat(chunks).toString('utf8').trim();\n    if (!input) {\n      return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n    }\n\n    return JSON.parse(input);\n  } catch {\n    return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n  }\n}\n\n/**\n * Get field from hook input using optional chaining\n */\nexport function getField<T>(input: HookInput, path: string): T | undefined {\n  const parts = path.replace(/^\\./, '').split('.');\n  let value: unknown = input;\n\n  for (const part of parts) {\n    if (value === null || value === undefined) return undefined;\n    value = (value as Record<string, unknown>)[part];\n  }\n\n  return value as T;\n}\n\n// -----------------------------------------------------------------------------\n// ReDoS-Safe String Matching\n// -----------------------------------------------------------------------------\n\n/**\n * Check if any single line contains all specified substrings (ReDoS-safe O(n)).\n * Use instead of polynomial regexes like /A.*B.*C/.test(content).\n */\nexport function lineContainsAll(content: string, ...terms: string[]): boolean {\n  return content.split('\\n').some(line => terms.every(t => line.includes(t)));\n}\n\n/**\n * Check if any single line contains all specified substrings (case-insensitive, ReDoS-safe O(n)).\n */\nexport function lineContainsAllCI(content: string, ...terms: string[]): boolean {\n  return content.split('\\n').some(line => {\n    const lower = line.toLowerCase();\n    return terms.every(t => lower.includes(t.toLowerCase()));\n  });\n}\n\n// -----------------------------------------------------------------------------\n// String Utilities\n// -----------------------------------------------------------------------------\n\n/**\n * Normalize command: remove line continuations and collapse whitespace\n * Prevents bypassing detection with backslash-newline tricks (CC 2.1.6 fix)\n */\nexport function normalizeCommand(command: string): string {\n  return command\n    .replace(/\\\\\\s*[\\r\\n]+/g, ' ') // Remove line continuations\n    .replace(/\\n/g, ' ') // Replace newlines with spaces\n    .replace(/\\s+/g, ' ') // Collapse whitespace\n    .trim();\n}\n\n/**\n * Escape string for use in regex\n */\nexport function escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-18\n\n/**\n * Analytics Write Buffer \u2014 Batches appendFileSync calls and flushes on exit\n *\n * Reduces per-hook I/O overhead by buffering analytics/metrics/log writes\n * and flushing them in a single batch per file path. Registered process\n * handlers ensure data is written before the process terminates.\n *\n * Issue #688: Buffer analytics writes and flush on process exit\n */\n\nimport { appendFileSync, mkdirSync } from 'node:fs';\nimport { dirname } from 'node:path';\n\ninterface BufferEntry {\n  filePath: string;\n  content: string;\n}\n\nconst buffer: BufferEntry[] = [];\nlet flushing = false;\nlet handlersRegistered = false;\n\n/**\n * Queue an analytics/log write for batched flushing.\n * Call this instead of appendFileSync for non-essential writes.\n */\nexport function bufferWrite(filePath: string, content: string): void {\n  buffer.push({ filePath, content });\n  ensureHandlers();\n}\n\n/**\n * Flush all buffered writes to disk immediately.\n * Groups entries by file path to minimize syscalls.\n */\nexport function flush(): void {\n  if (flushing || buffer.length === 0) return;\n  flushing = true;\n\n  // Group by filePath to write each file once\n  const grouped = new Map<string, string[]>();\n  for (const entry of buffer) {\n    const arr = grouped.get(entry.filePath);\n    if (arr) {\n      arr.push(entry.content);\n    } else {\n      grouped.set(entry.filePath, [entry.content]);\n    }\n  }\n\n  for (const [path, contents] of grouped) {\n    try {\n      mkdirSync(dirname(path), { recursive: true });\n      appendFileSync(path, contents.join(''));\n    } catch {\n      // Ignore flush errors \u2014 never block process exit\n    }\n  }\n\n  buffer.length = 0;\n  flushing = false;\n}\n\n/** Number of entries currently buffered (for testing) */\nexport function pendingCount(): number {\n  return buffer.length;\n}\n\n/** Clear buffer without writing (for testing) */\nexport function _resetForTesting(): void {\n  buffer.length = 0;\n  flushing = false;\n}\n\nfunction ensureHandlers(): void {\n  if (handlersRegistered) return;\n  handlersRegistered = true;\n\n  process.on('exit', flush);\n  process.on('SIGTERM', () => { flush(); process.exit(0); });\n  process.on('SIGINT', () => { flush(); process.exit(0); });\n}\n", "/**\n * Cross-platform path utilities for TypeScript hooks\n *\n * Provides consistent path handling across Windows, macOS, and Linux.\n * All path construction uses path.join() for correct separators.\n * All temp directories use os.tmpdir() for platform awareness.\n */\n\nimport os from 'node:os';\nimport path from 'node:path';\n\n/**\n * Get the user's home directory (cross-platform)\n * Prefers explicit env vars, falls back to os.homedir()\n */\nexport function getHomeDir(): string {\n  return process.env.HOME || process.env.USERPROFILE || os.homedir();\n}\n\n/**\n * Get the system temp directory (cross-platform)\n * Returns /tmp on Unix, C:\\Users\\X\\AppData\\Local\\Temp on Windows\n */\nexport function getTempDir(): string {\n  return os.tmpdir();\n}\n\n/**\n * Get the project directory from environment\n */\nexport function getProjectDir(): string {\n  return process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the plugin root directory from environment\n */\nexport function getPluginRoot(): string {\n  return process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the log directory path (cross-platform)\n * Uses path.join() for correct separators on all platforms\n */\nexport function getLogDir(): string {\n  if (process.env.CLAUDE_PLUGIN_ROOT) {\n    return path.join(getHomeDir(), '.claude', 'logs', 'ork');\n  }\n  return path.join(getProjectDir(), '.claude', 'logs');\n}\n\n/**\n * Get the memory directory path (cross-platform)\n */\nexport function getMemoryDir(): string {\n  return path.join(getProjectDir(), '.claude', 'memory');\n}\n\n/**\n * Get the coordination directory path (cross-platform)\n */\nexport function getCoordinationDir(): string {\n  return path.join(getProjectDir(), '.claude', 'coordination');\n}\n\n/**\n * Get the session metrics file path (cross-platform)\n * Uses CLAUDE_METRICS_FILE env var if set (for test isolation), otherwise temp dir.\n */\nexport function getMetricsFile(): string {\n  return process.env.CLAUDE_METRICS_FILE || path.join(getTempDir(), 'claude-session-metrics.json');\n}\n\n/**\n * Get the session error metrics file path (cross-platform)\n */\nexport function getSessionErrorsFile(): string {\n  return process.env.CLAUDE_SESSION_ERRORS_FILE || path.join(getTempDir(), 'claude-session-errors.json');\n}\n\n/**\n * Get the session temp directory for a given session ID (cross-platform)\n */\nexport function getSessionTempDir(sessionId: string): string {\n  return path.join(getTempDir(), `claude-session-${sessionId}`);\n}\n\n/**\n * Get the active todos file path (cross-platform)\n */\nexport function getActiveTodosFile(): string {\n  return path.join(getTempDir(), 'claude-active-todos.json');\n}\n\n/**\n * Get the context tracking state file path for a session (cross-platform)\n */\nexport function getContextTrackingFile(sessionId: string): string {\n  return path.join(getTempDir(), `claude-context-tracking-${sessionId}.json`);\n}\n\n/**\n * Get the read count temp file path (cross-platform)\n */\nexport function getReadCountFile(): string {\n  return path.join(getTempDir(), 'claude-read-count');\n}\n\n/**\n * Normalize a path for consistent comparison\n * Converts backslashes to forward slashes and removes trailing slashes\n */\nexport function normalizePath(p: string): string {\n  return path.normalize(p).replace(/\\\\/g, '/').replace(/\\/$/, '');\n}\n\n/**\n * Check if a path is absolute\n */\nexport function isAbsolutePath(p: string): boolean {\n  return path.isAbsolute(p);\n}\n\n/**\n * Join path segments (cross-platform)\n * Re-export for convenience\n */\nexport const joinPath = path.join;\n\n/**\n * Get path separator for current platform\n */\nexport const pathSeparator = path.sep;\n", "/**\n * Smart Session ID Generator\n * Generates human-readable session IDs when CLAUDE_SESSION_ID is not available.\n *\n * Format: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n * Example: \"orchestkit-main-0130-1745-a3f2\"\n *\n * Benefits:\n * - Human-readable at a glance\n * - Contains project context\n * - Contains branch info\n * - Chronologically sortable (date-time)\n * - Short unique suffix prevents collisions\n * - Valid file path characters only\n */\n\nimport { execSync } from 'node:child_process';\nimport { createHash } from 'node:crypto';\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join, basename } from 'node:path';\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\n/** Maximum length for project name component */\nconst MAX_PROJECT_LENGTH = 20;\n\n/** Maximum length for branch name component */\nconst MAX_BRANCH_LENGTH = 15;\n\n/** Characters allowed in session ID (safe for file paths) */\nconst SAFE_CHARS = /[^a-z0-9-]/g;\n\n// =============================================================================\n// SESSION ID GENERATION\n// =============================================================================\n\n/**\n * Get project name from directory path\n * Sanitizes to lowercase alphanumeric with dashes\n */\nexport function getProjectName(projectDir?: string): string {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const name = basename(dir);\n  return sanitizeName(name, MAX_PROJECT_LENGTH);\n}\n\n/**\n * Get git branch name (cached for performance)\n * Returns 'nobranch' if git is not available or not in a repo\n */\nexport function getGitBranchForSession(projectDir?: string): string {\n  // Check cache first\n  if (process.env.ORCHESTKIT_SESSION_BRANCH) {\n    return process.env.ORCHESTKIT_SESSION_BRANCH;\n  }\n\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n\n  try {\n    const branch = execSync('git branch --show-current', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 2000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n\n    const sanitized = sanitizeName(branch || 'detached', MAX_BRANCH_LENGTH);\n    process.env.ORCHESTKIT_SESSION_BRANCH = sanitized;\n    return sanitized;\n  } catch {\n    return 'nobranch';\n  }\n}\n\n/**\n * Format current date as MMDD\n */\nexport function formatDateComponent(date?: Date): string {\n  const d = date || new Date();\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${month}${day}`;\n}\n\n/**\n * Format current time as HHMM (24-hour)\n */\nexport function formatTimeComponent(date?: Date): string {\n  const d = date || new Date();\n  const hours = String(d.getHours()).padStart(2, '0');\n  const minutes = String(d.getMinutes()).padStart(2, '0');\n  return `${hours}${minutes}`;\n}\n\n/**\n * Generate short hash for uniqueness (4 hex chars)\n * Uses PID + timestamp + random for entropy\n */\nexport function generateShortHash(): string {\n  const entropy = `${process.pid}-${Date.now()}-${Math.random()}`;\n  return createHash('sha256')\n    .update(entropy)\n    .digest('hex')\n    .slice(0, 4);\n}\n\n/**\n * Sanitize a name for use in session ID\n * - Lowercase\n * - Replace non-alphanumeric with dashes\n * - Collapse multiple dashes\n * - Trim dashes from ends\n * - Truncate to max length\n */\nexport function sanitizeName(name: string, maxLength: number): string {\n  return name\n    .toLowerCase()\n    .replace(SAFE_CHARS, '-')\n    .replace(/-+/g, '-')\n    .replace(/^-|-$/g, '')\n    .slice(0, maxLength);\n}\n\n/**\n * Generate a smart session ID\n *\n * Format: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n * Example: \"orchestkit-main-0130-1745-a3f2\"\n *\n * @param projectDir - Optional project directory (defaults to env or cwd)\n * @param date - Optional date for testing (defaults to now)\n */\nexport function generateSmartSessionId(projectDir?: string, date?: Date): string {\n  const project = getProjectName(projectDir);\n  const branch = getGitBranchForSession(projectDir);\n  const dateStr = formatDateComponent(date);\n  const timeStr = formatTimeComponent(date);\n  const hash = generateShortHash();\n\n  return `${project}-${branch}-${dateStr}-${timeStr}-${hash}`;\n}\n\n// =============================================================================\n// SESSION ID CACHING\n// =============================================================================\n\n/**\n * Get cached session ID from .instance directory\n * Returns undefined if not cached\n */\nexport function getCachedSessionId(projectDir?: string): string | undefined {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const cachePath = join(dir, '.instance', 'session-id.json');\n\n  if (!existsSync(cachePath)) {\n    return undefined;\n  }\n\n  try {\n    const data = JSON.parse(readFileSync(cachePath, 'utf8'));\n    // Validate the cached ID hasn't expired (24 hours)\n    if (data.session_id && data.created_at) {\n      const age = Date.now() - new Date(data.created_at).getTime();\n      const maxAge = 24 * 60 * 60 * 1000; // 24 hours\n      if (age < maxAge) {\n        return data.session_id;\n      }\n    }\n  } catch {\n    // Ignore read/parse errors\n  }\n\n  return undefined;\n}\n\n/**\n * Cache session ID to .instance directory\n */\nexport function cacheSessionId(sessionId: string, projectDir?: string): void {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const instanceDir = join(dir, '.instance');\n  const cachePath = join(instanceDir, 'session-id.json');\n\n  try {\n    if (!existsSync(instanceDir)) {\n      mkdirSync(instanceDir, { recursive: true });\n    }\n\n    writeFileSync(cachePath, JSON.stringify({\n      session_id: sessionId,\n      created_at: new Date().toISOString(),\n    }, null, 2));\n  } catch {\n    // Ignore write errors - caching is optional\n  }\n}\n\n/**\n * Get or generate session ID with caching\n *\n * Priority:\n * 1. CLAUDE_SESSION_ID env var (from CC runtime)\n * 2. Cached session ID (from .instance/session-id.json)\n * 3. Generate new smart session ID (and cache it)\n */\nexport function getOrGenerateSessionId(projectDir?: string): string {\n  // 1. Try CLAUDE_SESSION_ID first (preferred)\n  if (process.env.CLAUDE_SESSION_ID) {\n    return process.env.CLAUDE_SESSION_ID;\n  }\n\n  // 2. Try cached session ID\n  const cached = getCachedSessionId(projectDir);\n  if (cached) {\n    return cached;\n  }\n\n  // 3. Generate new smart session ID\n  const newId = generateSmartSessionId(projectDir);\n  cacheSessionId(newId, projectDir);\n  return newId;\n}\n", "/**\n * Dependency Version Check - Check for outdated dependencies at session start\n * Hook: SessionStart (#136)\n * CC 2.1.7 Compliant\n * Optimized with timeout, caching, and fast-exit to prevent startup hangs\n *\n * Parses:\n * - package.json (Node.js)\n * - requirements.txt, pyproject.toml (Python)\n * - go.mod (Go)\n *\n * Warns about:\n * - Known security vulnerabilities (CVE database)\n * - Severely outdated packages\n * - Deprecated packages\n *\n * Uses additionalContext to inject warnings into session context\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\ninterface KnownVuln {\n  package: string;\n  pattern: string;\n  severity: string;\n  cve: string;\n  description: string;\n}\n\ninterface DependencyCache {\n  warnings: string;\n  timestamp: number;\n}\n\ninterface PackageJson {\n  dependencies?: Record<string, string>;\n  devDependencies?: Record<string, string>;\n}\n\n// Known vulnerabilities database (static for offline operation)\nconst KNOWN_VULNS: KnownVuln[] = [\n  { package: 'lodash', pattern: '<4.17.21', severity: 'high', cve: 'CVE-2021-23337', description: 'Prototype pollution' },\n  { package: 'minimist', pattern: '<1.2.6', severity: 'critical', cve: 'CVE-2021-44906', description: 'Prototype pollution' },\n  { package: 'node-fetch', pattern: '<2.6.7', severity: 'high', cve: 'CVE-2022-0235', description: 'Information exposure' },\n  { package: 'axios', pattern: '<0.21.2', severity: 'high', cve: 'CVE-2021-3749', description: 'ReDoS vulnerability' },\n  { package: 'jsonwebtoken', pattern: '<9.0.0', severity: 'critical', cve: 'CVE-2022-23529', description: 'Insecure token verification' },\n  { package: 'express', pattern: '<4.17.3', severity: 'medium', cve: 'CVE-2022-24999', description: 'Open redirect' },\n  { package: 'tar', pattern: '<6.1.11', severity: 'critical', cve: 'CVE-2021-37701', description: 'Arbitrary file overwrite' },\n  { package: 'path-parse', pattern: '<1.0.7', severity: 'medium', cve: 'CVE-2021-23343', description: 'ReDoS vulnerability' },\n  { package: 'django', pattern: '<3.2.14', severity: 'high', cve: 'CVE-2022-34265', description: 'SQL injection' },\n  { package: 'flask', pattern: '<2.0.2', severity: 'medium', cve: 'CVE-2021-28091', description: 'Path traversal' },\n  { package: 'requests', pattern: '<2.28.0', severity: 'medium', cve: 'CVE-2023-32681', description: 'Information disclosure' },\n  { package: 'urllib3', pattern: '<1.26.5', severity: 'high', cve: 'CVE-2021-33503', description: 'ReDoS vulnerability' },\n  { package: 'pillow', pattern: '<9.0.0', severity: 'high', cve: 'CVE-2022-22817', description: 'Buffer overflow' },\n  { package: 'pyyaml', pattern: '<5.4', severity: 'critical', cve: 'CVE-2020-14343', description: 'Arbitrary code execution' },\n  { package: 'jinja2', pattern: '<3.0.3', severity: 'medium', cve: 'CVE-2020-28493', description: 'XSS vulnerability' },\n  { package: 'sqlalchemy', pattern: '<1.4.46', severity: 'medium', cve: 'CVE-2023-30533', description: 'SQL injection' },\n];\n\nconst CACHE_TTL_HOURS = 24;\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Compare semantic versions (simplified)\n */\nfunction versionLessThan(current: string, target: string): boolean {\n  const currentParts = current.split('.').map((p) => parseInt(p, 10) || 0);\n  const targetParts = target.split('.').map((p) => parseInt(p, 10) || 0);\n\n  for (let i = 0; i < Math.max(currentParts.length, targetParts.length); i++) {\n    const c = currentParts[i] || 0;\n    const t = targetParts[i] || 0;\n    if (c < t) return true;\n    if (c > t) return false;\n  }\n  return false;\n}\n\n/**\n * Check if version matches vulnerability pattern\n */\nfunction versionMatchesVuln(currentVersion: string, vulnPattern: string): boolean {\n  const operator = vulnPattern.charAt(0);\n  const vulnVersion = vulnPattern.substring(1);\n\n  if (operator === '<') {\n    return versionLessThan(currentVersion, vulnVersion);\n  } else if (operator === '=') {\n    return currentVersion === vulnVersion;\n  }\n\n  return false;\n}\n\n/**\n * Clean version string (remove ^, ~, etc.)\n */\nfunction cleanVersion(version: string): string {\n  return version\n    .replace(/^[^~>=<]/, '')\n    .replace(/,.*$/, '')\n    .trim();\n}\n\n/**\n * Check a package against known vulnerabilities\n */\nfunction checkPackageVulnerability(packageName: string, version: string): KnownVuln | null {\n  const cleanedVersion = cleanVersion(version);\n  const pkgLower = packageName.toLowerCase();\n\n  for (const vuln of KNOWN_VULNS) {\n    if (pkgLower === vuln.package) {\n      if (versionMatchesVuln(cleanedVersion, vuln.pattern)) {\n        return vuln;\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Check if cache is valid\n */\nfunction getCachedWarnings(cacheFile: string): string | null {\n  if (!existsSync(cacheFile)) {\n    return null;\n  }\n\n  try {\n    const cache: DependencyCache = JSON.parse(readFileSync(cacheFile, 'utf-8'));\n    const cacheAge = (Date.now() - cache.timestamp) / (1000 * 60 * 60);\n\n    if (cacheAge < CACHE_TTL_HOURS) {\n      return cache.warnings;\n    }\n  } catch {\n    // Cache invalid\n  }\n\n  return null;\n}\n\n/**\n * Save warnings to cache\n */\nfunction saveCache(cacheFile: string, warnings: string): void {\n  try {\n    mkdirSync(cacheFile.replace(/\\/[^/]+$/, ''), { recursive: true });\n\n    const cache: DependencyCache = {\n      warnings,\n      timestamp: Date.now(),\n    };\n\n    writeFileSync(cacheFile, JSON.stringify(cache, null, 2));\n  } catch {\n    // Ignore cache write errors\n  }\n}\n\n/**\n * Parse package.json for vulnerabilities\n */\nfunction parsePackageJson(filePath: string): { criticalCount: number; highCount: number; warnings: string } {\n  let criticalCount = 0;\n  let highCount = 0;\n  let warnings = '';\n\n  if (!existsSync(filePath)) {\n    return { criticalCount, highCount, warnings };\n  }\n\n  try {\n    const pkg: PackageJson = JSON.parse(readFileSync(filePath, 'utf-8'));\n    const allDeps = { ...pkg.dependencies, ...pkg.devDependencies };\n\n    for (const [packageName, version] of Object.entries(allDeps)) {\n      const vuln = checkPackageVulnerability(packageName, version);\n      if (vuln) {\n        if (vuln.severity === 'critical') criticalCount++;\n        if (vuln.severity === 'high') highCount++;\n        warnings += `\\n- ${packageName}@${version}: ${vuln.description} (${vuln.cve}, ${vuln.severity}) - upgrade to ${vuln.pattern}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return { criticalCount, highCount, warnings };\n}\n\n/**\n * Parse requirements.txt for vulnerabilities\n */\nfunction parseRequirementsTxt(filePath: string): { criticalCount: number; highCount: number; warnings: string } {\n  let criticalCount = 0;\n  let highCount = 0;\n  let warnings = '';\n\n  if (!existsSync(filePath)) {\n    return { criticalCount, highCount, warnings };\n  }\n\n  try {\n    const content = readFileSync(filePath, 'utf-8');\n    const lines = content.split('\\n');\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (!trimmed || trimmed.startsWith('#')) continue;\n\n      // Parse package==version or package>=version\n      const match = trimmed.match(/^([a-zA-Z0-9_-]+)(?:==|>=|~=|!=|<|>)\\s*([0-9.]+)/);\n      if (!match) continue;\n\n      const [, packageName, version] = match;\n      const vuln = checkPackageVulnerability(packageName, version);\n      if (vuln) {\n        if (vuln.severity === 'critical') criticalCount++;\n        if (vuln.severity === 'high') highCount++;\n        warnings += `\\n- ${packageName}==${version}: ${vuln.description} (${vuln.cve}, ${vuln.severity}) - upgrade to ${vuln.pattern}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return { criticalCount, highCount, warnings };\n}\n\n/**\n * Dependency version check hook\n */\nexport function dependencyVersionCheck(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('dependency-version-check', 'Skipping dependency check (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('dependency-version-check', 'Starting dependency version check');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const cacheFile = `${projectDir}/.claude/feedback/dependency-check-cache.json`;\n\n  // Fast exit: Check if any package files exist\n  const hasPackageJson = existsSync(`${projectDir}/package.json`);\n  const hasRequirementsTxt = existsSync(`${projectDir}/requirements.txt`);\n  const hasPyprojectToml = existsSync(`${projectDir}/pyproject.toml`);\n  const hasGoMod = existsSync(`${projectDir}/go.mod`);\n\n  if (!hasPackageJson && !hasRequirementsTxt && !hasPyprojectToml && !hasGoMod) {\n    logHook('dependency-version-check', 'No package files found, skipping check');\n    saveCache(cacheFile, 'none');\n    return outputSilentSuccess();\n  }\n\n  // Check cache first\n  const cached = getCachedWarnings(cacheFile);\n  if (cached !== null) {\n    logHook('dependency-version-check', 'Using cached dependency warnings');\n    if (cached !== 'none') {\n      return outputWithContext(`DEPENDENCY SECURITY CHECK (cached): ${cached}`);\n    }\n    return outputSilentSuccess();\n  }\n\n  let totalCritical = 0;\n  let totalHigh = 0;\n  let allWarnings = '';\n\n  // Check package.json\n  if (hasPackageJson) {\n    const result = parsePackageJson(`${projectDir}/package.json`);\n    totalCritical += result.criticalCount;\n    totalHigh += result.highCount;\n    if (result.warnings) {\n      allWarnings += `\\n\\nNode.js (package.json):${result.warnings}`;\n    }\n  }\n\n  // Check requirements.txt\n  if (hasRequirementsTxt) {\n    const result = parseRequirementsTxt(`${projectDir}/requirements.txt`);\n    totalCritical += result.criticalCount;\n    totalHigh += result.highCount;\n    if (result.warnings) {\n      allWarnings += `\\n\\nPython (requirements.txt):${result.warnings}`;\n    }\n  }\n\n  // Generate output\n  if (allWarnings) {\n    const summary = `Found ${totalCritical} critical and ${totalHigh} high severity vulnerabilities`;\n    const fullWarning = `DEPENDENCY SECURITY CHECK: ${summary}${allWarnings}\\n\\nRun 'npm audit' or 'pip-audit' for full details.`;\n\n    saveCache(cacheFile, fullWarning);\n    logHook('dependency-version-check', summary);\n\n    // Only show warning if there are critical or high severity issues\n    if (totalCritical > 0 || totalHigh > 0) {\n      return outputWithContext(fullWarning);\n    }\n  } else {\n    saveCache(cacheFile, 'none');\n    logHook('dependency-version-check', 'No known vulnerabilities found');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Unified Setup Dispatcher\n * Issue #239: Move initialization hooks to Setup event (CC 2.1.10)\n *\n * Consolidates one-time initialization hooks that only need to run\n * at plugin load, not every session.\n *\n * Migrated from SessionStart dispatcher:\n * - dependency-version-check (only needs once per plugin load)\n *\n * CC 2.1.10+ Compliant: Uses Setup event for plugin-level initialization\n *\n * NOTE: Async hooks are fire-and-forget by design. They can only return\n * { async: true, asyncTimeout } - fields like systemMessage, continue,\n * decision are NOT processed by Claude Code for async hooks.\n * Failures are logged to file but not surfaced to users.\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\n\n// Import hook implementations from lifecycle (they stay there, we just call them from Setup)\nimport { dependencyVersionCheck } from '../lifecycle/dependency-version-check.js';\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype HookFn = (input: HookInput) => HookResult | Promise<HookResult>;\n\ninterface HookConfig {\n  name: string;\n  fn: HookFn;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Registry\n// -----------------------------------------------------------------------------\n\n/**\n * Registry of hooks that should run once at plugin load (Setup event)\n * These were previously in SessionStart but don't need session context\n */\nconst HOOKS: HookConfig[] = [\n  { name: 'dependency-version-check', fn: dependencyVersionCheck },\n];\n\n/** Exposed for registry wiring tests */\nexport const registeredHookNames = () => HOOKS.map(h => h.name);\n\n// -----------------------------------------------------------------------------\n// Dispatcher Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Unified dispatcher that runs Setup hooks in parallel\n * Runs once at plugin load, not every session\n */\nexport async function unifiedSetupDispatcher(input: HookInput): Promise<HookResult> {\n  logHook('setup-dispatcher', `Running ${HOOKS.length} Setup hooks in parallel`);\n\n  // Run all hooks in parallel\n  const results = await Promise.allSettled(\n    HOOKS.map(async hook => {\n      try {\n        const result = hook.fn(input);\n        if (result instanceof Promise) {\n          await result;\n        }\n        return { hook: hook.name, status: 'success' };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        logHook('setup-dispatcher', `${hook.name} failed: ${message}`);\n        return { hook: hook.name, status: 'error', message };\n      }\n    })\n  );\n\n  // Count failures for logging (async hooks can't report to users)\n  const failures: string[] = [];\n\n  for (const result of results) {\n    if (result.status === 'rejected') {\n      failures.push('unknown');\n    } else if (result.value.status === 'error') {\n      failures.push(result.value.hook);\n    }\n  }\n\n  // Log failures (async hooks are fire-and-forget - can't surface to users)\n  if (failures.length > 0) {\n    logHook('setup-dispatcher', `${failures.length}/${HOOKS.length} hooks failed: ${failures.join(', ')}`);\n  } else {\n    logHook('setup-dispatcher', `All ${HOOKS.length} Setup hooks completed successfully`);\n  }\n\n  // Async hooks always return silent success - CC ignores other fields\n  return outputSilentSuccess();\n}\n", "/**\n * First Run Setup - Full setup with optional interactive wizard\n * Hook: Setup (triggered by setup-check.sh)\n * CC 2.1.11 Compliant\n *\n * Phases:\n * 1. Environment detection\n * 2. Dependency validation\n * 3. Configuration selection\n * 4. Apply configuration\n * 5. Create marker file\n */\n\nimport { existsSync, mkdirSync, writeFileSync, readdirSync, chmodSync, } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getPluginRoot, outputWithContext, } from '../lib/common.js';\n\nconst CURRENT_VERSION = '4.25.0';\n\ninterface EnvironmentInfo {\n  python?: string;\n  nodejs?: string;\n  git?: boolean;\n  docker?: boolean;\n  sqlite3?: boolean;\n  os: string;\n}\n\ninterface PresetConfig {\n  preset: string;\n  description: string;\n  features: {\n    skills: boolean;\n    agents: boolean;\n    hooks: boolean;\n    mcp: boolean;\n    coordination: boolean;\n    statusline: boolean;\n  };\n  hook_groups: {\n    safety: boolean;\n    quality: boolean;\n    productivity: boolean;\n    observability: boolean;\n  };\n}\n\n/**\n * Detect environment\n */\nfunction detectEnvironment(): EnvironmentInfo {\n  logHook('first-run-setup', 'Phase 1: Detecting environment');\n\n  const envInfo: EnvironmentInfo = {\n    os: process.platform,\n  };\n\n  // Detect Python version\n  try {\n    const result = execSync('python3 --version', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    const match = result.match(/(\\d+\\.\\d+)/);\n    if (match) {\n      envInfo.python = match[1];\n      logHook('first-run-setup', `Python: ${match[1]}`);\n    }\n  } catch {\n    // Python not available\n  }\n\n  // Detect Node.js version\n  try {\n    const result = execSync('node --version', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    const match = result.match(/(\\d+\\.\\d+)/);\n    if (match) {\n      envInfo.nodejs = match[1];\n      logHook('first-run-setup', `Node.js: ${match[1]}`);\n    }\n  } catch {\n    // Node.js not available\n  }\n\n  // Detect Git\n  try {\n    execSync('which git', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    envInfo.git = true;\n    logHook('first-run-setup', 'Git: available');\n  } catch {\n    // Git not available\n  }\n\n  // Detect Docker\n  try {\n    execSync('which docker', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    envInfo.docker = true;\n    logHook('first-run-setup', 'Docker: available');\n  } catch {\n    // Docker not available\n  }\n\n  // Detect SQLite3\n  try {\n    execSync('which sqlite3', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    envInfo.sqlite3 = true;\n    logHook('first-run-setup', 'SQLite3: available (multi-instance coordination enabled)');\n  } catch {\n    // SQLite3 not available\n  }\n\n  return envInfo;\n}\n\n/**\n * Validate dependencies\n */\nfunction validateDependencies(): { valid: boolean; missing: string[]; warnings: string[] } {\n  logHook('first-run-setup', 'Phase 2: Validating dependencies');\n\n  const missing: string[] = [];\n  const warnings: string[] = [];\n\n  // Required: jq\n  try {\n    execSync('which jq', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n  } catch {\n    missing.push('jq (required for JSON processing)');\n  }\n\n  // Optional: sqlite3\n  try {\n    execSync('which sqlite3', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n  } catch {\n    warnings.push('sqlite3 not found - multi-instance coordination disabled');\n  }\n\n  // Optional: anthropic SDK\n  try {\n    execSync('python3 -c \"import anthropic\"', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    logHook('first-run-setup', 'Anthropic SDK: available (Memory Fabric Agent enabled)');\n  } catch {\n    warnings.push('anthropic SDK not found - Memory Fabric Agent will use fallback mode');\n    warnings.push(\"  Install with: pip install 'orchestkit[memory]'\");\n  }\n\n  // Report\n  if (missing.length > 0) {\n    logHook('first-run-setup', 'ERROR: Missing required dependencies:');\n    for (const dep of missing) {\n      logHook('first-run-setup', `  - ${dep}`);\n    }\n  }\n\n  for (const warn of warnings) {\n    logHook('first-run-setup', `WARN: ${warn}`);\n  }\n\n  return { valid: missing.length === 0, missing, warnings };\n}\n\n/**\n * Get preset configuration\n */\nfunction getPresetConfig(preset: string): PresetConfig {\n  const configs: Record<string, PresetConfig> = {\n    complete: {\n      preset: 'complete',\n      description: 'Full AI-assisted development toolkit',\n      features: {\n        skills: true,\n        agents: true,\n        hooks: true,\n        mcp: true,\n        coordination: true,\n        statusline: true,\n      },\n      hook_groups: {\n        safety: true,\n        quality: true,\n        productivity: true,\n        observability: true,\n      },\n    },\n    standard: {\n      preset: 'standard',\n      description: 'Skills and hooks without agent orchestration',\n      features: {\n        skills: true,\n        agents: false,\n        hooks: true,\n        mcp: true,\n        coordination: true,\n        statusline: true,\n      },\n      hook_groups: {\n        safety: true,\n        quality: true,\n        productivity: true,\n        observability: true,\n      },\n    },\n    lite: {\n      preset: 'lite',\n      description: 'Essential skills for constrained environments',\n      features: {\n        skills: true,\n        agents: false,\n        hooks: true,\n        mcp: false,\n        coordination: false,\n        statusline: false,\n      },\n      hook_groups: {\n        safety: true,\n        quality: true,\n        productivity: false,\n        observability: false,\n      },\n    },\n    'hooks-only': {\n      preset: 'hooks-only',\n      description: 'Safety hooks only for pure automation',\n      features: {\n        skills: false,\n        agents: false,\n        hooks: true,\n        mcp: false,\n        coordination: false,\n        statusline: false,\n      },\n      hook_groups: {\n        safety: true,\n        quality: false,\n        productivity: false,\n        observability: false,\n      },\n    },\n  };\n\n  return configs[preset] || configs.complete;\n}\n\n/**\n * Apply configuration\n */\nfunction applyConfiguration(preset: string, _envInfo: EnvironmentInfo, pluginRoot: string): PresetConfig {\n  logHook('first-run-setup', `Phase 4: Applying configuration (preset: ${preset})`);\n\n  const config = getPresetConfig(preset);\n\n  // Ensure directories exist\n  const dirs = [\n    `${pluginRoot}/.claude/defaults`,\n    `${pluginRoot}/.claude/context/session`,\n    `${pluginRoot}/.claude/context/knowledge`,\n    `${pluginRoot}/.claude/logs`,\n  ];\n\n  for (const dir of dirs) {\n    try {\n      mkdirSync(dir, { recursive: true });\n    } catch {\n      // Ignore\n    }\n  }\n\n  // Write config if it doesn't exist\n  const configFile = `${pluginRoot}/.claude/defaults/config.json`;\n  if (!existsSync(configFile)) {\n    writeFileSync(configFile, JSON.stringify(config, null, 2));\n    logHook('first-run-setup', `Created config file: ${configFile}`);\n  }\n\n  // Make all hooks executable\n  try {\n    const hooksDir = `${pluginRoot}/hooks`;\n    if (existsSync(hooksDir)) {\n      const makeExecutable = (dir: string) => {\n        try {\n          const entries = readdirSync(dir, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${dir}/${entry.name}`;\n            if (entry.isDirectory()) {\n              makeExecutable(fullPath);\n            } else if (entry.name.endsWith('.sh')) {\n              try {\n                chmodSync(fullPath, 0o755);\n              } catch {\n                // Ignore chmod errors\n              }\n            }\n          }\n        } catch {\n          // Ignore directory errors\n        }\n      };\n      makeExecutable(hooksDir);\n      logHook('first-run-setup', 'Made hooks executable');\n    }\n  } catch {\n    // Ignore\n  }\n\n  return config;\n}\n\n/**\n * Create marker file\n */\nfunction createMarker(preset: string, envInfo: EnvironmentInfo, pluginRoot: string): void {\n  logHook('first-run-setup', 'Phase 5: Creating marker file');\n\n  const now = new Date().toISOString();\n\n  // Count components\n  let hookCount = 0;\n  let skillCount = 0;\n  let agentCount = 0;\n\n  try {\n    const countFiles = (dir: string, pattern: RegExp): number => {\n      let count = 0;\n      const walk = (d: string) => {\n        try {\n          const entries = readdirSync(d, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${d}/${entry.name}`;\n            if (entry.isDirectory()) {\n              walk(fullPath);\n            } else if (pattern.test(entry.name)) {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n      };\n      walk(dir);\n      return count;\n    };\n\n    hookCount = countFiles(`${pluginRoot}/hooks`, /\\.sh$/);\n    skillCount = countFiles(`${pluginRoot}/skills`, /SKILL\\.md$/);\n    agentCount = countFiles(`${pluginRoot}/agents`, /\\.md$/);\n  } catch {\n    // Ignore count errors\n  }\n\n  const marker = {\n    version: CURRENT_VERSION,\n    setup_date: now,\n    preset,\n    components: {\n      hooks: { count: hookCount, valid: true },\n      skills: { count: skillCount, valid: true },\n      agents: { count: agentCount, valid: true },\n    },\n    last_health_check: now,\n    last_maintenance: now,\n    environment: envInfo,\n    user_preferences: {\n      onboarding_completed: true,\n      mcp_configured: false,\n      statusline_configured: false,\n    },\n  };\n\n  const markerFile = `${pluginRoot}/.setup-complete`;\n  writeFileSync(markerFile, JSON.stringify(marker, null, 2));\n  logHook('first-run-setup', `Marker file created: ${markerFile}`);\n}\n\n/**\n * First run setup hook\n */\nexport function firstRunSetup(_input: HookInput): HookResult {\n  const pluginRoot = getPluginRoot();\n  const mode = process.argv.includes('--silent') ? 'silent' : 'interactive';\n\n  logHook('first-run-setup', `First-run setup starting (mode: ${mode})`);\n\n  // Phase 1: Environment detection\n  const envInfo = detectEnvironment();\n\n  // Phase 2: Dependency validation\n  const { valid, missing } = validateDependencies();\n  if (!valid) {\n    logHook('first-run-setup', 'ERROR: Dependency validation failed');\n    const ctx = `OrchestKit setup failed: Missing required dependencies. Install ${missing.join(', ')}.`;\n    return outputWithContext(ctx);\n  }\n\n  // Phase 3: Select preset (default to complete)\n  const preset = 'complete';\n  if (mode === 'interactive') {\n    logHook('first-run-setup', 'Interactive mode - using complete preset (wizard via Claude conversation)');\n  } else {\n    logHook('first-run-setup', 'Silent mode - using complete preset');\n  }\n\n  // Phase 4: Apply configuration\n  applyConfiguration(preset, envInfo, pluginRoot);\n\n  // Phase 5: Create marker\n  createMarker(preset, envInfo, pluginRoot);\n\n  // Count components for success message\n  let hookCount = 0;\n  let skillCount = 0;\n  let agentCount = 0;\n  try {\n    const countFiles = (dir: string, pattern: RegExp): number => {\n      let count = 0;\n      const walk = (d: string) => {\n        try {\n          const entries = readdirSync(d, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${d}/${entry.name}`;\n            if (entry.isDirectory()) {\n              walk(fullPath);\n            } else if (pattern.test(entry.name)) {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n      };\n      walk(dir);\n      return count;\n    };\n\n    hookCount = countFiles(`${pluginRoot}/hooks`, /\\.sh$/);\n    skillCount = countFiles(`${pluginRoot}/skills`, /SKILL\\.md$/);\n    agentCount = countFiles(`${pluginRoot}/agents`, /\\.md$/);\n  } catch {\n    // Ignore count errors\n  }\n\n  logHook('first-run-setup', `Setup complete: ${skillCount} skills, ${agentCount} agents, ${hookCount} hooks`);\n\n  const ctx =\n    mode === 'interactive'\n      ? `OrchestKit v${CURRENT_VERSION} setup complete! Loaded ${skillCount} skills, ${agentCount} agents, and ${hookCount} hooks. Use /ork:configure to customize settings.`\n      : `OrchestKit v${CURRENT_VERSION} initialized (silent mode).`;\n\n  return outputWithContext(ctx);\n}\n", "/**\n * Monorepo Detector - Setup Hook\n * CC 2.1.20: Detects monorepo structures and suggests --add-dir usage\n *\n * Runs once at plugin load. Checks for monorepo indicators and\n * notifies users about multi-directory context support.\n */\n\nimport { existsSync, readFileSync, readdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\n// Monorepo indicator files\nconst MONOREPO_INDICATORS = [\n  'pnpm-workspace.yaml',\n  'lerna.json',\n  'nx.json',\n  'turbo.json',\n  'rush.json',\n];\n\n/**\n * Count nested package.json files (depth 2 max)\n */\nfunction countNestedPackageJsons(projectDir: string): number {\n  let count = 0;\n\n  try {\n    const entries = readdirSync(projectDir, { withFileTypes: true });\n    for (const entry of entries) {\n      if (!entry.isDirectory() || entry.name.startsWith('.') || entry.name === 'node_modules') {\n        continue;\n      }\n      const subDir = `${projectDir}/${entry.name}`;\n      if (existsSync(`${subDir}/package.json`)) {\n        count++;\n      }\n      // Check one more level deep (e.g., packages/api/package.json)\n      try {\n        const subEntries = readdirSync(subDir, { withFileTypes: true });\n        for (const subEntry of subEntries) {\n          if (!subEntry.isDirectory() || subEntry.name.startsWith('.') || subEntry.name === 'node_modules') {\n            continue;\n          }\n          if (existsSync(`${subDir}/${subEntry.name}/package.json`)) {\n            count++;\n          }\n        }\n      } catch {\n        // Ignore permission errors\n      }\n    }\n  } catch {\n    // Ignore permission errors\n  }\n\n  return count;\n}\n\n/**\n * Monorepo detector hook\n */\nexport function monorepoDetector(input: HookInput): HookResult {\n  logHook('monorepo-detector', 'Checking for monorepo structure');\n\n  // CC 2.1.49: When added_dirs are active, surface package context instead of skipping\n  if (input.added_dirs && input.added_dirs.length > 0) {\n    logHook('monorepo-detector', `${input.added_dirs.length} added_dirs active, surfacing context`);\n\n    // Extract package names from added directories\n    const packageNames: string[] = [];\n    for (const dir of input.added_dirs) {\n      try {\n        const pkgPath = `${dir}/package.json`;\n        if (existsSync(pkgPath)) {\n          const pkg = JSON.parse(readFileSync(pkgPath, 'utf8'));\n          if (pkg.name) packageNames.push(pkg.name);\n        }\n      } catch {\n        // Ignore unreadable packages\n      }\n    }\n\n    if (packageNames.length > 0) {\n      return outputWithContext(\n        `**Multi-directory context active** (${input.added_dirs.length} dirs)\\n\\n` +\n        `Packages: ${packageNames.join(', ')}\\n\\n` +\n        'Each directory may have its own CLAUDE.md with targeted instructions.'\n      );\n    }\n\n    return outputSilentSuccess();\n  }\n\n  // Skip if env var already set\n  if (process.env.CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD === '1') {\n    logHook('monorepo-detector', 'CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD already set, skipping');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const detectedIndicators: string[] = [];\n\n  // Check for monorepo indicator files\n  for (const indicator of MONOREPO_INDICATORS) {\n    if (existsSync(`${projectDir}/${indicator}`)) {\n      detectedIndicators.push(indicator);\n    }\n  }\n\n  // Check for multiple nested package.json files\n  const nestedPackageCount = countNestedPackageJsons(projectDir);\n  const isMonorepo = detectedIndicators.length > 0 || nestedPackageCount >= 3;\n\n  if (!isMonorepo) {\n    logHook('monorepo-detector', 'No monorepo detected');\n    return outputSilentSuccess();\n  }\n\n  const indicators = detectedIndicators.length > 0\n    ? `Detected: ${detectedIndicators.join(', ')}`\n    : `Found ${nestedPackageCount} nested packages`;\n\n  logHook('monorepo-detector', `Monorepo detected: ${indicators}`);\n\n  return outputWithContext(\n    `**Monorepo Detected** (${indicators})\\n\\n` +\n    'CC 2.1.20 supports multi-directory context with `--add-dir`. ' +\n    'Each service can have its own CLAUDE.md for targeted instructions.\\n\\n' +\n    'Set `CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD=1` to auto-load CLAUDE.md from added directories.'\n  );\n}\n", "/**\n * Setup Check - Entry point for CC 2.1.11 Setup hooks\n * Hook: Setup (triggered by --init, --init-only, --maintenance)\n * Also runs on SessionStart for fast validation\n *\n * This hook implements the hybrid marker file + validation approach:\n * 1. Check marker file for fast path (< 10ms when setup complete)\n * 2. Quick validation for self-healing (< 50ms)\n * 3. Triggers appropriate sub-hook based on state\n */\n\nimport { existsSync, readFileSync, readdirSync, writeFileSync } from 'node:fs';\nimport { spawn } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getPluginRoot, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\nconst CURRENT_VERSION = '4.25.0';\n\n/**\n * Get marker field from marker file\n */\nfunction getMarkerField(markerFile: string, field: string): unknown {\n  if (!existsSync(markerFile)) {\n    return null;\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(markerFile, 'utf-8'));\n    // Simple dot notation parsing\n    const parts = field.split('.');\n    let value: unknown = content;\n    for (const part of parts) {\n      if (value === null || value === undefined) return null;\n      value = (value as Record<string, unknown>)[part];\n    }\n    return value;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Quick validation - checks critical components exist (< 50ms target)\n */\nfunction quickValidate(pluginRoot: string): number {\n  let errors = 0;\n\n  // Check 1: Config file exists and is valid JSON\n  const configFile = `${pluginRoot}/.claude/defaults/config.json`;\n  if (existsSync(configFile)) {\n    try {\n      JSON.parse(readFileSync(configFile, 'utf-8'));\n    } catch {\n      logHook('setup-check', 'WARN: config.json is invalid JSON');\n      errors++;\n    }\n  }\n\n  // Check 2: At least some hooks exist (simplified count)\n  let hookCount = 0;\n  if (existsSync(`${pluginRoot}/hooks`)) {\n    try {\n      const countShFiles = (dir: string, depth = 0): number => {\n        if (depth > 3) return 0; // Limit depth\n        let count = 0;\n        try {\n          const entries = readdirSync(dir, { withFileTypes: true });\n          for (const entry of entries.slice(0, 100)) {\n            // Limit entries\n            const fullPath = `${dir}/${entry.name}`;\n            if (entry.isDirectory() && !entry.name.startsWith('.')) {\n              count += countShFiles(fullPath, depth + 1);\n            } else if (entry.name.endsWith('.sh')) {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n        return count;\n      };\n      hookCount = countShFiles(`${pluginRoot}/hooks`);\n    } catch {\n      // Ignore\n    }\n  }\n\n  if (hookCount < 10) {\n    logHook('setup-check', `WARN: Only ${hookCount} hooks found (expected 50+)`);\n    // Don't increment errors - just warn\n  }\n\n  // Check 3: Version matches\n  const markerFile = `${pluginRoot}/.setup-complete`;\n  const markerVersion = getMarkerField(markerFile, 'version') as string | null;\n  if (markerVersion && markerVersion !== CURRENT_VERSION) {\n    logHook('setup-check', `INFO: Version mismatch - marker: ${markerVersion}, current: ${CURRENT_VERSION}`);\n    return 2; // Trigger migration\n  }\n\n  return errors;\n}\n\n/**\n * Check if maintenance is due\n */\nfunction isMaintenanceDue(markerFile: string): boolean {\n  const lastMaintenance = getMarkerField(markerFile, 'last_maintenance') as string | null;\n  if (!lastMaintenance) {\n    return true;\n  }\n\n  try {\n    const lastEpoch = new Date(lastMaintenance).getTime();\n    const nowEpoch = Date.now();\n    const hoursSince = (nowEpoch - lastEpoch) / (1000 * 60 * 60);\n    return hoursSince >= 24;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Update marker field\n */\nfunction updateMarker(markerFile: string, field: string, value: unknown): void {\n  if (!existsSync(markerFile)) {\n    return;\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(markerFile, 'utf-8'));\n    content[field] = value;\n    writeFileSync(markerFile, JSON.stringify(content, null, 2));\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Setup check hook\n */\nexport function setupCheck(input: HookInput): HookResult {\n  // Check bypass flags\n  if (process.env.ORCHESTKIT_SKIP_SETUP === '1' || process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1') {\n    return outputSilentSuccess();\n  }\n\n  const pluginRoot = getPluginRoot();\n  const markerFile = `${pluginRoot}/.setup-complete`;\n  const setupDir = `${pluginRoot}/hooks/setup`;\n\n  logHook('setup-check', `Setup check starting (v${CURRENT_VERSION})`);\n\n  // Check trigger mode from argv\n  const args = process.argv;\n  if (args.includes('--init') || args.includes('init')) {\n    logHook('setup-check', 'Explicit --init: Running full setup');\n    // In TS we can't exec, but the bash wrapper will handle this\n    return {\n      continue: true,\n      systemMessage: 'Running first-run setup...',\n    };\n  }\n\n  if (args.includes('--init-only') || args.includes('init-only')) {\n    logHook('setup-check', 'CI/CD mode (--init-only): Running silent setup');\n    return {\n      continue: true,\n      systemMessage: 'Running silent setup...',\n    };\n  }\n\n  if (args.includes('--maintenance') || args.includes('maintenance')) {\n    logHook('setup-check', 'Explicit --maintenance: Running maintenance tasks');\n    return {\n      continue: true,\n      systemMessage: 'Running maintenance tasks...',\n    };\n  }\n\n  // Auto mode: Check marker file first (fast path)\n  if (!existsSync(markerFile)) {\n    logHook('setup-check', 'No marker file found - first run detected');\n\n    const hookEvent = input.hook_event || process.env.HOOK_EVENT;\n    if (hookEvent === 'Setup') {\n      return {\n        continue: true,\n        systemMessage: 'First run detected. Running setup...',\n      };\n    } else {\n      // SessionStart - inform user but don't block\n      const ctx = \"OrchestKit setup not complete. Run 'claude --init' to configure the plugin.\";\n      return outputWithContext(ctx);\n    }\n  }\n\n  // Marker exists - run quick validation\n  logHook('setup-check', 'Marker file exists - running quick validation');\n\n  const validationResult = quickValidate(pluginRoot);\n\n  switch (validationResult) {\n    case 0:\n      // All checks passed - check if maintenance is due\n      if (isMaintenanceDue(markerFile)) {\n        logHook('setup-check', 'Maintenance due - queueing background tasks');\n        // Run maintenance in background (spawn detached)\n        const maintenanceScript = `${setupDir}/setup-maintenance.sh`;\n        if (existsSync(maintenanceScript)) {\n          const child = spawn(maintenanceScript, ['--background'], {\n            detached: true,\n            stdio: 'ignore',\n          });\n          child.unref();\n        }\n      }\n\n      logHook('setup-check', 'Setup check passed (fast path)');\n      return outputSilentSuccess();\n\n    case 1: {\n      // Validation failed - trigger repair in background\n      logHook('setup-check', 'Validation failed - triggering self-healing repair');\n      const repairScript = `${setupDir}/setup-repair.sh`;\n      if (existsSync(repairScript)) {\n        const child = spawn(repairScript, [], {\n          detached: true,\n          stdio: 'ignore',\n        });\n        child.unref();\n      }\n      return outputWithContext('OrchestKit setup validation failed. Repair running in background.');\n    }\n\n    case 2: {\n      // Version mismatch - run migration in background\n      logHook('setup-check', 'Version mismatch - running migration');\n      const maintenanceScript = `${setupDir}/setup-maintenance.sh`;\n      if (existsSync(maintenanceScript)) {\n        const child = spawn(maintenanceScript, ['--migrate'], {\n          detached: true,\n          stdio: 'ignore',\n        });\n        child.unref();\n      }\n\n      updateMarker(markerFile, 'version', CURRENT_VERSION);\n      return outputWithContext(`OrchestKit upgraded to v${CURRENT_VERSION}.`);\n    }\n\n    default:\n      return outputSilentSuccess();\n  }\n}\n", "/**\n * Setup Maintenance - Periodic maintenance tasks\n * Hook: Setup (triggered by setup-check.sh or --maintenance flag)\n * CC 2.1.11 Compliant\n *\n * Tasks:\n * - Log rotation (daily)\n * - Stale lock cleanup (daily)\n * - Session archive (daily)\n * - Memory Fabric cleanup (daily)\n * - Metrics aggregation (weekly)\n * - Full health validation (weekly)\n * - Version migrations (on version change)\n */\n\nimport {\n  existsSync,\n  mkdirSync,\n  readFileSync,\n  writeFileSync,\n  renameSync,\n  readdirSync,\n  unlinkSync,\n  rmSync,\n  statSync,\n  chmodSync,\n} from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getPluginRoot, getProjectDir, outputSilentSuccess, outputWithContext } from '../lib/common.js';\nimport { getHomeDir, getTempDir } from '../lib/paths.js';\nimport { isAgentTeamsActive } from '../lib/agent-teams.js';\n\nconst CURRENT_VERSION = '4.25.0';\n\nconst tasksCompleted: string[] = [];\n\n/**\n * Get marker field\n */\nfunction getMarkerField(markerFile: string, field: string): unknown {\n  if (!existsSync(markerFile)) {\n    return null;\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(markerFile, 'utf-8'));\n    return content[field.replace(/^\\./, '')];\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Update marker field\n */\nfunction updateMarkerField(markerFile: string, field: string, value: unknown): void {\n  if (!existsSync(markerFile)) {\n    return;\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(markerFile, 'utf-8'));\n    content[field.replace(/^\\./, '')] = value;\n    writeFileSync(markerFile, JSON.stringify(content, null, 2));\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Calculate hours since timestamp\n */\nfunction hoursSince(timestamp: string | null): number {\n  if (!timestamp) {\n    return 999;\n  }\n\n  try {\n    const lastEpoch = new Date(timestamp).getTime();\n    const nowEpoch = Date.now();\n    return (nowEpoch - lastEpoch) / (1000 * 60 * 60);\n  } catch {\n    return 999;\n  }\n}\n\n/**\n * Task: Log rotation\n */\nfunction taskLogRotation(pluginRoot: string): void {\n  logHook('setup-maintenance', 'Task: Log rotation');\n\n  const logDirs = [`${pluginRoot}/.claude/logs`, `${getHomeDir()}/.claude/logs/ork`];\n\n  let rotated = 0;\n\n  for (const logDir of logDirs) {\n    if (!existsSync(logDir)) {\n      continue;\n    }\n\n    try {\n      const files = readdirSync(logDir);\n      for (const file of files) {\n        if (!file.endsWith('.log')) continue;\n\n        const filePath = `${logDir}/${file}`;\n        try {\n          const stats = statSync(filePath);\n          if (stats.size > 204800) {\n            // 200KB\n            const rotatedName = `${filePath}.old.${Date.now()}`;\n            renameSync(filePath, rotatedName);\n            rotated++;\n\n            // Try to gzip\n            try {\n              execSync(`gzip \"${rotatedName}\"`, { stdio: ['pipe', 'pipe', 'pipe'] });\n            } catch {\n              // gzip not available\n            }\n          }\n        } catch {\n          // Ignore file errors\n        }\n      }\n\n      // Clean up old rotated logs (keep last 5)\n      const rotatedLogs = files.filter((f) => f.includes('.log.old.')).sort().reverse();\n      for (const oldLog of rotatedLogs.slice(5)) {\n        try {\n          unlinkSync(`${logDir}/${oldLog}`);\n        } catch {\n          // Ignore\n        }\n      }\n    } catch {\n      // Ignore directory errors\n    }\n  }\n\n  if (rotated > 0) {\n    tasksCompleted.push(`Rotated ${rotated} log files`);\n  }\n}\n\n/**\n * Task: Stale lock cleanup.\n * Issue #362: Skips coordination DB when Agent Teams is active.\n */\nfunction taskStaleLockCleanup(pluginRoot: string): void {\n  logHook('setup-maintenance', 'Task: Stale lock cleanup');\n\n  const coordDb = `${pluginRoot}/.claude/coordination/.claude.db`;\n  let cleaned = 0;\n\n  if (existsSync(coordDb) && !isAgentTeamsActive()) {\n    try {\n      execSync(`sqlite3 \"${coordDb}\" \"DELETE FROM file_locks WHERE datetime(acquired_at) < datetime('now', '-24 hours');\"`, {\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n\n      const lockCount = execSync(`sqlite3 \"${coordDb}\" \"SELECT COUNT(*) FROM file_locks;\"`, {\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }).trim();\n\n      logHook('setup-maintenance', `Coordination locks remaining: ${lockCount}`);\n      cleaned = 1;\n    } catch {\n      // Ignore SQLite errors\n    }\n  }\n\n  // Clean up .lock files older than 24 hours\n  try {\n    const walkAndClean = (dir: string, depth = 0) => {\n      if (depth > 3) return;\n      try {\n        const entries = readdirSync(dir, { withFileTypes: true });\n        for (const entry of entries) {\n          const fullPath = `${dir}/${entry.name}`;\n          if (entry.isDirectory() && !entry.name.startsWith('.')) {\n            walkAndClean(fullPath, depth + 1);\n          } else if (entry.name.endsWith('.lock')) {\n            try {\n              const stats = statSync(fullPath);\n              const ageHours = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60);\n              if (ageHours > 24) {\n                unlinkSync(fullPath);\n                cleaned++;\n              }\n            } catch {\n              // Ignore\n            }\n          }\n        }\n      } catch {\n        // Ignore\n      }\n    };\n    walkAndClean(pluginRoot);\n  } catch {\n    // Ignore\n  }\n\n  if (cleaned > 0) {\n    tasksCompleted.push('Cleaned stale locks');\n  }\n}\n\n/**\n * Task: Session cleanup\n */\nfunction taskSessionCleanup(pluginRoot: string): void {\n  logHook('setup-maintenance', 'Task: Session cleanup');\n\n  const sessionDir = `${pluginRoot}/.claude/context/sessions`;\n  const archiveDir = `${pluginRoot}/.claude/context/archive`;\n\n  if (!existsSync(sessionDir)) {\n    return;\n  }\n\n  let archived = 0;\n\n  try {\n    mkdirSync(archiveDir, { recursive: true });\n    const entries = readdirSync(sessionDir, { withFileTypes: true });\n\n    for (const entry of entries) {\n      if (!entry.isDirectory()) continue;\n\n      const fullPath = `${sessionDir}/${entry.name}`;\n      try {\n        const stats = statSync(fullPath);\n        const ageDays = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60 * 24);\n        if (ageDays > 7) {\n          renameSync(fullPath, `${archiveDir}/${entry.name}`);\n          archived++;\n        }\n      } catch {\n        // Ignore\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  // Clean up old temp files\n  const systemTmpDir = getTempDir();\n  try {\n    const entries = readdirSync(systemTmpDir);\n    for (const entry of entries) {\n      if (!entry.startsWith('claude-session-')) continue;\n\n      const fullPath = `${systemTmpDir}/${entry}`;\n      try {\n        const stats = statSync(fullPath);\n        const ageDays = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60 * 24);\n        if (ageDays > 7 && stats.isDirectory()) {\n          rmSync(fullPath, { recursive: true, force: true });\n        }\n      } catch {\n        // Ignore\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  if (archived > 0) {\n    tasksCompleted.push(`Archived ${archived} old sessions`);\n  }\n}\n\n/**\n * Task: Memory Fabric cleanup\n */\nfunction taskMemoryFabricCleanup(projectDir: string): void {\n  logHook('setup-maintenance', 'Task: Memory Fabric cleanup');\n\n  let cleaned = 0;\n  const logsDir = `${projectDir}/.claude/logs`;\n\n  // Clean up old pending sync files (older than 7 days)\n  if (existsSync(logsDir)) {\n    try {\n      const files = readdirSync(logsDir);\n      for (const file of files) {\n        if (!file.startsWith('.pending-sync-')) continue;\n\n        const fullPath = `${logsDir}/${file}`;\n        try {\n          const stats = statSync(fullPath);\n          const ageDays = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60 * 24);\n          if (ageDays > 7) {\n            unlinkSync(fullPath);\n            cleaned++;\n          }\n        } catch {\n          // Ignore\n        }\n      }\n    } catch {\n      // Ignore\n    }\n  }\n\n  if (cleaned > 0) {\n    tasksCompleted.push(`Cleaned ${cleaned} Memory Fabric files`);\n  }\n}\n\n/**\n * Task: Health validation\n */\nfunction taskHealthValidation(pluginRoot: string, markerFile: string): void {\n  logHook('setup-maintenance', 'Task: Full health validation');\n\n  let issues = 0;\n\n  // Validate all hooks are executable\n  let nonExec = 0;\n  const checkExecutable = (dir: string, depth = 0) => {\n    if (depth > 4) return;\n    try {\n      const entries = readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        const fullPath = `${dir}/${entry.name}`;\n        if (entry.isDirectory() && !entry.name.startsWith('.')) {\n          checkExecutable(fullPath, depth + 1);\n        } else if (entry.name.endsWith('.sh')) {\n          try {\n            const stats = statSync(fullPath);\n            if (!(stats.mode & 0o111)) {\n              chmodSync(fullPath, 0o755);\n              nonExec++;\n            }\n          } catch {\n            // Ignore\n          }\n        }\n      }\n    } catch {\n      // Ignore\n    }\n  };\n\n  checkExecutable(`${pluginRoot}/hooks`);\n  if (nonExec > 0) {\n    logHook('setup-maintenance', `WARN: ${nonExec} hooks were not executable`);\n    issues++;\n  }\n\n  // Validate config.json\n  const configFile = `${pluginRoot}/.claude/defaults/config.json`;\n  if (existsSync(configFile)) {\n    try {\n      JSON.parse(readFileSync(configFile, 'utf-8'));\n    } catch {\n      logHook('setup-maintenance', 'WARN: config.json is invalid');\n      issues++;\n    }\n  }\n\n  // Update health check timestamp\n  updateMarkerField(markerFile, 'last_health_check', new Date().toISOString());\n\n  if (issues === 0) {\n    tasksCompleted.push('Health validation passed');\n  } else {\n    tasksCompleted.push(`Health validation found ${issues} issues (auto-fixed)`);\n  }\n}\n\n/**\n * Task: Version migration\n */\nfunction taskVersionMigration(markerFile: string): void {\n  logHook('setup-maintenance', 'Task: Version migration');\n\n  const markerVersion = getMarkerField(markerFile, 'version') as string | null;\n\n  if (!markerVersion || markerVersion === CURRENT_VERSION) {\n    return;\n  }\n\n  logHook('setup-maintenance', `Migrating from ${markerVersion} to ${CURRENT_VERSION}`);\n\n  // Version-specific migrations would go here\n  // For now, just log and update version\n\n  updateMarkerField(markerFile, 'version', CURRENT_VERSION);\n  tasksCompleted.push(`Migrated from ${markerVersion} to ${CURRENT_VERSION}`);\n}\n\n/**\n * Setup maintenance hook\n */\nexport function setupMaintenance(input: HookInput): HookResult {\n  const pluginRoot = getPluginRoot();\n  const projectDir = input.project_dir || getProjectDir();\n  const markerFile = `${pluginRoot}/.setup-complete`;\n\n  // Determine mode from argv\n  const args = process.argv;\n  let mode = 'auto';\n  if (args.includes('--force')) {\n    mode = 'force';\n  } else if (args.includes('--migrate')) {\n    mode = 'migrate';\n  } else if (args.includes('--background')) {\n    mode = 'background';\n  }\n\n  logHook('setup-maintenance', `Maintenance starting (mode: ${mode})`);\n\n  const now = new Date().toISOString();\n  const lastMaintenance = getMarkerField(markerFile, 'last_maintenance') as string | null;\n  const hours = hoursSince(lastMaintenance);\n\n  let runDaily = false;\n  let runWeekly = false;\n\n  switch (mode) {\n    case 'force':\n      runDaily = true;\n      runWeekly = true;\n      break;\n    case 'migrate':\n      taskVersionMigration(markerFile);\n      break;\n    case 'background':\n    case 'auto':\n      if (hours >= 24) {\n        runDaily = true;\n      }\n      if (hours >= 168) {\n        // 7 days\n        runWeekly = true;\n      }\n      break;\n  }\n\n  // Run daily tasks\n  if (runDaily) {\n    logHook('setup-maintenance', 'Running daily maintenance tasks');\n    taskLogRotation(pluginRoot);\n    taskStaleLockCleanup(pluginRoot);\n    taskSessionCleanup(pluginRoot);\n    taskMemoryFabricCleanup(projectDir);\n  }\n\n  // Run weekly tasks\n  if (runWeekly) {\n    logHook('setup-maintenance', 'Running weekly maintenance tasks');\n    taskHealthValidation(pluginRoot, markerFile);\n  }\n\n  // Update last maintenance timestamp\n  updateMarkerField(markerFile, 'last_maintenance', now);\n\n  // Build summary\n  if (tasksCompleted.length > 0) {\n    logHook('setup-maintenance', `Maintenance complete: ${tasksCompleted.length} tasks`);\n    const summary = `Completed: ${tasksCompleted.join(', ')}`;\n\n    if (mode === 'background') {\n      return outputSilentSuccess();\n    }\n\n    return outputWithContext(`Maintenance: ${summary}`);\n  }\n\n  logHook('setup-maintenance', 'No maintenance tasks needed');\n  return outputSilentSuccess();\n}\n", "/**\n * Agent Teams Detection & Configuration Utility\n * Issue #362: Deprecate coordination hooks redundant with CC Agent Teams\n *\n * CC Agent Teams (CC 2.1.33+) provides native multi-instance coordination:\n * - Teammate lifecycle management\n * - 5-minute runtime heartbeat\n * - Idle notifications\n * - Cleanup on session end\n *\n * When Agent Teams is active, OrchestKit's custom coordination hooks\n * should yield to CC's native implementation to avoid duplication.\n */\n\nimport { existsSync, readFileSync, readdirSync, statSync, rmSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check if CC Agent Teams is active.\n *\n * Detection signals:\n * - CLAUDE_CODE_TEAM_NAME: Set when running as part of an Agent Teams team\n * - CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS: Feature flag for Agent Teams\n */\nexport function isAgentTeamsActive(): boolean {\n  return !!(\n    process.env.CLAUDE_CODE_TEAM_NAME ||\n    process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS === '1'\n  );\n}\n\n/** Check if current session is a teammate in a team */\nexport function isTeammate(): boolean {\n  return !!process.env.CLAUDE_CODE_TEAM_NAME;\n}\n\n/** Get current team name */\nexport function getTeamName(): string | null {\n  return process.env.CLAUDE_CODE_TEAM_NAME || null;\n}\n\nexport interface TeamMember {\n  name: string;\n  agentType: string;\n}\n\n/**\n * Read team config to get member list.\n * Reads from ~/.claude/teams/{team-name}/config.json\n */\nexport function getTeamMembers(): TeamMember[] {\n  const teamName = getTeamName();\n  if (!teamName) return [];\n\n  const homeDir = process.env.HOME || process.env.USERPROFILE || '';\n  if (!homeDir) return [];\n\n  const configPath = join(homeDir, '.claude', 'teams', teamName, 'config.json');\n  if (!existsSync(configPath)) return [];\n\n  try {\n    const config = JSON.parse(readFileSync(configPath, 'utf-8'));\n    const members = config.members;\n    if (!Array.isArray(members)) return [];\n\n    return members.map((m: { name?: string; agentType?: string }) => ({\n      name: m.name || 'unknown',\n      agentType: m.agentType || 'unknown',\n    }));\n  } catch {\n    return [];\n  }\n}\n\n/** Count current team members */\nexport function getTeamSize(): number {\n  return getTeamMembers().length;\n}\n\n/** List all team directories */\nexport function listAllTeams(): string[] {\n  const homeDir = process.env.HOME || process.env.USERPROFILE || '';\n  if (!homeDir) return [];\n  const teamsDir = join(homeDir, '.claude', 'teams');\n  if (!existsSync(teamsDir)) return [];\n  try {\n    return readdirSync(teamsDir).filter(name => {\n      try { return statSync(join(teamsDir, name)).isDirectory(); } catch { return false; }\n    });\n  } catch { return []; }\n}\n\n/** Check if team is stale (no config, or dir older than maxAgeHours) */\nexport function isStaleTeam(teamName: string, maxAgeHours: number = 4): boolean {\n  const homeDir = process.env.HOME || process.env.USERPROFILE || '';\n  if (!homeDir) return false;\n  const teamPath = join(homeDir, '.claude', 'teams', teamName);\n  if (!existsSync(teamPath)) return false;\n  const configPath = join(teamPath, 'config.json');\n  if (!existsSync(configPath)) return true;  // no config = orphaned\n  try {\n    const ageMs = Date.now() - statSync(teamPath).mtimeMs;\n    return ageMs > maxAgeHours * 3600_000;\n  } catch { return true; }\n}\n\n/** Remove team + task directories */\nexport function cleanupTeam(teamName: string): boolean {\n  const homeDir = process.env.HOME || process.env.USERPROFILE || '';\n  if (!homeDir) return false;\n  let ok = true;\n  for (const sub of ['teams', 'tasks']) {\n    const dir = join(homeDir, '.claude', sub, teamName);\n    if (existsSync(dir)) {\n      try { rmSync(dir, { recursive: true, force: true }); } catch { ok = false; }\n    }\n  }\n  return ok;\n}\n", "/**\n * Setup Repair - Self-healing for broken installations\n *\n * INTERNAL HOOK: Called by setup-check when validation fails.\n * NOT registered in plugin.json (by design - it's a sub-hook).\n *\n * CC 2.1.11 Compliant\n *\n * Repair Actions:\n * - Restore missing/corrupt config files\n * - Fix hook permissions\n * - Regenerate marker file\n * - Run migrations for version mismatches\n */\n\nimport {\n  existsSync,\n  mkdirSync,\n  readFileSync,\n  writeFileSync,\n  renameSync,\n  readdirSync,\n  statSync,\n  chmodSync,\n} from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getPluginRoot, outputSilentSuccess, outputWithContext } from '../lib/common.js';\nimport { isAgentTeamsActive } from '../lib/agent-teams.js';\n\nconst CURRENT_VERSION = '4.25.0';\n\nconst repairsMade: string[] = [];\nconst repairsFailed: string[] = [];\nlet notifyUser = false;\n\n/**\n * Repair: Restore config.json\n */\nfunction repairConfig(pluginRoot: string): void {\n  const configFile = `${pluginRoot}/.claude/defaults/config.json`;\n  const configDir = `${pluginRoot}/.claude/defaults`;\n\n  // Ensure directory exists\n  try {\n    mkdirSync(configDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  // Check if config exists and is valid\n  if (existsSync(configFile)) {\n    try {\n      JSON.parse(readFileSync(configFile, 'utf-8'));\n      return; // Config is valid\n    } catch {\n      // Backup corrupt config\n      const backup = `${configFile}.corrupt.${Date.now()}`;\n      try {\n        renameSync(configFile, backup);\n        logHook('setup-repair', `Backed up corrupt config to ${backup}`);\n        notifyUser = true;\n      } catch {\n        // Ignore rename errors\n      }\n    }\n  }\n\n  // Restore default config\n  const defaultConfig = {\n    preset: 'complete',\n    description: 'Full AI-assisted development toolkit (restored by repair)',\n    features: {\n      skills: true,\n      agents: true,\n      hooks: true,\n      mcp: true,\n      coordination: true,\n      statusline: true,\n    },\n    hook_groups: {\n      safety: true,\n      quality: true,\n      productivity: true,\n      observability: true,\n    },\n  };\n\n  writeFileSync(configFile, JSON.stringify(defaultConfig, null, 2));\n  repairsMade.push('config.json restored');\n  logHook('setup-repair', 'Restored default config.json');\n}\n\n/**\n * Repair: Fix hook permissions\n */\nfunction repairHookPermissions(pluginRoot: string): void {\n  let fixed = 0;\n\n  const fixPermissions = (dir: string, depth = 0) => {\n    if (depth > 5) return;\n\n    try {\n      const entries = readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        const fullPath = `${dir}/${entry.name}`;\n        if (entry.isDirectory() && !entry.name.startsWith('.')) {\n          fixPermissions(fullPath, depth + 1);\n        } else if (entry.name.endsWith('.sh')) {\n          try {\n            const stats = statSync(fullPath);\n            if (!(stats.mode & 0o111)) {\n              chmodSync(fullPath, 0o755);\n              fixed++;\n            }\n          } catch {\n            // Ignore\n          }\n        }\n      }\n    } catch {\n      // Ignore\n    }\n  };\n\n  fixPermissions(`${pluginRoot}/hooks`);\n\n  if (fixed > 0) {\n    repairsMade.push(`${fixed} hook permissions fixed`);\n    logHook('setup-repair', `Fixed permissions on ${fixed} hooks`);\n  }\n}\n\n/**\n * Repair: Ensure required directories exist\n */\nfunction repairDirectories(pluginRoot: string): void {\n  let dirsCreated = 0;\n\n  // Issue #362: Skip coordination dir when Agent Teams is active \u2014 Teams\n  // provides native coordination, custom .claude/coordination is unused.\n  const requiredDirs = [\n    `${pluginRoot}/.claude/defaults`,\n    `${pluginRoot}/.claude/context/session`,\n    `${pluginRoot}/.claude/context/knowledge`,\n    `${pluginRoot}/.claude/logs`,\n    ...(isAgentTeamsActive() ? [] : [`${pluginRoot}/.claude/coordination`]),\n  ];\n\n  for (const dir of requiredDirs) {\n    if (!existsSync(dir)) {\n      try {\n        mkdirSync(dir, { recursive: true });\n        dirsCreated++;\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  if (dirsCreated > 0) {\n    repairsMade.push(`${dirsCreated} directories created`);\n    logHook('setup-repair', `Created ${dirsCreated} missing directories`);\n  }\n}\n\n/**\n * Repair: Regenerate marker file\n */\nfunction repairMarker(pluginRoot: string): void {\n  const now = new Date().toISOString();\n\n  // Count components\n  let hookCount = 0;\n  let skillCount = 0;\n  let agentCount = 0;\n\n  const countFiles = (dir: string, pattern: RegExp, maxDepth = 5): number => {\n    let count = 0;\n    const walk = (d: string, depth: number) => {\n      if (depth > maxDepth) return;\n      try {\n        const entries = readdirSync(d, { withFileTypes: true });\n        for (const entry of entries) {\n          const fullPath = `${d}/${entry.name}`;\n          if (entry.isDirectory() && !entry.name.startsWith('.')) {\n            walk(fullPath, depth + 1);\n          } else if (pattern.test(entry.name)) {\n            count++;\n          }\n        }\n      } catch {\n        // Ignore\n      }\n    };\n    walk(dir, 0);\n    return count;\n  };\n\n  try {\n    hookCount = countFiles(`${pluginRoot}/hooks`, /\\.sh$/);\n    skillCount = countFiles(`${pluginRoot}/skills`, /SKILL\\.md$/);\n    agentCount = countFiles(`${pluginRoot}/agents`, /\\.md$/);\n  } catch {\n    // Ignore\n  }\n\n  const marker = {\n    version: CURRENT_VERSION,\n    setup_date: now,\n    preset: 'complete',\n    repaired_at: now,\n    components: {\n      hooks: { count: hookCount, valid: true },\n      skills: { count: skillCount, valid: true },\n      agents: { count: agentCount, valid: true },\n    },\n    last_health_check: now,\n    last_maintenance: now,\n    environment: {\n      os: process.platform,\n    },\n    user_preferences: {\n      onboarding_completed: true,\n      mcp_configured: false,\n      statusline_configured: false,\n    },\n  };\n\n  const markerFile = `${pluginRoot}/.setup-complete`;\n  writeFileSync(markerFile, JSON.stringify(marker, null, 2));\n  repairsMade.push('marker file regenerated');\n  logHook('setup-repair', 'Regenerated marker file');\n}\n\n/**\n * Check for critical missing components\n */\nfunction checkCriticalComponents(pluginRoot: string): boolean {\n  let criticalMissing = 0;\n\n  // Count hooks\n  let hookCount = 0;\n  try {\n    const countFiles = (dir: string): number => {\n      let count = 0;\n      const walk = (d: string, depth: number) => {\n        if (depth > 4) return;\n        try {\n          const entries = readdirSync(d, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${d}/${entry.name}`;\n            if (entry.isDirectory() && !entry.name.startsWith('.')) {\n              walk(fullPath, depth + 1);\n            } else if (entry.name.endsWith('.sh')) {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n      };\n      walk(dir, 0);\n      return count;\n    };\n    hookCount = countFiles(`${pluginRoot}/hooks`);\n  } catch {\n    // Ignore\n  }\n\n  if (hookCount < 20) {\n    logHook('setup-repair', `CRITICAL: Only ${hookCount} hooks found (expected 50+)`);\n    criticalMissing++;\n  }\n\n  // Count skills\n  let skillCount = 0;\n  try {\n    const countFiles = (dir: string): number => {\n      let count = 0;\n      const walk = (d: string, depth: number) => {\n        if (depth > 2) return;\n        try {\n          const entries = readdirSync(d, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${d}/${entry.name}`;\n            if (entry.isDirectory() && !entry.name.startsWith('.')) {\n              walk(fullPath, depth + 1);\n            } else if (entry.name === 'SKILL.md') {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n      };\n      walk(dir, 0);\n      return count;\n    };\n    skillCount = countFiles(`${pluginRoot}/skills`);\n  } catch {\n    // Ignore\n  }\n\n  if (skillCount < 50) {\n    logHook('setup-repair', `CRITICAL: Only ${skillCount} skills found (expected 100+)`);\n    criticalMissing++;\n  }\n\n  // Check for common.sh library\n  if (!existsSync(`${pluginRoot}/hooks/_lib/common.sh`)) {\n    logHook('setup-repair', 'CRITICAL: hooks/_lib/common.sh missing');\n    criticalMissing++;\n  }\n\n  if (criticalMissing >= 2) {\n    repairsFailed.push('Multiple critical components missing - reinstall recommended');\n    notifyUser = true;\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Setup repair hook\n */\nexport function setupRepair(_input: HookInput): HookResult {\n  const pluginRoot = getPluginRoot();\n\n  logHook('setup-repair', 'Setup repair starting');\n\n  // Run repairs in order of importance\n  repairDirectories(pluginRoot);\n  repairConfig(pluginRoot);\n  repairHookPermissions(pluginRoot);\n\n  // Check for critical missing components\n  if (!checkCriticalComponents(pluginRoot)) {\n    logHook('setup-repair', 'WARN: Critical components missing, repair incomplete');\n  }\n\n  // Regenerate marker file last (after other repairs)\n  repairMarker(pluginRoot);\n\n  // Build output message\n  let repairSummary = '';\n  if (repairsMade.length > 0) {\n    repairSummary = `Repairs: ${repairsMade.join(', ')}`;\n  }\n\n  if (repairsFailed.length > 0) {\n    repairSummary = `${repairSummary ? `${repairSummary}. ` : ''}Issues: ${repairsFailed.join(', ')}`;\n    notifyUser = true;\n  }\n\n  logHook('setup-repair', `Repair complete: ${repairsMade.length} repairs made, ${repairsFailed.length} issues`);\n\n  // Output result\n  if (notifyUser && repairSummary) {\n    return outputWithContext(`OrchestKit auto-repair: ${repairSummary}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-28\n\n/**\n * Sync Setup Dispatcher \u2014 Setup Hook\n * Consolidates 6 Setup hooks into a single dispatcher.\n *\n * Consolidated hooks:\n * - unified-dispatcher (was async \u2014 becomes internal sub-hook, runs dependency-version-check)\n * - setup-check (once: true \u2014 fast path validation, triggers maintenance/repair)\n * - first-run-setup (once: true \u2014 full first-run initialization)\n * - setup-maintenance (periodic maintenance tasks)\n * - setup-repair (self-healing for broken installations)\n * - monorepo-detector (once: true \u2014 detects monorepo structure)\n *\n * NOT consolidated (remain separate in hooks.json):\n * None \u2014 all Setup hooks are consolidated here.\n *\n * CC 2.1.11 Compliant: Single sync hook with merged systemMessage output.\n * Once-gate pattern: setup-check, first-run-setup, monorepo-detector run only once per install.\n */\n\nimport { existsSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, extractContext } from '../lib/common.js';\n\n// Import consolidated hook implementations\nimport { unifiedSetupDispatcher } from './unified-dispatcher.js';\nimport { setupCheck } from './setup-check.js';\nimport { firstRunSetup } from './first-run-setup.js';\nimport { setupMaintenance } from './setup-maintenance.js';\nimport { setupRepair } from './setup-repair.js';\nimport { monorepoDetector } from './monorepo-detector.js';\n\nconst HOOK_NAME = 'sync-setup-dispatcher';\n\n// -----------------------------------------------------------------------------\n// Once-gate helpers\n// -----------------------------------------------------------------------------\n\nfunction hasRunOnce(hookName: string): boolean {\n  const markerDir = join(homedir(), '.claude', 'ork', 'once-markers');\n  const marker = join(markerDir, `${hookName}.done`);\n  return existsSync(marker);\n}\n\nfunction markAsRun(hookName: string): void {\n  const markerDir = join(homedir(), '.claude', 'ork', 'once-markers');\n  mkdirSync(markerDir, { recursive: true });\n  writeFileSync(join(markerDir, `${hookName}.done`), new Date().toISOString());\n}\n\n// -----------------------------------------------------------------------------\n// Hook registry\n// -----------------------------------------------------------------------------\n\ninterface SyncHookConfig {\n  name: string;\n  fn: (input: HookInput) => HookResult | Promise<HookResult>;\n  once?: boolean;\n}\n\n/**\n * Registry of Setup hooks, executed sequentially.\n * Order matters \u2014 unified-dispatcher runs first (dep checks), then setup-check,\n * first-run-setup, maintenance, repair, and monorepo-detector last.\n */\nconst SYNC_HOOKS: SyncHookConfig[] = [\n  { name: 'unified-dispatcher', fn: unifiedSetupDispatcher },\n  { name: 'setup-check', fn: setupCheck, once: true },\n  { name: 'first-run-setup', fn: firstRunSetup, once: true },\n  { name: 'setup-maintenance', fn: setupMaintenance },\n  { name: 'setup-repair', fn: setupRepair },\n  { name: 'monorepo-detector', fn: monorepoDetector, once: true },\n];\n\n// -----------------------------------------------------------------------------\n// Dispatcher implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Consolidated sync Setup dispatcher.\n * Runs all Setup hooks sequentially, respecting once-gate for hooks marked once: true.\n * Merges systemMessage/additionalContext outputs.\n */\nexport async function syncSetupDispatcher(input: HookInput): Promise<HookResult> {\n  const messages: string[] = [];\n\n  for (const hook of SYNC_HOOKS) {\n    // Skip once-gated hooks that have already run\n    if (hook.once && hasRunOnce(hook.name)) {\n      logHook(HOOK_NAME, `${hook.name}: skipped (already ran once)`);\n      continue;\n    }\n\n    try {\n      const resultOrPromise = hook.fn(input);\n      const result = resultOrPromise instanceof Promise ? await resultOrPromise : resultOrPromise;\n\n      // Mark once-gated hooks after successful run\n      if (hook.once) {\n        markAsRun(hook.name);\n      }\n\n      // Collect systemMessage (primary output channel for Setup)\n      if (result.systemMessage) {\n        messages.push(result.systemMessage);\n        logHook(HOOK_NAME, `${hook.name}: systemMessage collected`);\n      }\n\n      // Fallback: extract additionalContext\n      const context = extractContext(result);\n      if (context && !result.systemMessage) {\n        messages.push(context);\n        logHook(HOOK_NAME, `${hook.name}: additionalContext converted to systemMessage`);\n      }\n    } catch (error) {\n      const msg = error instanceof Error ? error.message : String(error);\n      logHook(HOOK_NAME, `${hook.name} failed: ${msg}`, 'warn');\n    }\n  }\n\n  if (messages.length === 0) {\n    logHook(HOOK_NAME, 'All Setup hooks silent');\n    return outputSilentSuccess();\n  }\n\n  const merged = messages.join('\\n');\n  logHook(HOOK_NAME, `Merged ${messages.length} messages from Setup hooks`);\n\n  return {\n    continue: true,\n    systemMessage: merged,\n  };\n}\n", "/**\n * Setup Hooks Entry Point\n *\n * Hooks that run during setup (--init, --maintenance)\n * Bundle: setup.mjs (~15 KB estimated)\n */\n\n// Re-export types and utilities\nexport * from '../types.js';\nexport * from '../lib/common.js';\n\n// Setup hooks (6)\nimport { unifiedSetupDispatcher } from '../setup/unified-dispatcher.js';\nimport { firstRunSetup } from '../setup/first-run-setup.js';\nimport { monorepoDetector } from '../setup/monorepo-detector.js';\nimport { setupCheck } from '../setup/setup-check.js';\nimport { setupMaintenance } from '../setup/setup-maintenance.js';\nimport { setupRepair } from '../setup/setup-repair.js';\nimport { syncSetupDispatcher } from '../setup/sync-setup-dispatcher.js';\n\nimport type { HookFn } from '../types.js';\n\n/**\n * Setup hooks registry\n */\nexport const hooks: Record<string, HookFn> = {\n  'setup/unified-dispatcher': unifiedSetupDispatcher,\n  'setup/first-run-setup': firstRunSetup,\n  'setup/monorepo-detector': monorepoDetector,\n  'setup/setup-check': setupCheck,\n  'setup/setup-maintenance': setupMaintenance,\n  'setup/setup-repair': setupRepair,\n  'setup/sync-setup-dispatcher': syncSetupDispatcher,\n};\n\nexport function getHook(name: string): HookFn | undefined {\n  return hooks[name];\n}\n\nexport function listHooks(): string[] {\n  return Object.keys(hooks);\n}\n"],
  "mappings": "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",
  "names": ["isBashInput", "input", "isWriteInput", "isEditInput", "isReadInput", "existsSync", "statSync", "renameSync", "mkdirSync", "readSync", "appendFileSync", "mkdirSync", "dirname", "buffer", "flushing", "handlersRegistered", "bufferWrite", "filePath", "content", "ensureHandlers", "flush", "grouped", "entry", "arr", "path", "contents", "ensureHandlers", "handlersRegistered", "flush", "execSync", "os", "path", "getHomeDir", "getTempDir", "getProjectDir", "getPluginRoot", "getLogDir", "joinPath", "path", "pathSeparator", "execSync", "createHash", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "join", "basename", "MAX_PROJECT_LENGTH", "MAX_BRANCH_LENGTH", "SAFE_CHARS", "getProjectName", "projectDir", "dir", "name", "sanitizeName", "getGitBranchForSession", "branch", "sanitized", "formatDateComponent", "date", "d", "month", "day", "formatTimeComponent", "hours", "minutes", "generateShortHash", "entropy", "maxLength", "generateSmartSessionId", "project", "dateStr", "timeStr", "hash", "getCachedSessionId", "cachePath", "data", "age", "maxAge", "cacheSessionId", "sessionId", "instanceDir", "getOrGenerateSessionId", "cached", "newId", "getLogDir", "getProjectDir", "getPluginRoot", "getEnvFile", "getSessionId", "getOrGenerateSessionId", "getCachedBranch", "projectDir", "branch", "execSync", "getLogLevel", "normalizeLineEndings", "content", "shouldLog", "level", "levels", "outputSilentSuccess", "outputSilentAllow", "outputBlock", "reason", "outputWithContext", "ctx", "outputPromptContext", "outputWithNotification", "userMessage", "claudeContext", "result", "outputAllowWithContext", "systemMessage", "outputError", "message", "outputWarning", "outputStderrWarning", "outputDeny", "outputWithUpdatedInput", "updatedInput", "LOG_ROTATION_MAX_SIZE", "PERMISSION_LOG_MAX_SIZE", "rotateLogFile", "logFile", "maxSize", "existsSync", "statSync", "rotated", "renameSync", "ensureDir", "dir", "mkdirSync", "logHook", "hookName", "logDir", "timestamp", "bufferWrite", "logPermissionFeedback", "decision", "input", "toolName", "sessionId", "extractContext", "estimateTokenCount", "charsPerToken", "outputPromptContextBudgeted", "category", "budgetChecker", "tokenTracker", "tokens", "readHookInput", "chunks", "buf", "bytesRead", "fd", "readSync", "getField", "path", "parts", "value", "part", "lineContainsAll", "terms", "line", "t", "lineContainsAllCI", "lower", "normalizeCommand", "command", "escapeRegex", "str", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "KNOWN_VULNS", "CACHE_TTL_HOURS", "shouldSkipSlowHooks", "versionLessThan", "current", "target", "currentParts", "p", "targetParts", "i", "t", "versionMatchesVuln", "currentVersion", "vulnPattern", "operator", "vulnVersion", "cleanVersion", "version", "checkPackageVulnerability", "packageName", "cleanedVersion", "pkgLower", "vuln", "getCachedWarnings", "cacheFile", "existsSync", "cache", "readFileSync", "saveCache", "warnings", "mkdirSync", "writeFileSync", "parsePackageJson", "filePath", "criticalCount", "highCount", "pkg", "allDeps", "parseRequirementsTxt", "lines", "line", "trimmed", "match", "dependencyVersionCheck", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "hasPackageJson", "hasRequirementsTxt", "hasPyprojectToml", "hasGoMod", "cached", "outputWithContext", "totalCritical", "totalHigh", "allWarnings", "result", "summary", "fullWarning", "HOOKS", "dependencyVersionCheck", "unifiedSetupDispatcher", "input", "logHook", "HOOKS", "results", "hook", "result", "error", "message", "failures", "outputSilentSuccess", "existsSync", "mkdirSync", "writeFileSync", "readdirSync", "chmodSync", "execSync", "CURRENT_VERSION", "detectEnvironment", "logHook", "envInfo", "match", "execSync", "validateDependencies", "missing", "warnings", "dep", "warn", "getPresetConfig", "preset", "configs", "applyConfiguration", "_envInfo", "pluginRoot", "config", "dirs", "dir", "mkdirSync", "configFile", "existsSync", "writeFileSync", "hooksDir", "makeExecutable", "entries", "readdirSync", "entry", "fullPath", "chmodSync", "createMarker", "now", "hookCount", "skillCount", "agentCount", "countFiles", "pattern", "count", "walk", "d", "marker", "markerFile", "firstRunSetup", "_input", "getPluginRoot", "mode", "valid", "ctx", "outputWithContext", "existsSync", "readFileSync", "readdirSync", "MONOREPO_INDICATORS", "countNestedPackageJsons", "projectDir", "count", "entries", "readdirSync", "entry", "subDir", "existsSync", "subEntries", "subEntry", "monorepoDetector", "input", "logHook", "packageNames", "dir", "pkgPath", "pkg", "readFileSync", "outputWithContext", "outputSilentSuccess", "getProjectDir", "detectedIndicators", "indicator", "nestedPackageCount", "indicators", "existsSync", "readFileSync", "readdirSync", "writeFileSync", "spawn", "CURRENT_VERSION", "getMarkerField", "markerFile", "field", "existsSync", "content", "readFileSync", "parts", "value", "part", "quickValidate", "pluginRoot", "errors", "configFile", "logHook", "hookCount", "countShFiles", "dir", "depth", "count", "entries", "readdirSync", "entry", "fullPath", "markerVersion", "isMaintenanceDue", "lastMaintenance", "lastEpoch", "updateMarker", "writeFileSync", "setupCheck", "input", "outputSilentSuccess", "getPluginRoot", "setupDir", "args", "outputWithContext", "maintenanceScript", "spawn", "repairScript", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "renameSync", "readdirSync", "unlinkSync", "rmSync", "statSync", "chmodSync", "execSync", "isAgentTeamsActive", "CURRENT_VERSION", "tasksCompleted", "getMarkerField", "markerFile", "field", "existsSync", "readFileSync", "updateMarkerField", "value", "content", "writeFileSync", "hoursSince", "timestamp", "lastEpoch", "taskLogRotation", "pluginRoot", "logHook", "logDirs", "getHomeDir", "rotated", "logDir", "files", "readdirSync", "file", "filePath", "statSync", "rotatedName", "renameSync", "execSync", "rotatedLogs", "f", "oldLog", "unlinkSync", "taskStaleLockCleanup", "coordDb", "cleaned", "isAgentTeamsActive", "lockCount", "walkAndClean", "dir", "depth", "entries", "entry", "fullPath", "stats", "taskSessionCleanup", "sessionDir", "archiveDir", "archived", "mkdirSync", "systemTmpDir", "getTempDir", "rmSync", "taskMemoryFabricCleanup", "projectDir", "logsDir", "taskHealthValidation", "issues", "nonExec", "checkExecutable", "chmodSync", "configFile", "taskVersionMigration", "markerVersion", "setupMaintenance", "input", "getPluginRoot", "getProjectDir", "args", "mode", "now", "lastMaintenance", "hours", "runDaily", "runWeekly", "summary", "outputSilentSuccess", "outputWithContext", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "renameSync", "readdirSync", "statSync", "chmodSync", "CURRENT_VERSION", "repairsMade", "repairsFailed", "notifyUser", "repairConfig", "pluginRoot", "configFile", "configDir", "mkdirSync", "existsSync", "readFileSync", "backup", "renameSync", "logHook", "writeFileSync", "repairHookPermissions", "fixed", "fixPermissions", "dir", "depth", "entries", "readdirSync", "entry", "fullPath", "statSync", "chmodSync", "repairDirectories", "dirsCreated", "requiredDirs", "isAgentTeamsActive", "repairMarker", "now", "hookCount", "skillCount", "agentCount", "countFiles", "pattern", "maxDepth", "count", "walk", "d", "marker", "markerFile", "checkCriticalComponents", "criticalMissing", "setupRepair", "_input", "getPluginRoot", "repairSummary", "outputWithContext", "outputSilentSuccess", "existsSync", "writeFileSync", "mkdirSync", "join", "homedir", "HOOK_NAME", "hasRunOnce", "hookName", "markerDir", "join", "homedir", "marker", "existsSync", "markAsRun", "mkdirSync", "writeFileSync", "SYNC_HOOKS", "unifiedSetupDispatcher", "setupCheck", "firstRunSetup", "setupMaintenance", "setupRepair", "monorepoDetector", "syncSetupDispatcher", "input", "messages", "hook", "logHook", "resultOrPromise", "result", "context", "extractContext", "error", "msg", "outputSilentSuccess", "merged", "hooks", "unifiedSetupDispatcher", "firstRunSetup", "monorepoDetector", "setupCheck", "setupMaintenance", "setupRepair", "syncSetupDispatcher", "getHook", "name", "listHooks"]
}
