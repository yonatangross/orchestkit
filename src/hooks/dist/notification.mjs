// OrchestKit Hooks - notification bundle
// Generated: 2026-02-25T14:40:22.083Z

function wt(t){return typeof t.command=="string"}function Nt(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function At(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Ut(t){return typeof t.file_path=="string"&&t.content===void 0}import{existsSync as $,statSync as pt,renameSync as gt,mkdirSync as ft,readSync as lt}from"node:fs";import{appendFileSync as B,mkdirSync as M}from"node:fs";import{dirname as G}from"node:path";var p=[],m=!1,H=!1;function h(t,e){p.push({filePath:t,content:e}),J()}function S(){if(m||p.length===0)return;m=!0;let t=new Map;for(let e of p){let n=t.get(e.filePath);n?n.push(e.content):t.set(e.filePath,[e.content])}for(let[e,n]of t)try{M(G(e),{recursive:!0}),B(e,n.join(""))}catch{}p.length=0,m=!1}function J(){H||(H=!0,process.on("exit",S),process.on("SIGTERM",()=>{S(),process.exit(0)}),process.on("SIGINT",()=>{S(),process.exit(0)}))}import{execSync as dt}from"node:child_process";import W from"node:os";import g from"node:path";function z(){return process.env.HOME||process.env.USERPROFILE||W.homedir()}function k(){return process.env.CLAUDE_PROJECT_DIR||"."}function E(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function O(){return process.env.CLAUDE_PLUGIN_ROOT?g.join(z(),".claude","logs","ork"):g.join(k(),".claude","logs")}var Jt=g.join,Wt=g.sep;import{execSync as K}from"node:child_process";import{createHash as Z}from"node:crypto";import{existsSync as b,readFileSync as X,writeFileSync as q,mkdirSync as V}from"node:fs";import{join as x,basename as Q}from"node:path";var Y=20,tt=15,et=/[^a-z0-9-]/g;function nt(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=Q(e);return T(n,Y)}function ot(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=K("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=T(n||"detached",tt);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function rt(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function it(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function st(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return Z("sha256").update(t).digest("hex").slice(0,4)}function T(t,e){return t.toLowerCase().replace(et,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function ut(t,e){let n=nt(t),o=ot(t),r=rt(e),i=it(e),c=st();return`${n}-${o}-${r}-${i}-${c}`}function ct(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=x(e,".instance","session-id.json");if(b(n))try{let o=JSON.parse(X(n,"utf8"));if(o.session_id&&o.created_at){let r=Date.now()-new Date(o.created_at).getTime(),i=1440*60*1e3;if(r<i)return o.session_id}}catch{}}function at(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=x(n,".instance"),r=x(o,"session-id.json");try{b(o)||V(o,{recursive:!0}),q(r,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function C(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=ct(t);if(e)return e;let n=ut(t);return at(n,t),n}function v(){return O()}function y(){return k()}function mt(){return E()}function oe(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${mt()}/.claude/.instance_env`}function _(){return C()}function D(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=dt("git branch --show-current",{cwd:t||y(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function St(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function re(t){return t.replace(/\r\n/g,`
`)}function ht(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(St())}function s(){return{continue:!0,suppressOutput:!0}}function ie(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function se(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function ue(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function kt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function ce(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function ae(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function pe(t){return{continue:!0,systemMessage:t}}function ge(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function fe(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function le(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function de(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var xt=200*1024,_t=100*1024;function P(t,e){if($(t))try{if(pt(t).size>e){let o=`${t}.old.${Date.now()}`;gt(t,o)}}catch{}}function w(t){$(t)||ft(t,{recursive:!0})}function u(t,e,n="debug"){if(!ht(n))return;let o=v(),r=`${o}/hooks.log`;try{w(o),P(r,xt);let i=new Date().toISOString().replace("T"," ").slice(0,19);h(r,`[${i}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function me(t,e,n){let o=v(),r=`${o}/permission-feedback.log`;try{w(o),P(r,_t);let i=new Date().toISOString(),c=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=n?.session_id||_();h(r,`${i} | ${t} | ${e} | tool=${c} | session=${a}
`)}catch{}}function Se(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function yt(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function he(t,e,n,o,r){let i=yt(t);return o?.isOverBudget(n)?(u(e,`Budget exhausted for ${n}, suppressing ${i}t`),s()):(r&&r.trackTokenUsage(e,n,i),kt(t))}function ke(){try{let t=[],n=Buffer.allocUnsafe(256),o,r=0;for(;;)try{if(o=lt(r,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:_(),tool_input:{}}}catch{return{tool_name:"",session_id:_(),tool_input:{}}}}function xe(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let r of n){if(o==null)return;o=o[r]}return o}function _e(t,...e){return t.split(`
`).some(n=>e.every(o=>n.includes(o)))}function ye(t,...e){return t.split(`
`).some(n=>{let o=n.toLowerCase();return e.every(r=>o.includes(r.toLowerCase()))})}function Re(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function Ie(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as I}from"node:child_process";import{basename as Rt}from"node:path";function f(t){return`'${t.replace(/'/g,"'\\''")}'`}function N(t){if(!t||!/^[a-zA-Z0-9_-]+$/.test(t))throw new Error(`Unsafe command name: ${JSON.stringify(t)}`);return t}var A={permission_prompt:"Sosumi",idle_prompt:"Ping",default:"Ping"};function R(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function U(t){try{return N(t),I(`command -v ${t}`,{stdio:"ignore"}),!0}catch{return!1}}function It(t){let e=t.match(/(?:feature|fix|bug|issue)[/-](\d+)/i);return e?`#${e[1]}`:null}function Ht(){try{let t=y();return Rt(t)}catch{return"Claude Code"}}function Et(t,e){let n=It(t),o=e==="permission_prompt"?"\u23F8 Permission needed":"\u{1F4A4} Waiting";return n?`${o} \xB7 ${n} \xB7 ${t}`:`${o} \xB7 ${t}`}function Ot(t,e=120){return t.length<=e?t:`${t.substring(0,e-3)}...`}function bt(t,e,n,o){try{let r=R(t),i=R(e),a=`display notification "${R(Ot(n))}" with title "${r}" subtitle "${i}" sound name "${o}"`;return I(`osascript -e ${f(a)}`,{stdio:"ignore",timeout:5e3}),!0}catch{return!1}}function Tt(t,e,n){try{let o=`${e}
${n}`;return I(`notify-send -- ${f(t)} ${f(o)}`,{stdio:"ignore",timeout:5e3}),!0}catch{return!1}}function l(t){let e=t.tool_input||{},n=e.message||t.message||"",o=e.notification_type||t.notification_type||"";if(u("desktop",`Notification: [${o}] ${n.substring(0,100)}`),o!=="permission_prompt"&&o!=="idle_prompt")return s();let r=Ht(),i=D(),c=Et(i,o),a=A[o]||A.default;return U("osascript")?bt(r,c,n,a):U("notify-send")&&Tt(r,c,n),s()}import{execSync as Ct,spawn as $t}from"node:child_process";var vt={permission_prompt:"/System/Library/Sounds/Sosumi.aiff",idle_prompt:"/System/Library/Sounds/Ping.aiff",auth_success:"/System/Library/Sounds/Glass.aiff"};function Dt(){try{return Ct("command -v afplay",{stdio:"ignore"}),!0}catch{return!1}}function Pt(t){try{$t("afplay",[t],{stdio:"ignore",detached:!0}).unref()}catch{}}function d(t){let n=(t.tool_input||{}).notification_type||"";if(u("sound",`Sound notification check: [${n}]`),Dt()){let o=vt[n];o&&Pt(o)}return s()}var L=[{name:"desktop",fn:l},{name:"sound",fn:d}];async function F(t){let n=(await Promise.allSettled(L.map(async o=>{try{let r=o.fn(t);return r instanceof Promise&&await r,{hook:o.name,status:"success"}}catch(r){let i=r instanceof Error?r.message:String(r);return u("notification-dispatcher",`${o.name} failed: ${i}`),{hook:o.name,status:"error",message:i}}}))).filter(o=>o.status==="rejected"||o.status==="fulfilled"&&o.value.status==="error");return n.length>0&&u("notification-dispatcher",`${n.length}/${L.length} hooks had errors`),s()}var j={"notification/desktop":l,"notification/sound":d,"notification/unified-dispatcher":F};function Be(t){return j[t]}function Me(){return Object.keys(j)}export{Ie as escapeRegex,yt as estimateTokenCount,Se as extractContext,D as getCachedBranch,oe as getEnvFile,xe as getField,Be as getHook,v as getLogDir,St as getLogLevel,mt as getPluginRoot,y as getProjectDir,_ as getSessionId,j as hooks,wt as isBashInput,At as isEditInput,Ut as isReadInput,Nt as isWriteInput,_e as lineContainsAll,ye as lineContainsAllCI,Me as listHooks,u as logHook,me as logPermissionFeedback,Re as normalizeCommand,re as normalizeLineEndings,ae as outputAllowWithContext,se as outputBlock,le as outputDeny,pe as outputError,kt as outputPromptContext,he as outputPromptContextBudgeted,ie as outputSilentAllow,s as outputSilentSuccess,fe as outputStderrWarning,ge as outputWarning,ue as outputWithContext,ce as outputWithNotification,de as outputWithUpdatedInput,ke as readHookInput,ht as shouldLog};
//# sourceMappingURL=notification.mjs.map
