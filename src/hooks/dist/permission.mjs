// OrchestKit Hooks - permission bundle
// Generated: 2026-02-28T13:40:06.750Z

var V=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function te(t){return typeof t.command=="string"}function ee(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function ne(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function oe(t){return typeof t.file_path=="string"&&t.content===void 0}import{existsSync as k,statSync as Rt,renameSync as Et,mkdirSync as N,readSync as It,readFileSync as vt,writeFileSync as yt}from"node:fs";import{join as bt}from"node:path";import{appendFileSync as Q,mkdirSync as Y}from"node:fs";import{dirname as tt}from"node:path";var m=[],E=!1,P=!1;function v(t,e){m.push({filePath:t,content:e}),et()}function I(){if(E||m.length===0)return;E=!0;let t=new Map;for(let e of m){let n=t.get(e.filePath);n?n.push(e.content):t.set(e.filePath,[e.content])}for(let[e,n]of t)try{Y(tt(e),{recursive:!0}),Q(e,n.join(""))}catch{}m.length=0,E=!1}function et(){P||(P=!0,process.on("exit",I),process.on("SIGTERM",()=>{I(),process.exit(0)}),process.on("SIGINT",()=>{I(),process.exit(0)}))}import{execSync as Ht}from"node:child_process";import nt from"node:os";import h from"node:path";function ot(){return process.env.HOME||process.env.USERPROFILE||nt.homedir()}function y(){return process.env.CLAUDE_PROJECT_DIR||"."}function D(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function A(){return process.env.CLAUDE_PLUGIN_ROOT?h.join(ot(),".claude","logs","ork"):h.join(y(),".claude","logs")}var pe=h.join,le=h.sep;import{execSync as rt}from"node:child_process";import{createHash as st}from"node:crypto";import{existsSync as $,readFileSync as it,writeFileSync as ut,mkdirSync as at}from"node:fs";import{join as b,basename as ct}from"node:path";var pt=20,lt=15,ft=/[^a-z0-9-]/g;function gt(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=ct(e);return j(n,pt)}function dt(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=rt("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=j(n||"detached",lt);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function mt(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function ht(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function kt(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return st("sha256").update(t).digest("hex").slice(0,4)}function j(t,e){return t.toLowerCase().replace(ft,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function xt(t,e){let n=gt(t),o=dt(t),r=mt(e),i=ht(e),g=kt();return`${n}-${o}-${r}-${i}-${g}`}function St(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=b(e,".instance","session-id.json");if($(n))try{let o=JSON.parse(it(n,"utf8"));if(o.session_id&&o.created_at){let r=Date.now()-new Date(o.created_at).getTime(),i=1440*60*1e3;if(r<i)return o.session_id}}catch{}}function _t(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=b(n,".instance"),r=b(o,"session-id.json");try{$(o)||at(o,{recursive:!0}),ut(r,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function L(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=St(t);if(e)return e;let n=xt(t);return _t(n,t),n}function M(){return A()}function C(){return y()}function T(){return D()}function ve(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${T()}/.claude/.instance_env`}function H(){return L()}function ye(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=Ht("git branch --show-current",{cwd:t||C(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function Ct(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function be(t){return t.replace(/\r\n/g,`
`)}function Tt(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(Ct())}function s(){return{continue:!0,suppressOutput:!0}}function c(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function He(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function Ce(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function wt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function Te(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function we(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function Oe(t){return{continue:!0,systemMessage:t}}function Pe(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function De(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function Ae(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function $e(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var Ot=200*1024,Pt=100*1024;function U(t,e){if(k(t))try{if(Rt(t).size>e){let o=`${t}.old.${Date.now()}`;Et(t,o)}}catch{}}function B(t){k(t)||N(t,{recursive:!0})}function u(t,e,n="debug"){if(!Tt(n))return;let o=M(),r=`${o}/hooks.log`;try{B(o),U(r,Ot);let i=new Date().toISOString().replace("T"," ").slice(0,19);v(r,`[${i}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function p(t,e,n){let o=M(),r=`${o}/permission-feedback.log`;try{B(o),U(r,Pt);let i=new Date().toISOString(),g=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=n?.session_id||H();v(r,`${i} | ${t} | ${e} | tool=${g} | session=${a}
`)}catch{}}function je(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function Dt(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function Le(t,e,n,o,r){let i=Dt(t);return o?.isOverBudget(n)?(u(e,`Budget exhausted for ${n}, suppressing ${i}t`),s()):(r&&r.trackTokenUsage(e,n,i),wt(t))}function F(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e=Math.imul(e,16777619);return(e>>>0).toString(16).padStart(8,"0")}function Fe(t,e,n,o){let r=bt(t,e);if(k(r))try{let i=vt(r,"utf8");if(F(i)===F(n))return u(o,`Rules file ${e} unchanged, skipping write`),!1}catch{}return k(t)||N(t,{recursive:!0}),yt(r,n,"utf8"),u(o,`Wrote rules file: ${r}`),!0}function Ne(){try{let t=[],n=Buffer.allocUnsafe(256),o,r=0;for(;;)try{if(o=It(r,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:H(),tool_input:{}}}catch{return{tool_name:"",session_id:H(),tool_input:{}}}}function Me(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let r of n){if(o==null)return;o=o[r]}return o}function Ue(t,...e){return t.split(`
`).some(n=>e.every(o=>n.includes(o)))}function Be(t,...e){return t.split(`
`).some(n=>{let o=n.toLowerCase();return e.every(r=>o.includes(r.toLowerCase()))})}function Ge(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function We(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function G(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function At(t,e){let n=t.split("*"),o=0;for(let r of n){if(r==="")continue;let i=r;if(i.indexOf("?")>=0){let a=!1;for(let d=o;d<=e.length-i.length;d++){let O=!0;for(let l=0;l<i.length;l++)if(i[l]!=="?"&&i[l]!==e[d+l]){O=!1;break}if(O){o=d+i.length,a=!0;break}}if(!a)return!1}else{let a=e.indexOf(i,o);if(a===-1)return!1;o=a+i.length}}return!0}function Xe(t){return e=>t(e)?null:s()}function w(t,...e){let n=t.tool_input.file_path;if(!n)return s();let o=n.split(".").pop()?.toLowerCase()||"";return e.map(i=>i.toLowerCase().replace(/^\./,"")).includes(o)?null:s()}function Ze(t){return w(t,"py","ts","tsx","js","jsx","go","rs","java")}function Ve(t){return w(t,"py")}function Qe(t){return w(t,"ts","tsx","js","jsx")}function Ye(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(o=>o.test(e))?null:s():s()}function tn(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(o=>o.test(e))?s():null}function en(t,...e){let n=t.tool_input.file_path;if(!n)return s();for(let o of e)if(typeof o=="string"){if(At(o,n))return null}else if(o.test(n))return null;return s()}function W(t,...e){let n=t.tool_name;return n?e.includes(n)?null:s():s()}function nn(t){return W(t,"Write","Edit")}function on(t){return W(t,"Bash")}function rn(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(o=>o.test(e))?s():null}function sn(t){return(t.tool_input.command||"").startsWith("git")?null:s()}function un(t){if(G())return s();let n=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:o}=V("node:fs");if(o(n))return null}catch{}return s()}function an(t,...e){for(let n of e){let o=n(t);if(o!==null)return o}return null}function cn(t){return t.permissionMode==="dontAsk"}function $t(t){return t.replace(/\\x([0-9a-fA-F]{2})/g,(e,n)=>String.fromCharCode(parseInt(n,16)))}function jt(t){return t.replace(/\\([0-7]{3})/g,(e,n)=>String.fromCharCode(parseInt(n,8)))}function Lt(t){return t.replace(/\\([^\s])/g,"$1")}function Ft(t){let e=t;return e=e.replace(/"([^"]*)"/g,"$1"),e=e.replace(/'([^']*)'/g,"$1"),e}function f(t){let e=t;return e=$t(e),e=jt(e),e=Lt(e),e=Ft(e),e=e.replace(/\\\s*[\r\n]+/g," "),e=e.replace(/\n/g," "),e=e.replace(/\s+/g," "),e.trim()}function x(t){let e=t.replace(/\\\s*[\r\n]+/g," ");if(/\n/.test(e))return!0;let n=f(t);return/(?:&&|\|\||[|;])/.test(n)}var Nt=[/^git\s+checkout\s+--\s+\./,/^git\s+checkout\s+\.\s*$/,/^git\s+checkout\s+(-f|--force)/,/^git\s+clean/,/^git\s+reset\s+--hard/,/^git\s+push\s+.*--force/,/^git\s+push\s+-f\b/],Mt=[/^git (status|log|diff|branch|show|fetch|pull)/,/^git checkout\s+\S/,/^npm (list|ls|outdated|audit|run|test)/,/^pnpm (list|ls|outdated|audit|run|test)/,/^yarn (list|outdated|audit|run|test)/,/^poetry (show|run|env)/,/^docker (ps|images|logs|inspect)/,/^docker-compose (ps|logs)/,/^docker compose (ps|logs)/,/^ls(\s|$)/,/^pwd$/,/^echo\s/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^find\s/,/^which\s/,/^type\s/,/^env$/,/^printenv/,/^gh (issue|pr|repo|workflow) (list|view|status)/,/^gh milestone (list|view)/,/^pytest/,/^poetry run pytest/,/^npm run (test|lint|typecheck|format)/,/^ruff (check|format)/,/^ty check/,/^mypy/];function S(t){let e=t.tool_input.command||"";if(u("auto-approve-safe-bash",`Evaluating bash command: ${e.slice(0,50)}...`),e&&x(e))return u("auto-approve-safe-bash","Compound command detected, requiring manual approval"),s();let n=e?f(e):"";for(let o of Nt)if(o.test(n))return u("auto-approve-safe-bash",`Rejected: matches reject pattern ${o}`),s();for(let o of Mt)if(o.test(n))return u("auto-approve-safe-bash",`Auto-approved: matches safe pattern ${o}`),p("allow",`Matches safe pattern: ${o}`,t),c();return u("auto-approve-safe-bash","Command requires manual approval"),s()}import{resolve as Ut,isAbsolute as K,relative as Bt,normalize as z,sep as J}from"node:path";var Gt=["node_modules",".git","dist","build","__pycache__",".venv","venv"];function Wt(t,e){let n=Bt(z(e),z(t));return!n.startsWith("..")&&!K(n)}function zt(t){for(let e of Gt)if(t.includes(`${J}${e}${J}`))return!0;return!1}function q(t){let e=t.tool_input.file_path||"",n=t.project_dir||C();u("auto-approve-project-writes",`Evaluating write to: ${e}`),K(e)||(e=Ut(n,e));let o=[n,...t.added_dirs??[]];for(let r of o){if(!Wt(e,r))continue;if(zt(e))return u("auto-approve-project-writes",`Write to excluded directory in: ${r}`),s();let i=r===n?"project directory":`added dir ${r}`;return u("auto-approve-project-writes",`Auto-approved: within ${i}`),p("allow",`In-project write: ${e}`,t),c()}return u("auto-approve-project-writes","Write outside project directory - manual approval required"),s()}import{existsSync as Jt,readFileSync as Kt}from"node:fs";import{join as qt}from"node:path";var Xt=[/rm\s+-rf\s+[/~]/,/sudo\s/,/chmod\s+-R\s+777/,/>\s*\/dev\/sd/,/mkfs\./,/dd\s+if=/,{test:t=>t.includes(":")&&t.includes("()")&&t.includes("{")&&t.includes("|")&&t.includes("&")&&t.includes("}")},{test:t=>t.includes("curl")&&/\|\s*sh/.test(t)},{test:t=>t.includes("wget")&&/\|\s*sh/.test(t)}];function Zt(t){return Xt.some(e=>e.test(t))}function Vt(){let t=T(),e=qt(t,".claude","feedback","learned-patterns.json");try{if(Jt(e))return JSON.parse(Kt(e,"utf8")).autoApprovePatterns||[]}catch{}return[]}function Qt(t){let e=Vt(),n=f(t).toLowerCase();for(let o of e)if(!(typeof o!="string"||o.length===0||o.length>200)&&n.startsWith(o.toLowerCase().trim()))return!0;return!1}function _(t){let e=t.tool_name,n=t.tool_input.command||t.tool_input.file_path||"";if(u("learning-tracker",`Processing permission for tool: ${e}, command: ${n.slice(0,50)}...`),e==="Bash"&&n){if(Zt(n))return u("learning-tracker","Command matches security blocklist, skipping"),s();if(x(n))return u("learning-tracker","Compound command detected, skipping auto-approve"),s();if(Qt(n))return u("learning-tracker","Command matches learned auto-approve pattern"),p("allow","Learned pattern match",t),c()}return s()}var R="permission-bash-dispatcher";function X(t){try{let e=S(t);if(e.hookSpecificOutput?.permissionDecision==="allow")return u(R,"auto-approve-safe-bash: allowed"),e}catch(e){let n=e instanceof Error?e.message:String(e);u(R,`auto-approve-safe-bash failed: ${n}`,"warn")}try{let e=_(t);if(e.hookSpecificOutput?.permissionDecision==="allow")return u(R,"learning-tracker: allowed via learned pattern"),e}catch(e){let n=e instanceof Error?e.message:String(e);u(R,`learning-tracker failed: ${n}`,"warn")}return s()}var Z={"permission/auto-approve-safe-bash":S,"permission/auto-approve-project-writes":q,"permission/learning-tracker":_,"permission/unified-dispatcher":X};function On(t){return Z[t]}function Pn(){return Object.keys(Z)}export{Xe as createGuard,We as escapeRegex,Dt as estimateTokenCount,je as extractContext,F as fnv1aHash,ye as getCachedBranch,ve as getEnvFile,Me as getField,On as getHook,M as getLogDir,Ct as getLogLevel,T as getPluginRoot,C as getProjectDir,H as getSessionId,on as guardBash,Ze as guardCodeFiles,w as guardFileExtension,sn as guardGitCommand,un as guardMultiInstance,rn as guardNontrivialBash,en as guardPathPattern,Ve as guardPythonFiles,tn as guardSkipInternal,Ye as guardTestFiles,W as guardTool,Qe as guardTypescriptFiles,nn as guardWriteEdit,Z as hooks,te as isBashInput,cn as isDontAskMode,ne as isEditInput,oe as isReadInput,ee as isWriteInput,Ue as lineContainsAll,Be as lineContainsAllCI,Pn as listHooks,u as logHook,p as logPermissionFeedback,Ge as normalizeCommand,be as normalizeLineEndings,we as outputAllowWithContext,He as outputBlock,Ae as outputDeny,Oe as outputError,wt as outputPromptContext,Le as outputPromptContextBudgeted,c as outputSilentAllow,s as outputSilentSuccess,De as outputStderrWarning,Pe as outputWarning,Ce as outputWithContext,Te as outputWithNotification,$e as outputWithUpdatedInput,Ne as readHookInput,an as runGuards,Tt as shouldLog,Fe as writeRulesFile};
//# sourceMappingURL=permission.mjs.map
