{
  "version": 3,
  "sources": ["../src/types.ts", "../src/lib/common.ts", "../src/lib/analytics-buffer.ts", "../src/lib/paths.ts", "../src/lib/session-id-generator.ts", "../src/lib/git.ts", "../src/lib/agent-teams.ts", "../src/lib/guards.ts", "../src/lib/normalize-command.ts", "../src/pretool/bash/dangerous-command-blocker.ts", "../src/pretool/bash/git-validator.ts", "../src/pretool/bash/compound-command-validator.ts", "../src/pretool/bash/default-timeout-setter.ts", "../src/pretool/bash/error-pattern-warner.ts", "../src/pretool/bash/conflict-predictor.ts", "../src/lib/sanitize-shell.ts", "../src/pretool/bash/affected-tests-finder.ts", "../src/pretool/bash/ci-simulation.ts", "../src/pretool/bash/pre-commit-simulation.ts", "../src/pretool/bash/pr-merge-gate.ts", "../src/pretool/bash/changelog-generator.ts", "../src/pretool/bash/version-sync.ts", "../src/pretool/bash/license-compliance.ts", "../src/pretool/bash/gh-issue-creation-guide.ts", "../src/pretool/bash/issue-docs-requirement.ts", "../src/pretool/bash/multi-instance-quality-gate.ts", "../src/pretool/bash/agent-browser-safety.ts", "../src/pretool/bash/commit-atomicity-checker.ts", "../src/pretool/bash/issue-reference-checker.ts", "../src/pretool/write-edit/content-secret-scanner.ts", "../src/pretool/write-edit/file-guard.ts", "../src/pretool/Write/architecture-change-detector.ts", "../src/pretool/Write/code-quality-gate.ts", "../src/pretool/Write/docstring-enforcer.ts", "../src/pretool/Write/security-pattern-validator.ts", "../src/pretool/mcp/context7-tracker.ts", "../src/pretool/mcp/memory-validator.ts", "../src/pretool/mcp/notebooklm-advisor.ts", "../src/pretool/input-mod/write-headers.ts", "../src/pretool/skill/skill-tracker.ts", "../src/pretool/read/tldr-summary.ts", "../src/lib/code-summarizer.ts", "../src/pretool/task/team-size-gate.ts", "../src/pretool/bash/unified-advisory-dispatcher.ts", "../src/pretool/write-edit/unified-quality-dispatcher.ts", "../src/agent/block-writes.ts", "../src/agent/migration-safety-check.ts", "../src/agent/security-command-audit.ts", "../src/agent/ci-safety-check.ts", "../src/agent/deployment-safety-check.ts", "../src/pretool/task/unified-agent-safety-dispatcher.ts", "../src/pretool/bash/sync-bash-dispatcher.ts", "../src/pretool/write-edit/sync-write-edit-dispatcher.ts", "../src/pretool/task/sync-task-dispatcher.ts", "../src/entries/pretool.ts"],
  "sourcesContent": ["/**\n * TypeScript type definitions for Claude Code hooks\n * CC 2.1.9 compliant with additionalContext support\n */\n\n/**\n * Hook events supported by Claude Code\n */\nexport type HookEvent =\n  | 'PreToolUse'\n  | 'PostToolUse'\n  | 'PostToolUseFailure'\n  | 'PermissionRequest'\n  | 'UserPromptSubmit'\n  | 'SessionStart'\n  | 'SessionEnd'\n  | 'Stop'\n  | 'SubagentStart'\n  | 'SubagentStop'\n  | 'Setup'\n  | 'Notification'\n  | 'PreCompact'\n  | 'TeammateIdle'\n  | 'TaskCompleted'\n  | 'WorktreeCreate'\n  | 'WorktreeRemove'\n  | 'ConfigChange';\n\n/**\n * Hook input envelope from Claude Code (sent via stdin as JSON)\n */\nexport interface HookInput {\n  /** The hook event type */\n  hook_event?: HookEvent;\n  /** The tool being invoked */\n  tool_name: string;\n  /** Session ID (CC 2.1.9 guarantees availability) */\n  session_id: string;\n  /** Tool-specific input parameters */\n  tool_input: ToolInput;\n  /** Tool output (PostToolUse only) */\n  tool_output?: unknown;\n  /** Tool error message if any */\n  tool_error?: string;\n  /** Tool exit code */\n  exit_code?: number;\n  /** Whether a stop hook is currently active (prevents re-entry) */\n  stop_hook_active?: boolean;\n  /** Permission mode (CC 2.1.25: dontAsk mode makes quality gates warn-only) */\n  permissionMode?: 'default' | 'acceptEdits' | 'dontAsk';\n  /** User prompt (UserPromptSubmit only) */\n  prompt?: string;\n  /** Project directory */\n  project_dir?: string;\n\n  // SubagentStart/SubagentStop specific fields\n  /** Agent type for subagent hooks */\n  subagent_type?: string;\n  /** Agent type (alternative field name) */\n  agent_type?: string;\n  /** Agent ID */\n  agent_id?: string;\n  /** Agent output (SubagentStop) */\n  agent_output?: string;\n  /** Output (alternative field name) */\n  output?: string;\n  /** Error from subagent */\n  error?: string;\n  /** Duration in milliseconds */\n  duration_ms?: number;\n  /** Tool result \u2014 string from most hooks, object from Skill PostToolUse */\n  tool_result?: string | { is_error?: boolean; content?: string };\n\n  // TeammateIdle specific fields (CC 2.1.33)\n  /** Teammate agent ID */\n  teammate_id?: string;\n  /** Teammate agent type */\n  teammate_type?: string;\n  /** How long the teammate has been idle (ms) */\n  idle_duration_ms?: number;\n\n  // TaskCompleted specific fields (CC 2.1.33)\n  /** Completed task ID */\n  task_id?: string;\n  /** Task subject */\n  task_subject?: string;\n  /** Task result status */\n  task_status?: string;\n  /** Token count consumed by the task (CC 2.1.30) */\n  token_count?: number;\n  /** Number of tool invocations in the task (CC 2.1.30) */\n  tool_uses?: number;\n\n  // Notification specific fields\n  /** Notification message */\n  message?: string;\n  /** Notification type */\n  notification_type?: string;\n\n  // Stop/SubagentStop specific fields (CC 2.1.47)\n  /** The final assistant message text (Stop and SubagentStop, CC 2.1.47+) */\n  last_assistant_message?: string;\n\n  // Workspace/statusline fields (CC 2.1.47)\n  /** Directories added via /add-dir, from statusline workspace section (CC 2.1.47+) */\n  added_dirs?: string[];\n}\n\n/**\n * Tool input types - union of all tool inputs\n */\nexport interface ToolInput {\n  /** Bash command (Bash tool) */\n  command?: string;\n  /** Timeout in ms (Bash tool) */\n  timeout?: number;\n  /** File path (Write/Edit/Read tools) */\n  file_path?: string;\n  /** File content (Write tool) */\n  content?: string;\n  /** Old text to replace (Edit tool) */\n  old_string?: string;\n  /** New text (Edit tool) */\n  new_string?: string;\n  /** Pattern (Glob/Grep tools) */\n  pattern?: string;\n  /** Allow additional properties */\n  [key: string]: unknown;\n}\n\n/**\n * Hook-specific output for CC 2.1.9\n */\nexport interface HookSpecificOutput {\n  /** Hook event name for context */\n  hookEventName?: 'PreToolUse' | 'PostToolUse' | 'PostToolUseFailure' | 'PermissionRequest' | 'UserPromptSubmit';\n  /** Permission decision (PermissionRequest hooks) */\n  permissionDecision?: 'allow' | 'deny';\n  /** Reason for permission decision */\n  permissionDecisionReason?: string;\n  /** Additional context injected before tool execution (CC 2.1.9) */\n  additionalContext?: string;\n  /** Modified tool input (CC 2.1.25: canonical way to modify tool inputs) */\n  updatedInput?: Record<string, unknown>;\n}\n\n/**\n * Hook result - output JSON to stdout\n * CC 2.1.7+ compliant\n */\nexport interface HookResult {\n  /** Whether to continue execution */\n  continue: boolean;\n  /** Suppress hook output from user */\n  suppressOutput?: boolean;\n  /** System message shown to user */\n  systemMessage?: string;\n  /** Reason for stopping (when continue is false) */\n  stopReason?: string;\n  /** Hook-specific output fields */\n  hookSpecificOutput?: HookSpecificOutput;\n}\n\n/**\n * Hook function signature\n */\nexport type HookFn = (input: HookInput) => Promise<HookResult> | HookResult;\n\n/**\n * Hook metadata for auto-discovery and governance\n * Co-export alongside hook functions for single-source-of-truth registration\n */\nexport interface HookMeta {\n  /** Full hook name path (e.g., 'pretool/bash/dangerous-command-blocker') */\n  name: string;\n  /** Human-readable description */\n  description: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher patterns for hooks.json (e.g., 'Bash', 'Write|Edit') */\n  matchers?: string[];\n  /** Run asynchronously (non-blocking) */\n  async?: boolean;\n  /** Only run once per session */\n  once?: boolean;\n  /** Timeout in seconds (async hooks only) */\n  timeout?: number;\n  /** Risk category for prioritization */\n  tier?: 'security-critical' | 'data-loss' | 'quality-gate' | 'standard';\n}\n\n/**\n * Hook overrides configuration for per-project toggle/customization\n * Stored at .claude/hook-overrides.json (gitignored)\n */\nexport interface HookOverrides {\n  /** Hook names to disable entirely */\n  disabled?: string[];\n  /** Per-hook timeout overrides (seconds) */\n  timeouts?: Record<string, number>;\n}\n\n/**\n * Hook registration entry\n */\nexport interface HookRegistration {\n  /** Hook name (e.g., 'permission/auto-approve-readonly') */\n  name: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher (string pattern or regex) */\n  matcher?: string | RegExp;\n  /** Hook implementation function */\n  fn: HookFn;\n}\n\n/**\n * Bash tool input (type guard helper)\n */\nexport interface BashToolInput extends ToolInput {\n  command: string;\n  timeout?: number;\n}\n\n/**\n * Write tool input (type guard helper)\n */\nexport interface WriteToolInput extends ToolInput {\n  file_path: string;\n  content: string;\n}\n\n/**\n * Edit tool input (type guard helper)\n */\nexport interface EditToolInput extends ToolInput {\n  file_path: string;\n  old_string: string;\n  new_string: string;\n}\n\n/**\n * Read tool input (type guard helper)\n */\nexport interface ReadToolInput extends ToolInput {\n  file_path: string;\n  offset?: number;\n  limit?: number;\n}\n\n/**\n * Type guards for tool inputs\n */\nexport function isBashInput(input: ToolInput): input is BashToolInput {\n  return typeof input.command === 'string';\n}\n\nexport function isWriteInput(input: ToolInput): input is WriteToolInput {\n  return typeof input.file_path === 'string' && typeof input.content === 'string';\n}\n\nexport function isEditInput(input: ToolInput): input is EditToolInput {\n  return (\n    typeof input.file_path === 'string' &&\n    typeof input.old_string === 'string' &&\n    typeof input.new_string === 'string'\n  );\n}\n\nexport function isReadInput(input: ToolInput): input is ReadToolInput {\n  return typeof input.file_path === 'string' && input.content === undefined;\n}\n", "/**\n * Common utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh\n */\n\nimport { existsSync, statSync, renameSync, mkdirSync, readSync } from 'node:fs';\nimport { bufferWrite } from './analytics-buffer.js';\nimport { execSync } from 'node:child_process';\nimport type { HookResult, HookInput } from '../types.js';\nimport {\n  getLogDir as getLogDirFromPaths,\n  getProjectDir as getProjectDirFromPaths,\n  getPluginRoot as getPluginRootFromPaths,\n} from './paths.js';\nimport { getOrGenerateSessionId } from './session-id-generator.js';\n\n// -----------------------------------------------------------------------------\n// Environment and Paths\n// All functions read env vars dynamically to support testing\n// Re-export from paths.ts for cross-platform compatibility\n// -----------------------------------------------------------------------------\n\n/**\n * Get the log directory path (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getLogDir(): string {\n  return getLogDirFromPaths();\n}\n\n/**\n * Get the project directory (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getProjectDir(): string {\n  return getProjectDirFromPaths();\n}\n\n/**\n * Get the plugin root directory (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getPluginRoot(): string {\n  return getPluginRootFromPaths();\n}\n\n/**\n * Get the environment file path (CC 2.1.25: CLAUDE_ENV_FILE support)\n * Falls back to .instance_env for backward compatibility\n */\nexport function getEnvFile(): string {\n  if (process.env.CLAUDE_ENV_FILE) {\n    return process.env.CLAUDE_ENV_FILE;\n  }\n  // Fallback to legacy .instance_env\n  const pluginRoot = getPluginRoot();\n  return `${pluginRoot}/.claude/.instance_env`;\n}\n\n/**\n * Get the session ID\n *\n * Resolution order:\n * 1. CLAUDE_SESSION_ID env var (from CC runtime - preferred)\n * 2. Cached session ID (from .instance/session-id.json)\n * 3. Generate smart session ID: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n *\n * Example smart ID: \"orchestkit-main-0130-1745-a3f2\"\n *\n * The old fallback format \"fallback-{pid}-{timestamp}\" was confusing and unhelpful.\n * Smart IDs are human-readable, showing project, branch, and time context.\n */\nexport function getSessionId(): string {\n  return getOrGenerateSessionId();\n}\n\n/**\n * Get cached git branch (set at session start or first call)\n * Caches result in process.env to avoid repeated execSync calls\n */\nexport function getCachedBranch(projectDir?: string): string {\n  if (process.env.ORCHESTKIT_BRANCH) {\n    return process.env.ORCHESTKIT_BRANCH;\n  }\n\n  try {\n    const branch = execSync('git branch --show-current', {\n      cwd: projectDir || getProjectDir(),\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n    process.env.ORCHESTKIT_BRANCH = branch;\n    return branch;\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Get log level (debug|info|warn|error, default: warn)\n */\nexport function getLogLevel(): string {\n  return process.env.ORCHESTKIT_LOG_LEVEL || 'warn';\n}\n\n/**\n * Normalize line endings from CRLF to LF for cross-platform compatibility.\n * Windows uses \\r\\n (CRLF) while Unix uses \\n (LF).\n * This is critical for parsing YAML frontmatter where we match '---' exactly.\n */\nexport function normalizeLineEndings(content: string): string {\n  return content.replace(/\\r\\n/g, '\\n');\n}\n\n/**\n * Check if should log at given level\n */\nexport function shouldLog(level: 'debug' | 'info' | 'warn' | 'error'): boolean {\n  const levels = ['debug', 'info', 'warn', 'error'];\n  return levels.indexOf(level) >= levels.indexOf(getLogLevel());\n}\n\n// -----------------------------------------------------------------------------\n// Output Helpers (CC 2.1.7+ compliant)\n// -----------------------------------------------------------------------------\n\n/**\n * Output silent success - hook completed without errors, no user-visible output\n */\nexport function outputSilentSuccess(): HookResult {\n  return { continue: true, suppressOutput: true };\n}\n\n/**\n * Output silent allow - permission hook approves silently\n */\nexport function outputSilentAllow(): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: { permissionDecision: 'allow' },\n  };\n}\n\n/**\n * Output block - stops the operation with an error\n */\nexport function outputBlock(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with additionalContext - injects context before tool execution (CC 2.1.9)\n * For PostToolUse hooks (hookEventName optional)\n */\nexport function outputWithContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PostToolUse',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with additionalContext for UserPromptSubmit hooks (CC 2.1.9)\n * hookEventName is REQUIRED for UserPromptSubmit\n */\nexport function outputPromptContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with user notification + Claude context (CC 2.1.9+)\n * Issue #278: Dual-channel output for three-tier UX\n *\n * @param userMessage - Brief message shown to user via systemMessage (optional)\n * @param claudeContext - Full context for Claude via additionalContext (optional)\n * @returns HookResult with appropriate channels set\n *\n * Usage:\n * - Both set: User sees notification, Claude gets context\n * - Only claudeContext: Silent injection (Claude-only)\n * - Only userMessage: User notification without context\n */\nexport function outputWithNotification(\n  userMessage: string | undefined,\n  claudeContext: string | undefined\n): HookResult {\n  const result: HookResult = {\n    continue: true,\n    suppressOutput: true,\n  };\n\n  if (userMessage) {\n    result.systemMessage = userMessage;\n  }\n\n  if (claudeContext) {\n    result.hookSpecificOutput = {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: claudeContext,\n    };\n  }\n\n  return result;\n}\n\n/**\n * Output allow with additionalContext - permission hook approves with context (CC 2.1.9)\n */\nexport function outputAllowWithContext(ctx: string, systemMessage?: string): HookResult {\n  const result: HookResult = {\n    continue: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      additionalContext: ctx,\n      permissionDecision: 'allow',\n    },\n  };\n\n  if (systemMessage) {\n    result.systemMessage = systemMessage;\n  } else {\n    result.suppressOutput = true;\n  }\n\n  return result;\n}\n\n/**\n * Output error message - only use when there's an actual problem\n */\nexport function outputError(message: string): HookResult {\n  return { continue: true, systemMessage: message };\n}\n\n/**\n * Output warning message via JSON stdout \u2014 visible to both user and Claude (CC 2.1.7+).\n * Use this when Claude needs to see and act on the warning (e.g., cost advice, quality gates).\n * For user-only warnings where Claude should NOT see the message, use outputStderrWarning.\n */\nexport function outputWarning(message: string): HookResult {\n  return { continue: true, systemMessage: `\\u26a0 ${message}` };\n}\n\n/**\n * Output warning via stderr + exit(2) \u2014 visible to user only, Claude does NOT see it (CC 2.1.39).\n * Use this for informational warnings that should not influence Claude's behavior\n * (e.g., deprecation notices, non-actionable advisories).\n *\n * IMPORTANT: This function calls process.exit(2) and never returns.\n * Do NOT use inside unified dispatchers \u2014 it will crash the dispatcher process.\n * Only use in standalone hook entry points.\n */\nexport function outputStderrWarning(message: string): never {\n  process.stderr.write(`\\u26a0 ${message}\\n`);\n  process.exit(2);\n}\n\n/**\n * Output deny with feedback logging (CC 2.1.7)\n */\nexport function outputDeny(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with updatedInput - modifies tool input before execution (CC 2.1.25)\n * Canonical way to modify tool inputs from PreToolUse hooks\n */\nexport function outputWithUpdatedInput(updatedInput: Record<string, unknown>): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      updatedInput,\n    },\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Logging (with log level guard for performance)\n// -----------------------------------------------------------------------------\n\nconst LOG_ROTATION_MAX_SIZE = 200 * 1024; // 200KB\nconst PERMISSION_LOG_MAX_SIZE = 100 * 1024; // 100KB\n\n/**\n * Rotate log file if it exceeds size limit\n */\nfunction rotateLogFile(logFile: string, maxSize: number): void {\n  if (!existsSync(logFile)) return;\n\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > maxSize) {\n      const rotated = `${logFile}.old.${Date.now()}`;\n      renameSync(logFile, rotated);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n}\n\n/**\n * Log to hook log file with automatic rotation\n * Respects ORCHESTKIT_LOG_LEVEL (default: warn, skips debug logs in production)\n */\nexport function logHook(hookName: string, message: string, level: 'debug' | 'info' | 'warn' | 'error' = 'debug'): void {\n  // Skip if below log level threshold (big perf win - avoids I/O)\n  if (!shouldLog(level)) {\n    return;\n  }\n\n  const logDir = getLogDir();\n  const logFile = `${logDir}/hooks.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, LOG_ROTATION_MAX_SIZE);\n\n    const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n    bufferWrite(logFile, `[${timestamp}] [${level.toUpperCase()}] [${hookName}] ${message}\\n`);\n  } catch {\n    // Ignore logging errors - don't block hook execution\n  }\n}\n\n/**\n * Log permission decision for audit trail (CC 2.1.7 feature)\n * Always logs (security audit trail) - not affected by log level\n */\nexport function logPermissionFeedback(\n  decision: 'allow' | 'deny' | 'warn',\n  reason: string,\n  input?: HookInput | Record<string, unknown>\n): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/permission-feedback.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, PERMISSION_LOG_MAX_SIZE);\n\n    const timestamp = new Date().toISOString();\n    const toolName = (input as HookInput)?.tool_name || process.env.HOOK_TOOL_NAME || 'unknown';\n    const sessionId = (input as HookInput)?.session_id || getSessionId();\n\n    bufferWrite(\n      logFile,\n      `${timestamp} | ${decision} | ${reason} | tool=${toolName} | session=${sessionId}\\n`\n    );\n  } catch {\n    // Ignore logging errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Context Extraction (shared by all sync dispatchers)\n// -----------------------------------------------------------------------------\n\n/**\n * Extract additionalContext from a hook result.\n * Handles both the correct hookSpecificOutput.additionalContext format\n * and the legacy bare systemMessage format.\n *\n * Issue #682: Deduplicated from 5 dispatchers into shared utility.\n */\nexport function extractContext(result: HookResult): string | null {\n  // Standard format: hookSpecificOutput.additionalContext\n  if (result.hookSpecificOutput?.additionalContext) {\n    return result.hookSpecificOutput.additionalContext as string;\n  }\n\n  // Legacy format: bare systemMessage (antipattern-detector bug)\n  if (result.systemMessage && typeof result.systemMessage === 'string') {\n    return result.systemMessage;\n  }\n\n  return null;\n}\n\n// -----------------------------------------------------------------------------\n// Token Estimation\n// -----------------------------------------------------------------------------\n\n/**\n * Content-aware token estimation (~80% accuracy without external tokenizer).\n * Code-heavy content averages ~2.8 chars/token; prose ~3.5 chars/token.\n */\nexport function estimateTokenCount(content: string): number {\n  if (!content) return 0;\n  const codeIndicators = (content.match(/[{};()=><]/g) || []).length;\n  const codeRatio = codeIndicators / content.length;\n  const charsPerToken = codeRatio > 0.03 ? 2.8 : 3.5;\n  return Math.ceil(content.length / charsPerToken);\n}\n\n// -----------------------------------------------------------------------------\n// Budgeted Output Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Output prompt context with token budget awareness.\n * Checks if the category is over budget before injecting.\n * Falls back to silent success when budget exhausted.\n *\n * Accepts budget checker and tracker as parameters to avoid circular deps.\n * If not provided, falls back to unchecked injection.\n */\nexport function outputPromptContextBudgeted(\n  ctx: string,\n  hookName: string,\n  category: string,\n  budgetChecker?: { isOverBudget: (cat: string) => boolean },\n  tokenTracker?: { trackTokenUsage: (hook: string, cat: string, tokens: number) => void },\n): HookResult {\n  const tokens = estimateTokenCount(ctx);\n\n  if (budgetChecker?.isOverBudget(category)) {\n    logHook(hookName, `Budget exhausted for ${category}, suppressing ${tokens}t`);\n    return outputSilentSuccess();\n  }\n\n  if (tokenTracker) {\n    tokenTracker.trackTokenUsage(hookName, category, tokens);\n  }\n\n  return outputPromptContext(ctx);\n}\n\n// -----------------------------------------------------------------------------\n// Input Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Read hook input from stdin synchronously\n * Returns parsed JSON or empty object on failure\n */\nexport function readHookInput(): HookInput {\n  try {\n    // Read from stdin synchronously\n    const chunks: Buffer[] = [];\n    const BUFSIZE = 256;\n    const buf = Buffer.allocUnsafe(BUFSIZE);\n\n    let bytesRead: number;\n    const fd = 0; // stdin\n\n    while (true) {\n      try {\n        bytesRead = readSync(fd, buf, 0, BUFSIZE, null);\n        if (bytesRead === 0) break;\n        chunks.push(Buffer.from(buf.subarray(0, bytesRead)));\n      } catch {\n        break;\n      }\n    }\n\n    const input = Buffer.concat(chunks).toString('utf8').trim();\n    if (!input) {\n      return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n    }\n\n    return JSON.parse(input);\n  } catch {\n    return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n  }\n}\n\n/**\n * Get field from hook input using optional chaining\n */\nexport function getField<T>(input: HookInput, path: string): T | undefined {\n  const parts = path.replace(/^\\./, '').split('.');\n  let value: unknown = input;\n\n  for (const part of parts) {\n    if (value === null || value === undefined) return undefined;\n    value = (value as Record<string, unknown>)[part];\n  }\n\n  return value as T;\n}\n\n// -----------------------------------------------------------------------------\n// ReDoS-Safe String Matching\n// -----------------------------------------------------------------------------\n\n/**\n * Check if any single line contains all specified substrings (ReDoS-safe O(n)).\n * Use instead of polynomial regexes like /A.*B.*C/.test(content).\n */\nexport function lineContainsAll(content: string, ...terms: string[]): boolean {\n  return content.split('\\n').some(line => terms.every(t => line.includes(t)));\n}\n\n/**\n * Check if any single line contains all specified substrings (case-insensitive, ReDoS-safe O(n)).\n */\nexport function lineContainsAllCI(content: string, ...terms: string[]): boolean {\n  return content.split('\\n').some(line => {\n    const lower = line.toLowerCase();\n    return terms.every(t => lower.includes(t.toLowerCase()));\n  });\n}\n\n// -----------------------------------------------------------------------------\n// String Utilities\n// -----------------------------------------------------------------------------\n\n/**\n * Normalize command: remove line continuations and collapse whitespace\n * Prevents bypassing detection with backslash-newline tricks (CC 2.1.6 fix)\n */\nexport function normalizeCommand(command: string): string {\n  return command\n    .replace(/\\\\\\s*[\\r\\n]+/g, ' ') // Remove line continuations\n    .replace(/\\n/g, ' ') // Replace newlines with spaces\n    .replace(/\\s+/g, ' ') // Collapse whitespace\n    .trim();\n}\n\n/**\n * Escape string for use in regex\n */\nexport function escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-18\n\n/**\n * Analytics Write Buffer \u2014 Batches appendFileSync calls and flushes on exit\n *\n * Reduces per-hook I/O overhead by buffering analytics/metrics/log writes\n * and flushing them in a single batch per file path. Registered process\n * handlers ensure data is written before the process terminates.\n *\n * Issue #688: Buffer analytics writes and flush on process exit\n */\n\nimport { appendFileSync, mkdirSync } from 'node:fs';\nimport { dirname } from 'node:path';\n\ninterface BufferEntry {\n  filePath: string;\n  content: string;\n}\n\nconst buffer: BufferEntry[] = [];\nlet flushing = false;\nlet handlersRegistered = false;\n\n/**\n * Queue an analytics/log write for batched flushing.\n * Call this instead of appendFileSync for non-essential writes.\n */\nexport function bufferWrite(filePath: string, content: string): void {\n  buffer.push({ filePath, content });\n  ensureHandlers();\n}\n\n/**\n * Flush all buffered writes to disk immediately.\n * Groups entries by file path to minimize syscalls.\n */\nexport function flush(): void {\n  if (flushing || buffer.length === 0) return;\n  flushing = true;\n\n  // Group by filePath to write each file once\n  const grouped = new Map<string, string[]>();\n  for (const entry of buffer) {\n    const arr = grouped.get(entry.filePath);\n    if (arr) {\n      arr.push(entry.content);\n    } else {\n      grouped.set(entry.filePath, [entry.content]);\n    }\n  }\n\n  for (const [path, contents] of grouped) {\n    try {\n      mkdirSync(dirname(path), { recursive: true });\n      appendFileSync(path, contents.join(''));\n    } catch {\n      // Ignore flush errors \u2014 never block process exit\n    }\n  }\n\n  buffer.length = 0;\n  flushing = false;\n}\n\n/** Number of entries currently buffered (for testing) */\nexport function pendingCount(): number {\n  return buffer.length;\n}\n\n/** Clear buffer without writing (for testing) */\nexport function _resetForTesting(): void {\n  buffer.length = 0;\n  flushing = false;\n}\n\nfunction ensureHandlers(): void {\n  if (handlersRegistered) return;\n  handlersRegistered = true;\n\n  process.on('exit', flush);\n  process.on('SIGTERM', () => { flush(); process.exit(0); });\n  process.on('SIGINT', () => { flush(); process.exit(0); });\n}\n", "/**\n * Cross-platform path utilities for TypeScript hooks\n *\n * Provides consistent path handling across Windows, macOS, and Linux.\n * All path construction uses path.join() for correct separators.\n * All temp directories use os.tmpdir() for platform awareness.\n */\n\nimport os from 'node:os';\nimport path from 'node:path';\n\n/**\n * Get the user's home directory (cross-platform)\n * Prefers explicit env vars, falls back to os.homedir()\n */\nexport function getHomeDir(): string {\n  return process.env.HOME || process.env.USERPROFILE || os.homedir();\n}\n\n/**\n * Get the system temp directory (cross-platform)\n * Returns /tmp on Unix, C:\\Users\\X\\AppData\\Local\\Temp on Windows\n */\nexport function getTempDir(): string {\n  return os.tmpdir();\n}\n\n/**\n * Get the project directory from environment\n */\nexport function getProjectDir(): string {\n  return process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the plugin root directory from environment\n */\nexport function getPluginRoot(): string {\n  return process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the log directory path (cross-platform)\n * Uses path.join() for correct separators on all platforms\n */\nexport function getLogDir(): string {\n  if (process.env.CLAUDE_PLUGIN_ROOT) {\n    return path.join(getHomeDir(), '.claude', 'logs', 'ork');\n  }\n  return path.join(getProjectDir(), '.claude', 'logs');\n}\n\n/**\n * Get the memory directory path (cross-platform)\n */\nexport function getMemoryDir(): string {\n  return path.join(getProjectDir(), '.claude', 'memory');\n}\n\n/**\n * Get the coordination directory path (cross-platform)\n */\nexport function getCoordinationDir(): string {\n  return path.join(getProjectDir(), '.claude', 'coordination');\n}\n\n/**\n * Get the session metrics file path (cross-platform)\n * Uses CLAUDE_METRICS_FILE env var if set (for test isolation), otherwise temp dir.\n */\nexport function getMetricsFile(): string {\n  return process.env.CLAUDE_METRICS_FILE || path.join(getTempDir(), 'claude-session-metrics.json');\n}\n\n/**\n * Get the session error metrics file path (cross-platform)\n */\nexport function getSessionErrorsFile(): string {\n  return process.env.CLAUDE_SESSION_ERRORS_FILE || path.join(getTempDir(), 'claude-session-errors.json');\n}\n\n/**\n * Get the session temp directory for a given session ID (cross-platform)\n */\nexport function getSessionTempDir(sessionId: string): string {\n  return path.join(getTempDir(), `claude-session-${sessionId}`);\n}\n\n/**\n * Get the active todos file path (cross-platform)\n */\nexport function getActiveTodosFile(): string {\n  return path.join(getTempDir(), 'claude-active-todos.json');\n}\n\n/**\n * Get the context tracking state file path for a session (cross-platform)\n */\nexport function getContextTrackingFile(sessionId: string): string {\n  return path.join(getTempDir(), `claude-context-tracking-${sessionId}.json`);\n}\n\n/**\n * Get the read count temp file path (cross-platform)\n */\nexport function getReadCountFile(): string {\n  return path.join(getTempDir(), 'claude-read-count');\n}\n\n/**\n * Normalize a path for consistent comparison\n * Converts backslashes to forward slashes and removes trailing slashes\n */\nexport function normalizePath(p: string): string {\n  return path.normalize(p).replace(/\\\\/g, '/').replace(/\\/$/, '');\n}\n\n/**\n * Check if a path is absolute\n */\nexport function isAbsolutePath(p: string): boolean {\n  return path.isAbsolute(p);\n}\n\n/**\n * Join path segments (cross-platform)\n * Re-export for convenience\n */\nexport const joinPath = path.join;\n\n/**\n * Get path separator for current platform\n */\nexport const pathSeparator = path.sep;\n", "/**\n * Smart Session ID Generator\n * Generates human-readable session IDs when CLAUDE_SESSION_ID is not available.\n *\n * Format: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n * Example: \"orchestkit-main-0130-1745-a3f2\"\n *\n * Benefits:\n * - Human-readable at a glance\n * - Contains project context\n * - Contains branch info\n * - Chronologically sortable (date-time)\n * - Short unique suffix prevents collisions\n * - Valid file path characters only\n */\n\nimport { execSync } from 'node:child_process';\nimport { createHash } from 'node:crypto';\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join, basename } from 'node:path';\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\n/** Maximum length for project name component */\nconst MAX_PROJECT_LENGTH = 20;\n\n/** Maximum length for branch name component */\nconst MAX_BRANCH_LENGTH = 15;\n\n/** Characters allowed in session ID (safe for file paths) */\nconst SAFE_CHARS = /[^a-z0-9-]/g;\n\n// =============================================================================\n// SESSION ID GENERATION\n// =============================================================================\n\n/**\n * Get project name from directory path\n * Sanitizes to lowercase alphanumeric with dashes\n */\nexport function getProjectName(projectDir?: string): string {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const name = basename(dir);\n  return sanitizeName(name, MAX_PROJECT_LENGTH);\n}\n\n/**\n * Get git branch name (cached for performance)\n * Returns 'nobranch' if git is not available or not in a repo\n */\nexport function getGitBranchForSession(projectDir?: string): string {\n  // Check cache first\n  if (process.env.ORCHESTKIT_SESSION_BRANCH) {\n    return process.env.ORCHESTKIT_SESSION_BRANCH;\n  }\n\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n\n  try {\n    const branch = execSync('git branch --show-current', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 2000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n\n    const sanitized = sanitizeName(branch || 'detached', MAX_BRANCH_LENGTH);\n    process.env.ORCHESTKIT_SESSION_BRANCH = sanitized;\n    return sanitized;\n  } catch {\n    return 'nobranch';\n  }\n}\n\n/**\n * Format current date as MMDD\n */\nexport function formatDateComponent(date?: Date): string {\n  const d = date || new Date();\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${month}${day}`;\n}\n\n/**\n * Format current time as HHMM (24-hour)\n */\nexport function formatTimeComponent(date?: Date): string {\n  const d = date || new Date();\n  const hours = String(d.getHours()).padStart(2, '0');\n  const minutes = String(d.getMinutes()).padStart(2, '0');\n  return `${hours}${minutes}`;\n}\n\n/**\n * Generate short hash for uniqueness (4 hex chars)\n * Uses PID + timestamp + random for entropy\n */\nexport function generateShortHash(): string {\n  const entropy = `${process.pid}-${Date.now()}-${Math.random()}`;\n  return createHash('sha256')\n    .update(entropy)\n    .digest('hex')\n    .slice(0, 4);\n}\n\n/**\n * Sanitize a name for use in session ID\n * - Lowercase\n * - Replace non-alphanumeric with dashes\n * - Collapse multiple dashes\n * - Trim dashes from ends\n * - Truncate to max length\n */\nexport function sanitizeName(name: string, maxLength: number): string {\n  return name\n    .toLowerCase()\n    .replace(SAFE_CHARS, '-')\n    .replace(/-+/g, '-')\n    .replace(/^-|-$/g, '')\n    .slice(0, maxLength);\n}\n\n/**\n * Generate a smart session ID\n *\n * Format: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n * Example: \"orchestkit-main-0130-1745-a3f2\"\n *\n * @param projectDir - Optional project directory (defaults to env or cwd)\n * @param date - Optional date for testing (defaults to now)\n */\nexport function generateSmartSessionId(projectDir?: string, date?: Date): string {\n  const project = getProjectName(projectDir);\n  const branch = getGitBranchForSession(projectDir);\n  const dateStr = formatDateComponent(date);\n  const timeStr = formatTimeComponent(date);\n  const hash = generateShortHash();\n\n  return `${project}-${branch}-${dateStr}-${timeStr}-${hash}`;\n}\n\n// =============================================================================\n// SESSION ID CACHING\n// =============================================================================\n\n/**\n * Get cached session ID from .instance directory\n * Returns undefined if not cached\n */\nexport function getCachedSessionId(projectDir?: string): string | undefined {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const cachePath = join(dir, '.instance', 'session-id.json');\n\n  if (!existsSync(cachePath)) {\n    return undefined;\n  }\n\n  try {\n    const data = JSON.parse(readFileSync(cachePath, 'utf8'));\n    // Validate the cached ID hasn't expired (24 hours)\n    if (data.session_id && data.created_at) {\n      const age = Date.now() - new Date(data.created_at).getTime();\n      const maxAge = 24 * 60 * 60 * 1000; // 24 hours\n      if (age < maxAge) {\n        return data.session_id;\n      }\n    }\n  } catch {\n    // Ignore read/parse errors\n  }\n\n  return undefined;\n}\n\n/**\n * Cache session ID to .instance directory\n */\nexport function cacheSessionId(sessionId: string, projectDir?: string): void {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const instanceDir = join(dir, '.instance');\n  const cachePath = join(instanceDir, 'session-id.json');\n\n  try {\n    if (!existsSync(instanceDir)) {\n      mkdirSync(instanceDir, { recursive: true });\n    }\n\n    writeFileSync(cachePath, JSON.stringify({\n      session_id: sessionId,\n      created_at: new Date().toISOString(),\n    }, null, 2));\n  } catch {\n    // Ignore write errors - caching is optional\n  }\n}\n\n/**\n * Get or generate session ID with caching\n *\n * Priority:\n * 1. CLAUDE_SESSION_ID env var (from CC runtime)\n * 2. Cached session ID (from .instance/session-id.json)\n * 3. Generate new smart session ID (and cache it)\n */\nexport function getOrGenerateSessionId(projectDir?: string): string {\n  // 1. Try CLAUDE_SESSION_ID first (preferred)\n  if (process.env.CLAUDE_SESSION_ID) {\n    return process.env.CLAUDE_SESSION_ID;\n  }\n\n  // 2. Try cached session ID\n  const cached = getCachedSessionId(projectDir);\n  if (cached) {\n    return cached;\n  }\n\n  // 3. Generate new smart session ID\n  const newId = generateSmartSessionId(projectDir);\n  cacheSessionId(newId, projectDir);\n  return newId;\n}\n", "/**\n * Git utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh git functions\n */\n\nimport { execSync } from 'node:child_process';\nimport { getProjectDir } from './common.js';\n\n/**\n * Get the current git branch\n */\nexport function getCurrentBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git branch --show-current', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Check if on a protected branch (dev, main, master)\n */\nexport function isProtectedBranch(branch?: string): boolean {\n  const currentBranch = branch || getCurrentBranch();\n  return ['dev', 'main', 'master'].includes(currentBranch);\n}\n\n/**\n * Get the repository root directory\n */\nexport function getRepoRoot(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git rev-parse --show-toplevel', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return dir;\n  }\n}\n\n/**\n * Check if path is inside a git repository\n */\nexport function isGitRepo(projectDir?: string): boolean {\n  const dir = projectDir || getProjectDir();\n  try {\n    execSync('git rev-parse --git-dir', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get git status (short format)\n */\nexport function getGitStatus(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git status --short', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 10000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Check if there are uncommitted changes\n */\nexport function hasUncommittedChanges(projectDir?: string): boolean {\n  return getGitStatus(projectDir).length > 0;\n}\n\n/**\n * Get the default branch (main or master)\n */\nexport function getDefaultBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    // Check if 'main' exists\n    execSync('git rev-parse --verify main', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return 'main';\n  } catch {\n    try {\n      // Check if 'master' exists\n      execSync('git rev-parse --verify master', {\n        cwd: dir,\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n      return 'master';\n    } catch {\n      return 'main'; // Default to main\n    }\n  }\n}\n\n/**\n * Extract issue number from branch name\n * Supports patterns like: issue/123-description, feature/123, fix-123\n */\nexport function extractIssueNumber(branch: string): number | null {\n  // Match common patterns\n  const patterns = [\n    /issue\\/(\\d+)/i,\n    /feature\\/(\\d+)/i,\n    /fix\\/(\\d+)/i,\n    /bug\\/(\\d+)/i,\n    /feat\\/(\\d+)/i,\n    /^(\\d+)-/,\n    /-(\\d+)$/,\n    /#(\\d+)/,\n  ];\n\n  for (const pattern of patterns) {\n    const match = branch.match(pattern);\n    if (match) {\n      return parseInt(match[1], 10);\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get list of staged files (ready to be committed)\n * Returns array of file paths\n */\nexport function getStagedFiles(projectDir?: string): string[] {\n  const dir = projectDir || getProjectDir();\n  try {\n    const output = execSync('git diff --cached --name-only', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 10000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n    return output ? output.split('\\n').filter((f) => f.trim()) : [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Analyze staged files for atomicity\n * Returns an object describing the change characteristics\n */\nexport function analyzeStagedChanges(projectDir?: string): {\n  files: string[];\n  directories: Set<string>;\n  extensions: Set<string>;\n  hasTests: boolean;\n  hasConfig: boolean;\n  hasDocs: boolean;\n  hasSource: boolean;\n} {\n  const files = getStagedFiles(projectDir);\n  const directories = new Set<string>();\n  const extensions = new Set<string>();\n  let hasTests = false;\n  let hasConfig = false;\n  let hasDocs = false;\n  let hasSource = false;\n\n  for (const file of files) {\n    // Extract top-level directory\n    const parts = file.split('/');\n    if (parts.length > 1) {\n      directories.add(parts[0]);\n      // Also track second-level for deeper analysis\n      if (parts.length > 2) {\n        directories.add(`${parts[0]}/${parts[1]}`);\n      }\n    }\n\n    // Extension\n    const ext = file.split('.').pop() || '';\n    extensions.add(ext);\n\n    // Classify file type\n    if (/\\.(test|spec)\\.\\w+$/.test(file) || /^tests?\\//.test(file) || /__tests__\\//.test(file)) {\n      hasTests = true;\n    } else if (/\\.(md|mdx|txt|rst)$/.test(file) || /^docs?\\//.test(file) || file === 'README.md') {\n      hasDocs = true;\n    } else if (\n      /\\.(json|ya?ml|toml|ini|cfg|env)$/.test(file) ||\n      /config/i.test(file) ||\n      file === 'package.json' ||\n      file === 'tsconfig.json'\n    ) {\n      hasConfig = true;\n    } else {\n      hasSource = true;\n    }\n  }\n\n  return { files, directories, extensions, hasTests, hasConfig, hasDocs, hasSource };\n}\n\n/**\n * Validate branch name format\n * Returns error message if invalid, null if valid\n */\nexport function validateBranchName(branch: string): string | null {\n  // Skip validation for protected branches\n  if (isProtectedBranch(branch)) {\n    return null;\n  }\n\n  // Valid prefixes\n  const validPrefixes = [\n    'issue/',\n    'feature/',\n    'fix/',\n    'bug/',\n    'feat/',\n    'chore/',\n    'docs/',\n    'refactor/',\n    'test/',\n    'ci/',\n    'perf/',\n    'style/',\n    'release/',\n    'hotfix/',\n  ];\n\n  const hasValidPrefix = validPrefixes.some((prefix) => branch.startsWith(prefix));\n  if (!hasValidPrefix) {\n    return `Branch name should start with a valid prefix: ${validPrefixes.join(', ')}`;\n  }\n\n  // Check for issue number in issue/ branches\n  if (branch.startsWith('issue/') && !extractIssueNumber(branch)) {\n    return 'issue/ branches should include an issue number (e.g., issue/123-description)';\n  }\n\n  return null;\n}\n", "/**\n * Agent Teams Detection & Configuration Utility\n * Issue #362: Deprecate coordination hooks redundant with CC Agent Teams\n *\n * CC Agent Teams (CC 2.1.33+) provides native multi-instance coordination:\n * - Teammate lifecycle management\n * - 5-minute runtime heartbeat\n * - Idle notifications\n * - Cleanup on session end\n *\n * When Agent Teams is active, OrchestKit's custom coordination hooks\n * should yield to CC's native implementation to avoid duplication.\n */\n\nimport { existsSync, readFileSync, readdirSync, statSync, rmSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check if CC Agent Teams is active.\n *\n * Detection signals:\n * - CLAUDE_CODE_TEAM_NAME: Set when running as part of an Agent Teams team\n * - CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS: Feature flag for Agent Teams\n */\nexport function isAgentTeamsActive(): boolean {\n  return !!(\n    process.env.CLAUDE_CODE_TEAM_NAME ||\n    process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS === '1'\n  );\n}\n\n/** Check if current session is a teammate in a team */\nexport function isTeammate(): boolean {\n  return !!process.env.CLAUDE_CODE_TEAM_NAME;\n}\n\n/** Get current team name */\nexport function getTeamName(): string | null {\n  return process.env.CLAUDE_CODE_TEAM_NAME || null;\n}\n\nexport interface TeamMember {\n  name: string;\n  agentType: string;\n}\n\n/**\n * Read team config to get member list.\n * Reads from ~/.claude/teams/{team-name}/config.json\n */\nexport function getTeamMembers(): TeamMember[] {\n  const teamName = getTeamName();\n  if (!teamName) return [];\n\n  const homeDir = process.env.HOME || process.env.USERPROFILE || '';\n  if (!homeDir) return [];\n\n  const configPath = join(homeDir, '.claude', 'teams', teamName, 'config.json');\n  if (!existsSync(configPath)) return [];\n\n  try {\n    const config = JSON.parse(readFileSync(configPath, 'utf-8'));\n    const members = config.members;\n    if (!Array.isArray(members)) return [];\n\n    return members.map((m: { name?: string; agentType?: string }) => ({\n      name: m.name || 'unknown',\n      agentType: m.agentType || 'unknown',\n    }));\n  } catch {\n    return [];\n  }\n}\n\n/** Count current team members */\nexport function getTeamSize(): number {\n  return getTeamMembers().length;\n}\n\n/** List all team directories */\nexport function listAllTeams(): string[] {\n  const homeDir = process.env.HOME || process.env.USERPROFILE || '';\n  if (!homeDir) return [];\n  const teamsDir = join(homeDir, '.claude', 'teams');\n  if (!existsSync(teamsDir)) return [];\n  try {\n    return readdirSync(teamsDir).filter(name => {\n      try { return statSync(join(teamsDir, name)).isDirectory(); } catch { return false; }\n    });\n  } catch { return []; }\n}\n\n/** Check if team is stale (no config, or dir older than maxAgeHours) */\nexport function isStaleTeam(teamName: string, maxAgeHours: number = 4): boolean {\n  const homeDir = process.env.HOME || process.env.USERPROFILE || '';\n  if (!homeDir) return false;\n  const teamPath = join(homeDir, '.claude', 'teams', teamName);\n  if (!existsSync(teamPath)) return false;\n  const configPath = join(teamPath, 'config.json');\n  if (!existsSync(configPath)) return true;  // no config = orphaned\n  try {\n    const ageMs = Date.now() - statSync(teamPath).mtimeMs;\n    return ageMs > maxAgeHours * 3600_000;\n  } catch { return true; }\n}\n\n/** Remove team + task directories */\nexport function cleanupTeam(teamName: string): boolean {\n  const homeDir = process.env.HOME || process.env.USERPROFILE || '';\n  if (!homeDir) return false;\n  let ok = true;\n  for (const sub of ['teams', 'tasks']) {\n    const dir = join(homeDir, '.claude', sub, teamName);\n    if (existsSync(dir)) {\n      try { rmSync(dir, { recursive: true, force: true }); } catch { ok = false; }\n    }\n  }\n  return ok;\n}\n", "/**\n * Self-guard helpers for TypeScript hooks\n * Ported from hooks/_lib/common.sh guard functions\n *\n * Guards are predicates that determine if a hook should run.\n * They return `true` to run the hook, `false` to skip it.\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess } from './common.js';\nimport { isAgentTeamsActive } from './agent-teams.js';\n\n/**\n * Simple glob matcher using indexOf with position tracking.\n * Splits glob on `*`, checks each literal part appears in order.\n * `?` matches any single character via single-char skip.\n * Avoids polynomial regex from chained `.*` patterns.\n */\nfunction globMatch(glob: string, str: string): boolean {\n  // Split on * to get literal segments\n  const parts = glob.split('*');\n  let pos = 0;\n\n  for (const part of parts) {\n    if (part === '') continue;\n    // Handle ? by replacing with single-char search\n    const searchPart = part;\n    const qIdx = searchPart.indexOf('?');\n    if (qIdx >= 0) {\n      // For segments with ?, match char-by-char\n      let matched = false;\n      for (let i = pos; i <= str.length - searchPart.length; i++) {\n        let ok = true;\n        for (let j = 0; j < searchPart.length; j++) {\n          if (searchPart[j] !== '?' && searchPart[j] !== str[i + j]) {\n            ok = false;\n            break;\n          }\n        }\n        if (ok) {\n          pos = i + searchPart.length;\n          matched = true;\n          break;\n        }\n      }\n      if (!matched) return false;\n    } else {\n      const idx = str.indexOf(searchPart, pos);\n      if (idx === -1) return false;\n      pos = idx + searchPart.length;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Guard result type - either continue (null) or skip with result\n */\nexport type GuardResult = HookResult | null;\n\n/**\n * Create a guard that returns silent success if predicate fails\n */\nexport function createGuard(\n  predicate: (input: HookInput) => boolean\n): (input: HookInput) => GuardResult {\n  return (input: HookInput) => (predicate(input) ? null : outputSilentSuccess());\n}\n\n// -----------------------------------------------------------------------------\n// File Extension Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for specific file extensions\n */\nexport function guardFileExtension(\n  input: HookInput,\n  ...extensions: string[]\n): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  const ext = filePath.split('.').pop()?.toLowerCase() || '';\n  const normalizedExtensions = extensions.map((e) => e.toLowerCase().replace(/^\\./, ''));\n\n  if (normalizedExtensions.includes(ext)) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Only run for code files\n */\nexport function guardCodeFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'py', 'ts', 'tsx', 'js', 'jsx', 'go', 'rs', 'java');\n}\n\n/**\n * Guard: Only run for Python files\n */\nexport function guardPythonFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'py');\n}\n\n/**\n * Guard: Only run for TypeScript/JavaScript files\n */\nexport function guardTypescriptFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'ts', 'tsx', 'js', 'jsx');\n}\n\n// -----------------------------------------------------------------------------\n// Path Pattern Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for test files\n */\nexport function guardTestFiles(input: HookInput): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  const testPatterns = [/test/i, /spec/i, /__tests__/i];\n  if (testPatterns.some((p) => p.test(filePath))) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Skip internal/generated files\n */\nexport function guardSkipInternal(input: HookInput): GuardResult {\n  const filePath = input.tool_input.file_path || '';\n  if (!filePath) return null; // No file path, continue\n\n  // Skip these directories/patterns\n  const skipPatterns = [\n    /\\/\\.claude\\//,\n    /\\/node_modules\\//,\n    /\\/\\.git\\//,\n    /\\/dist\\//,\n    /\\/build\\//,\n    /\\/__pycache__\\//,\n    /\\/\\.venv\\//,\n    /\\/venv\\//,\n    /\\.lock$/,\n  ];\n\n  if (skipPatterns.some((p) => p.test(filePath))) {\n    return outputSilentSuccess();\n  }\n\n  return null; // Continue with hook\n}\n\n/**\n * Guard: Only run for files matching path patterns\n */\nexport function guardPathPattern(input: HookInput, ...patterns: (string | RegExp)[]): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  for (const pattern of patterns) {\n    if (typeof pattern === 'string') {\n      // Simple glob-like matching using indexOf with position tracking\n      // Avoids polynomial regex from .* chains\n      if (globMatch(pattern, filePath)) return null;\n    } else {\n      if (pattern.test(filePath)) return null;\n    }\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Tool Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for specific tool names\n */\nexport function guardTool(input: HookInput, ...tools: string[]): GuardResult {\n  const toolName = input.tool_name;\n  if (!toolName) return outputSilentSuccess();\n\n  if (tools.includes(toolName)) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Only run for Write or Edit tools\n */\nexport function guardWriteEdit(input: HookInput): GuardResult {\n  return guardTool(input, 'Write', 'Edit');\n}\n\n/**\n * Guard: Only run for Bash tool\n */\nexport function guardBash(input: HookInput): GuardResult {\n  return guardTool(input, 'Bash');\n}\n\n// -----------------------------------------------------------------------------\n// Command Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for non-trivial bash commands\n */\nexport function guardNontrivialBash(input: HookInput): GuardResult {\n  const command = input.tool_input.command || '';\n\n  // Skip trivial commands\n  const trivialPatterns = [\n    /^echo\\s/,\n    /^ls(\\s|$)/,\n    /^pwd$/,\n    /^cat\\s/,\n    /^head\\s/,\n    /^tail\\s/,\n    /^wc\\s/,\n    /^date$/,\n    /^whoami$/,\n  ];\n\n  if (trivialPatterns.some((p) => p.test(command))) {\n    return outputSilentSuccess();\n  }\n\n  return null; // Continue with hook\n}\n\n/**\n * Guard: Only run for git commands\n */\nexport function guardGitCommand(input: HookInput): GuardResult {\n  const command = input.tool_input.command || '';\n\n  if (command.startsWith('git')) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Environment Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run if multi-instance coordination is enabled.\n * Issue #362: Yields when Agent Teams is active \u2014 Teams provides native\n * multi-instance coordination, making custom .claude/coordination redundant.\n */\nexport function guardMultiInstance(input: HookInput): GuardResult {\n  if (isAgentTeamsActive()) {\n    return outputSilentSuccess(); // Teams handles coordination natively\n  }\n\n  const projectDir = input.project_dir || process.env.CLAUDE_PROJECT_DIR || '.';\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  try {\n    const { existsSync } = require('node:fs');\n    if (existsSync(dbPath)) {\n      return null; // Continue with hook\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Composite Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Run multiple guards in sequence, return first skip result or null to continue\n */\nexport function runGuards(input: HookInput, ...guards: ((input: HookInput) => GuardResult)[]): GuardResult {\n  for (const guard of guards) {\n    const result = guard(input);\n    if (result !== null) {\n      return result; // Skip with this result\n    }\n  }\n  return null; // All guards passed, continue\n}\n\n// -----------------------------------------------------------------------------\n// Permission Mode Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Check if Claude Code is running in dontAsk mode (CC 2.1.25)\n * In dontAsk mode, quality gates should warn instead of blocking\n */\nexport function isDontAskMode(input: HookInput): boolean {\n  return input.permissionMode === 'dontAsk';\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-18\n\n/**\n * Normalize shell commands for safe pattern matching.\n * Prevents bypass via quoting, escapes, and compound operators.\n *\n * Issue #687: centralizes normalization that was previously ad-hoc\n * across dangerous-command-blocker, auto-approve-safe-bash, and learning-tracker.\n */\n\n/**\n * Expand hex escapes: \\x72\\x6d -> rm\n */\nfunction expandHexEscapes(cmd: string): string {\n  return cmd.replace(/\\\\x([0-9a-fA-F]{2})/g, (_match, hex) =>\n    String.fromCharCode(parseInt(hex, 16))\n  );\n}\n\n/**\n * Expand octal escapes: \\162\\155 -> rm\n */\nfunction expandOctalEscapes(cmd: string): string {\n  return cmd.replace(/\\\\([0-7]{3})/g, (_match, oct) =>\n    String.fromCharCode(parseInt(oct, 8))\n  );\n}\n\n/**\n * Strip backslash escapes from individual characters: r\\m -> rm, r\\\\m -> rm\n * Runs AFTER hex/octal expansion so those are already resolved.\n */\nfunction stripBackslashEscapes(cmd: string): string {\n  // Remove backslash before any non-whitespace character (escape bypass)\n  return cmd.replace(/\\\\([^\\s])/g, '$1');\n}\n\n/**\n * Strip wrapping quotes from tokens: \"rm\" -> rm, 'rm' -> rm\n * Handles full-token quoting and inline quoting like r\"m\" -> rm\n */\nfunction stripQuotes(cmd: string): string {\n  // Remove matched single or double quotes around content\n  let result = cmd;\n  // Strip double-quoted segments: \"...\" -> content\n  result = result.replace(/\"([^\"]*)\"/g, '$1');\n  // Strip single-quoted segments: '...' -> content\n  result = result.replace(/'([^']*)'/g, '$1');\n  return result;\n}\n\n/**\n * Split a command string on compound operators: && || ; | and newlines.\n * Pipe (|) is included because `safe | dangerous` should not auto-approve\n * based on the safe prefix alone.\n *\n * Does NOT split inside quotes (simplified: quotes are already stripped).\n */\nfunction _splitCompound(cmd: string): string[] {\n  // Split on &&, ||, ;, |, or newlines\n  // Order matters: && and || before single & and |\n  return cmd.split(/\\s*(?:&&|\\|\\||\\||;|\\n)\\s*/);\n}\n\n/**\n * Normalize a single sub-command (no splitting, just cleaning).\n * - Expand hex/octal escapes\n * - Strip backslash escapes\n * - Strip quotes\n * - Remove line continuations\n * - Collapse whitespace\n */\nexport function normalizeSingle(cmd: string): string {\n  let result = cmd;\n  result = expandHexEscapes(result);\n  result = expandOctalEscapes(result);\n  result = stripBackslashEscapes(result);\n  result = stripQuotes(result);\n  // Remove line continuations (backslash + newline)\n  result = result.replace(/\\\\\\s*[\\r\\n]+/g, ' ');\n  // Replace remaining newlines\n  result = result.replace(/\\n/g, ' ');\n  // Collapse whitespace\n  result = result.replace(/\\s+/g, ' ');\n  return result.trim();\n}\n\n/**\n * Normalize a shell command for safe matching.\n * Strips quoting, expands escapes, splits compound operators.\n * Returns array of individual normalized sub-commands.\n */\nexport function normalizeCommand(cmd: string): string[] {\n  if (!cmd || !cmd.trim()) return [];\n\n  // Pre-process: expand escapes and strip quotes on the raw input,\n  // but preserve newlines and compound operators for splitting.\n  let preprocessed = cmd;\n  preprocessed = expandHexEscapes(preprocessed);\n  preprocessed = expandOctalEscapes(preprocessed);\n  preprocessed = stripBackslashEscapes(preprocessed);\n  preprocessed = stripQuotes(preprocessed);\n  // Remove line continuations (backslash + newline) \u2014 these join lines\n  preprocessed = preprocessed.replace(/\\\\\\s*[\\r\\n]+/g, ' ');\n\n  // Split on compound operators (&&, ||, |, ;) AND newlines\n  const parts = preprocessed.split(/\\s*(?:&&|\\|\\||\\||;|\\n)\\s*/);\n\n  // Normalize whitespace in each part and filter empties\n  return parts\n    .map((p) => p.replace(/\\s+/g, ' ').trim())\n    .filter(Boolean);\n}\n\n/**\n * Check if any sub-command in a compound command matches a dangerous pattern.\n * Patterns are matched as lowercase substrings against each normalized sub-command.\n */\nexport function containsDangerousCommand(\n  cmd: string,\n  patterns: string[]\n): { matches: boolean; matched?: string; subCommand?: string } {\n  const subCommands = normalizeCommand(cmd);\n\n  for (const sub of subCommands) {\n    const lowerSub = sub.toLowerCase();\n    for (const pattern of patterns) {\n      if (lowerSub.includes(pattern.toLowerCase())) {\n        return { matches: true, matched: pattern, subCommand: sub };\n      }\n    }\n  }\n\n  return { matches: false };\n}\n\n/**\n * Detect suspicious shell features that bypass simple operator splitting.\n * Returns array of finding descriptions, empty if clean.\n *\n * Detects: process substitution, brace expansion (command form), here-strings,\n * IFS manipulation, and nested command substitution.\n */\nexport function detectSuspiciousShellFeatures(cmd: string): string[] {\n  const findings: string[] = [];\n\n  // 1. Process substitution: <(cmd) or >(cmd)\n  if (/[<>]\\([^)]+\\)/.test(cmd)) {\n    findings.push('process substitution detected (<(...) or >(...))');\n  }\n\n  // 2. Brace expansion (command form): {cat,/etc/passwd}\n  // Heuristic: flag when the first element looks like a command binary (3+ chars,\n  // no dots/slashes, starts alpha). Short elements like {ts,js} are file extensions.\n  const braceMatch = cmd.match(/\\{([^},]+),([^}]+)\\}/g);\n  if (braceMatch) {\n    for (const m of braceMatch) {\n      const inner = m.slice(1, -1);\n      const firstElement = inner.split(',')[0].trim();\n      // Skip file extension globs (1-2 char tokens like {ts,js}) and paths with dots/slashes\n      const isLikelyExtension = firstElement.length <= 2;\n      const hasPathChars = firstElement.includes('.') || firstElement.includes('/');\n      // Also check if preceded by a dot or glob (*.{ts,js}) \u2014 definitely a file glob\n      const braceIdx = cmd.indexOf(m);\n      const charBefore = braceIdx > 0 ? cmd[braceIdx - 1] : '';\n      const isPrecededByGlob = charBefore === '.' || charBefore === '*' || charBefore === '/';\n      if (firstElement && !isLikelyExtension && !hasPathChars && !isPrecededByGlob && /^[a-zA-Z]/.test(firstElement)) {\n        findings.push(`brace expansion with command-like pattern: ${m}`);\n      }\n    }\n  }\n\n  // 3. Here-strings: <<<\n  if (/<<</.test(cmd)) {\n    findings.push('here-string detected (<<<)');\n  }\n\n  // 4. IFS manipulation: ${IFS} or IFS= assignment\n  if (/\\$\\{?IFS\\}?/.test(cmd) || /\\bIFS=/.test(cmd)) {\n    findings.push('IFS manipulation detected');\n  }\n\n  // 5. Nested command substitution: $(echo `cmd`) or $(`cmd`)\n  if (/\\$\\([^)]*`[^`]*`[^)]*\\)/.test(cmd)) {\n    findings.push('nested command substitution detected ($(..`..`..))');\n  }\n\n  return findings;\n}\n\n/**\n * Check if a command is a compound command (contains operators like &&, ||, ;, |, or newlines).\n */\nexport function isCompoundCommand(cmd: string): boolean {\n  // Check for newlines BEFORE normalization (normalization converts \\n to space)\n  // But ignore line continuations (backslash + newline) which join lines\n  const withoutContinuations = cmd.replace(/\\\\\\s*[\\r\\n]+/g, ' ');\n  if (/\\n/.test(withoutContinuations)) return true;\n\n  // Check the normalized form for compound operators\n  const normalized = normalizeSingle(cmd);\n  return /(?:&&|\\|\\||[|;])/.test(normalized);\n}\n", "/**\n * Dangerous Command Blocker - Blocks commands matching dangerous patterns\n * Hook: PreToolUse (Bash)\n * CC 2.1.7 Compliant: outputs JSON with continue field\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  normalizeCommand as normalizeCommandLegacy,\n} from '../../lib/common.js';\nimport {\n  containsDangerousCommand,\n} from '../../lib/normalize-command.js';\n\n/**\n * Dangerous patterns - commands that can cause catastrophic system damage\n * These are matched as literal substrings via normalizedCommand.includes()\n *\n * NOTE: Root-path rm patterns (rm -rf /, rm -fr /) are in DANGEROUS_REGEX_PATTERNS\n * below to avoid false positives on legitimate paths like /tmp, /var/log, etc.\n */\nconst DANGEROUS_PATTERNS: string[] = [\n  // Filesystem destruction (relative paths only \u2014 absolute root uses regex below)\n  'rm -rf ~',\n  'rm -fr ~',\n  'mv /* /dev/null',\n  // Device wiping\n  '> /dev/sda',\n  'mkfs.',\n  'dd if=/dev/zero of=/dev/',\n  'dd if=/dev/random of=/dev/',\n  // Permission abuse\n  'chmod -R 777 /',\n  // Fork bomb\n  ':(){:|:&};:',\n  // Destructive git operations (data loss)\n  'git reset --hard',\n  'git clean -fd',\n  // Database destruction\n  'drop database',\n  'drop schema',\n  'truncate table',\n];\n\n/**\n * Regex patterns for root-path destruction commands.\n * These need anchored matching to avoid false positives:\n * - \"rm -rf /\" (bare root) \u2192 BLOCKED\n * - \"rm -rf /tmp/build\" \u2192 ALLOWED (legitimate path)\n * - \"rm -rf /*\" \u2192 BLOCKED (glob root)\n */\nconst DANGEROUS_REGEX_PATTERNS: { pattern: RegExp; label: string }[] = [\n  // rm -rf / or rm -rf /* but NOT rm -rf /tmp/...\n  // Matches: rm -rf /, rm -rf /*, rm -rf / &&, rm -rf / ;\n  // Does NOT match: rm -rf /tmp, rm -rf /var/log\n  { pattern: /\\brm\\s+-r[f]\\s+\\/(\\s|$|\\*|\\))/i, label: 'rm -rf /' },\n  { pattern: /\\brm\\s+-[f]r\\s+\\/(\\s|$|\\*|\\))/i, label: 'rm -fr /' },\n];\n\n/**\n * Shell and script interpreters that should never receive piped input.\n * Catches: wget URL | sh, curl URL | bash, cat file | python3, etc.\n */\nconst PIPE_TO_SHELL_RE = /\\|\\s*(sh|bash|zsh|dash|python[23]?|node|perl|ruby|tclsh)\\b/i;\n\n/**\n * Git force-push patterns that rewrite remote history.\n * Catches: git push --force, git push -f, git push origin main --force\n */\nconst GIT_FORCE_PUSH_RE = /git\\s+push\\s+.*(-f|--force)\\b/i;\n\n/**\n * Block dangerous commands\n */\nexport function dangerousCommandBlocker(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Normalize: expand escapes, strip quotes, split compound operators, then check each sub-command\n  const dangerousCheck = containsDangerousCommand(command, DANGEROUS_PATTERNS);\n  if (dangerousCheck.matches) {\n    const pattern = dangerousCheck.matched!;\n    logHook('dangerous-command-blocker', `BLOCKED: Dangerous pattern: ${pattern}`);\n    logPermissionFeedback('deny', `Dangerous pattern: ${pattern}`, input);\n\n    return outputDeny(\n      `Command matches dangerous pattern: ${pattern}\\n\\n` +\n        'This command could cause severe system damage and has been blocked.'\n    );\n  }\n\n  // Check regex patterns for root-path destruction (anchored to avoid false positives)\n  const normalizedForRegex = normalizeCommandLegacy(command);\n  for (const { pattern, label } of DANGEROUS_REGEX_PATTERNS) {\n    if (pattern.test(normalizedForRegex)) {\n      logHook('dangerous-command-blocker', `BLOCKED: Dangerous pattern: ${label}`);\n      logPermissionFeedback('deny', `Dangerous pattern: ${label}`, input);\n\n      return outputDeny(\n        `Command matches dangerous pattern: ${label}\\n\\n` +\n          'This command could cause severe system damage and has been blocked.'\n      );\n    }\n  }\n\n  // Legacy normalized form for regex checks and patterns that contain operators\n  const normalizedCommand = normalizeCommandLegacy(command).toLowerCase();\n\n  // Fork bomb detection \u2014 pattern contains | and ; so it can't be matched after splitting\n  if (normalizedCommand.includes(':(){:|:&};:')) {\n    const reason = 'Fork bomb detected';\n    logHook('dangerous-command-blocker', `BLOCKED: ${reason}`);\n    logPermissionFeedback('deny', reason, input);\n\n    return outputDeny(\n      `Command matches dangerous pattern: :(){:|:&};:\\n\\n` +\n        'This command could cause severe system damage and has been blocked.'\n    );\n  }\n\n  // Check for piping to shell interpreters (e.g., wget URL | sh, curl URL | bash)\n  if (PIPE_TO_SHELL_RE.test(normalizedCommand)) {\n    const reason = 'Piping to shell interpreter detected';\n    logHook('dangerous-command-blocker', `BLOCKED: ${reason}`);\n    logPermissionFeedback('deny', reason, input);\n\n    return outputDeny(\n      `${reason}\\n\\n` +\n        'Piping untrusted content to a shell interpreter is dangerous and has been blocked.'\n    );\n  }\n\n  // Check for git force-push (rewrites remote history)\n  if (GIT_FORCE_PUSH_RE.test(normalizedCommand)) {\n    const reason = 'Git force-push detected (rewrites remote history)';\n    logHook('dangerous-command-blocker', `BLOCKED: ${reason}`);\n    logPermissionFeedback('deny', reason, input);\n\n    return outputDeny(\n      `${reason}\\n\\n` +\n        'Force-pushing can destroy remote commit history and has been blocked.'\n    );\n  }\n\n  // Command is safe, allow it silently\n  return outputSilentSuccess();\n}\n", "/**\n * Unified Git Validator Hook\n * Consolidates: branch-protection, branch-naming, commit-message, atomic-commit\n *\n * Performance: Single execSync call for branch, cached for all validations\n * CC 2.1.9 Enhanced: additionalContext for guidance\n *\n * @version 2.0.0 - Consolidated from 4 separate hooks\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputWithContext,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getCachedBranch,\n} from '../../lib/common.js';\nimport { isProtectedBranch, validateBranchName, analyzeStagedChanges } from '../../lib/git.js';\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\nconst VALID_COMMIT_TYPES = ['feat', 'fix', 'refactor', 'docs', 'test', 'chore', 'style', 'perf', 'ci', 'build'];\nconst STAGED_FILE_WARNING_THRESHOLD = 10;\n\n// =============================================================================\n// HELPERS\n// =============================================================================\n\nfunction extractCommitMessage(command: string): string | null {\n  const quotedMatch = command.match(/-m\\s+[\"']([^\"']+)[\"']/);\n  if (quotedMatch) return quotedMatch[1];\n\n  const unquotedMatch = command.match(/-m\\s+(\\S+)/);\n  if (unquotedMatch) return unquotedMatch[1];\n\n  return null;\n}\n\nfunction extractNewBranchName(command: string): string | null {\n  const checkoutMatch = command.match(/checkout\\s+-b\\s+(\\S+)/);\n  if (checkoutMatch) return checkoutMatch[1];\n\n  const branchMatch = command.match(/git\\s+branch\\s+(\\S+)/);\n  if (branchMatch) return branchMatch[1];\n\n  return null;\n}\n\n// =============================================================================\n// VALIDATION FUNCTIONS\n// =============================================================================\n\nfunction validateBranchProtection(command: string, currentBranch: string): HookResult | null {\n  if (!isProtectedBranch(currentBranch)) {\n    return null;\n  }\n\n  if (/git\\s+(commit|push)/.test(command)) {\n    const errorMsg = `BLOCKED: Cannot commit or push directly to '${currentBranch}' branch.\n\nRequired workflow:\n1. git checkout -b issue/<number>-<description>\n2. git commit -m \"feat(#<number>): Description\"\n3. git push -u origin issue/<number>-<description>\n4. gh pr create --base dev`;\n\n    logPermissionFeedback('deny', `Blocked on protected branch: ${currentBranch}`);\n    return outputDeny(errorMsg);\n  }\n\n  return outputWithContext(`On protected branch '${currentBranch}'. Create feature branch for changes.`);\n}\n\nfunction validateBranchNaming(command: string): HookResult | null {\n  if (!/git\\s+(checkout\\s+-b|branch\\s+)/.test(command)) {\n    return null;\n  }\n\n  const branchName = extractNewBranchName(command);\n  if (!branchName) return null;\n\n  const validationError = validateBranchName(branchName);\n  if (validationError) {\n    const context = `Branch naming: ${validationError}\n\nRecommended: issue/123-description, feature/xyz, fix/bug-name`;\n    logPermissionFeedback('allow', `Branch naming guidance: ${branchName}`);\n    return outputAllowWithContext(context);\n  }\n\n  return null;\n}\n\nfunction validateCommitMessage(command: string): HookResult | null {\n  if (!/^git\\s+commit/.test(command)) {\n    return null;\n  }\n\n  if (/<<['\"]?EOF/.test(command)) {\n    return outputAllowWithContext(`Heredoc commit. Use: type(#issue): description\nTypes: ${VALID_COMMIT_TYPES.join(', ')}\nEnd with: Co-Authored-By: Claude <noreply@anthropic.com>`);\n  }\n\n  const commitMsg = extractCommitMessage(command);\n  if (!commitMsg) {\n    return outputAllowWithContext(`Interactive commit. Use: type(#issue): description`);\n  }\n\n  const typesPattern = VALID_COMMIT_TYPES.join('|');\n  const conventionalPattern = new RegExp(`^(${typesPattern})(\\\\(#?[0-9]+\\\\)|(\\\\([a-z-]+\\\\)))?: .+`);\n  const simplePattern = new RegExp(`^(${typesPattern}): .+`);\n\n  if (conventionalPattern.test(commitMsg) || simplePattern.test(commitMsg)) {\n    const titleLen = commitMsg.split('\\n')[0].length;\n    if (titleLen > 72) {\n      return outputAllowWithContext(`Commit title is ${titleLen} chars (max 72 recommended)`);\n    }\n    return null;\n  }\n\n  const errorMsg = `INVALID COMMIT FORMAT: \"${commitMsg}\"\n\nRequired: type(#issue): description\nTypes: ${VALID_COMMIT_TYPES.join(', ')}\nExample: feat(#123): Add user authentication`;\n\n  logPermissionFeedback('deny', `Invalid commit: ${commitMsg}`);\n  return outputDeny(errorMsg);\n}\n\nfunction validateAtomicCommit(command: string, projectDir?: string): HookResult | null {\n  if (!/^git\\s+commit/.test(command)) {\n    return null;\n  }\n\n  const analysis = analyzeStagedChanges(projectDir);\n  const warnings: string[] = [];\n\n  // Check 1: File count threshold\n  if (analysis.files.length > STAGED_FILE_WARNING_THRESHOLD) {\n    warnings.push(`Large commit: ${analysis.files.length} staged files.`);\n  }\n\n  // Check 2: Mixed concerns \u2014 source + docs + config in one commit\n  const concernCount = [analysis.hasSource, analysis.hasDocs, analysis.hasConfig].filter(Boolean).length;\n  if (concernCount > 1 && !analysis.hasTests) {\n    // Tests with source is fine, but source + docs + config is suspicious\n    const concerns = [];\n    if (analysis.hasSource) concerns.push('source code');\n    if (analysis.hasDocs) concerns.push('documentation');\n    if (analysis.hasConfig) concerns.push('configuration');\n    warnings.push(`Mixed concerns: ${concerns.join(' + ')}. Consider separate commits for each.`);\n  }\n\n  // Check 3: Directory spread \u2014 changes in many unrelated top-level dirs\n  const topLevelDirs = new Set(analysis.files.map((f) => f.split('/')[0]).filter((d) => d && d !== '.'));\n  const UNRELATED_DIR_THRESHOLD = 4;\n  if (topLevelDirs.size >= UNRELATED_DIR_THRESHOLD) {\n    warnings.push(\n      `Changes span ${topLevelDirs.size} top-level directories (${[...topLevelDirs].slice(0, 5).join(', ')}). Verify all changes are related.`\n    );\n  }\n\n  // Check 4: Detect likely commit type mixing from file patterns\n  const commitMsg = extractCommitMessage(command);\n  if (commitMsg) {\n    const declaredType = commitMsg.match(/^(feat|fix|refactor|docs|test|chore|style|perf|ci|build)/)?.[1];\n    if (declaredType === 'feat' && analysis.hasConfig && !analysis.hasSource) {\n      warnings.push(`Commit type is \"feat\" but only config files are staged. Use \"chore\" instead?`);\n    }\n    if (declaredType === 'docs' && analysis.hasSource) {\n      warnings.push(`Commit type is \"docs\" but source files are staged. Split docs from code changes.`);\n    }\n    if (declaredType === 'test' && analysis.hasSource && !analysis.hasTests) {\n      warnings.push(`Commit type is \"test\" but no test files found in staged changes.`);\n    }\n  }\n\n  if (warnings.length > 0) {\n    const context = `Atomic commit check:\\n${warnings.map((w) => `- ${w}`).join('\\n')}\\n\\nTip: Use \\`git add -p\\` to stage changes interactively. See commit/rules/atomic-commit.md for guidelines.`;\n    return outputAllowWithContext(context);\n  }\n\n  return null;\n}\n\n// =============================================================================\n// MAIN HOOK\n// =============================================================================\n\nexport function gitValidator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  if (!command.startsWith('git')) {\n    return outputSilentSuccess();\n  }\n\n  const currentBranch = getCachedBranch(input.project_dir);\n\n  logHook('git-validator', `Validating: ${command.slice(0, 50)}...`);\n\n  // 1. Branch protection (can block)\n  const protectionResult = validateBranchProtection(command, currentBranch);\n  if (protectionResult?.continue === false) {\n    return protectionResult;\n  }\n\n  // 2. Commit message validation (can block)\n  const commitMsgResult = validateCommitMessage(command);\n  if (commitMsgResult?.continue === false) {\n    return commitMsgResult;\n  }\n\n  // 3. Branch naming (advisory)\n  const branchNameResult = validateBranchNaming(command);\n\n  // 4. Atomic commit (advisory)\n  const atomicResult = validateAtomicCommit(command, input.project_dir);\n\n  // Combine advisory contexts\n  const contexts: string[] = [];\n\n  if (protectionResult?.hookSpecificOutput?.additionalContext) {\n    contexts.push(protectionResult.hookSpecificOutput.additionalContext as string);\n  }\n  if (commitMsgResult?.hookSpecificOutput?.additionalContext) {\n    contexts.push(commitMsgResult.hookSpecificOutput.additionalContext as string);\n  }\n  if (branchNameResult?.hookSpecificOutput?.additionalContext) {\n    contexts.push(branchNameResult.hookSpecificOutput.additionalContext as string);\n  }\n  if (atomicResult?.hookSpecificOutput?.additionalContext) {\n    contexts.push(atomicResult.hookSpecificOutput.additionalContext as string);\n  }\n\n  if (contexts.length > 0) {\n    return outputWithContext(contexts.join('\\n\\n'));\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Compound Command Validator Hook\n * Detects suspicious shell features that bypass simple pattern matching.\n * CC 2.1.7: Catches process substitution, brace expansion, IFS manipulation, etc.\n *\n * NOTE: Dangerous command patterns (rm -rf, dd, mkfs, etc.) are handled by\n * dangerous-command-blocker.ts which runs FIRST in sync-bash-dispatcher.\n * This hook focuses solely on shell feature detection \u2014 its unique value.\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\nimport { detectSuspiciousShellFeatures } from '../../lib/normalize-command.js';\n\n/**\n * Validate compound commands for suspicious shell features\n */\nexport function compoundCommandValidator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Detect shell features that bypass simple pattern matching:\n  // process substitution <(...), brace expansion {cmd,...},\n  // here-strings <<<, IFS manipulation, nested command substitution\n  const suspiciousFeatures = detectSuspiciousShellFeatures(command);\n  if (suspiciousFeatures.length > 0) {\n    const reason = suspiciousFeatures.join('; ');\n    logPermissionFeedback('deny', `Suspicious shell feature: ${reason}`, input);\n    logHook('compound-command-validator', `BLOCKED: ${reason}`);\n\n    return outputDeny(\n      `BLOCKED: Suspicious shell feature detected.\n\nFinding: ${reason}\n\nThese shell features can bypass command validation and are not permitted.\nPlease rewrite the command using standard shell syntax.`\n    );\n  }\n\n  // Safe compound command - allow execution\n  logPermissionFeedback('allow', 'Compound command validated: safe', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Default Timeout Setter Hook\n * Sets default timeout of 120000ms (2 minutes) if not specified\n * CC 2.1.25 Compliant: uses canonical outputWithUpdatedInput helper\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport { logHook, outputWithUpdatedInput } from '../../lib/common.js';\n\n/**\n * Default timeout: 2 minutes (120000ms)\n */\nconst DEFAULT_TIMEOUT = 120000;\n\n/**\n * Set default timeout if not specified\n */\nexport function defaultTimeoutSetter(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const timeout = input.tool_input.timeout;\n  const description = input.tool_input.description;\n\n  // If timeout is already set, don't modify\n  if (typeof timeout === 'number' && timeout > 0) {\n    return { continue: true, suppressOutput: true };\n  }\n\n  // Build updatedInput with default timeout\n  const updated: Record<string, unknown> = {\n    command,\n    timeout: DEFAULT_TIMEOUT,\n  };\n\n  if (description && typeof description === 'string') {\n    updated.description = description;\n  }\n\n  logHook('default-timeout-setter', `Setting default timeout: ${DEFAULT_TIMEOUT}ms`);\n\n  return outputWithUpdatedInput(updated);\n}\n", "/**\n * Error Pattern Warner Hook\n * Warns before executing commands matching known bad patterns\n * CC 2.1.9 Enhanced: injects additionalContext with learned error patterns\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\ninterface ErrorRule {\n  tool: string;\n  signature: string;\n  pattern?: string;\n  occurrence_count?: number;\n  suggested_fix?: string;\n  sample_input?: {\n    command?: string;\n  };\n}\n\ninterface RulesFile {\n  rules: ErrorRule[];\n}\n\n/**\n * Load error rules from file\n */\nfunction loadErrorRules(projectDir: string): ErrorRule[] {\n  const rulesFile = join(projectDir, '.claude', 'rules', 'error_rules.json');\n\n  try {\n    if (existsSync(rulesFile)) {\n      const data: RulesFile = JSON.parse(readFileSync(rulesFile, 'utf8'));\n      return data.rules || [];\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return [];\n}\n\n/**\n * Count common words between two strings\n */\nfunction countCommonWords(str1: string, str2: string): number {\n  const words1 = new Set(str1.toLowerCase().split(/\\s+/));\n  const words2 = new Set(str2.toLowerCase().split(/\\s+/));\n\n  let count = 0;\n  for (const word of words1) {\n    if (words2.has(word) && word.length > 2) {\n      count++;\n    }\n  }\n\n  return count;\n}\n\n/**\n * Warn about commands matching known error patterns\n */\nexport function errorPatternWarner(input: HookInput): HookResult {\n  const projectDir = getProjectDir();\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Load error rules\n  const rules = loadErrorRules(projectDir);\n  if (rules.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const hints: string[] = [];\n\n  // Check for common database connection patterns that often fail\n  if (command.includes('psql') && /-U\\s+(postgres|orchestkit|root)/.test(command)) {\n    const dbRules = rules.filter(\n      (r) => r.tool === 'Bash' && r.signature?.includes('role')\n    );\n    if (dbRules.length > 0) {\n      hints.push('DB role error: use docker exec -it <container> psql -U orchestkit_user');\n    }\n  }\n\n  // Check for MCP postgres tool issues\n  if (command.includes('mcp__postgres')) {\n    const mcpRules = rules.filter((r) => r.tool?.includes('postgres-mcp'));\n    if (mcpRules.length > 0) {\n      hints.push('MCP postgres: verify connection to correct database');\n    }\n  }\n\n  // Check against high-occurrence error patterns\n  for (const rule of rules) {\n    if (!rule.pattern || (rule.occurrence_count || 0) < 5) continue;\n\n    const sampleCommand = rule.sample_input?.command;\n    if (sampleCommand && countCommonWords(command, sampleCommand) > 3) {\n      logHook('error-pattern-warner', `Pattern match: ${rule.signature}`);\n      if (rule.suggested_fix) {\n        hints.push(`${rule.signature} (${rule.occurrence_count}x): ${rule.suggested_fix}`);\n      } else {\n        hints.push(`${rule.signature} (${rule.occurrence_count}x)`);\n      }\n    }\n  }\n\n  // CC 2.1.9: Inject additionalContext if we have pattern hints\n  if (hints.length > 0) {\n    let contextMsg = `Learned error patterns | ${hints.join(' | ')}`;\n\n    // Truncate if too long (keep under 200 chars for context budget)\n    if (contextMsg.length > 200) {\n      contextMsg = `${contextMsg.slice(0, 197)}...`;\n    }\n\n    return outputWithContext(contextMsg);\n  }\n\n  // No relevant patterns found\n  return outputSilentSuccess();\n}\n", "/**\n * Conflict Predictor Hook\n * Predicts potential merge conflicts before git operations\n * CC 2.1.9: Injects warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\nimport { assertSafeGitRef, assertSafeShellArg } from '../../lib/sanitize-shell.js';\n\n/**\n * Get files that might conflict on merge/rebase\n */\nfunction getPotentialConflicts(projectDir: string, targetBranch: string): string[] {\n  try {\n    const safeBranch = assertSafeGitRef(targetBranch, 'target branch');\n    // Get files changed in current branch since diverging from target\n    const result = execSync(\n      `git diff --name-only ${safeBranch}...HEAD 2>/dev/null || echo \"\"`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    const changedFiles = result.trim().split('\\n').filter(Boolean);\n\n    // Check which of these files have also been modified in target branch\n    const conflicts: string[] = [];\n    for (const file of changedFiles.slice(0, 20)) {\n      // Limit to first 20 files\n      try {\n        const safeFile = assertSafeShellArg(file, 'file path');\n        const targetModified = execSync(\n          `git log -1 --pretty=format:\"%h\" ${safeBranch} -- \"${safeFile}\" 2>/dev/null || echo \"\"`,\n          {\n            cwd: projectDir,\n            encoding: 'utf8',\n            timeout: 5000,\n            stdio: ['pipe', 'pipe', 'pipe'],\n          }\n        );\n\n        if (targetModified.trim()) {\n          conflicts.push(file);\n        }\n      } catch {\n        // Ignore individual file check errors\n      }\n    }\n\n    return conflicts;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Predict conflicts before merge/rebase operations\n */\nexport function conflictPredictor(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git merge or rebase commands\n  if (!/git\\s+(merge|rebase|pull)/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract target branch\n  let targetBranch: string | null = null;\n\n  // git merge <branch>, git rebase <branch>\n  const branchMatch = command.match(/git\\s+(merge|rebase)\\s+(\\S+)/);\n  if (branchMatch) {\n    targetBranch = branchMatch[2];\n  }\n\n  // git pull (uses remote tracking branch)\n  if (command.includes('git pull')) {\n    targetBranch = 'origin/dev'; // Assume dev as base\n  }\n\n  if (!targetBranch) {\n    return outputSilentSuccess();\n  }\n\n  // Check for potential conflicts\n  const conflicts = getPotentialConflicts(projectDir, targetBranch);\n\n  if (conflicts.length > 0) {\n    const context = `Potential conflicts detected: ${conflicts.length} file(s)\nFiles: ${conflicts.slice(0, 5).join(', ')}${conflicts.length > 5 ? '...' : ''}\n\nConsider:\n1. Review changes in these files before merging\n2. Run: git diff ${targetBranch}...HEAD -- <file>\n3. Prepare conflict resolution strategy`;\n\n    logPermissionFeedback('allow', `Conflict prediction: ${conflicts.length} files`, input);\n    logHook('conflict-predictor', `Potential conflicts: ${conflicts.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  logPermissionFeedback('allow', 'No conflicts predicted', input);\n  return outputSilentSuccess();\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-23\n\n/**\n * Shell argument sanitization for safe command construction\n *\n * Prevents shell injection by validating arguments against strict allowlists\n * or quoting them safely for shell consumption.\n */\n\n/**\n * Strict allowlist regex for safe shell arguments: alphanumeric, dots, slashes,\n * hyphens, underscores, tildes, equals, colons, at-signs.\n * Rejects anything containing shell metacharacters.\n */\nconst SAFE_ARG_RE = /^[a-zA-Z0-9._/~=:@-]+$/;\n\n/**\n * Validate that a string is safe to interpolate into a shell command.\n * Returns the string unchanged if it matches the allowlist, otherwise throws.\n */\nexport function assertSafeShellArg(arg: string, label = 'argument'): string {\n  if (!arg || !SAFE_ARG_RE.test(arg)) {\n    throw new Error(`Unsafe shell ${label}: ${JSON.stringify(arg)}`);\n  }\n  return arg;\n}\n\n/**\n * Quote a string for safe use in a single-quoted shell argument.\n * Wraps in single quotes with internal single-quote escaping.\n * Safe for arbitrary content including spaces and special characters.\n */\nexport function shellQuote(arg: string): string {\n  return `'${arg.replace(/'/g, \"'\\\\''\")}'`;\n}\n\n/**\n * Validate that a string looks like a git ref (branch name, tag, or SHA).\n * Allows: alphanumeric, dots, slashes, hyphens, underscores.\n * Rejects shell metacharacters, spaces, and anything suspicious.\n */\nexport function assertSafeGitRef(ref: string, label = 'git ref'): string {\n  if (!ref || !/^[a-zA-Z0-9._/-]+$/.test(ref)) {\n    throw new Error(`Unsafe ${label}: ${JSON.stringify(ref)}`);\n  }\n  return ref;\n}\n\n/**\n * Validate that a string is a simple command name (no path separators or spaces).\n * For use with `command -v` / `which` checks.\n */\nexport function assertSafeCommandName(cmd: string): string {\n  if (!cmd || !/^[a-zA-Z0-9_-]+$/.test(cmd)) {\n    throw new Error(`Unsafe command name: ${JSON.stringify(cmd)}`);\n  }\n  return cmd;\n}\n\n/**\n * Validate that a string is a safe filename glob pattern.\n * Allows: alphanumeric, dots, underscores, hyphens, asterisks (for globs).\n * For use with `find -name` inside double quotes (shell won't expand globs).\n */\nexport function assertSafeGlobPattern(pattern: string, label = 'glob pattern'): string {\n  if (!pattern || !/^[a-zA-Z0-9._*-]+$/.test(pattern)) {\n    throw new Error(`Unsafe ${label}: ${JSON.stringify(pattern)}`);\n  }\n  return pattern;\n}\n\n/**\n * Validate that a string looks like a GitHub issue number (digits only).\n */\nexport function assertSafeIssueNumber(num: string): string {\n  if (!num || !/^\\d+$/.test(num)) {\n    throw new Error(`Unsafe issue number: ${JSON.stringify(num)}`);\n  }\n  return num;\n}\n", "/**\n * Affected Tests Finder Hook\n * Suggests running tests related to changed files\n * CC 2.1.9: Injects test suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\nimport { existsSync } from 'node:fs';\nimport { join, basename, dirname } from 'node:path';\n\n/**\n * Find test files related to a source file\n */\nfunction findRelatedTests(projectDir: string, sourceFile: string): string[] {\n  const tests: string[] = [];\n  const baseName = basename(sourceFile).replace(/\\.(ts|tsx|js|jsx|py)$/, '');\n  const dirName = dirname(sourceFile);\n\n  // Common test file patterns\n  const testPatterns = [\n    `${dirName}/${baseName}.test.ts`,\n    `${dirName}/${baseName}.test.tsx`,\n    `${dirName}/${baseName}.spec.ts`,\n    `${dirName}/${baseName}.spec.tsx`,\n    `${dirName}/__tests__/${baseName}.test.ts`,\n    `${dirName}/__tests__/${baseName}.test.tsx`,\n    `tests/${sourceFile.replace(/\\.(ts|tsx|js|jsx)$/, '.test.ts')}`,\n    `test_${baseName}.py`,\n    `tests/test_${baseName}.py`,\n  ];\n\n  for (const pattern of testPatterns) {\n    const fullPath = join(projectDir, pattern);\n    if (existsSync(fullPath)) {\n      tests.push(pattern);\n    }\n  }\n\n  return tests;\n}\n\n/**\n * Get changed files from git status\n */\nfunction getChangedFiles(projectDir: string): string[] {\n  try {\n    const result = execSync('git status --short 2>/dev/null || echo \"\"', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    return result\n      .split('\\n')\n      .filter((line) => line.trim())\n      .map((line) => line.slice(3).trim())\n      .filter((file) => /\\.(ts|tsx|js|jsx|py)$/.test(file));\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Suggest running affected tests before push/commit\n */\nexport function affectedTestsFinder(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git push or npm test commands\n  if (!/git\\s+push|npm\\s+run\\s+test|pytest/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip if already running tests\n  if (/npm\\s+run\\s+test|pytest/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get changed files\n  const changedFiles = getChangedFiles(projectDir);\n  if (changedFiles.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Find related tests\n  const relatedTests: string[] = [];\n  for (const file of changedFiles.slice(0, 10)) {\n    // Limit to first 10 files\n    const tests = findRelatedTests(projectDir, file);\n    relatedTests.push(...tests);\n  }\n\n  // Remove duplicates\n  const uniqueTests = [...new Set(relatedTests)];\n\n  if (uniqueTests.length > 0) {\n    const context = `Related tests for changed files:\n${uniqueTests.slice(0, 5).join('\\n')}${uniqueTests.length > 5 ? '\\n...' : ''}\n\nConsider running: npm run test -- ${uniqueTests[0]}`;\n\n    logPermissionFeedback('allow', `Found ${uniqueTests.length} related tests`, input);\n    logHook('affected-tests-finder', `Tests: ${uniqueTests.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * CI Simulation Hook\n * Suggests running CI-like checks locally before push\n * CC 2.1.9: Injects CI suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Detect available CI checks based on project files\n */\nfunction detectCIChecks(projectDir: string): string[] {\n  const checks: string[] = [];\n\n  // Node.js project\n  if (existsSync(join(projectDir, 'package.json'))) {\n    checks.push('npm run lint');\n    checks.push('npm run typecheck');\n    checks.push('npm run test');\n  }\n\n  // Python project\n  if (existsSync(join(projectDir, 'pyproject.toml'))) {\n    checks.push('ruff check .');\n    checks.push('mypy .');\n    checks.push('pytest');\n  }\n\n  // Go project\n  if (existsSync(join(projectDir, 'go.mod'))) {\n    checks.push('go vet ./...');\n    checks.push('go test ./...');\n  }\n\n  return checks;\n}\n\n/**\n * Suggest CI checks before git push\n */\nexport function ciSimulation(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git push commands\n  if (!/git\\s+push/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Detect available checks\n  const checks = detectCIChecks(projectDir);\n\n  if (checks.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Pre-push CI simulation suggested:\n${checks.slice(0, 3).join('\\n')}\n\nRun these locally to catch issues before CI fails.\nOr: git push --no-verify to skip (not recommended)`;\n\n  logPermissionFeedback('allow', 'CI simulation suggested', input);\n  logHook('ci-simulation', `Suggested checks: ${checks.join(', ')}`);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Pre-Commit Simulation Hook\n * Suggests running pre-commit hooks locally\n * CC 2.1.9: Injects pre-commit suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check if pre-commit is configured\n */\nfunction hasPreCommitConfig(projectDir: string): boolean {\n  return (\n    existsSync(join(projectDir, '.pre-commit-config.yaml')) ||\n    existsSync(join(projectDir, '.pre-commit-config.yml'))\n  );\n}\n\n/**\n * Check if husky is configured\n */\nfunction hasHuskyConfig(projectDir: string): boolean {\n  return existsSync(join(projectDir, '.husky'));\n}\n\n/**\n * Suggest pre-commit checks before commit\n */\nexport function preCommitSimulation(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git commit commands\n  if (!/git\\s+commit/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if using --no-verify (skip hooks)\n  if (/--no-verify/.test(command)) {\n    const context = `WARNING: --no-verify will skip pre-commit hooks.\nConsider removing it unless intentional.\nSkipped checks may cause CI failures.`;\n\n    logPermissionFeedback('allow', 'Skip pre-commit detected', input);\n    logHook('pre-commit-simulation', '--no-verify used');\n    return outputAllowWithContext(context);\n  }\n\n  // Check for pre-commit configuration\n  if (hasPreCommitConfig(projectDir)) {\n    const context = `Pre-commit hooks will run: .pre-commit-config.yaml\nIf hooks fail, fix issues and retry.\nRun manually: pre-commit run --all-files`;\n\n    logPermissionFeedback('allow', 'pre-commit config found', input);\n    return outputAllowWithContext(context);\n  }\n\n  // Check for husky\n  if (hasHuskyConfig(projectDir)) {\n    const context = `Husky hooks will run: .husky/\nIf hooks fail, fix issues and retry.`;\n\n    logPermissionFeedback('allow', 'husky config found', input);\n    return outputAllowWithContext(context);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * PR Merge Gate Hook\n * Checks PR status before merge commands\n * CC 2.1.9: Injects PR status via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\n\ninterface PRStatus {\n  number: number;\n  state: string;\n  mergeable: boolean;\n  statusCheckRollup: string;\n  reviewDecision: string;\n}\n\n/**\n * Get PR status from GitHub CLI\n */\nfunction getPRStatus(projectDir: string, prNumber?: number): PRStatus | null {\n  try {\n    const prArg = prNumber ? `${prNumber}` : '';\n    const result = execSync(\n      `gh pr view ${prArg} --json number,state,mergeable,statusCheckRollup,reviewDecision 2>/dev/null`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    return JSON.parse(result) as PRStatus;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check PR status before merge\n */\nexport function prMergeGate(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process gh pr merge commands\n  if (!/gh\\s+pr\\s+merge/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract PR number if specified\n  const prMatch = command.match(/gh\\s+pr\\s+merge\\s+(\\d+)/);\n  const prNumber = prMatch ? parseInt(prMatch[1], 10) : undefined;\n\n  // Get PR status\n  const status = getPRStatus(projectDir, prNumber);\n\n  if (!status) {\n    const context = `Could not fetch PR status. Ensure:\n1. gh CLI is installed and authenticated\n2. You're in a git repository\n3. PR exists and is accessible`;\n\n    logPermissionFeedback('allow', 'PR status unavailable', input);\n    return outputAllowWithContext(context);\n  }\n\n  // Check if PR is mergeable\n  const issues: string[] = [];\n\n  if (status.state !== 'OPEN') {\n    issues.push(`PR state: ${status.state} (expected OPEN)`);\n  }\n\n  if (!status.mergeable) {\n    issues.push('PR has merge conflicts');\n  }\n\n  if (status.statusCheckRollup !== 'SUCCESS' && status.statusCheckRollup !== 'PENDING') {\n    issues.push(`Status checks: ${status.statusCheckRollup}`);\n  }\n\n  if (status.reviewDecision === 'CHANGES_REQUESTED') {\n    issues.push('Changes requested by reviewer');\n  }\n\n  if (issues.length > 0) {\n    const context = `PR #${status.number} has issues:\n${issues.join('\\n')}\n\nResolve these before merging.`;\n\n    logPermissionFeedback('allow', `PR issues: ${issues.join(', ')}`, input);\n    logHook('pr-merge-gate', `PR #${status.number} has ${issues.length} issues`);\n    return outputAllowWithContext(context);\n  }\n\n  // PR looks good\n  logPermissionFeedback('allow', `PR #${status.number} ready to merge`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Changelog Generator Hook\n * Suggests changelog entries for version bumps\n * CC 2.1.9: Injects changelog suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\n\n/**\n * Get recent commits for changelog\n */\nfunction getRecentCommits(projectDir: string, since?: string): string[] {\n  try {\n    const sinceArg = since ? `--since=\"${since}\"` : '--max-count=20';\n    const result = execSync(\n      `git log ${sinceArg} --pretty=format:\"%s\" 2>/dev/null || echo \"\"`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    return result.split('\\n').filter(Boolean);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Group commits by type for changelog\n */\nfunction groupCommitsByType(commits: string[]): Record<string, string[]> {\n  const groups: Record<string, string[]> = {\n    feat: [],\n    fix: [],\n    refactor: [],\n    docs: [],\n    test: [],\n    chore: [],\n    other: [],\n  };\n\n  for (const commit of commits) {\n    const match = commit.match(/^(feat|fix|refactor|docs|test|chore|perf|ci|build)/);\n    if (match) {\n      const type = match[1] === 'perf' || match[1] === 'ci' || match[1] === 'build' ? 'chore' : match[1];\n      groups[type].push(commit);\n    } else {\n      groups.other.push(commit);\n    }\n  }\n\n  return groups;\n}\n\n/**\n * Suggest changelog entries for version commands\n */\nexport function changelogGenerator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm version, poetry version, or changelog commands\n  if (!/npm\\s+version|poetry\\s+version|changelog/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get recent commits\n  const commits = getRecentCommits(projectDir);\n\n  if (commits.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Group by type\n  const groups = groupCommitsByType(commits);\n\n  // Build changelog suggestion\n  const sections: string[] = [];\n\n  if (groups.feat.length > 0) {\n    sections.push(`### Features\\n${groups.feat.slice(0, 5).map((c) => `- ${c}`).join('\\n')}`);\n  }\n  if (groups.fix.length > 0) {\n    sections.push(`### Bug Fixes\\n${groups.fix.slice(0, 5).map((c) => `- ${c}`).join('\\n')}`);\n  }\n  if (groups.refactor.length > 0 || groups.chore.length > 0) {\n    const combined = [...groups.refactor, ...groups.chore];\n    sections.push(`### Maintenance\\n${combined.slice(0, 3).map((c) => `- ${c}`).join('\\n')}`);\n  }\n\n  if (sections.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Suggested changelog entries:\n\n${sections.join('\\n\\n')}\n\nUpdate CHANGELOG.md before releasing.`;\n\n  logPermissionFeedback('allow', 'Changelog suggestions generated', input);\n  logHook('changelog-generator', `Generated ${sections.length} sections`);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Version Sync Hook\n * Checks version consistency across files\n * CC 2.1.9: Injects version warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\ninterface VersionSource {\n  file: string;\n  version: string | null;\n}\n\n/**\n * Extract version from package.json\n */\nfunction getPackageJsonVersion(projectDir: string): string | null {\n  const filePath = join(projectDir, 'package.json');\n  try {\n    if (existsSync(filePath)) {\n      const data = JSON.parse(readFileSync(filePath, 'utf8'));\n      return data.version || null;\n    }\n  } catch {\n    // Ignore\n  }\n  return null;\n}\n\n/**\n * Extract version from pyproject.toml\n */\nfunction getPyprojectVersion(projectDir: string): string | null {\n  const filePath = join(projectDir, 'pyproject.toml');\n  try {\n    if (existsSync(filePath)) {\n      const content = readFileSync(filePath, 'utf8');\n      const match = content.match(/version\\s*=\\s*[\"']([^\"']+)[\"']/);\n      return match ? match[1] : null;\n    }\n  } catch {\n    // Ignore\n  }\n  return null;\n}\n\n/**\n * Get all version sources\n */\nfunction getVersionSources(projectDir: string): VersionSource[] {\n  const sources: VersionSource[] = [];\n\n  const pkgVersion = getPackageJsonVersion(projectDir);\n  if (pkgVersion) {\n    sources.push({ file: 'package.json', version: pkgVersion });\n  }\n\n  const pyVersion = getPyprojectVersion(projectDir);\n  if (pyVersion) {\n    sources.push({ file: 'pyproject.toml', version: pyVersion });\n  }\n\n  return sources;\n}\n\n/**\n * Check version sync on version bump commands\n */\nexport function versionSync(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm version or poetry version commands\n  if (!/npm\\s+version|poetry\\s+version/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get all version sources\n  const sources = getVersionSources(projectDir);\n\n  if (sources.length < 2) {\n    return outputSilentSuccess();\n  }\n\n  // Check if versions are in sync\n  const versions = sources.map((s) => s.version);\n  const uniqueVersions = [...new Set(versions)];\n\n  if (uniqueVersions.length > 1) {\n    const context = `Version mismatch detected:\n${sources.map((s) => `${s.file}: ${s.version}`).join('\\n')}\n\nConsider syncing versions across all files.`;\n\n    logPermissionFeedback('allow', 'Version mismatch detected', input);\n    logHook('version-sync', `Versions: ${versions.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  // All in sync\n  logPermissionFeedback('allow', `Versions in sync: ${uniqueVersions[0]}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * License Compliance Hook\n * Checks for license compliance issues in dependencies\n * CC 2.1.9: Injects license warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Problematic license patterns\n */\nconst PROBLEMATIC_LICENSES = [\n  'GPL', // Copyleft\n  'AGPL', // Strong copyleft\n  'LGPL', // Weaker copyleft but still restrictive\n  'CC-BY-NC', // Non-commercial\n  'SSPL', // Server Side Public License\n];\n\n/**\n * Check package.json dependencies for license issues\n */\nfunction checkNpmLicenses(projectDir: string): string[] {\n  const issues: string[] = [];\n  const lockFile = join(projectDir, 'package-lock.json');\n\n  try {\n    if (existsSync(lockFile)) {\n      const content = readFileSync(lockFile, 'utf8');\n\n      for (const license of PROBLEMATIC_LICENSES) {\n        if (content.includes(`\"license\": \"${license}`)) {\n          issues.push(`Found ${license} license in npm dependencies`);\n        }\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  return issues;\n}\n\n/**\n * Check for license compliance on install commands\n */\nexport function licenseCompliance(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm install, yarn add, or pip install commands\n  if (!/npm\\s+install|yarn\\s+add|pip\\s+install|poetry\\s+add/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip if just installing from lock file\n  if (/npm\\s+ci|npm\\s+install\\s*$/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract package name\n  const pkgMatch = command.match(/(?:npm\\s+install|yarn\\s+add|pip\\s+install|poetry\\s+add)\\s+(\\S+)/);\n  const pkgName = pkgMatch ? pkgMatch[1] : null;\n\n  if (!pkgName) {\n    return outputSilentSuccess();\n  }\n\n  // Check existing licenses\n  const issues = checkNpmLicenses(projectDir);\n\n  if (issues.length > 0) {\n    const context = `License compliance check:\n${issues.join('\\n')}\n\nNew dependency: ${pkgName}\nConsider checking its license before adding.\n\nUse: npm view ${pkgName} license`;\n\n    logPermissionFeedback('allow', 'License compliance warning', input);\n    logHook('license-compliance', `Checking: ${pkgName}`);\n    return outputAllowWithContext(context);\n  }\n\n  // Suggest checking license\n  const context = `Installing: ${pkgName}\nVerify license compatibility before production use.\nCheck: npm view ${pkgName} license`;\n\n  logPermissionFeedback('allow', `Installing package: ${pkgName}`, input);\n  return outputAllowWithContext(context);\n}\n", "/**\n * GitHub Issue Creation Guide Hook\n * Provides guidance for creating GitHub issues\n * CC 2.1.9: Injects issue creation context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Issue templates based on type\n */\nconst ISSUE_TEMPLATES: Record<string, string> = {\n  bug: `## Description\n<!-- Clear description of the bug -->\n\n## Steps to Reproduce\n1.\n2.\n3.\n\n## Expected Behavior\n<!-- What should happen -->\n\n## Actual Behavior\n<!-- What actually happens -->\n\n## Environment\n- OS:\n- Version:`,\n\n  feature: `## Description\n<!-- Clear description of the feature -->\n\n## Motivation\n<!-- Why is this feature needed? -->\n\n## Proposed Solution\n<!-- How should this be implemented? -->\n\n## Alternatives Considered\n<!-- Other approaches considered -->`,\n\n  chore: `## Description\n<!-- What maintenance task needs to be done? -->\n\n## Impact\n<!-- What does this affect? -->\n\n## Checklist\n- [ ] Task 1\n- [ ] Task 2`,\n};\n\n/**\n * Detect issue type from command\n */\nfunction detectIssueType(command: string): string | null {\n  if ((command.includes('--label') && /bug/i.test(command)) || /bug\\s+report/i.test(command)) return 'bug';\n  if ((command.includes('--label') && /feature/i.test(command)) || /feature\\s+request/i.test(command)) return 'feature';\n  if ((command.includes('--label') && /chore/i.test(command)) || /maintenance/i.test(command)) return 'chore';\n  return null;\n}\n\n/**\n * Provide guidance for GitHub issue creation\n */\nexport function ghIssueCreationGuide(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process gh issue create commands\n  if (!/gh\\s+issue\\s+create/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if already has body/template\n  if (/--body|--body-file|-b\\s/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Detect issue type\n  const issueType = detectIssueType(command);\n\n  if (issueType && ISSUE_TEMPLATES[issueType]) {\n    const context = `Issue type detected: ${issueType}\n\nSuggested template:\n${ISSUE_TEMPLATES[issueType].slice(0, 200)}...\n\nAdd --body with template or use --web for interactive creation.`;\n\n    logPermissionFeedback('allow', `Issue creation: ${issueType}`, input);\n    logHook('gh-issue-creation-guide', `Type: ${issueType}`);\n    return outputAllowWithContext(context);\n  }\n\n  // Generic guidance\n  const context = `Creating GitHub issue. Consider:\n- Clear, descriptive title\n- Add appropriate labels (bug, feature, chore)\n- Include reproduction steps for bugs\n- Reference related issues/PRs\n\nUse --web for interactive creation with templates.`;\n\n  logPermissionFeedback('allow', 'Issue creation guidance', input);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Issue Docs Requirement Hook\n * Reminds to update documentation for feature issues\n * CC 2.1.9: Injects documentation reminders via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Documentation checklist for features\n */\nconst DOCS_CHECKLIST = `Documentation checklist for features:\n- [ ] Update README.md if public API changes\n- [ ] Add/update JSDoc or docstrings\n- [ ] Update CHANGELOG.md\n- [ ] Add usage examples\n- [ ] Update API documentation`;\n\n/**\n * Remind about documentation for feature branches/issues\n */\nexport function issueDocsRequirement(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process gh issue close or gh pr merge for feature issues\n  if (!/gh\\s+(issue\\s+close|pr\\s+merge)/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if this is a feature (look for feat/feature labels or branch names)\n  const isFeature =\n    (command.includes('--label') && /feat/i.test(command)) ||\n    /feat|feature/.test(command);\n\n  if (!isFeature) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Feature completion detected. Ensure documentation is updated.\n\n${DOCS_CHECKLIST}\n\nSkip with --no-edit if docs are already complete.`;\n\n  logPermissionFeedback('allow', 'Feature docs reminder', input);\n  logHook('issue-docs-requirement', 'Feature completion - docs reminder');\n  return outputAllowWithContext(context);\n}\n", "/**\n * Multi-Instance Quality Gate Hook\n * Enforces quality checks in multi-instance scenarios\n * CC 2.1.9: Injects quality gate context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { isAgentTeamsActive } from '../../lib/agent-teams.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check if multi-instance coordination is enabled\n */\nfunction isMultiInstanceEnabled(projectDir: string): boolean {\n  const dbPath = join(projectDir, '.claude', 'coordination', '.claude.db');\n  return existsSync(dbPath);\n}\n\n/**\n * Get quality gate status from work registry\n */\nfunction getQualityGateStatus(projectDir: string): Record<string, boolean> {\n  const registryPath = join(projectDir, '.claude', 'coordination', 'work-registry.json');\n\n  try {\n    if (existsSync(registryPath)) {\n      const data = JSON.parse(readFileSync(registryPath, 'utf8'));\n      return data.qualityGates || {};\n    }\n  } catch {\n    // Ignore\n  }\n\n  return {};\n}\n\n/**\n * Enforce quality gates before merge/deploy in multi-instance mode\n */\nexport function multiInstanceQualityGate(input: HookInput): HookResult {\n  // Issue #362: Yield to CC Agent Teams when active\n  if (isAgentTeamsActive()) {\n    return outputSilentSuccess();\n  }\n\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process merge/deploy commands\n  if (!/gh\\s+pr\\s+merge|git\\s+merge|deploy/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if multi-instance is enabled\n  if (!isMultiInstanceEnabled(projectDir)) {\n    return outputSilentSuccess();\n  }\n\n  // Get quality gate status\n  const gates = getQualityGateStatus(projectDir);\n\n  // Check required gates\n  const requiredGates = ['tests', 'lint', 'typecheck'];\n  const failedGates = requiredGates.filter((gate) => !gates[gate]);\n\n  if (failedGates.length > 0) {\n    const context = `Multi-instance quality gate check:\nFailed/missing gates: ${failedGates.join(', ')}\n\nRun these checks before merging:\n${failedGates.map((g) => `- npm run ${g}`).join('\\n')}\n\nQuality gates ensure consistency across instances.`;\n\n    logPermissionFeedback('allow', `Quality gates failed: ${failedGates.join(', ')}`, input);\n    logHook('multi-instance-quality-gate', `Failed: ${failedGates.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  // All gates passed\n  logPermissionFeedback('allow', 'All quality gates passed', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Agent Browser Safety Hook\n * Validates agent-browser CLI commands for safety\n *\n * Features:\n * - URL blocklist (internal, OAuth providers)\n * - Sensitive action warnings\n * - Per-domain rate limiting (#318)\n * - robots.txt enforcement (#319)\n *\n * CC 2.1.9: Injects safety context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getLogDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { execFileSync } from 'node:child_process';\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\n/**\n * Rate limit configuration (configurable via env vars)\n */\nconst RATE_LIMITS = {\n  requestsPerMinute: parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_MIN || '10', 10),\n  requestsPerHour: parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_HOUR || '100', 10),\n  burstLimit: parseInt(process.env.AGENT_BROWSER_BURST_LIMIT || '3', 10),\n};\n\n/**\n * robots.txt cache TTL in milliseconds (default: 1 hour)\n */\nconst ROBOTS_CACHE_TTL = parseInt(process.env.AGENT_BROWSER_ROBOTS_CACHE_TTL || '3600000', 10);\n\n/**\n * Blocked URL patterns for agent-browser\n */\nconst BLOCKED_URL_PATTERNS = [\n  /localhost/i,\n  /127\\.0\\.0\\.1/i,\n  /internal\\./i,\n  /intranet\\./i,\n  /\\.local\\//i,\n  /file:\\/\\//i,\n  // Cloud metadata endpoints (SSRF prevention)\n  /169\\.254\\.169\\.254/i,\n  /metadata\\.google\\.internal/i,\n  /100\\.100\\.100\\.200/i,\n  /\\[::1\\]/i,\n  /^https?:\\/\\/0\\.0\\.0\\.0/i,\n  // Private network ranges (RFC 1918)\n  /^https?:\\/\\/10\\.\\d+\\.\\d+\\.\\d+/i,\n  /^https?:\\/\\/172\\.(1[6-9]|2\\d|3[01])\\.\\d+\\.\\d+/i,\n  /^https?:\\/\\/192\\.168\\.\\d+\\.\\d+/i,\n  // Auth/OAuth provider domains - sensitive login pages\n  /accounts\\.google\\.com/i,\n  /login\\.microsoftonline\\.com/i,\n  /auth0\\.com/i,\n  /okta\\.com/i,\n  /login\\.live\\.com/i,\n  /appleid\\.apple\\.com/i,\n  /github\\.com\\/login/i,\n  /gitlab\\.com\\/users\\/sign_in/i,\n];\n\n/**\n * Sensitive action patterns\n */\nconst SENSITIVE_ACTIONS = [\n  'click.*delete',\n  'click.*remove',\n  'fill.*password',\n  'fill.*credit',\n  'submit.*payment',\n];\n\n// =============================================================================\n// Rate Limiting (#318)\n// =============================================================================\n\ninterface RateLimitRecord {\n  timestamps: number[];\n  lastUpdated: number;\n}\n\ninterface RateLimitStore {\n  domains: Record<string, RateLimitRecord>;\n}\n\n/**\n * Get rate limit storage file path\n */\nfunction getRateLimitFile(): string {\n  const logDir = getLogDir();\n  const rateDir = join(logDir, 'agent-browser');\n  if (!existsSync(rateDir)) {\n    mkdirSync(rateDir, { recursive: true });\n  }\n  return join(rateDir, 'rate-limits.json');\n}\n\n/**\n * Load rate limit store from disk\n */\nfunction loadRateLimitStore(): RateLimitStore {\n  const file = getRateLimitFile();\n  try {\n    if (existsSync(file)) {\n      return JSON.parse(readFileSync(file, 'utf-8'));\n    }\n  } catch {\n    // Corrupted file, start fresh\n  }\n  return { domains: {} };\n}\n\n/**\n * Save rate limit store to disk\n */\nfunction saveRateLimitStore(store: RateLimitStore): void {\n  const file = getRateLimitFile();\n  try {\n    writeFileSync(file, JSON.stringify(store, null, 2));\n  } catch {\n    // Ignore write errors\n  }\n}\n\n/**\n * Extract domain from URL\n */\nfunction extractDomain(url: string): string | null {\n  try {\n    const parsed = new URL(url);\n    return parsed.hostname;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check if request is rate limited\n * Returns { allowed: true } or { allowed: false, reason: string }\n */\nfunction checkRateLimit(domain: string): { allowed: boolean; reason?: string; remaining?: number } {\n  const now = Date.now();\n  const store = loadRateLimitStore();\n\n  // Get or create domain record\n  const record = store.domains[domain] || { timestamps: [], lastUpdated: now };\n\n  // Filter to requests in the last minute\n  const oneMinuteAgo = now - 60000;\n  const oneHourAgo = now - 3600000;\n\n  record.timestamps = record.timestamps.filter((t) => t > oneHourAgo);\n\n  const requestsLastMinute = record.timestamps.filter((t) => t > oneMinuteAgo).length;\n  const requestsLastHour = record.timestamps.length;\n\n  // Check minute limit\n  if (requestsLastMinute >= RATE_LIMITS.requestsPerMinute) {\n    return {\n      allowed: false,\n      reason: `Rate limited: ${requestsLastMinute}/${RATE_LIMITS.requestsPerMinute} requests per minute to ${domain}`,\n      remaining: 0,\n    };\n  }\n\n  // Check hour limit\n  if (requestsLastHour >= RATE_LIMITS.requestsPerHour) {\n    return {\n      allowed: false,\n      reason: `Rate limited: ${requestsLastHour}/${RATE_LIMITS.requestsPerHour} requests per hour to ${domain}`,\n      remaining: 0,\n    };\n  }\n\n  // Check burst (rapid successive requests)\n  const lastThreeSeconds = now - 3000;\n  const recentBurst = record.timestamps.filter((t) => t > lastThreeSeconds).length;\n  if (recentBurst >= RATE_LIMITS.burstLimit) {\n    return {\n      allowed: false,\n      reason: `Burst limited: Too many rapid requests to ${domain}. Wait a moment.`,\n      remaining: 0,\n    };\n  }\n\n  // Allow and record\n  record.timestamps.push(now);\n  record.lastUpdated = now;\n  store.domains[domain] = record;\n  saveRateLimitStore(store);\n\n  return {\n    allowed: true,\n    remaining: RATE_LIMITS.requestsPerMinute - requestsLastMinute - 1,\n  };\n}\n\n// =============================================================================\n// robots.txt Enforcement (#319)\n// =============================================================================\n\ninterface RobotsCacheEntry {\n  rules: string[];\n  disallowedPaths: string[];\n  expires: number;\n  fetchedAt: number;\n}\n\ninterface RobotsCache {\n  entries: Record<string, RobotsCacheEntry>;\n}\n\n/**\n * Get robots.txt cache file path\n */\nfunction getRobotsCacheFile(): string {\n  const logDir = getLogDir();\n  const cacheDir = join(logDir, 'agent-browser');\n  if (!existsSync(cacheDir)) {\n    mkdirSync(cacheDir, { recursive: true });\n  }\n  return join(cacheDir, 'robots-cache.json');\n}\n\n/**\n * Load robots.txt cache from disk\n */\nfunction loadRobotsCache(): RobotsCache {\n  const file = getRobotsCacheFile();\n  try {\n    if (existsSync(file)) {\n      return JSON.parse(readFileSync(file, 'utf-8'));\n    }\n  } catch {\n    // Corrupted file, start fresh\n  }\n  return { entries: {} };\n}\n\n/**\n * Save robots.txt cache to disk\n */\nfunction saveRobotsCache(cache: RobotsCache): void {\n  const file = getRobotsCacheFile();\n  try {\n    writeFileSync(file, JSON.stringify(cache, null, 2));\n  } catch {\n    // Ignore write errors\n  }\n}\n\n/**\n * Parse robots.txt content and extract disallowed paths for * user-agent\n */\nfunction parseRobotsTxt(content: string): string[] {\n  const disallowed: string[] = [];\n  let inWildcardSection = false;\n\n  const lines = content.split('\\n');\n  for (const line of lines) {\n    const trimmed = line.trim().toLowerCase();\n\n    // Check for user-agent directive\n    if (trimmed.startsWith('user-agent:')) {\n      const agent = trimmed.replace('user-agent:', '').trim();\n      inWildcardSection = agent === '*';\n    }\n\n    // Collect Disallow rules for * agent\n    if (inWildcardSection && trimmed.startsWith('disallow:')) {\n      const path = line.trim().replace(/^disallow:\\s*/i, '').trim();\n      if (path) {\n        disallowed.push(path);\n      }\n    }\n  }\n\n  return disallowed;\n}\n\n/**\n * Fetch and cache robots.txt for a domain\n */\nfunction fetchRobotsTxt(origin: string): RobotsCacheEntry | null {\n  const cache = loadRobotsCache();\n  const now = Date.now();\n\n  // Check cache first\n  const cached = cache.entries[origin];\n  if (cached && cached.expires > now) {\n    return cached;\n  }\n\n  // Fetch robots.txt (synchronous with timeout)\n  const robotsUrl = `${origin}/robots.txt`;\n  try {\n    // Use execFileSync to avoid shell injection \u2014 arguments are passed directly\n    const result = execFileSync('curl', ['-sL', '--max-time', '5', robotsUrl], {\n      encoding: 'utf-8',\n      timeout: 6000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    const disallowed = parseRobotsTxt(result);\n    const entry: RobotsCacheEntry = {\n      rules: result.split('\\n').slice(0, 50), // Store first 50 lines for debugging\n      disallowedPaths: disallowed,\n      expires: now + ROBOTS_CACHE_TTL,\n      fetchedAt: now,\n    };\n\n    cache.entries[origin] = entry;\n    saveRobotsCache(cache);\n\n    return entry;\n  } catch {\n    // No robots.txt or fetch failed - create permissive entry\n    const entry: RobotsCacheEntry = {\n      rules: [],\n      disallowedPaths: [],\n      expires: now + ROBOTS_CACHE_TTL,\n      fetchedAt: now,\n    };\n    cache.entries[origin] = entry;\n    saveRobotsCache(cache);\n    return entry;\n  }\n}\n\n/**\n * Check if path is allowed by robots.txt\n */\nfunction isAllowedByRobots(url: string): { allowed: boolean; reason?: string } {\n  // Skip robots.txt check if explicitly disabled\n  if (process.env.AGENT_BROWSER_IGNORE_ROBOTS === 'true') {\n    return { allowed: true };\n  }\n\n  try {\n    const parsed = new URL(url);\n    const origin = parsed.origin;\n    const path = parsed.pathname;\n\n    const robots = fetchRobotsTxt(origin);\n    if (!robots || robots.disallowedPaths.length === 0) {\n      return { allowed: true };\n    }\n\n    // Check if path matches any disallowed pattern\n    for (const disallowed of robots.disallowedPaths) {\n      // Handle wildcard patterns\n      if (disallowed.includes('*')) {\n        // Escape regex special chars first, then convert escaped glob wildcards (\\*) back to .*\n        const escaped = disallowed.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&').replace(/\\\\\\*/g, '.*');\n        const regex = new RegExp(`^${escaped}`);\n        if (regex.test(path)) {\n          return {\n            allowed: false,\n            reason: `Blocked by robots.txt: ${disallowed}`,\n          };\n        }\n      } else if (path.startsWith(disallowed)) {\n        return {\n          allowed: false,\n          reason: `Blocked by robots.txt: ${disallowed}`,\n        };\n      }\n    }\n\n    return { allowed: true };\n  } catch {\n    // URL parsing failed - allow by default\n    return { allowed: true };\n  }\n}\n\n// =============================================================================\n// Core Functions\n// =============================================================================\n\n/**\n * Extract URL from agent-browser command\n */\nfunction extractUrl(command: string): string | null {\n  const urlMatch = command.match(/(?:navigate|goto|open)\\s+[\"']?([^\"'\\s]+)[\"']?/i);\n  return urlMatch ? urlMatch[1] : null;\n}\n\n/**\n * Check if URL is blocked\n */\nfunction isBlockedUrl(url: string): boolean {\n  return BLOCKED_URL_PATTERNS.some((pattern) => pattern.test(url));\n}\n\n/**\n * Check if action is sensitive\n */\nfunction isSensitiveAction(command: string): boolean {\n  return SENSITIVE_ACTIONS.some((pattern) => new RegExp(pattern, 'i').test(command));\n}\n\n// =============================================================================\n// Main Hook\n// =============================================================================\n\n/**\n * Validate agent-browser commands for safety\n */\nexport function agentBrowserSafety(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process agent-browser commands\n  if (!/agent-browser|ab\\s/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract URL from command\n  const url = extractUrl(command);\n\n  // Check 1: URL blocklist\n  if (url && isBlockedUrl(url)) {\n    logPermissionFeedback('deny', `Blocked URL: ${url}`, input);\n    logHook('agent-browser-safety', `BLOCKED: ${url}`);\n\n    return outputDeny(\n      `agent-browser blocked: URL matches blocked pattern.\n\nURL: ${url}\n\nBlocked patterns include internal, localhost admin, and file:// URLs.\nIf this is intentional, use direct browser access instead.`\n    );\n  }\n\n  // Check 2: Rate limiting (for navigation commands)\n  if (url) {\n    const domain = extractDomain(url);\n    if (domain) {\n      const rateCheck = checkRateLimit(domain);\n      if (!rateCheck.allowed) {\n        logPermissionFeedback('deny', rateCheck.reason || 'Rate limited', input);\n        logHook('agent-browser-safety', `RATE LIMITED: ${domain}`);\n\n        return outputDeny(\n          `agent-browser rate limited.\n\n${rateCheck.reason}\n\nLimits: ${RATE_LIMITS.requestsPerMinute}/min, ${RATE_LIMITS.requestsPerHour}/hour\nConfigure via AGENT_BROWSER_RATE_LIMIT_PER_MIN and AGENT_BROWSER_RATE_LIMIT_PER_HOUR env vars.\n\nWait a moment before retrying, or use --session <name> for isolated sessions.`\n        );\n      }\n    }\n  }\n\n  // Check 3: robots.txt enforcement\n  if (url) {\n    const robotsCheck = isAllowedByRobots(url);\n    if (!robotsCheck.allowed) {\n      logPermissionFeedback('deny', robotsCheck.reason || 'Blocked by robots.txt', input);\n      logHook('agent-browser-safety', `ROBOTS BLOCKED: ${url}`);\n\n      return outputDeny(\n        `agent-browser blocked by robots.txt.\n\nURL: ${url}\n${robotsCheck.reason}\n\nThe website's robots.txt disallows automated access to this path.\nSet AGENT_BROWSER_IGNORE_ROBOTS=true to override (not recommended).`\n      );\n    }\n  }\n\n  // Check 4: Sensitive actions\n  if (isSensitiveAction(command)) {\n    const domain = url ? extractDomain(url) : 'unknown';\n    const rateCheck = url && domain ? checkRateLimit(domain) : { remaining: '?' };\n\n    const context = `Sensitive browser action detected:\n${command.slice(0, 100)}...\n\nThis may interact with:\n- Delete/remove buttons\n- Password fields\n- Payment forms\n\nRate limit remaining: ${rateCheck.remaining}/${RATE_LIMITS.requestsPerMinute} per minute\n\nProceed with caution. Verify target elements.`;\n\n    logPermissionFeedback('allow', 'Sensitive action warning', input);\n    logHook('agent-browser-safety', 'Sensitive action detected');\n    return outputAllowWithContext(context);\n  }\n\n  // Safe command\n  logPermissionFeedback('allow', 'agent-browser command validated', input);\n  return outputSilentSuccess();\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-15\n\n/**\n * Commit Atomicity Checker - Heuristic check for atomic commits\n * Hook: PreToolUse (Bash) \u2014 matcher: Bash(git commit*)\n *\n * Replaces the LLM prompt-based atomicity check with fast heuristics:\n * - File count: >10 staged files \u2192 warn\n * - Directory spread: >3 distinct top-level dirs \u2192 warn\n * - Type mixing: files span src/ + docs/ + config/ (3+ categories) \u2192 warn\n * - \"And\" test: commit message contains \" and \" \u2192 warn\n *\n * Zero LLM calls, zero network \u2014 pure local heuristics.\n */\n\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\n\nconst HOOK_NAME = 'commit-atomicity-checker';\n\n/** Threshold for staged file count warning */\nconst MAX_FILES = 10;\n\n/** Threshold for distinct top-level directory count */\nconst MAX_DIRS = 3;\n\n/**\n * Category buckets for type-mixing detection.\n * A file is assigned to a category based on its path prefix.\n */\nconst CATEGORY_PREFIXES: Record<string, string> = {\n  'src/': 'source',\n  'lib/': 'source',\n  'app/': 'source',\n  'docs/': 'docs',\n  'doc/': 'docs',\n  'test/': 'tests',\n  'tests/': 'tests',\n  '__tests__/': 'tests',\n  'spec/': 'tests',\n  'config/': 'config',\n  '.github/': 'config',\n  'scripts/': 'config',\n};\n\n/**\n * Get the category for a file path based on its prefix.\n */\nfunction getCategory(filePath: string): string {\n  for (const [prefix, category] of Object.entries(CATEGORY_PREFIXES)) {\n    if (filePath.startsWith(prefix)) {\n      return category;\n    }\n  }\n  return 'other';\n}\n\n/**\n * Extract commit message from a git commit command string.\n * Handles: -m \"msg\", -m 'msg', -m msg, --message=\"msg\", --message 'msg'\n */\nfunction extractCommitMessage(command: string): string | null {\n  // Match -m \"...\" or -m '...' or --message=\"...\" or --message '...'\n  const patterns = [\n    /-m\\s+\"([^\"]+)\"/,\n    /-m\\s+'([^']+)'/,\n    /--message=\"([^\"]+)\"/,\n    /--message='([^']+)'/,\n    /--message\\s+\"([^\"]+)\"/,\n    /--message\\s+'([^']+)'/,\n    /-m\\s+([^\\s\"'-][^\\s]*)/,\n  ];\n\n  for (const pattern of patterns) {\n    const match = command.match(pattern);\n    if (match) return match[1];\n  }\n  return null;\n}\n\n/**\n * Get staged file list from git index. Returns null on error.\n */\nfunction getStagedFiles(cwd: string): string[] | null {\n  try {\n    const output = execSync('git diff --cached --name-only', {\n      cwd,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return output.trim().split('\\n').filter(Boolean);\n  } catch {\n    logHook(HOOK_NAME, 'Failed to get staged files, skipping check', 'warn');\n    return null;\n  }\n}\n\n/**\n * Collect atomicity warnings for the given staged files and commit command.\n */\nfunction collectWarnings(stagedFiles: string[], command: string): string[] {\n  const warnings: string[] = [];\n\n  if (stagedFiles.length > MAX_FILES) {\n    warnings.push(`${stagedFiles.length} staged files (>${MAX_FILES}) \u2014 verify all changes are related`);\n  }\n\n  const topLevelDirs = new Set(\n    stagedFiles.map(f => f.includes('/') ? f.split('/')[0] : '(root)'),\n  );\n  if (topLevelDirs.size > MAX_DIRS) {\n    warnings.push(`Changes span ${topLevelDirs.size} top-level dirs (${[...topLevelDirs].join(', ')}) \u2014 may mix concerns`);\n  }\n\n  const categories = new Set(stagedFiles.map(getCategory));\n  if (categories.size >= 3) {\n    warnings.push(`Mixed change types: ${[...categories].join(', ')} \u2014 consider splitting`);\n  }\n\n  const message = extractCommitMessage(command);\n  if (message && /\\band\\b/i.test(message)) {\n    warnings.push(`Commit message contains \"and\" \u2014 may describe multiple concerns`);\n  }\n\n  return warnings;\n}\n\n/**\n * Heuristic atomicity checker for git commit commands.\n */\nexport function commitAtomicityChecker(input: HookInput): HookResult {\n  try {\n    const command = input.tool_input.command || '';\n    if (!command) return outputSilentSuccess();\n\n    const cwd = input.project_dir || getProjectDir();\n    const stagedFiles = getStagedFiles(cwd);\n    if (!stagedFiles || stagedFiles.length === 0) return outputSilentSuccess();\n\n    const warnings = collectWarnings(stagedFiles, command);\n    if (warnings.length === 0) return outputSilentSuccess();\n\n    const context = `Atomicity check:\\n${warnings.map(w => `- ${w}`).join('\\n')}\\n\\nConsider splitting into atomic commits if these are unrelated changes.`;\n    logHook(HOOK_NAME, `${warnings.length} warning(s) for commit`);\n    return outputAllowWithContext(context);\n  } catch {\n    logHook(HOOK_NAME, 'Unexpected error, falling back to silent success', 'warn');\n    return outputSilentSuccess();\n  }\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-15\n\n/**\n * Issue Reference Checker Hook\n * Reminds Claude to include issue number in commit messages when on an issue branch.\n * PreToolUse hook for Bash(git commit*) \u2014 soft advisory, never blocks.\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  getCachedBranch,\n} from '../../lib/common.js';\n\n/**\n * Extract the commit message from a git commit command string.\n * Handles -m \"msg\", -m 'msg', and -m msg (unquoted single-word).\n */\nfunction extractCommitMessage(command: string): string | null {\n  // Match -m followed by a quoted or unquoted message\n  // Handles: -m \"msg\", -m 'msg', -m msg\n  const match = command.match(/-m\\s+(?:\"([^\"\\\\]*(?:\\\\[\\s\\S][^\"\\\\]*)*)\"|'([^']*)'|(\\S+))/);\n  if (!match) return null;\n  return match[1] ?? match[2] ?? match[3] ?? null;\n}\n\n/**\n * Extract issue number from a branch name.\n * Matches patterns like: issue/123-desc, fix/123-desc, feat/123, 123-desc, prefix/123\n */\nfunction extractIssueNumber(branch: string): string | null {\n  // Match a number after a slash or at the start, optionally followed by -description\n  const match = branch.match(/(?:^|\\/)(#?\\d+)(?:-|$)/);\n  if (!match) return null;\n  // Strip leading # if present\n  return match[1].replace(/^#/, '');\n}\n\n/**\n * Check if commit message references the issue number.\n * Matches #123 or bare 123.\n */\nfunction messageReferencesIssue(message: string, issueNum: string): boolean {\n  // Check for #123 or bare 123\n  return message.includes(`#${issueNum}`) || message.includes(issueNum);\n}\n\n/**\n * Issue reference checker \u2014 reminds to include issue number in commit messages.\n */\nexport function issueReferenceChecker(input: HookInput): HookResult {\n  try {\n    const command = input.tool_input.command || '';\n    if (!command) return outputSilentSuccess();\n\n    // Extract commit message\n    const commitMessage = extractCommitMessage(command);\n    if (!commitMessage) return outputSilentSuccess();\n\n    // Get current branch\n    const branch = getCachedBranch();\n    if (!branch || branch === 'unknown') return outputSilentSuccess();\n\n    // Extract issue number from branch name\n    const issueNum = extractIssueNumber(branch);\n    if (!issueNum) return outputSilentSuccess();\n\n    // Check if commit message already references the issue\n    if (messageReferencesIssue(commitMessage, issueNum)) {\n      return outputSilentSuccess();\n    }\n\n    // Issue number found in branch but not in commit message \u2014 remind\n    return outputAllowWithContext(\n      `Reminder: You're on branch \\`${branch}\\` \u2014 include #${issueNum} in the commit message to link it to the issue.`\n    );\n  } catch {\n    // Never block on errors\n    return outputSilentSuccess();\n  }\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-27\n\n/**\n * Content-Based Secret Scanner Hook\n * Scans Write/Edit content for high-confidence secret patterns\n *\n * OWASP ASI02/ASI03: Prevents accidental secret leakage through file writes.\n * file-guard.ts blocks .env filenames; this hook blocks secret CONTENT in any file.\n *\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\nimport { basename, extname } from 'node:path';\n\n// ---------------------------------------------------------------------------\n// High-confidence secret patterns (15 patterns)\n// Source: secrets-patterns-db (1600+ patterns), filtered to high-confidence\n// ---------------------------------------------------------------------------\n\nconst SECRET_PATTERNS: Array<{ name: string; regex: RegExp }> = [\n  { name: 'OpenAI API Key', regex: /sk-[A-Za-z0-9]{20,}/ },\n  { name: 'Anthropic API Key', regex: /sk-ant-[A-Za-z0-9_-]{20,}/ },\n  { name: 'GitHub PAT (classic)', regex: /ghp_[A-Za-z0-9]{36,}/ },\n  { name: 'GitHub PAT (fine-grained)', regex: /github_pat_[A-Za-z0-9_]{30,}/ },\n  { name: 'AWS Access Key', regex: /(?:AKIA|ASIA)[A-Z0-9]{16}/ },\n  { name: 'GCP API Key', regex: /AIza[A-Za-z0-9_-]{35}/ },\n  { name: 'Stripe Secret Key', regex: /sk_live_[A-Za-z0-9]{24,}/ },\n  { name: 'Stripe Publishable Key', regex: /pk_live_[A-Za-z0-9]{24,}/ },\n  { name: 'Twilio API Key', regex: /SK[0-9a-f]{32}/ },\n  { name: 'SendGrid API Key', regex: /SG\\.[A-Za-z0-9_-]{22,}\\.[A-Za-z0-9_-]{22,}/ },\n  { name: 'Slack Token', regex: /xox[bpras]-[A-Za-z0-9-]{10,}/ },\n  { name: 'Tavily API Key', regex: /tvly-[A-Za-z0-9]{20,}/ },\n  { name: 'Mem0 API Key', regex: /m0-[A-Za-z0-9]{20,}/ },\n  { name: 'JWT Token', regex: /eyJ[A-Za-z0-9_-]{10,}\\.eyJ[A-Za-z0-9_-]{10,}\\.[A-Za-z0-9_-]{10,}/ },\n  { name: 'Private Key Block', regex: /-----BEGIN\\s+(?:RSA|DSA|EC|OPENSSH|PGP)?\\s*PRIVATE KEY-----/ },\n];\n\n// Contextual pattern: api_key=\"value\" assignments (not just variable names)\nconst CONTEXTUAL_SECRET_PATTERN = /(?:api_key|secret_key|api_secret|access_token|auth_token|private_key)\\s*[=:]\\s*[\"'][A-Za-z0-9_\\-/.+]{16,}[\"']/i;\n\n// ---------------------------------------------------------------------------\n// False positive exclusions\n// ---------------------------------------------------------------------------\n\nconst EXCLUDED_EXTENSIONS = new Set(['.md', '.txt', '.rst', '.adoc']);\n\nfunction isExcludedPath(filePath: string): boolean {\n  const ext = extname(filePath).toLowerCase();\n  if (EXCLUDED_EXTENSIONS.has(ext)) return true;\n\n  const lowerPath = filePath.toLowerCase();\n  return (\n    lowerPath.includes('fixtures/') ||\n    lowerPath.includes('__tests__/') ||\n    lowerPath.includes('test-data/') ||\n    lowerPath.includes('testdata/') ||\n    lowerPath.includes('/tests/') && lowerPath.includes('/fixtures/')\n  );\n}\n\n// ---------------------------------------------------------------------------\n// Scanner\n// ---------------------------------------------------------------------------\n\nfunction scanForSecrets(content: string): { name: string; snippet: string } | null {\n  // Check high-confidence patterns\n  for (const { name, regex } of SECRET_PATTERNS) {\n    const match = content.match(regex);\n    if (match) {\n      // Mask the secret for logging (show first 8 chars + \"...\")\n      const snippet = match[0].length > 12\n        ? `${match[0].substring(0, 8)}...`\n        : match[0].substring(0, 4) + '...';\n      return { name, snippet };\n    }\n  }\n\n  // Check contextual pattern\n  const ctxMatch = content.match(CONTEXTUAL_SECRET_PATTERN);\n  if (ctxMatch) {\n    const snippet = ctxMatch[0].length > 20\n      ? `${ctxMatch[0].substring(0, 16)}...`\n      : ctxMatch[0];\n    return { name: 'Secret Assignment', snippet };\n  }\n\n  return null;\n}\n\n/**\n * Scan Write/Edit content for secret patterns\n */\nexport function contentSecretScanner(input: HookInput): HookResult {\n  const toolName = input.tool_name;\n  const filePath = input.tool_input.file_path || '';\n\n  // Determine content to scan based on tool\n  let content = '';\n  if (toolName === 'Write') {\n    content = input.tool_input.content || '';\n  } else if (toolName === 'Edit') {\n    content = input.tool_input.new_string || '';\n  }\n\n  if (!content || !filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Skip excluded paths (docs, tests, fixtures)\n  if (isExcludedPath(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  const finding = scanForSecrets(content);\n\n  if (finding) {\n    const fileName = basename(filePath);\n    logPermissionFeedback('deny', `Secret detected in ${fileName}: ${finding.name}`, input);\n    logHook('content-secret-scanner', `BLOCKED: ${finding.name} in ${filePath} (${finding.snippet})`);\n\n    return outputDeny(\n      `BLOCKED: Potential secret detected in file content.\n\nType: ${finding.name}\nFile: ${filePath}\nMatch: ${finding.snippet}\n\nSecrets must NEVER be committed to source code. Use:\n- Environment variables (.env files \u2014 which are gitignored)\n- Secret managers (AWS Secrets Manager, Vault, etc.)\n- CI/CD secret injection\n\nIf this is a false positive (e.g., test fixture or documentation),\nmove the file to a test-data/ or fixtures/ directory.`\n    );\n  }\n\n  logPermissionFeedback('allow', `Content scan clean: ${basename(filePath)}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * File Guard Hook\n * Protects sensitive files from modification\n * CC 2.1.7 Compliant\n *\n * SECURITY: Resolves symlinks before checking patterns (ME-001 fix)\n * to prevent symlink-based bypasses of file protection.\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { realpathSync, existsSync } from 'node:fs';\nimport { resolve, isAbsolute, extname, basename } from 'node:path';\n\n// ---------------------------------------------------------------------------\n// File size gate \u2014 configurable via env vars\n// ---------------------------------------------------------------------------\n\nconst MAX_FILE_LINES = parseInt(process.env.ORCHESTKIT_MAX_FILE_LINES || '300', 10);\nconst MAX_TEST_FILE_LINES = parseInt(process.env.ORCHESTKIT_MAX_TEST_FILE_LINES || '500', 10);\n\nconst CODE_EXTENSIONS = new Set(['py', 'ts', 'tsx', 'js', 'jsx', 'go', 'rs', 'java']);\n\nfunction isTestFile(filePath: string): boolean {\n  const name = basename(filePath);\n  return /\\.(test|spec)\\.[^.]+$/.test(name)\n      || /^test_/.test(name)\n      || /_test\\.[^.]+$/.test(name)\n      || filePath.includes('__tests__/');\n}\n\ninterface BloatSignal {\n  name: string;\n  detected: boolean;\n  detail: string;\n}\n\nfunction detectBloatPatterns(content: string): BloatSignal[] {\n  const signals: BloatSignal[] = [];\n  const lines = content.split('\\n');\n\n  // 1. Too many exports (god file / barrel file)\n  const exportCount = lines.filter(l => /^export\\s/.test(l.trim())).length;\n  if (exportCount > 15) {\n    signals.push({\n      name: 'god-file', detected: true,\n      detail: `${exportCount} exports \u2014 split by domain`,\n    });\n  }\n\n  // 2. Mixed concerns: types + logic in same file\n  const hasTypes = lines.some(l => /^(export\\s+)?(type|interface)\\s/.test(l.trim()));\n  const hasFunctions = lines.some(l => /^(export\\s+)?(async\\s+)?function\\s/.test(l.trim()));\n  const hasClasses = lines.some(l => /^(export\\s+)?class\\s/.test(l.trim()));\n  if (hasTypes && (hasFunctions || hasClasses) && lines.length > 150) {\n    signals.push({\n      name: 'mixed-concerns', detected: true,\n      detail: 'types + logic in same file \u2014 extract types to types.ts',\n    });\n  }\n\n  // 3. Too many imports (coupling smell)\n  const importCount = lines.filter(l => /^import\\s/.test(l.trim())).length;\n  if (importCount > 20) {\n    signals.push({\n      name: 'high-coupling', detected: true,\n      detail: `${importCount} imports \u2014 file does too much, split by responsibility`,\n    });\n  }\n\n  // 4. Multiple classes/components in one file\n  const classCount = lines.filter(l => /^(export\\s+)?(default\\s+)?class\\s/.test(l.trim())).length;\n  const componentCount = lines.filter(l =>\n    /^(export\\s+)?(default\\s+)?(const|function)\\s+[A-Z]/.test(l.trim())\n  ).length;\n  if (classCount > 1) {\n    signals.push({ name: 'multi-class', detected: true, detail: `${classCount} classes \u2014 one class per file` });\n  }\n  if (componentCount > 3) {\n    signals.push({ name: 'multi-component', detected: true, detail: `${componentCount} components \u2014 one per file` });\n  }\n\n  return signals.filter(s => s.detected);\n}\n\nfunction checkFileSizeAndBloat(input: HookInput): HookResult | null {\n  if (input.tool_name !== 'Write') return null;\n\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n  if (!filePath || !content) return null;\n\n  const ext = extname(filePath).toLowerCase().replace('.', '');\n  if (!CODE_EXTENSIONS.has(ext)) return null;\n\n  const lineCount = content.split('\\n').length;\n  const limit = isTestFile(filePath) ? MAX_TEST_FILE_LINES : MAX_FILE_LINES;\n  const bloatSignals = detectBloatPatterns(content);\n\n  // Block if over line limit\n  if (lineCount > limit) {\n    const fileType = isTestFile(filePath) ? 'test' : 'source';\n    const bloatDetails = bloatSignals.length > 0\n      ? `\\n\\nBloat patterns detected:\\n${bloatSignals.map(s => `- ${s.name}: ${s.detail}`).join('\\n')}`\n      : '';\n\n    return outputDeny(\n      `File too long: ${lineCount} lines (limit: ${limit} for ${fileType} files)${bloatDetails}\n\nSplit this file into smaller modules. Override with:\n  ORCHESTKIT_MAX_FILE_LINES=500 (source)\n  ORCHESTKIT_MAX_TEST_FILE_LINES=800 (tests)`\n    );\n  }\n\n  // Under limit but has bloat signals \u2014 warn, don't block\n  if (bloatSignals.length >= 2) {\n    logHook('file-guard', `Bloat detected in ${filePath}: ${bloatSignals.map(s => s.name).join(', ')}`);\n  }\n\n  return null;\n}\n\n/**\n * Protected file patterns - files that should NEVER be modified\n */\nconst PROTECTED_PATTERNS: RegExp[] = [\n  /\\.env$/,\n  /\\.env\\.local$/,\n  /\\.env\\.production$/,\n  /credentials\\.json$/,\n  /secrets\\.json$/,\n  /private\\.key$/,\n  /\\.pem$/,\n  /id_rsa$/,\n  /id_ed25519$/,\n];\n\n/**\n * Config patterns - files to warn about but allow\n */\nconst CONFIG_PATTERNS: RegExp[] = [\n  /package\\.json$/,\n  /pyproject\\.toml$/,\n  /tsconfig\\.json$/,\n];\n\n/**\n * Resolve file path, following symlinks\n */\nfunction resolveRealPath(filePath: string, projectDir: string): string {\n  try {\n    // Make absolute if relative\n    const absolutePath = isAbsolute(filePath)\n      ? filePath\n      : resolve(projectDir, filePath);\n\n    // Follow symlinks if file exists\n    if (existsSync(absolutePath)) {\n      return realpathSync(absolutePath);\n    }\n\n    return absolutePath;\n  } catch {\n    return filePath;\n  }\n}\n\n/**\n * Check if file matches protected patterns\n */\nfunction isProtected(realPath: string): RegExp | null {\n  for (const pattern of PROTECTED_PATTERNS) {\n    if (pattern.test(realPath)) {\n      return pattern;\n    }\n  }\n  return null;\n}\n\n/**\n * Check if file is a config file\n */\nfunction isConfigFile(realPath: string): boolean {\n  return CONFIG_PATTERNS.some((pattern) => pattern.test(realPath));\n}\n\n/**\n * Guard against modifying sensitive files\n */\nexport function fileGuard(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = getProjectDir();\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  logHook('file-guard', `File write/edit: ${filePath}`);\n\n  // Resolve symlinks to prevent bypass attacks (ME-001 fix)\n  const realPath = resolveRealPath(filePath, projectDir);\n  logHook('file-guard', `Resolved path: ${realPath}`);\n\n  // Check if file matches protected patterns\n  const matchedPattern = isProtected(realPath);\n\n  if (matchedPattern) {\n    logPermissionFeedback('deny', `Protected file blocked: ${filePath} (pattern: ${matchedPattern})`, input);\n    logHook('file-guard', `BLOCKED: ${filePath} matches ${matchedPattern}`);\n\n    return outputDeny(\n      `Cannot modify protected file: ${filePath}\n\nResolved path: ${realPath}\nMatched pattern: ${matchedPattern}\n\nProtected files include:\n- Environment files (.env, .env.local, .env.production)\n- Credential files (credentials.json, secrets.json)\n- Private keys (.pem, id_rsa, id_ed25519)\n\nIf you need to modify this file, do it manually outside Claude Code.`\n    );\n  }\n\n  // Check file size and bloat patterns (Write only)\n  const sizeResult = checkFileSizeAndBloat(input);\n  if (sizeResult) return sizeResult;\n\n  // Warn on config files (but allow)\n  if (isConfigFile(realPath)) {\n    logHook('file-guard', `WARNING: Config file modification: ${realPath}`);\n    logPermissionFeedback('warn', `Config file modification: ${filePath}`, input);\n  }\n\n  // Allow the write\n  logPermissionFeedback('allow', `File write allowed: ${filePath}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Architecture Change Detector Hook\n * Detects breaking architectural changes and injects guidelines\n * CC 2.1.9 Enhanced: Injects architectural guidelines as additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  outputWarning,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { guardPathPattern, isDontAskMode } from '../../lib/guards.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Architectural layer definitions\n */\ntype ArchLayer = 'api-layer' | 'service-layer' | 'data-layer' | 'workflow-layer' | 'unknown';\n\n/**\n * Path patterns for architectural layers\n */\nconst LAYER_PATTERNS: Record<ArchLayer, RegExp[]> = {\n  'api-layer': [/\\/api\\//, /\\/routes\\//, /\\/endpoints\\//],\n  'service-layer': [/\\/services\\//],\n  'data-layer': [/\\/db\\//, /\\/models\\//, /\\/repositories\\//],\n  'workflow-layer': [/\\/workflows\\//, /\\/agents\\//],\n  unknown: [],\n};\n\n/**\n * Determine architectural layer from file path\n */\nfunction detectArchLayer(filePath: string): ArchLayer {\n  for (const [layer, patterns] of Object.entries(LAYER_PATTERNS)) {\n    if (layer === 'unknown') continue;\n    if (patterns.some((p) => p.test(filePath))) {\n      return layer as ArchLayer;\n    }\n  }\n  return 'unknown';\n}\n\n/**\n * Load pattern hints from project patterns directory\n */\nfunction loadPatternHints(layer: ArchLayer, projectDir: string): string {\n  const patternsDir = join(projectDir, '.claude', 'context', 'patterns');\n  const layerPatternFile = join(patternsDir, `${layer}.json`);\n\n  try {\n    if (existsSync(layerPatternFile)) {\n      const content = readFileSync(layerPatternFile, 'utf8');\n      const patterns = JSON.parse(content);\n      const count = Array.isArray(patterns) ? patterns.length : Object.keys(patterns).length;\n      if (count > 0) {\n        return ` | Patterns loaded: ${count}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return '';\n}\n\n/**\n * Detect architectural changes and inject context\n */\nexport function architectureChangeDetector(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Self-guard: Only run for architectural paths\n  const archPatterns = [\n    '**/api/**',\n    '**/services/**',\n    '**/db/**',\n    '**/models/**',\n    '**/workflows/**',\n  ];\n  const guardResult = guardPathPattern(input, ...archPatterns);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  // Determine architectural layer\n  const archLayer = detectArchLayer(filePath);\n\n  if (archLayer === 'unknown') {\n    return outputSilentSuccess();\n  }\n\n  // Load pattern hints\n  const patternHints = loadPatternHints(archLayer, projectDir);\n\n  // Check if file exists (new file vs modification)\n  const isNewFile = !existsSync(filePath);\n\n  // Build architecture context\n  let archContext: string;\n  if (isNewFile) {\n    archContext = `New ${archLayer} file. Follow layer conventions: dependency injection, interface contracts${patternHints}`;\n  } else {\n    archContext = `Modifying ${archLayer}. Ensure: no breaking API changes, maintain layer boundaries${patternHints}`;\n  }\n\n  logPermissionFeedback('allow', `Architectural change: ${filePath} (${archLayer})`, input);\n  logHook('architecture-change-detector', `ARCH_DETECT: ${filePath} (layer=${archLayer})`);\n\n  // CC 2.1.9: Inject context\n  // In dontAsk mode, show visible warning instead of silent context\n  if (isDontAskMode(input)) {\n    return outputWarning(`[Quality Gate] ${archContext}`);\n  }\n  return outputWithContext(archContext);\n}\n", "/**\n * Code Quality Gate Hook\n * Unified code quality checks before write\n * Consolidates: complexity-gate.sh + type-check-on-save.sh\n *\n * Analyzes code quality BEFORE allowing write:\n * - Checks function length (>50 lines = warning)\n * - Checks cyclomatic complexity patterns (nested if/loops)\n * - Checks for existing type errors in the file being modified (cached results)\n *\n * CC 2.1.9 Compliant: Uses additionalContext for quality warnings\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  outputWarning,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { guardCodeFiles, guardSkipInternal, runGuards, isDontAskMode } from '../../lib/guards.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join, extname, basename } from 'node:path';\n\n// Thresholds\nconst MAX_FUNCTION_LINES = 50;\nconst MAX_NESTING_DEPTH = 4;\nconst MAX_CONDITIONALS_PER_FUNCTION = 10;\n\n/**\n * Get file extension in lowercase\n */\nfunction getFileExt(filePath: string): string {\n  return extname(filePath).toLowerCase().replace('.', '');\n}\n\n/**\n * Check for long functions in the content\n */\nfunction checkFunctionLength(content: string, ext: string): string[] {\n  const warnings: string[] = [];\n  const lines = content.split('\\n');\n\n  if (ext === 'py') {\n    // Python: Track function definitions and line counts\n    let inFunction = false;\n    let functionName = '';\n    let functionLines = 0;\n\n    for (const line of lines) {\n      const defMatch = line.match(/^(\\s*)(?:async\\s+)?def\\s+([a-zA-Z_][a-zA-Z0-9_]*)/);\n      const classMatch = line.match(/^(\\s*)class\\s+/);\n\n      if (defMatch) {\n        // Check previous function if too long\n        if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n          warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n        }\n\n        inFunction = true;\n        functionName = defMatch[2];\n        functionLines = 1;\n      } else if (classMatch) {\n        // Class definition resets function tracking\n        if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n          warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n        }\n        inFunction = false;\n      } else if (inFunction) {\n        // Count non-empty lines in function\n        if (line.trim()) {\n          functionLines++;\n        }\n      }\n    }\n\n    // Check last function\n    if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n      warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n    }\n  } else if (['ts', 'tsx', 'js', 'jsx', 'go', 'java', 'rs'].includes(ext)) {\n    // Brace-based languages: Count lines between braces\n    let braceCount = 0;\n    let functionLines = 0;\n    let inFunction = false;\n    let functionName = '';\n\n    for (const line of lines) {\n      // Function detection\n      const funcMatch = line.match(/(?:function|func|fn)\\s+([a-zA-Z_][a-zA-Z0-9_]*)/);\n      const constFuncMatch = line.match(/const\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*(?:async\\s*)?\\(/);\n\n      if (funcMatch) {\n        functionName = funcMatch[1];\n        inFunction = true;\n        functionLines = 0;\n        braceCount = 0;\n      } else if (constFuncMatch) {\n        functionName = constFuncMatch[1];\n        inFunction = true;\n        functionLines = 0;\n        braceCount = 0;\n      }\n\n      if (inFunction) {\n        // Count braces\n        const openBraces = (line.match(/\\{/g) || []).length;\n        const closeBraces = (line.match(/\\}/g) || []).length;\n        braceCount += openBraces - closeBraces;\n\n        if (line.trim()) {\n          functionLines++;\n        }\n\n        // Function ended\n        if (braceCount <= 0 && functionLines > 0) {\n          if (functionLines > MAX_FUNCTION_LINES) {\n            warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n          }\n          inFunction = false;\n        }\n      }\n    }\n  }\n\n  return warnings;\n}\n\n/**\n * Check for deep nesting (cyclomatic complexity indicator)\n */\nfunction checkNestingDepth(content: string, ext: string): string[] {\n  const warnings: string[] = [];\n  const lines = content.split('\\n');\n  let maxDepth = 0;\n\n  if (ext === 'py') {\n    // Python: Count indent levels at control structures\n    for (const line of lines) {\n      const match = line.match(/^(\\s*)(if|for|while|with|try|elif|else|except|finally)[\\s:]/);\n      if (match) {\n        const indent = match[1].length;\n        const depth = Math.floor(indent / 4); // Assume 4-space indent\n        if (depth > maxDepth) {\n          maxDepth = depth;\n        }\n      }\n    }\n  } else if (['ts', 'tsx', 'js', 'jsx', 'go', 'java', 'rs'].includes(ext)) {\n    // Brace-based: Count brace depth at control structures\n    let braceDepth = 0;\n    for (const line of lines) {\n      const openBraces = (line.match(/\\{/g) || []).length;\n      const closeBraces = (line.match(/\\}/g) || []).length;\n      braceDepth += openBraces - closeBraces;\n\n      // Check if this line has a control structure\n      if (/(?:if|for|while|switch|try)\\s*\\(/.test(line)) {\n        if (braceDepth > maxDepth) {\n          maxDepth = braceDepth;\n        }\n      }\n    }\n  }\n\n  if (maxDepth > MAX_NESTING_DEPTH) {\n    warnings.push(`Deep nesting detected (depth: ${maxDepth}, max: ${MAX_NESTING_DEPTH})`);\n  }\n\n  return warnings;\n}\n\n/**\n * Count conditionals (cyclomatic complexity heuristic)\n */\nfunction checkConditionals(content: string): string[] {\n  const warnings: string[] = [];\n\n  const ifCount = (content.match(/\\b(if|elif|else if)\\b/g) || []).length;\n  const switchCount = (content.match(/\\b(switch|match)\\b/g) || []).length;\n  const ternaryCount = content.split('\\n').filter(line => line.includes('?') && line.includes(':') && /\\?/.test(line.split(':')[0])).length;\n\n  const totalConditionals = ifCount + switchCount + ternaryCount;\n\n  // Estimate functions\n  const functionCount = Math.max((content.match(/\\b(def|function|func|fn)\\b/g) || []).length, 1);\n  const avgConditionals = Math.floor(totalConditionals / functionCount);\n\n  if (avgConditionals > MAX_CONDITIONALS_PER_FUNCTION) {\n    warnings.push(`High cyclomatic complexity (~${avgConditionals} conditionals/function, consider refactoring)`);\n  }\n\n  return warnings;\n}\n\n/**\n * Get cached type errors for a file\n */\nfunction getCachedTypeErrors(filePath: string, projectDir: string): string {\n  const cacheFile = join(projectDir, '.claude', 'cache', 'type-errors.json');\n\n  if (!existsSync(cacheFile)) {\n    return '';\n  }\n\n  try {\n    const cache = JSON.parse(readFileSync(cacheFile, 'utf8'));\n    const fileBasename = basename(filePath);\n    return cache[fileBasename] || '';\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Code quality gate - analyzes quality before allowing write\n */\nexport function codeQualityGate(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles, guardSkipInternal);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath || !content) {\n    return outputSilentSuccess();\n  }\n\n  const ext = getFileExt(filePath);\n  const allWarnings: string[] = [];\n\n  // Run complexity checks\n  allWarnings.push(...checkFunctionLength(content, ext));\n  allWarnings.push(...checkNestingDepth(content, ext));\n  allWarnings.push(...checkConditionals(content));\n\n  // Check cached type errors\n  const typeErrors = getCachedTypeErrors(filePath, projectDir);\n  if (typeErrors) {\n    allWarnings.push(typeErrors);\n  }\n\n  // Build quality message\n  if (allWarnings.length > 0) {\n    logHook('code-quality-gate', `Quality warnings for ${filePath}: ${allWarnings.join(', ')}`);\n\n    let qualityMsg = `Code quality: ${allWarnings.join(' | ')}`;\n\n    // Truncate if too long\n    if (qualityMsg.length > 350) {\n      qualityMsg = `${qualityMsg.slice(0, 347)}...`;\n    }\n\n    // In dontAsk mode, show visible warning instead of silent context\n    if (isDontAskMode(input)) {\n      return outputWarning(`[Quality Gate] ${qualityMsg}`);\n    }\n    return outputWithContext(qualityMsg);\n  }\n\n  logHook('code-quality-gate', `No quality issues in ${filePath}`);\n  return outputSilentSuccess();\n}\n", "/**\n * Docstring Enforcer Hook\n * Checks if public functions have docstrings\n * For Python: checks for triple-quote docstrings\n * For TypeScript: checks for JSDoc comments\n *\n * CC 2.1.9 Enhanced: Uses additionalContext for warnings (does not block)\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  outputWarning,\n  logHook,\n} from '../../lib/common.js';\nimport { guardCodeFiles, guardSkipInternal, runGuards, isDontAskMode } from '../../lib/guards.js';\nimport { extname } from 'node:path';\n\n/**\n * Get file extension in lowercase\n */\nfunction getFileExt(filePath: string): string {\n  return extname(filePath).toLowerCase().replace('.', '');\n}\n\n/**\n * Check if file is a test file\n */\nfunction isTestFile(filePath: string): boolean {\n  const testPatterns = [\n    /test/i,\n    /spec/i,\n    /__tests__/i,\n    /_test\\.py$/,\n    /\\.test\\.ts$/,\n    /\\.spec\\.ts$/,\n  ];\n  return testPatterns.some((p) => p.test(filePath));\n}\n\n/**\n * Find Python functions missing docstrings\n */\nfunction findMissingPythonDocstrings(content: string): string[] {\n  const missing: string[] = [];\n  const lines = content.split('\\n');\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    // Match public function definitions (not starting with _)\n    const trimmed = line.trimStart();\n    const funcMatch = (trimmed.startsWith('def ') || trimmed.startsWith('async def '))\n      ? trimmed.replace(/^async\\s+/, '').match(/^def\\s+([^_][a-zA-Z0-9_]*)\\s*\\(/)\n      : null;\n\n    if (funcMatch) {\n      const funcName = funcMatch[1];\n\n      // Look for docstring on next non-empty line\n      let hasDocstring = false;\n      for (let j = i + 1; j < lines.length; j++) {\n        const nextLine = lines[j].trim();\n        if (!nextLine) continue; // Skip empty lines\n\n        if (nextLine.startsWith('\"\"\"') || nextLine.startsWith(\"'''\")) {\n          hasDocstring = true;\n        }\n        break;\n      }\n\n      if (!hasDocstring) {\n        missing.push(funcName);\n        if (missing.length >= 5) break; // Limit to 5\n      }\n    }\n  }\n\n  return missing;\n}\n\n/**\n * Find TypeScript/JavaScript exported functions missing JSDoc\n */\nfunction findMissingJSDoc(content: string): string[] {\n  const missing: string[] = [];\n  const lines = content.split('\\n');\n\n  let hasJSDoc = false;\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const prevLine = i > 0 ? lines[i - 1].trim() : '';\n\n    // Check if previous line ends JSDoc\n    if (prevLine.endsWith('*/')) {\n      hasJSDoc = true;\n    }\n\n    // Check for exported function\n    const exportMatch = line.match(\n      /^export\\s+(?:async\\s+)?(?:function\\s+([a-zA-Z][a-zA-Z0-9_]*)|const\\s+([a-zA-Z][a-zA-Z0-9_]*)\\s*=)/\n    );\n\n    if (exportMatch) {\n      const funcName = exportMatch[1] || exportMatch[2];\n\n      if (!hasJSDoc) {\n        missing.push(funcName);\n        if (missing.length >= 5) break; // Limit to 5\n      }\n      hasJSDoc = false;\n    } else if (!line.trim().endsWith('*/')) {\n      hasJSDoc = false;\n    }\n  }\n\n  return missing;\n}\n\n/**\n * Docstring enforcer - warns about missing documentation\n */\nexport function docstringEnforcer(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles, guardSkipInternal);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath || !content) {\n    return outputSilentSuccess();\n  }\n\n  // Skip test files - docstrings are less critical\n  if (isTestFile(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  const ext = getFileExt(filePath);\n  let missingDocstrings: string[] = [];\n\n  if (ext === 'py') {\n    missingDocstrings = findMissingPythonDocstrings(content);\n  } else if (['ts', 'tsx', 'js', 'jsx'].includes(ext)) {\n    missingDocstrings = findMissingJSDoc(content);\n  }\n\n  if (missingDocstrings.length > 0) {\n    const funcList = missingDocstrings.join(', ');\n    let contextMsg: string;\n\n    if (ext === 'py') {\n      contextMsg = `Documentation: ${missingDocstrings.length} public function(s) missing docstrings: ${funcList}. Consider adding \"\"\"docstrings\"\"\" for better code documentation.`;\n    } else {\n      contextMsg = `Documentation: ${missingDocstrings.length} exported function(s) missing JSDoc: ${funcList}. Consider adding /** JSDoc */ comments for better IDE support.`;\n    }\n\n    // Truncate if too long\n    if (contextMsg.length > 200) {\n      if (ext === 'py') {\n        contextMsg = `Documentation: ${missingDocstrings.length} public function(s) missing docstrings. Add \"\"\"docstrings\"\"\" for better documentation.`;\n      } else {\n        contextMsg = `Documentation: ${missingDocstrings.length} exported function(s) missing JSDoc. Add /** JSDoc */ for better IDE support.`;\n      }\n    }\n\n    logHook('docstring-enforcer', `DOCSTRING_WARN: ${missingDocstrings.length} functions missing docs in ${filePath}`);\n\n    // In dontAsk mode, show visible warning instead of silent context\n    if (isDontAskMode(input)) {\n      return outputWarning(`[Quality Gate] ${contextMsg}`);\n    }\n    return outputWithContext(contextMsg);\n  }\n\n  // All public functions documented - allow silently\n  logHook('docstring-enforcer', `DOCSTRING_OK: All public functions documented in ${filePath}`);\n  return outputSilentSuccess();\n}\n", "/**\n * Security Pattern Validator Hook\n * Detects security anti-patterns before write\n * CC 2.1.7 Compliant: Self-contained hook with stdin reading and self-guard\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\nimport { guardCodeFiles, runGuards } from '../../lib/guards.js';\nimport { basename } from 'node:path';\n\n/**\n * Security patterns to detect\n */\ninterface SecurityPattern {\n  name: string;\n  pattern: RegExp;\n  severity: 'high' | 'medium' | 'low';\n}\n\nconst SECURITY_PATTERNS: SecurityPattern[] = [\n  {\n    name: 'Potential hardcoded secret detected',\n    pattern: /(api[_-]?key|password|secret|token)\\s*[=:]\\s*['\"][^'\"]+['\"]/i,\n    severity: 'high',\n  },\n  {\n    name: 'Potential SQL injection vulnerability',\n    // Split into two substring checks to avoid polynomial regex backtracking\n    pattern: {\n      test: (s: string) =>\n        (s.includes('execute') && /execute\\s*\\(\\s*['\"]/.test(s) && s.includes('+')) ||\n        (/f['\"]/.test(s) && s.includes('SELECT') && s.includes('{')),\n    } as unknown as RegExp,\n    severity: 'high',\n  },\n  {\n    name: 'Dangerous eval/exec usage detected',\n    pattern: /eval\\s*\\(|exec\\s*\\(/,\n    severity: 'high',\n  },\n  {\n    name: 'Subprocess with shell=True detected',\n    pattern: /subprocess\\.(run|call|Popen).*shell\\s*=\\s*True/,\n    severity: 'medium',\n  },\n  {\n    name: 'Potential XSS vulnerability (innerHTML)',\n    pattern: /\\.innerHTML\\s*=|dangerouslySetInnerHTML/,\n    severity: 'medium',\n  },\n  {\n    name: 'Insecure random number generation',\n    pattern: /Math\\.random\\(\\).*(?:password|token|secret|key)/i,\n    severity: 'medium',\n  },\n  {\n    name: 'Potential command injection',\n    pattern: /os\\.system\\s*\\(|os\\.popen\\s*\\(/,\n    severity: 'high',\n  },\n  {\n    name: 'Insecure HTTP (should use HTTPS)',\n    pattern: /http:\\/\\/(?!localhost|127\\.0\\.0\\.1)/,\n    severity: 'low',\n  },\n];\n\n/**\n * Detect security issues in content\n */\nfunction detectSecurityIssues(content: string): string[] {\n  const issues: string[] = [];\n\n  for (const { name, pattern } of SECURITY_PATTERNS) {\n    if (pattern.test(content)) {\n      issues.push(name);\n    }\n  }\n\n  return issues;\n}\n\n/**\n * Security pattern validator - detects anti-patterns before write\n */\nexport function securityPatternValidator(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Detect security issues\n  const securityIssues = detectSecurityIssues(content);\n\n  if (securityIssues.length > 0) {\n    logHook('security-pattern-validator', `SECURITY_WARN: ${filePath} - ${securityIssues.join(', ')}`);\n\n    // Build warning message\n    const warningMsg = `Security warnings for ${basename(filePath)}: ${securityIssues.join(', ')}`;\n    logPermissionFeedback('warn', `Security issues in ${filePath}: ${securityIssues.join(', ')}`, input);\n\n    // CC 2.1.9: Use additionalContext for warnings\n    return outputWithContext(warningMsg);\n  }\n\n  logHook('security-pattern-validator', `SECURITY_OK: ${filePath}`);\n  logPermissionFeedback('allow', `No security issues in ${filePath}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Context7 Documentation Tracker Hook\n * Tracks context7 library lookups and injects cache state as additionalContext\n * CC 2.1.9 Enhanced\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n  getLogDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync, statSync, renameSync, mkdirSync } from 'node:fs';\nimport { bufferWrite } from '../../lib/analytics-buffer.js';\nimport { join } from 'node:path';\n\nconst MAX_LOG_SIZE = 102400; // 100KB\n\n// ---------------------------------------------------------------------------\n// Rate limiting (OWASP ASI02/ASI06)\n// ---------------------------------------------------------------------------\nconst MAX_QUERIES_PER_SESSION = 50;\nconst MAX_QUERIES_PER_MINUTE = 10;\nconst RATE_WINDOW_MS = 60_000; // 1 minute\n\n/**\n * Get telemetry log path\n */\nfunction getTelemetryLog(): string {\n  const logDir = getLogDir();\n  return join(logDir, 'context7-telemetry.log');\n}\n\n/**\n * Rotate log file if needed\n */\nfunction rotateLogIfNeeded(logFile: string): void {\n  try {\n    if (existsSync(logFile)) {\n      const stats = statSync(logFile);\n      if (stats.size > MAX_LOG_SIZE) {\n        renameSync(logFile, `${logFile}.old`);\n      }\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Calculate cache context from telemetry\n */\nfunction calculateCacheContext(logFile: string): string {\n  if (!existsSync(logFile)) {\n    return '';\n  }\n\n  try {\n    const content = readFileSync(logFile, 'utf8');\n    const lines = content.trim().split('\\n').filter(Boolean);\n\n    const totalQueries = lines.length;\n    if (totalQueries === 0) {\n      return '';\n    }\n\n    // Extract unique libraries\n    const librarySet = new Set<string>();\n    for (const line of lines) {\n      const match = line.match(/library=([^| ]+)/);\n      if (match?.[1] && match[1] !== '') {\n        librarySet.add(match[1]);\n      }\n    }\n\n    // Get recent unique libraries (last 3)\n    const recentLibraries: string[] = [];\n    for (let i = lines.length - 1; i >= 0 && recentLibraries.length < 3; i--) {\n      const match = lines[i].match(/library=([^| ]+)/);\n      if (match?.[1] && !recentLibraries.includes(match[1])) {\n        recentLibraries.push(match[1]);\n      }\n    }\n\n    const recentStr = recentLibraries.length > 0 ? recentLibraries.join(', ') : 'none';\n    return `Context7: ${totalQueries} queries, ${librarySet.size} libraries. Recent: ${recentStr}`;\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Check rate limits from telemetry log.\n * Returns null if within limits, or a deny message if exceeded.\n */\nfunction checkRateLimits(logFile: string): string | null {\n  if (!existsSync(logFile)) return null;\n\n  try {\n    const content = readFileSync(logFile, 'utf8');\n    const lines = content.trim().split('\\n').filter(Boolean);\n    const totalQueries = lines.length;\n\n    // Session limit\n    if (totalQueries >= MAX_QUERIES_PER_SESSION) {\n      return `Context7 session limit reached (${MAX_QUERIES_PER_SESSION} queries). Rely on already-fetched documentation or use WebFetch for additional lookups.`;\n    }\n\n    // Per-minute limit: count lines with timestamps within the last minute\n    const now = Date.now();\n    let recentCount = 0;\n    for (let i = lines.length - 1; i >= 0 && i >= lines.length - MAX_QUERIES_PER_MINUTE - 1; i--) {\n      const tsMatch = lines[i].match(/^(\\d{4}-\\d{2}-\\d{2}T[\\d:.]+Z?)/);\n      if (tsMatch) {\n        const ts = new Date(tsMatch[1]).getTime();\n        if (now - ts < RATE_WINDOW_MS) {\n          recentCount++;\n        } else {\n          break; // Lines are chronological, no need to check further\n        }\n      }\n    }\n\n    if (recentCount >= MAX_QUERIES_PER_MINUTE) {\n      return `Context7 rate limit: ${MAX_QUERIES_PER_MINUTE} queries/minute exceeded. Wait a moment before querying again.`;\n    }\n  } catch {\n    // If we can't read the log, allow the query\n  }\n\n  return null;\n}\n\n/**\n * Context7 tracker - tracks library lookups, enforces rate limits, and injects cache state\n */\nexport function context7Tracker(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process context7 MCP calls\n  if (!toolName.startsWith('mcp__context7__')) {\n    return outputSilentSuccess();\n  }\n\n  const libraryId = (input.tool_input.libraryId as string) || '';\n  const query = (input.tool_input.query as string) || '';\n\n  // Get log file path\n  const logDir = getLogDir();\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore mkdir errors\n  }\n\n  const telemetryLog = getTelemetryLog();\n  rotateLogIfNeeded(telemetryLog);\n\n  // Rate limit check (before logging this query)\n  const rateLimitMsg = checkRateLimits(telemetryLog);\n  if (rateLimitMsg) {\n    logPermissionFeedback('deny', `Context7 rate limited: ${rateLimitMsg}`, input);\n    logHook('context7-tracker', `RATE LIMITED: ${rateLimitMsg}`);\n    return outputDeny(rateLimitMsg);\n  }\n\n  // Log the query\n  const timestamp = new Date().toISOString();\n  const logEntry = `${timestamp} | tool=${toolName} | library=${libraryId} | query_length=${query.length}\\n`;\n\n  try {\n    bufferWrite(telemetryLog, logEntry);\n  } catch {\n    // Ignore log errors\n  }\n\n  // Calculate cache context\n  const cacheContext = calculateCacheContext(telemetryLog);\n\n  logPermissionFeedback('allow', `Documentation lookup: ${libraryId}`, input);\n  logHook('context7-tracker', `Query: ${toolName} library=${libraryId}`);\n\n  // CC 2.1.9: Inject cache context if available\n  if (cacheContext) {\n    return outputWithContext(cacheContext);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Knowledge Graph Validator Hook\n * Validates memory operations to prevent accidental data loss\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputWarning,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n// ---------------------------------------------------------------------------\n// Size limits (OWASP ASI06 \u2014 prevent memory poisoning)\n// ---------------------------------------------------------------------------\nconst MAX_ENTITY_NAME_LENGTH = 200;\nconst MAX_OBSERVATION_LENGTH = 1000;\nconst MAX_OBSERVATIONS_PER_ENTITY = 20;\n\n// Known entity types \u2014 warn on unknown, don't block (types evolve)\nconst KNOWN_ENTITY_TYPES = new Set([\n  'person', 'project', 'technology', 'concept', 'tool', 'pattern',\n  'decision', 'preference', 'workflow', 'organization', 'service',\n  'library', 'framework', 'language', 'file', 'module', 'api',\n  'endpoint', 'database', 'config', 'environment', 'event',\n]);\n\n/**\n * Validate entity size constraints.\n * Returns deny message if oversized (likely poisoning attempt), null if OK.\n */\nfunction validateEntitySizes(entities: Array<Record<string, unknown>>): string | null {\n  for (const entity of entities) {\n    const name = String(entity.name || '');\n    if (name.length > MAX_ENTITY_NAME_LENGTH) {\n      return `Entity name too long: ${name.length} chars (max ${MAX_ENTITY_NAME_LENGTH}). Oversized names may indicate a poisoning attempt.`;\n    }\n\n    const observations = entity.observations;\n    if (Array.isArray(observations)) {\n      if (observations.length > MAX_OBSERVATIONS_PER_ENTITY) {\n        return `Too many observations for '${name.substring(0, 50)}': ${observations.length} (max ${MAX_OBSERVATIONS_PER_ENTITY}). Split into multiple entities.`;\n      }\n      for (const obs of observations) {\n        const obsStr = String(obs);\n        if (obsStr.length > MAX_OBSERVATION_LENGTH) {\n          return `Observation too long for '${name.substring(0, 50)}': ${obsStr.length} chars (max ${MAX_OBSERVATION_LENGTH}). Summarize the observation.`;\n        }\n      }\n    }\n  }\n  return null;\n}\n\n/**\n * Check for unknown entity types (warn, don't block).\n */\nfunction checkEntityTypes(entities: Array<Record<string, unknown>>): string[] {\n  const unknownTypes: string[] = [];\n  for (const entity of entities) {\n    const entityType = String(entity.entityType || '').toLowerCase();\n    if (entityType && !KNOWN_ENTITY_TYPES.has(entityType)) {\n      unknownTypes.push(entityType);\n    }\n  }\n  return unknownTypes;\n}\n\n/**\n * Validate observation sizes for add_observations.\n */\nfunction validateObservationSizes(observationsInput: Array<Record<string, unknown>>): string | null {\n  for (const entry of observationsInput) {\n    const contents = entry.contents;\n    if (Array.isArray(contents)) {\n      if (contents.length > MAX_OBSERVATIONS_PER_ENTITY) {\n        return `Too many observations in batch: ${contents.length} (max ${MAX_OBSERVATIONS_PER_ENTITY}).`;\n      }\n      for (const obs of contents) {\n        const obsStr = String(obs);\n        if (obsStr.length > MAX_OBSERVATION_LENGTH) {\n          return `Observation too long: ${obsStr.length} chars (max ${MAX_OBSERVATION_LENGTH}). Summarize the observation.`;\n        }\n      }\n    }\n  }\n  return null;\n}\n\n/**\n * Memory validator - validates memory operations\n */\nexport function memoryValidator(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process memory MCP calls\n  if (!toolName.startsWith('mcp__memory__')) {\n    return outputSilentSuccess();\n  }\n\n  switch (toolName) {\n    case 'mcp__memory__delete_entities': {\n      // Check for bulk deletion\n      const entityNames = input.tool_input.entityNames;\n      const entityCount = Array.isArray(entityNames) ? entityNames.length : 0;\n\n      if (entityCount > 5) {\n        logPermissionFeedback('warn', `Bulk delete: ${entityCount} entities`, input);\n        logHook('memory-validator', `WARN: Bulk entity delete: ${entityCount} entities`);\n\n        // Warn but allow - let user confirm\n        return outputWarning(`Deleting ${entityCount} entities from knowledge graph`);\n      }\n      break;\n    }\n\n    case 'mcp__memory__delete_relations': {\n      // Check for bulk relation deletion\n      const relations = input.tool_input.relations;\n      const relationCount = Array.isArray(relations) ? relations.length : 0;\n\n      if (relationCount > 10) {\n        logPermissionFeedback('warn', `Bulk relation delete: ${relationCount} relations`, input);\n        logHook('memory-validator', `WARN: Bulk relation delete: ${relationCount} relations`);\n\n        return outputWarning(`Deleting ${relationCount} relations from knowledge graph`);\n      }\n      break;\n    }\n\n    case 'mcp__memory__create_entities': {\n      // Validate entity structure\n      const entities = input.tool_input.entities;\n      if (!Array.isArray(entities)) {\n        logPermissionFeedback('allow', 'Creating entities (non-array input)', input);\n        return outputSilentSuccess();\n      }\n\n      const entityCount = entities.length;\n\n      // Check each entity has required fields\n      const invalidCount = entities.filter(\n        (e: Record<string, unknown>) => !e.name || e.name === '' || !e.entityType || e.entityType === ''\n      ).length;\n\n      if (invalidCount > 0) {\n        logPermissionFeedback('warn', `Invalid entities: ${invalidCount} missing name or entityType`, input);\n        logHook('memory-validator', `WARN: ${invalidCount} entities missing required fields`);\n\n        return outputWarning(`${invalidCount} entities missing required fields (name, entityType)`);\n      }\n\n      // Size validation \u2014 block oversized (likely poisoning per OWASP ASI06)\n      const sizeError = validateEntitySizes(entities as Array<Record<string, unknown>>);\n      if (sizeError) {\n        logPermissionFeedback('deny', `Oversized entity: ${sizeError}`, input);\n        logHook('memory-validator', `BLOCKED: ${sizeError}`);\n        return outputDeny(sizeError);\n      }\n\n      // Unknown entity type warning (don't block \u2014 types evolve)\n      const unknownTypes = checkEntityTypes(entities as Array<Record<string, unknown>>);\n      if (unknownTypes.length > 0) {\n        logHook('memory-validator', `WARN: Unknown entity types: ${unknownTypes.join(', ')}`);\n      }\n\n      logPermissionFeedback('allow', `Creating ${entityCount} valid entities`, input);\n      break;\n    }\n\n    case 'mcp__memory__create_relations': {\n      // Validate relation structure\n      const relations = input.tool_input.relations;\n      if (!Array.isArray(relations)) {\n        logPermissionFeedback('allow', 'Creating relations (non-array input)', input);\n        return outputSilentSuccess();\n      }\n\n      const relationCount = relations.length;\n\n      // Check each relation has required fields\n      const invalidCount = relations.filter(\n        (r: Record<string, unknown>) => !r.from || !r.to || !r.relationType\n      ).length;\n\n      if (invalidCount > 0) {\n        logPermissionFeedback('warn', `Invalid relations: ${invalidCount} missing from/to/relationType`, input);\n        logHook('memory-validator', `WARN: ${invalidCount} relations missing required fields`);\n\n        return outputWarning(`${invalidCount} relations missing required fields`);\n      }\n\n      logPermissionFeedback('allow', `Creating ${relationCount} valid relations`, input);\n      break;\n    }\n\n    case 'mcp__memory__add_observations': {\n      // Validate observation sizes\n      const observations = input.tool_input.observations;\n      if (Array.isArray(observations)) {\n        const obsError = validateObservationSizes(observations as Array<Record<string, unknown>>);\n        if (obsError) {\n          logPermissionFeedback('deny', `Oversized observation: ${obsError}`, input);\n          logHook('memory-validator', `BLOCKED: ${obsError}`);\n          return outputDeny(obsError);\n        }\n      }\n      logPermissionFeedback('allow', `Adding observations`, input);\n      break;\n    }\n\n    default:\n      // Read operations - always allow\n      logPermissionFeedback('allow', `Read operation: ${toolName}`, input);\n      break;\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * NotebookLM MCP Advisor Hook\n * Advisory warnings for destructive/slow NotebookLM operations\n * Non-blocking \u2014 never uses outputBlock() or outputDeny()\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWarning,\n  outputWithContext,\n  logHook,\n} from '../../lib/common.js';\n\nconst HOOK_NAME = 'notebooklm-advisor';\n\n/** Slow operations \u2014 provide advisory context */\nconst SLOW_OPS: Record<string, string> = {\n  studio_create:\n    'Studio generation takes 2-5 minutes. Use studio_status to poll progress. Do not wait synchronously.',\n  research_start:\n    'Research uses Google quota and may take several minutes. Use research_status to poll progress.',\n};\n\n/** Destructive / sensitive operations \u2014 emit warnings */\nconst WARN_OPS: Record<string, string> = {\n  notebook_delete: 'Irreversible: all notebook content will be permanently deleted',\n  source_delete: 'Irreversible: source content will be permanently lost',\n  studio_delete: 'Irreversible: generated artifact will be permanently lost',\n  notebook_share_public: 'This makes the notebook publicly accessible via link',\n  notebook_share_invite: 'This sends an email invitation to the collaborator',\n};\n\n/**\n * NotebookLM advisor - warns about destructive and slow operations\n */\nexport function notebooklmAdvisor(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  if (!toolName.startsWith('mcp__notebooklm-mcp__')) {\n    return outputSilentSuccess();\n  }\n\n  const op = toolName.replace('mcp__notebooklm-mcp__', '');\n\n  // Slow operations \u2014 advisory context\n  if (SLOW_OPS[op]) {\n    logHook(HOOK_NAME, `Advisory: ${op}`);\n    return outputWithContext(SLOW_OPS[op]);\n  }\n\n  // Destructive / sensitive operations \u2014 warnings\n  if (WARN_OPS[op]) {\n    logHook(HOOK_NAME, `WARN: ${op}`);\n    return outputWarning(WARN_OPS[op]);\n  }\n\n  // Large source warning\n  if (op === 'source_add') {\n    const text = input.tool_input?.text;\n    if (typeof text === 'string' && text.length > 50000) {\n      logHook(HOOK_NAME, `WARN: source_add large text (${text.length} chars)`);\n      return outputWarning(\n        `Source is large (${text.length} chars). Consider splitting into multiple sources for better retrieval.`\n      );\n    }\n  }\n\n  // Note delete warning\n  if (op === 'note' && input.tool_input?.action === 'delete') {\n    logHook(HOOK_NAME, `WARN: note delete (irreversible)`);\n    return outputWarning('Irreversible: note will be permanently deleted');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Write Headers Hook\n * Adds standard headers to new files being created\n * Part of OrchestKit Claude Plugin\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, outputWithUpdatedInput, logHook } from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { extname } from 'node:path';\n\n/**\n * Get current date in YYYY-MM-DD format\n */\nfunction getCurrentDate(): string {\n  return new Date().toISOString().split('T')[0];\n}\n\n/**\n * Add header based on file type\n */\nfunction addHeader(ext: string, content: string): string {\n  const date = getCurrentDate();\n\n  switch (ext.toLowerCase()) {\n    case 'py':\n      return `# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n\n    case 'js':\n    case 'ts':\n      return `// Generated by OrchestKit Claude Plugin\n// Created: ${date}\n\n${content}`;\n\n    case 'sh': {\n      // For shell scripts, add after shebang if present\n      if (content.startsWith('#!/')) {\n        const firstNewline = content.indexOf('\\n');\n        const shebang = content.slice(0, firstNewline);\n        const rest = content.slice(firstNewline + 1);\n        return `${shebang}\n# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${rest}`;\n      }\n      return `#!/bin/bash\n# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n    }\n\n    case 'sql':\n      return `-- Generated by OrchestKit Claude Plugin\n-- Created: ${date}\n\n${content}`;\n\n    case 'html':\n    case 'xml':\n      return `<!-- Generated by OrchestKit Claude Plugin - ${date} -->\n\n${content}`;\n\n    case 'css':\n    case 'scss':\n    case 'sass':\n      return `/* Generated by OrchestKit Claude Plugin - ${date} */\n\n${content}`;\n\n    case 'yaml':\n    case 'yml':\n      return `# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n\n    case 'json':\n      // Don't add header for JSON (would break JSON format)\n      return content;\n\n    default:\n      // No header for unknown file types\n      return content;\n  }\n}\n\n/**\n * Create result with updated input (CC 2.1.25: canonical updatedInput)\n */\nfunction createUpdatedInputResult(filePath: string, content: string): HookResult {\n  return outputWithUpdatedInput({ file_path: filePath, content });\n}\n\n/**\n * Write headers hook - adds headers to new files\n */\nexport function writeHeaders(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Only process Write tool (not Edit - those are existing files)\n  if (toolName !== 'Write') {\n    return outputSilentSuccess();\n  }\n\n  // Check if file already exists (skip header if it does)\n  if (existsSync(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  // Get file extension\n  const ext = extname(filePath).replace('.', '');\n\n  // Skip if content already contains OrchestKit header\n  if (content.includes('OrchestKit')) {\n    logHook('write-headers', `Skipping header for ${filePath} (already has OrchestKit marker)`);\n    return outputSilentSuccess();\n  }\n\n  // Add header\n  const updatedContent = addHeader(ext, content);\n  const headerAdded = updatedContent !== content;\n\n  if (headerAdded) {\n    logHook('write-headers', `Added header to ${filePath}`);\n    // Use canonical updatedInput to modify tool input (CC 2.1.25)\n    return createUpdatedInputResult(filePath, updatedContent);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Skill Tracker Hook\n * Logs Skill tool invocations with analytics\n * CC 2.1.6 Compliant: includes continue field in all outputs\n *\n * Enhanced for Phase 4: Skill Usage Analytics (#56)\n * - Tracks skill usage patterns over time\n * - Enables context efficiency optimization\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, mkdirSync } from 'node:fs';\nimport { bufferWrite } from '../../lib/analytics-buffer.js';\nimport { join, dirname, basename } from 'node:path';\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  try {\n    if (!existsSync(dir)) {\n      mkdirSync(dir, { recursive: true });\n    }\n  } catch {\n    // Ignore mkdir errors\n  }\n}\n\n/**\n * Append to file safely\n */\nfunction appendSafe(file: string, content: string): void {\n  try {\n    ensureDir(dirname(file));\n    bufferWrite(file, content);\n  } catch {\n    // Ignore append errors\n  }\n}\n\n/**\n * Skill tracker - logs skill invocations with analytics\n */\nexport function skillTracker(input: HookInput): HookResult {\n  const skillName = (input.tool_input.skill as string) || '';\n  const skillArgs = (input.tool_input.args as string) || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  if (!skillName) {\n    return outputSilentSuccess();\n  }\n\n  logHook('skill-tracker', `Skill invocation: ${skillName}${skillArgs ? ` (args: ${skillArgs})` : ''}`);\n\n  // Log to temporary usage log for quick access\n  const usageLog = join(projectDir, '.claude', 'logs', 'skill-usage.log');\n  const timestamp = new Date().toISOString();\n  appendSafe(usageLog, `${timestamp} | ${skillName} | ${skillArgs || 'no args'}\\n`);\n\n  // Log to JSONL for detailed analytics\n  const analyticsLog = join(projectDir, '.claude', 'logs', 'skill-analytics.jsonl');\n  const analyticsEntry = JSON.stringify({\n    skill: skillName,\n    args: skillArgs || '',\n    timestamp,\n    project: basename(projectDir),\n    phase: 'start',\n  });\n  appendSafe(analyticsLog, `${analyticsEntry}\\n`);\n\n  logHook('skill-tracker', `Skill usage logged for ${skillName}`);\n\n  // CC 2.1.6 Compliant: JSON output without ANSI colors\n  return outputSilentSuccess();\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-10\n\n/**\n * TLDR Summary \u2014 PreToolUse[Read] Hook\n *\n * Intercepts Read calls on large files (>500 lines or >2000 tokens) and\n * injects a structural summary as additionalContext. Claude sees the\n * summary as a roadmap alongside the full file content.\n *\n * All error paths return silent success \u2014 never blocks a Read.\n *\n * @hook PreToolUse[Read]\n * @since v6.0.4\n * @see #463\n */\n\nimport { existsSync, readFileSync, statSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputAllowWithContext,\n  outputSilentSuccess,\n  logHook,\n  estimateTokenCount,\n} from '../../lib/common.js';\nimport { isSummarizable, summarizeCode } from '../../lib/code-summarizer.js';\n\nconst HOOK_NAME = 'tldr-summary';\nconst LINE_THRESHOLD = 500;\nconst TOKEN_THRESHOLD = 2000;\nconst MAX_FILE_SIZE = 2 * 1024 * 1024; // 2MB safety cap\n\n/** Session-level dedup: skip files already summarized this session */\nconst summarizedThisSession = new Set<string>();\n\nexport function tldrSummary(input: HookInput): HookResult {\n  try {\n    const toolInput = input.tool_input || {};\n    const filePath = toolInput.file_path as string | undefined;\n\n    // Guard: no file path\n    if (!filePath) {\n      return outputSilentSuccess();\n    }\n\n    // Guard: already summarized this session (dedup)\n    if (summarizedThisSession.has(filePath)) {\n      logHook(HOOK_NAME, `Skipping ${filePath}: already summarized this session`);\n      return outputSilentSuccess();\n    }\n\n    // Guard: targeted read (offset/limit set) \u2014 don't interfere with chunked reads\n    if (toolInput.offset !== undefined || toolInput.limit !== undefined) {\n      return outputSilentSuccess();\n    }\n\n    // Guard: unsupported extension\n    const dotIdx = filePath.lastIndexOf('.');\n    if (dotIdx === -1) {\n      return outputSilentSuccess();\n    }\n    const ext = filePath.slice(dotIdx).toLowerCase();\n    if (!isSummarizable(ext)) {\n      return outputSilentSuccess();\n    }\n\n    // Guard: file doesn't exist\n    if (!existsSync(filePath)) {\n      return outputSilentSuccess();\n    }\n\n    // Guard: file too large (>2MB)\n    const stats = statSync(filePath);\n    if (stats.size > MAX_FILE_SIZE) {\n      logHook(HOOK_NAME, `Skipping ${filePath}: ${stats.size} bytes > 2MB cap`);\n      return outputSilentSuccess();\n    }\n\n    // Read file content\n    const content = readFileSync(filePath, 'utf8');\n\n    // Guard: small file \u2014 below both thresholds\n    const lineCount = content.split('\\n').length;\n    const tokenCount = estimateTokenCount(content);\n    if (lineCount < LINE_THRESHOLD && tokenCount < TOKEN_THRESHOLD) {\n      return outputSilentSuccess();\n    }\n\n    // Generate summary\n    const summary = summarizeCode(content, filePath);\n    if (!summary) {\n      return outputSilentSuccess();\n    }\n\n    summarizedThisSession.add(filePath);\n    logHook(HOOK_NAME, `Injecting summary for ${filePath} (${lineCount} lines, ~${tokenCount} tokens)`);\n    return outputAllowWithContext(summary);\n  } catch (err) {\n    // Never block a Read \u2014 log and pass through\n    logHook(HOOK_NAME, `Error: ${err instanceof Error ? err.message : String(err)}`, 'warn');\n    return outputSilentSuccess();\n  }\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-10\n\n/**\n * Code Summarizer \u2014 Pure-function library for structural file summaries\n *\n * Extracts structural signatures (imports, functions, classes, types, exports)\n * from source files using regex-based extraction. No AST parsing required.\n *\n * @since v6.0.4\n * @see #463\n */\n\nimport { estimateTokenCount } from './common.js';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\ninterface ExtractedStructure {\n  imports: string[];\n  functions: string[];\n  classes: string[];\n  types: string[];\n  exports: string[];\n  sections: string[];   // Markdown h1-h3\n  variables: string[];  // Shell uppercase vars\n}\n\ntype LanguageId = 'typescript' | 'python' | 'go' | 'rust' | 'shell' | 'markdown';\n\n// ---------------------------------------------------------------------------\n// Extension Map\n// ---------------------------------------------------------------------------\n\nconst EXT_TO_LANG: Record<string, LanguageId> = {\n  '.ts': 'typescript',\n  '.tsx': 'typescript',\n  '.js': 'typescript',\n  '.jsx': 'typescript',\n  '.mjs': 'typescript',\n  '.mts': 'typescript',\n  '.py': 'python',\n  '.go': 'go',\n  '.rs': 'rust',\n  '.sh': 'shell',\n  '.bash': 'shell',\n  '.md': 'markdown',\n};\n\n/** Check if a file extension is supported for summarization */\nexport function isSummarizable(ext: string): boolean {\n  return ext in EXT_TO_LANG;\n}\n\n// ---------------------------------------------------------------------------\n// Language Extractors (regex-based, no AST)\n// ---------------------------------------------------------------------------\n\nfunction extractTypeScript(content: string): ExtractedStructure {\n  const lines = content.split('\\n');\n  const imports: string[] = [];\n  const functions: string[] = [];\n  const classes: string[] = [];\n  const types: string[] = [];\n  const exports: string[] = [];\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n\n    // Imports: import { X } from 'y' or import X from 'y'\n    if (/^import\\s/.test(trimmed)) {\n      imports.push(trimmed.replace(/;$/, ''));\n      continue;\n    }\n\n    // Interfaces and type aliases\n    if (/^(?:export\\s+)?(?:interface|type)\\s+\\w+/.test(trimmed)) {\n      const m = trimmed.match(/^(?:export\\s+)?(?:interface|type)\\s+(\\w+[^{=]*)/);\n      if (m) types.push(m[0].replace(/\\s*[{=]\\s*$/, '').trim());\n      continue;\n    }\n\n    // Classes\n    if (/^(?:export\\s+)?(?:abstract\\s+)?class\\s+\\w+/.test(trimmed)) {\n      const m = trimmed.match(/^(?:export\\s+)?(?:abstract\\s+)?class\\s+\\w+(?:\\s+extends\\s+\\w+)?(?:\\s+implements\\s+[\\w,\\s]+)?/);\n      if (m) classes.push(m[0].trim());\n      continue;\n    }\n\n    // Named function declarations: async function foo(...): RetType\n    if (/^(?:export\\s+)?(?:async\\s+)?function\\s+\\w+/.test(trimmed)) {\n      const m = trimmed.match(/^(?:export\\s+)?(?:async\\s+)?function\\s+\\w+\\([^)]*\\)(?:\\s*:\\s*[^{]+)?/);\n      if (m) functions.push(m[0].replace(/\\s*\\{?\\s*$/, '').trim());\n      continue;\n    }\n\n    // Arrow function exports: export const foo = (...) => or export const foo = async (...)\n    if (/^(?:export\\s+)?const\\s+\\w+\\s*=\\s*(?:async\\s+)?\\(/.test(trimmed)) {\n      const m = trimmed.match(/^(?:export\\s+)?const\\s+(\\w+)\\s*=\\s*(?:async\\s+)?\\([^)]*\\)(?:\\s*:\\s*[^=]+)?(?:\\s*=>)?/);\n      if (m) functions.push(m[0].replace(/\\s*=>\\s*$/, '').trim());\n      continue;\n    }\n\n    // Re-exports: export { X } from 'y' or export default\n    if (/^export\\s+(?:\\{|default\\s)/.test(trimmed)) {\n      exports.push(trimmed.replace(/;$/, ''));\n    }\n  }\n\n  return { imports, functions, classes, types, exports, sections: [], variables: [] };\n}\n\nfunction extractPython(content: string): ExtractedStructure {\n  const lines = content.split('\\n');\n  const imports: string[] = [];\n  const functions: string[] = [];\n  const classes: string[] = [];\n\n  let prevLineDecorator = '';\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n\n    // Imports\n    if (/^(?:from\\s|import\\s)/.test(trimmed)) {\n      imports.push(trimmed);\n      continue;\n    }\n\n    // Decorators (capture for next def/class)\n    if (/^@\\w+/.test(trimmed)) {\n      prevLineDecorator = trimmed;\n      continue;\n    }\n\n    // Top-level functions (no leading whitespace)\n    if (/^(?:async\\s+)?def\\s+\\w+/.test(line) && !line.startsWith(' ') && !line.startsWith('\\t')) {\n      const m = line.match(/^(?:async\\s+)?def\\s+\\w+\\([^)]*\\)(?:\\s*->\\s*[^:]+)?/);\n      if (m) {\n        const sig = prevLineDecorator ? `${prevLineDecorator} ${m[0].trim()}` : m[0].trim();\n        functions.push(sig);\n      }\n      prevLineDecorator = '';\n      continue;\n    }\n\n    // Classes (top-level)\n    if (/^class\\s+\\w+/.test(line) && !line.startsWith(' ') && !line.startsWith('\\t')) {\n      const m = line.match(/^class\\s+\\w+(?:\\([^)]*\\))?/);\n      if (m) {\n        // Collect method names inside the class\n        const className = m[0].trim();\n        classes.push(className);\n      }\n      prevLineDecorator = '';\n      continue;\n    }\n\n    // Class methods (indented def)\n    if (/^\\s+(?:async\\s+)?def\\s+\\w+/.test(line)) {\n      const m = line.match(/^\\s+(?:async\\s+)?def\\s+(\\w+)/);\n      if (m && !m[1].startsWith('_')) {\n        // Include public methods as part of the class info\n        functions.push(`  ${m[0].trim()}`);\n      }\n      prevLineDecorator = '';\n      continue;\n    }\n\n    prevLineDecorator = '';\n  }\n\n  return { imports, functions, classes, types: [], exports: [], sections: [], variables: [] };\n}\n\nfunction extractGo(content: string): ExtractedStructure {\n  const lines = content.split('\\n');\n  const imports: string[] = [];\n  const functions: string[] = [];\n  const types: string[] = [];\n\n  let inImportBlock = false;\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n\n    // Import block\n    if (/^import\\s*\\(/.test(trimmed)) {\n      inImportBlock = true;\n      continue;\n    }\n    if (inImportBlock) {\n      if (trimmed === ')') {\n        inImportBlock = false;\n      } else if (trimmed && !trimmed.startsWith('//')) {\n        imports.push(`import ${trimmed}`);\n      }\n      continue;\n    }\n    // Single import\n    if (/^import\\s+\"/.test(trimmed)) {\n      imports.push(trimmed);\n      continue;\n    }\n\n    // Functions (with optional receiver)\n    if (/^func\\s/.test(trimmed)) {\n      const m = trimmed.match(/^func\\s+(?:\\([^)]+\\)\\s+)?\\w+\\([^)]*\\)(?:\\s*(?:\\([^)]*\\)|\\*?\\w+))?/);\n      if (m) functions.push(m[0].trim());\n      continue;\n    }\n\n    // Type definitions: type X struct/interface\n    if (/^type\\s+\\w+\\s+(?:struct|interface)/.test(trimmed)) {\n      const m = trimmed.match(/^type\\s+\\w+\\s+(?:struct|interface)/);\n      if (m) types.push(m[0].trim());\n    }\n  }\n\n  return { imports, functions, classes: [], types, exports: [], sections: [], variables: [] };\n}\n\nfunction extractRust(content: string): ExtractedStructure {\n  const lines = content.split('\\n');\n  const imports: string[] = [];\n  const functions: string[] = [];\n  const types: string[] = [];\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n\n    // Use statements\n    if (/^use\\s/.test(trimmed)) {\n      imports.push(trimmed.replace(/;$/, ''));\n      continue;\n    }\n\n    // Functions: pub/async/fn\n    if (/^(?:pub\\s+)?(?:async\\s+)?fn\\s+\\w+/.test(trimmed)) {\n      const m = trimmed.match(/^(?:pub\\s+)?(?:async\\s+)?fn\\s+\\w+(?:<[^>]+>)?\\([^)]*\\)(?:\\s*->\\s*[^{]+)?/);\n      if (m) functions.push(m[0].replace(/\\s*\\{?\\s*$/, '').trim());\n      continue;\n    }\n\n    // Structs, enums, traits, impl\n    if (/^(?:pub\\s+)?(?:struct|enum|trait|impl)\\s+\\w+/.test(trimmed)) {\n      const m = trimmed.match(/^(?:pub\\s+)?(?:struct|enum|trait|impl)\\s+\\w+(?:<[^>]+>)?(?:\\s+for\\s+\\w+(?:<[^>]+>)?)?/);\n      if (m) types.push(m[0].trim());\n    }\n  }\n\n  return { imports, functions, classes: [], types, exports: [], sections: [], variables: [] };\n}\n\nfunction extractShell(content: string): ExtractedStructure {\n  const lines = content.split('\\n');\n  const functions: string[] = [];\n  const variables: string[] = [];\n  const varSet = new Set<string>();\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n\n    // Function definitions: foo() { or function foo {\n    if (/^(?:function\\s+)?(\\w+)\\s*\\(\\)\\s*\\{?/.test(trimmed)) {\n      const m = trimmed.match(/^(?:function\\s+)?(\\w+)\\s*\\(\\)/);\n      if (m && m[1] !== 'if' && m[1] !== 'while' && m[1] !== 'for') {\n        functions.push(m[1]);\n      }\n      continue;\n    }\n    if (/^function\\s+(\\w+)\\s*\\{?/.test(trimmed)) {\n      const m = trimmed.match(/^function\\s+(\\w+)/);\n      if (m) functions.push(m[1]);\n      continue;\n    }\n\n    // Uppercase variables (cap at 10)\n    if (/^[A-Z][A-Z0-9_]+=/.test(trimmed) && varSet.size < 10) {\n      const m = trimmed.match(/^([A-Z][A-Z0-9_]+)=/);\n      if (m && !varSet.has(m[1])) {\n        varSet.add(m[1]);\n        variables.push(m[1]);\n      }\n    }\n  }\n\n  return { imports: [], functions, classes: [], types: [], exports: [], sections: [], variables };\n}\n\nfunction extractMarkdown(content: string): ExtractedStructure {\n  const lines = content.split('\\n');\n  const sections: string[] = [];\n\n  for (const line of lines) {\n    // h1-h3 headers\n    const m = line.match(/^(#{1,3})\\s+(.+)/);\n    if (m) {\n      sections.push(`${m[1]} ${m[2].trim()}`);\n    }\n  }\n\n  return { imports: [], functions: [], classes: [], types: [], exports: [], sections, variables: [] };\n}\n\n// ---------------------------------------------------------------------------\n// Dispatcher\n// ---------------------------------------------------------------------------\n\nconst EXTRACTORS: Record<LanguageId, (content: string) => ExtractedStructure> = {\n  typescript: extractTypeScript,\n  python: extractPython,\n  go: extractGo,\n  rust: extractRust,\n  shell: extractShell,\n  markdown: extractMarkdown,\n};\n\n// ---------------------------------------------------------------------------\n// Formatter\n// ---------------------------------------------------------------------------\n\nconst SUMMARY_CHAR_BUDGET = 1400;\n\nfunction langLabel(lang: LanguageId): string {\n  const labels: Record<LanguageId, string> = {\n    typescript: 'TypeScript',\n    python: 'Python',\n    go: 'Go',\n    rust: 'Rust',\n    shell: 'Shell',\n    markdown: 'Markdown',\n  };\n  return labels[lang];\n}\n\nfunction formatSection(label: string, items: string[], indent = ''): string {\n  if (items.length === 0) return '';\n  const header = `${label} (${items.length}):`;\n  const itemLines = items.map((i) => `${indent}  ${i}`).join('\\n');\n  return `${header}\\n${itemLines}`;\n}\n\nfunction truncateToFit(sections: string[], budget: number): string {\n  let result = '';\n  for (const section of sections) {\n    if (result.length + section.length + 1 > budget) {\n      // Add truncation indicator and stop\n      result += '\\n  ...truncated';\n      break;\n    }\n    result += (result ? '\\n' : '') + section;\n  }\n  return result;\n}\n\n/**\n * Summarize a source file's structure.\n *\n * @param content - Full file content\n * @param filePath - File path (used for header + extension detection)\n * @returns Formatted summary string, or null if unsupported/empty\n */\nexport function summarizeCode(content: string, filePath: string): string | null {\n  // Extract extension\n  const dotIdx = filePath.lastIndexOf('.');\n  if (dotIdx === -1) return null;\n  const ext = filePath.slice(dotIdx).toLowerCase();\n  const lang = EXT_TO_LANG[ext];\n  if (!lang) return null;\n\n  const extractor = EXTRACTORS[lang];\n  const structure = extractor(content);\n\n  // Check if we extracted anything useful\n  const totalItems =\n    structure.imports.length +\n    structure.functions.length +\n    structure.classes.length +\n    structure.types.length +\n    structure.exports.length +\n    structure.sections.length +\n    structure.variables.length;\n\n  if (totalItems === 0) return null;\n\n  const lineCount = content.split('\\n').length;\n  const tokenEst = estimateTokenCount(content);\n\n  // Build header\n  const header = `[TLDR] ${filePath} (${lineCount} lines, ~${tokenEst} tokens, ${langLabel(lang)})`;\n\n  // Build body sections \u2014 ordered by priority (classes/types first, then functions, then imports)\n  const bodySections: string[] = [];\n\n  if (structure.classes.length > 0) {\n    bodySections.push(formatSection('Classes', structure.classes));\n  }\n  if (structure.types.length > 0) {\n    bodySections.push(formatSection('Types', structure.types));\n  }\n  if (structure.functions.length > 0) {\n    bodySections.push(formatSection('Functions', structure.functions));\n  }\n  if (structure.exports.length > 0) {\n    bodySections.push(formatSection('Exports', structure.exports));\n  }\n  if (structure.imports.length > 0) {\n    bodySections.push(formatSection('Imports', structure.imports));\n  }\n  if (structure.sections.length > 0) {\n    bodySections.push(formatSection('Sections', structure.sections));\n  }\n  if (structure.variables.length > 0) {\n    bodySections.push(formatSection('Variables', structure.variables));\n  }\n\n  // Truncate body to fit within budget (header excluded from budget)\n  const bodyBudget = SUMMARY_CHAR_BUDGET - header.length - 2; // -2 for newlines\n  const body = truncateToFit(bodySections, bodyBudget);\n\n  return `${header}\\n\\n${body}`;\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-06\n\n/**\n * Team Size Gate - PreToolUse[Task] Hook\n *\n * Enforces team size limits when spawning teammates via Agent Teams.\n * - Max 6 total team members (cost control)\n * - Max 3 Opus-model members (budget guard)\n * - Passthrough for non-team Task spawns (regular subagents)\n *\n * @hook PreToolUse[Task]\n * @since CC 2.1.33\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, outputDeny, logHook } from '../../lib/common.js';\nimport { getTeamMembers, isStaleTeam, cleanupTeam } from '../../lib/agent-teams.js';\n\nconst MAX_TEAM_SIZE = 6;\nconst MAX_OPUS_MEMBERS = 3;\n\nexport function teamSizeGate(input: HookInput): HookResult {\n  const toolInput = input.tool_input || {};\n\n  // Only gate team spawns \u2014 regular Task subagents pass through\n  const teamName = toolInput.team_name as string | undefined;\n  if (!teamName) {\n    return outputSilentSuccess();\n  }\n\n  // Auto-clean stale team if TeamCreate would conflict (#447)\n  if (isStaleTeam(teamName)) {\n    cleanupTeam(teamName);\n    logHook('team-size-gate', `Auto-cleaned stale team \"${teamName}\" before TeamCreate`);\n  }\n\n  const model = (toolInput.model as string) || '';\n  const description = (toolInput.description as string) || '';\n\n  // Read current team membership\n  const members = getTeamMembers();\n  const currentSize = members.length;\n\n  logHook('team-size-gate', `Team \"${teamName}\": ${currentSize} members, spawning model=\"${model}\"`);\n\n  // Check total team size\n  if (currentSize >= MAX_TEAM_SIZE) {\n    logHook('team-size-gate', `BLOCKED: Team size limit (${currentSize} >= ${MAX_TEAM_SIZE})`);\n    return outputDeny(\n      `Team Size Limit\\n\\nTeam \"${teamName}\" has ${currentSize} members (max ${MAX_TEAM_SIZE}).\\n\\n` +\n      `Wait for existing teammates to complete before spawning more.\\n\\n` +\n      `Attempted: ${description}`,\n    );\n  }\n\n  // Check Opus model count\n  if (model === 'opus') {\n    const opusCount = members.filter(\n      (m) => m.agentType.toLowerCase().includes('opus'),\n    ).length;\n\n    if (opusCount >= MAX_OPUS_MEMBERS) {\n      logHook('team-size-gate', `BLOCKED: Opus limit (${opusCount} >= ${MAX_OPUS_MEMBERS})`);\n      return outputDeny(\n        `Opus Model Limit\\n\\nTeam \"${teamName}\" already has ${opusCount} Opus members (max ${MAX_OPUS_MEMBERS}).\\n\\n` +\n        `Use a lighter model (sonnet/haiku) or wait for Opus teammates to finish.\\n\\n` +\n        `Attempted: ${description}`,\n      );\n    }\n  }\n\n  logHook('team-size-gate', `Team spawn allowed: ${currentSize + 1}/${MAX_TEAM_SIZE}`);\n  return outputSilentSuccess();\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-09\n\n/**\n * Unified Advisory Dispatcher \u2014 PreToolUse Bash Hook\n * Consolidates 8 advisory hooks into a single dispatcher to reduce process spawns.\n *\n * Hooks consolidated here:\n * - default-timeout-setter (input modifier \u2014 runs first)\n * - agent-browser-safety (can block \u2014 runs second)\n * - error-pattern-warner (context)\n * - issue-docs-requirement (context)\n * - multi-instance-quality-gate (context)\n * - gh-issue-creation-guide (context)\n * - affected-tests-finder (context)\n *\n * NOT consolidated (remain separate in hooks.json):\n * - dangerous-command-blocker (security-critical, must block early)\n * - compound-command-validator (security-critical, must block early)\n *\n * CC 2.1.9 Compliant: Single additionalContext output with 800-token budget\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  outputWithUpdatedInput,\n  logHook,\n  estimateTokenCount,\n  extractContext,\n} from '../../lib/common.js';\n\n// Import hook implementations\nimport { defaultTimeoutSetter } from './default-timeout-setter.js';\nimport { agentBrowserSafety } from './agent-browser-safety.js';\nimport { errorPatternWarner } from './error-pattern-warner.js';\nimport { issueDocsRequirement } from './issue-docs-requirement.js';\nimport { multiInstanceQualityGate } from './multi-instance-quality-gate.js';\nimport { ghIssueCreationGuide } from './gh-issue-creation-guide.js';\nimport { affectedTestsFinder } from './affected-tests-finder.js';\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\nconst HOOK_NAME = 'pretool-bash-dispatcher';\n\n/** Maximum total tokens for consolidated output */\nconst MAX_OUTPUT_TOKENS = 800;\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype HookFn = (input: HookInput) => HookResult;\n\ninterface AdvisoryHookConfig {\n  name: string;\n  fn: HookFn;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Registry \u2014 advisory hooks that produce context\n// -----------------------------------------------------------------------------\n\nconst ADVISORY_HOOKS: AdvisoryHookConfig[] = [\n  { name: 'error-pattern-warner', fn: errorPatternWarner },\n  { name: 'issue-docs-requirement', fn: issueDocsRequirement },\n  { name: 'multi-instance-quality-gate', fn: multiInstanceQualityGate },\n  { name: 'gh-issue-creation-guide', fn: ghIssueCreationGuide },\n  { name: 'affected-tests-finder', fn: affectedTestsFinder },\n];\n\n/** Exposed for testing */\nexport const registeredHookNames = () => [\n  'default-timeout-setter',\n  'agent-browser-safety',\n  ...ADVISORY_HOOKS.map(h => h.name),\n];\n\n// extractContext imported from ../../lib/common.js (Issue #682)\n\n// -----------------------------------------------------------------------------\n// Dispatcher Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Unified dispatcher for advisory Bash PreToolUse hooks.\n *\n * Execution order:\n * 1. default-timeout-setter (input modifier)\n * 2. agent-browser-safety (can block)\n * 3. Advisory hooks (context producers, budget-capped)\n */\nexport function unifiedBashAdvisoryDispatcher(input: HookInput): HookResult {\n  // --- Phase 1: Input modifier (default-timeout-setter) ---\n  let updatedInput: Record<string, unknown> | undefined;\n\n  try {\n    const timeoutResult = defaultTimeoutSetter(input);\n    if (timeoutResult.hookSpecificOutput?.updatedInput) {\n      updatedInput = timeoutResult.hookSpecificOutput.updatedInput as Record<string, unknown>;\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    logHook(HOOK_NAME, `default-timeout-setter failed: ${message}`, 'warn');\n  }\n\n  // --- Phase 2: Blocking check (agent-browser-safety) ---\n  try {\n    const browserResult = agentBrowserSafety(input);\n    if (!browserResult.continue) {\n      // Blocked \u2014 return the deny immediately\n      return browserResult;\n    }\n    // If it produced context, collect it\n    const browserContext = extractContext(browserResult);\n    if (browserContext) {\n      // Browser safety context is high-priority, prepend to advisory output\n      return mergeAdvisoryContext(input, updatedInput, browserContext);\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    logHook(HOOK_NAME, `agent-browser-safety failed: ${message}`, 'warn');\n  }\n\n  // --- Phase 3: Advisory hooks (context producers) ---\n  return mergeAdvisoryContext(input, updatedInput, null);\n}\n\n/**\n * Run advisory hooks, merge context, and combine with any input modifications.\n */\nfunction mergeAdvisoryContext(\n  input: HookInput,\n  updatedInput: Record<string, unknown> | undefined,\n  prependContext: string | null,\n): HookResult {\n  const contextParts: string[] = [];\n  let totalTokens = 0;\n\n  // Prepend high-priority context (e.g., browser safety warning)\n  if (prependContext) {\n    const tokens = estimateTokenCount(prependContext);\n    contextParts.push(prependContext);\n    totalTokens += tokens;\n  }\n\n  // Run advisory hooks\n  for (const hook of ADVISORY_HOOKS) {\n    try {\n      const result = hook.fn(input);\n\n      const context = extractContext(result);\n      if (!context) continue;\n\n      const contextTokens = estimateTokenCount(context);\n      if (totalTokens + contextTokens > MAX_OUTPUT_TOKENS) {\n        logHook(HOOK_NAME, `Budget limit: skipping ${hook.name} (${contextTokens}t would exceed ${MAX_OUTPUT_TOKENS}t cap)`);\n        continue;\n      }\n\n      contextParts.push(context);\n      totalTokens += contextTokens;\n      logHook(HOOK_NAME, `${hook.name}: +${contextTokens}t (total: ${totalTokens}t)`);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      logHook(HOOK_NAME, `${hook.name} failed: ${message}`, 'warn');\n    }\n  }\n\n  // --- Combine results ---\n\n  // Case 1: Input modified + context produced\n  if (updatedInput && contextParts.length > 0) {\n    const consolidated = contextParts.join('\\n\\n---\\n\\n');\n    logHook(HOOK_NAME, `Consolidated ${contextParts.length} hooks into ${totalTokens}t + input mod`);\n    return {\n      continue: true,\n      suppressOutput: true,\n      hookSpecificOutput: {\n        hookEventName: 'PreToolUse',\n        updatedInput,\n        additionalContext: consolidated,\n      },\n    };\n  }\n\n  // Case 2: Input modified only\n  if (updatedInput) {\n    return outputWithUpdatedInput(updatedInput);\n  }\n\n  // Case 3: Context produced only\n  if (contextParts.length > 0) {\n    const consolidated = contextParts.join('\\n\\n---\\n\\n');\n    logHook(HOOK_NAME, `Consolidated ${contextParts.length} hooks into ${totalTokens}t`);\n    return outputAllowWithContext(consolidated);\n  }\n\n  // Case 4: Nothing produced\n  return outputSilentSuccess();\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-09\n\n/**\n * Unified Quality Dispatcher \u2014 PreToolUse Write|Edit Hook\n * Consolidates 4 quality hooks into a single dispatcher to reduce process spawns.\n *\n * Hooks consolidated here:\n * - security-pattern-validator (can block \u2014 runs first)\n * - architecture-change-detector (context)\n *\n * NOT consolidated (remain separate in hooks.json):\n * - file-guard (security-critical guard, must block early)\n * - write-headers (input modifier, must run before quality checks)\n *\n * CC 2.1.9 Compliant: Single additionalContext output with 800-token budget\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  estimateTokenCount,\n  extractContext,\n} from '../../lib/common.js';\n\n// Import hook implementations\nimport { securityPatternValidator } from '../Write/security-pattern-validator.js';\nimport { architectureChangeDetector } from '../Write/architecture-change-detector.js';\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\nconst HOOK_NAME = 'pretool-write-edit-dispatcher';\n\n/** Maximum total tokens for consolidated output */\nconst MAX_OUTPUT_TOKENS = 800;\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype HookFn = (input: HookInput) => HookResult;\n\ninterface QualityHookConfig {\n  name: string;\n  fn: HookFn;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Registry \u2014 quality hooks that produce context\n// -----------------------------------------------------------------------------\n\nconst QUALITY_HOOKS: QualityHookConfig[] = [\n  { name: 'architecture-change-detector', fn: architectureChangeDetector },\n];\n\n/** Exposed for testing */\nexport const registeredHookNames = () => [\n  'security-pattern-validator',\n  ...QUALITY_HOOKS.map(h => h.name),\n];\n\n// extractContext imported from ../../lib/common.js (Issue #682)\n\n// -----------------------------------------------------------------------------\n// Dispatcher Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Unified dispatcher for quality Write|Edit PreToolUse hooks.\n *\n * Execution order:\n * 1. security-pattern-validator (can block)\n * 2. Quality hooks (context producers, budget-capped)\n */\nexport function unifiedWriteEditQualityDispatcher(input: HookInput): HookResult {\n  // --- Phase 1: Security check (can block) ---\n  try {\n    const securityResult = securityPatternValidator(input);\n    if (!securityResult.continue) {\n      return securityResult;\n    }\n    // If security produced a warning context, collect it as high-priority\n    const securityContext = extractContext(securityResult);\n    if (securityContext) {\n      return mergeQualityContext(input, securityContext);\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    logHook(HOOK_NAME, `security-pattern-validator failed: ${message}`, 'warn');\n  }\n\n  // --- Phase 2: Quality hooks (context producers) ---\n  return mergeQualityContext(input, null);\n}\n\n/**\n * Run quality hooks, merge context with optional prepended context.\n */\nfunction mergeQualityContext(\n  input: HookInput,\n  prependContext: string | null,\n): HookResult {\n  const contextParts: string[] = [];\n  let totalTokens = 0;\n\n  // Prepend high-priority context (e.g., security warnings)\n  if (prependContext) {\n    const tokens = estimateTokenCount(prependContext);\n    contextParts.push(prependContext);\n    totalTokens += tokens;\n  }\n\n  // Run quality hooks\n  for (const hook of QUALITY_HOOKS) {\n    try {\n      const result = hook.fn(input);\n\n      const context = extractContext(result);\n      if (!context) continue;\n\n      const contextTokens = estimateTokenCount(context);\n      if (totalTokens + contextTokens > MAX_OUTPUT_TOKENS) {\n        logHook(HOOK_NAME, `Budget limit: skipping ${hook.name} (${contextTokens}t would exceed ${MAX_OUTPUT_TOKENS}t cap)`);\n        continue;\n      }\n\n      contextParts.push(context);\n      totalTokens += contextTokens;\n      logHook(HOOK_NAME, `${hook.name}: +${contextTokens}t (total: ${totalTokens}t)`);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      logHook(HOOK_NAME, `${hook.name} failed: ${message}`, 'warn');\n    }\n  }\n\n  // No context produced\n  if (contextParts.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Single consolidated output\n  const consolidated = contextParts.join('\\n\\n---\\n\\n');\n  logHook(HOOK_NAME, `Consolidated ${contextParts.length} hooks into ${totalTokens}t`);\n  return outputAllowWithContext(consolidated);\n}\n", "/**\n * Block Writes - Blocks Write/Edit operations for read-only agents\n *\n * Used by: debug-investigator, code-quality-reviewer, ux-researcher,\n *          market-intelligence, system-design-reviewer\n *\n * Purpose: Enforce read-only boundaries for investigation/review agents\n *\n * CC 2.1.7 compliant output format\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny } from '../lib/common.js';\n\n/**\n * Block writes hook\n */\nexport function blockWrites(input: HookInput): HookResult {\n  const toolName = input.tool_name;\n  const agentId = process.env.CLAUDE_AGENT_ID || 'unknown';\n\n  // These tools are write operations that should be blocked\n  const writeTools = ['Write', 'Edit', 'MultiEdit', 'NotebookEdit'];\n\n  if (writeTools.includes(toolName)) {\n    // Block write operations\n    return outputDeny(\n      `BLOCKED: Agent '${agentId}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`\n    );\n  }\n\n  // Allow all other operations\n  return outputSilentSuccess();\n}\n", "/**\n * Migration Safety Check - Validates database commands are safe\n *\n * Used by: database-engineer agent\n *\n * Purpose: Prevent destructive database operations without explicit confirmation\n *\n * CC 2.1.7 compliant output format\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny } from '../lib/common.js';\nimport { normalizeSingle } from '../lib/normalize-command.js';\n\n// Dangerous database patterns\nconst DANGEROUS_PATTERNS: Array<{ test: (s: string) => boolean; source: string }> = [\n  { test: (s) => /DROP\\s+TABLE/i.test(s), source: 'DROP TABLE' },\n  { test: (s) => /DROP\\s+DATABASE/i.test(s), source: 'DROP DATABASE' },\n  { test: (s) => /TRUNCATE/i.test(s), source: 'TRUNCATE' },\n  { test: (s) => /DELETE\\s+FROM/i.test(s) && /WHERE\\s+1/i.test(s), source: 'DELETE FROM...WHERE 1' },\n  { test: (s) => /DELETE\\s+FROM/i.test(s) && !/WHERE/i.test(s), source: 'DELETE FROM (no WHERE)' },\n  { test: (s) => s.includes('--force'), source: '--force' },\n  { test: (s) => /alembic\\s+downgrade/i.test(s), source: 'alembic downgrade' },\n];\n\n/**\n * Migration safety check hook\n */\nexport function migrationSafetyCheck(input: HookInput): HookResult {\n  const toolName = input.tool_name;\n\n  // Only check Bash commands\n  if (toolName !== 'Bash') {\n    return outputSilentSuccess();\n  }\n\n  const rawCommand = input.tool_input.command || '';\n\n  // Normalize: expand hex/octal escapes, strip quotes, collapse whitespace\n  const command = rawCommand ? normalizeSingle(rawCommand) : '';\n\n  // Check for dangerous patterns\n  for (const pattern of DANGEROUS_PATTERNS) {\n    if (pattern.test(command)) {\n      return outputDeny(\n        `BLOCKED: Potentially destructive database command detected. Pattern: '${pattern.source}'. Please confirm this operation is intentional before proceeding.`\n      );\n    }\n  }\n\n  // Safe to proceed\n  return outputSilentSuccess();\n}\n", "/**\n * Security Command Audit - Extra audit logging for security agent operations\n *\n * Used by: security-auditor, security-layer-auditor agents\n *\n * Purpose: Log all Bash commands executed during security audits for compliance\n *\n * CC 2.1.7 compliant output format\n */\n\nimport { mkdirSync } from 'node:fs';\nimport { bufferWrite } from '../lib/analytics-buffer.js';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir, getSessionId } from '../lib/common.js';\n\n/**\n * Security command audit hook\n */\nexport function securityCommandAudit(input: HookInput): HookResult {\n  const agentId = process.env.CLAUDE_AGENT_ID || 'unknown';\n  const toolName = input.tool_name;\n  const sessionId = input.session_id || getSessionId();\n  const projectDir = input.project_dir || getProjectDir();\n\n  const logFile = `${projectDir}/.claude/logs/security-audit.log`;\n\n  // Only audit Bash commands\n  if (toolName !== 'Bash') {\n    return outputSilentSuccess();\n  }\n\n  const command = input.tool_input.command || '';\n  const timestamp = new Date().toISOString();\n\n  if (command) {\n    try {\n      // Create log directory if needed\n      mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n\n      // Log the command execution\n      bufferWrite(logFile, `[${timestamp}] [${sessionId}] [${agentId}] CMD: ${command}\\n`);\n    } catch {\n      // Ignore logging errors - don't block the operation\n    }\n  }\n\n  // Always continue - this is audit logging only\n  return outputSilentSuccess();\n}\n", "/**\n * CI Safety Check - Validates CI/CD commands for safety\n *\n * Used by: ci-cd-engineer agent\n *\n * Purpose: Prevent dangerous CI/CD operations without confirmation\n *\n * CC 2.1.7 compliant output format\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny, outputWithContext, lineContainsAllCI } from '../lib/common.js';\nimport { normalizeSingle } from '../lib/normalize-command.js';\n\n// Dangerous CI/CD patterns \u2014 each entry is [pattern, label]\n// String-based checks avoid ReDoS from polynomial regex backtracking\nconst DANGEROUS_PATTERNS: Array<{ test: (cmd: string) => boolean; source: string }> = [\n  { test: (cmd) => lineContainsAllCI(cmd, 'force', 'push'), source: 'force push' },\n  { test: (cmd) => lineContainsAllCI(cmd, 'push', '--force'), source: 'push --force' },\n  { test: (cmd) => cmd.includes('--force-with-lease'), source: '--force-with-lease' },\n  { test: (cmd) => cmd.toLowerCase().includes('workflow_dispatch'), source: 'workflow_dispatch' },\n  { test: (cmd) => lineContainsAllCI(cmd, 'delete', 'workflow'), source: 'delete workflow' },\n  { test: (cmd) => /gh\\s+secret\\s+delete/i.test(cmd), source: 'gh secret delete' },\n  { test: (cmd) => /gh\\s+variable\\s+delete/i.test(cmd), source: 'gh variable delete' },\n  { test: (cmd) => lineContainsAllCI(cmd, 'rm', '-rf', '.github'), source: 'rm -rf .github' },\n];\n\n/**\n * CI safety check hook\n */\nexport function ciSafetyCheck(input: HookInput): HookResult {\n  const rawCommand = input.tool_input.command || '';\n\n  // Normalize: expand hex/octal escapes, strip quotes, collapse whitespace\n  const command = rawCommand ? normalizeSingle(rawCommand) : '';\n\n  // Check for dangerous CI/CD patterns\n  for (const pattern of DANGEROUS_PATTERNS) {\n    if (pattern.test(command)) {\n      return outputDeny(\n        `BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${pattern.source}'. This requires explicit user approval.`\n      );\n    }\n  }\n\n  // Warn on deployment-related commands\n  if (/deploy|release|publish/i.test(command)) {\n    return outputWithContext(\n      'CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place.'\n    );\n  }\n\n  // Allow other commands\n  return outputSilentSuccess();\n}\n", "/**\n * Deployment Safety Check - Validates deployment commands for safety\n *\n * Used by: deployment-manager agent\n *\n * Purpose: Prevent dangerous deployment operations without verification\n *\n * CC 2.1.7 compliant output format\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny, outputWithContext } from '../lib/common.js';\n\n// Production patterns that should be blocked\nconst PRODUCTION_PATTERNS: Array<{ test: (cmd: string) => boolean; source: string }> = [\n  { test: (cmd) => /\\bprod\\b/i.test(cmd), source: 'prod' },\n  { test: (cmd) => /production/i.test(cmd), source: 'production' },\n  { test: (cmd) => cmd.includes('--env') && /prod/i.test(cmd), source: '--env.*prod' },\n  { test: (cmd) => cmd.includes('ENV=prod'), source: 'ENV=prod' },\n  { test: (cmd) => cmd.includes('ENVIRONMENT=prod'), source: 'ENVIRONMENT=prod' },\n  { test: (cmd) => cmd.toLowerCase().includes('deploy') && cmd.toLowerCase().includes('main'), source: 'deploy.*main' },\n  { test: (cmd) => cmd.toLowerCase().includes('deploy') && cmd.toLowerCase().includes('master'), source: 'deploy.*master' },\n];\n\n/**\n * Deployment safety check hook\n */\nexport function deploymentSafetyCheck(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Block production deployments without explicit markers\n  for (const pattern of PRODUCTION_PATTERNS) {\n    if (pattern.test(command)) {\n      return outputDeny(\n        `BLOCKED: Production deployment detected. Pattern: '${pattern.source}'. Production deployments require explicit user approval and should go through proper release processes.`\n      );\n    }\n  }\n\n  // Warn on rollback operations\n  if (/rollback|revert|downgrade/i.test(command)) {\n    return outputWithContext(\n      'Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed.'\n    );\n  }\n\n  // Warn on infrastructure changes\n  if (/terraform|kubectl|helm/i.test(command) || (command.toLowerCase().includes('docker') && command.toLowerCase().includes('push'))) {\n    return outputWithContext(\n      'Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment.'\n    );\n  }\n\n  // Allow other commands\n  return outputSilentSuccess();\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-09\n\n/**\n * Unified Agent Safety Dispatcher \u2014 PreToolUse Task Hook\n * Consolidates 5 agent-scoped hooks into a single dispatcher to reduce process spawns.\n *\n * Hooks consolidated here:\n * - block-writes (agent-scoped \u2014 can block)\n * - migration-safety-check (agent-scoped \u2014 can block)\n * - security-command-audit (agent-scoped \u2014 audit logging)\n * - ci-safety-check (agent-scoped \u2014 can block)\n * - deployment-safety-check (agent-scoped \u2014 can block)\n *\n * NOT consolidated (remains separate in hooks.json):\n * - team-size-gate (Agent Teams gate, different concern)\n *\n * CC 2.1.7 Compliant: Returns first blocking result, or merged context\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  estimateTokenCount,\n  extractContext,\n} from '../../lib/common.js';\n\n// Import hook implementations\nimport { blockWrites } from '../../agent/block-writes.js';\nimport { migrationSafetyCheck } from '../../agent/migration-safety-check.js';\nimport { securityCommandAudit } from '../../agent/security-command-audit.js';\nimport { ciSafetyCheck } from '../../agent/ci-safety-check.js';\nimport { deploymentSafetyCheck } from '../../agent/deployment-safety-check.js';\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\nconst HOOK_NAME = 'pretool-task-dispatcher';\n\n/** Maximum total tokens for consolidated output */\nconst MAX_OUTPUT_TOKENS = 800;\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype HookFn = (input: HookInput) => HookResult;\n\ninterface SafetyHookConfig {\n  name: string;\n  fn: HookFn;\n  /** Whether this hook can block (deny) operations */\n  canBlock: boolean;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Registry\n// Ordering: blocking hooks first, then audit/advisory\n// -----------------------------------------------------------------------------\n\nconst SAFETY_HOOKS: SafetyHookConfig[] = [\n  { name: 'block-writes', fn: blockWrites, canBlock: true },\n  { name: 'migration-safety-check', fn: migrationSafetyCheck, canBlock: true },\n  { name: 'ci-safety-check', fn: ciSafetyCheck, canBlock: true },\n  { name: 'deployment-safety-check', fn: deploymentSafetyCheck, canBlock: true },\n  { name: 'security-command-audit', fn: securityCommandAudit, canBlock: false },\n];\n\n/** Exposed for testing */\nexport const registeredHookNames = () => SAFETY_HOOKS.map(h => h.name);\n\n// extractContext imported from ../../lib/common.js (Issue #682)\n\n// -----------------------------------------------------------------------------\n// Dispatcher Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Unified dispatcher for agent safety PreToolUse Task hooks.\n *\n * Runs all hooks sequentially. If any blocking hook denies, returns immediately.\n * Otherwise, merges context from advisory hooks.\n */\nexport function unifiedAgentSafetyDispatcher(input: HookInput): HookResult {\n  const contextParts: string[] = [];\n  let totalTokens = 0;\n\n  for (const hook of SAFETY_HOOKS) {\n    try {\n      const result = hook.fn(input);\n\n      // If hook blocks, return immediately\n      if (!result.continue) {\n        logHook(HOOK_NAME, `${hook.name} blocked operation`);\n        return result;\n      }\n\n      // Collect context if produced\n      const context = extractContext(result);\n      if (!context) continue;\n\n      const contextTokens = estimateTokenCount(context);\n      if (totalTokens + contextTokens > MAX_OUTPUT_TOKENS) {\n        logHook(HOOK_NAME, `Budget limit: skipping ${hook.name} (${contextTokens}t would exceed ${MAX_OUTPUT_TOKENS}t cap)`);\n        continue;\n      }\n\n      contextParts.push(context);\n      totalTokens += contextTokens;\n      logHook(HOOK_NAME, `${hook.name}: +${contextTokens}t (total: ${totalTokens}t)`);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      logHook(HOOK_NAME, `${hook.name} failed: ${message}`, 'warn');\n    }\n  }\n\n  // No context produced\n  if (contextParts.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Single consolidated output\n  const consolidated = contextParts.join('\\n\\n---\\n\\n');\n  logHook(HOOK_NAME, `Consolidated ${contextParts.length} hooks into ${totalTokens}t`);\n  return outputAllowWithContext(consolidated);\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-28\n\n/**\n * Sync Bash Dispatcher \u2014 PreToolUse Bash Hook\n * Consolidates 3 Bash PreToolUse hooks into a single dispatcher.\n *\n * Consolidated hooks (security-first order):\n * - dangerous-command-blocker (blocks rm -rf, sudo, force push etc \u2014 FIRST)\n * - compound-command-validator (validates chained commands \u2014 SECOND)\n * - unified-advisory-dispatcher (advisory guidance \u2014 LAST)\n *\n * SHORT-CIRCUIT: On first block, returns immediately without running remaining hooks.\n * Merges additionalContext from all passing hooks into a single output.\n *\n * CC 2.1.9 Compliant: Single PreToolUse dispatcher with merged additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, outputWithUpdatedInput, logHook, extractContext } from '../../lib/common.js';\n\n// Import consolidated hook implementations\nimport { dangerousCommandBlocker } from './dangerous-command-blocker.js';\nimport { compoundCommandValidator } from './compound-command-validator.js';\nimport { unifiedBashAdvisoryDispatcher } from './unified-advisory-dispatcher.js';\n\nconst HOOK_NAME = 'sync-bash-dispatcher';\n\ninterface BlockingHookConfig {\n  name: string;\n  fn: (input: HookInput) => HookResult;\n}\n\n/**\n * Registry of Bash PreToolUse hooks, executed in security-first order.\n * Blockers run first; advisory dispatcher runs last.\n */\nconst BASH_HOOKS: BlockingHookConfig[] = [\n  { name: 'dangerous-command-blocker', fn: dangerousCommandBlocker },\n  { name: 'compound-command-validator', fn: compoundCommandValidator },\n  { name: 'unified-advisory-dispatcher', fn: unifiedBashAdvisoryDispatcher },\n];\n\n/**\n * Build the merged HookResult from collected context parts and optional updatedInput.\n */\nfunction buildMergedResult(\n  contextParts: string[],\n  updatedInput: Record<string, unknown> | undefined,\n): HookResult {\n  const mergedContext = contextParts.length > 0 ? contextParts.join('\\n\\n---\\n\\n') : null;\n\n  if (updatedInput && mergedContext) {\n    logHook(HOOK_NAME, `Merged ${contextParts.length} context(s) + updatedInput`);\n    return {\n      continue: true,\n      suppressOutput: true,\n      hookSpecificOutput: { hookEventName: 'PreToolUse', updatedInput, additionalContext: mergedContext },\n    };\n  }\n\n  if (updatedInput) {\n    logHook(HOOK_NAME, 'updatedInput only \u2014 no context');\n    return outputWithUpdatedInput(updatedInput);\n  }\n\n  if (mergedContext) {\n    logHook(HOOK_NAME, `Merged ${contextParts.length} context(s)`);\n    return {\n      continue: true,\n      suppressOutput: true,\n      hookSpecificOutput: { additionalContext: mergedContext, hookEventName: 'PreToolUse' },\n    };\n  }\n\n  logHook(HOOK_NAME, 'All hooks silent');\n  return outputSilentSuccess();\n}\n\n/**\n * Consolidated sync Bash PreToolUse dispatcher.\n *\n * Execution order:\n * 1. dangerous-command-blocker (can block \u2014 security critical)\n * 2. compound-command-validator (can block \u2014 security critical)\n * 3. unified-advisory-dispatcher (context + input modifier)\n *\n * On first block: SHORT-CIRCUIT immediately.\n * On pass: merge additionalContext and updatedInput from all hooks.\n */\nexport function syncBashDispatcher(input: HookInput): HookResult {\n  const contextParts: string[] = [];\n  let updatedInput: Record<string, unknown> | undefined;\n\n  for (const hook of BASH_HOOKS) {\n    try {\n      const result = hook.fn(input);\n\n      if (!result.continue) {\n        logHook(HOOK_NAME, `${hook.name} blocked \u2014 short-circuiting`);\n        return result;\n      }\n\n      if (result.hookSpecificOutput?.updatedInput) {\n        updatedInput = result.hookSpecificOutput.updatedInput as Record<string, unknown>;\n        logHook(HOOK_NAME, `${hook.name}: updatedInput collected`);\n      }\n\n      const context = extractContext(result);\n      if (context) {\n        contextParts.push(context);\n        logHook(HOOK_NAME, `${hook.name}: additionalContext collected`);\n      }\n    } catch (error) {\n      const msg = error instanceof Error ? error.message : String(error);\n      logHook(HOOK_NAME, `${hook.name} failed: ${msg}`, 'warn');\n    }\n  }\n\n  return buildMergedResult(contextParts, updatedInput);\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-28\n\n/**\n * Sync Write|Edit Dispatcher \u2014 PreToolUse Write|Edit Hook\n * Consolidates 4 Write|Edit PreToolUse hooks into a single dispatcher.\n *\n * Consolidated hooks (security-first order):\n * - content-secret-scanner (scans for secrets in file content \u2014 FIRST)\n * - file-guard (protects critical files from modification \u2014 SECOND)\n * - write-headers (adds headers to new files \u2014 input modifier)\n * - unified-quality-dispatcher (quality checks \u2014 LAST)\n *\n * SHORT-CIRCUIT: On first block, returns immediately without running remaining hooks.\n * Merges additionalContext from all passing hooks into a single output.\n *\n * CC 2.1.9 Compliant: Single PreToolUse dispatcher with merged additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, outputWithUpdatedInput, logHook, extractContext } from '../../lib/common.js';\n\n// Import consolidated hook implementations\nimport { contentSecretScanner } from './content-secret-scanner.js';\nimport { fileGuard } from './file-guard.js';\nimport { writeHeaders } from '../input-mod/write-headers.js';\nimport { unifiedWriteEditQualityDispatcher } from './unified-quality-dispatcher.js';\n\nconst HOOK_NAME = 'sync-write-edit-dispatcher';\n\ninterface WriteEditHookConfig {\n  name: string;\n  fn: (input: HookInput) => HookResult;\n}\n\n/**\n * Registry of Write|Edit PreToolUse hooks, executed in security-first order.\n * Blockers/scanners run first; quality advisory runs last.\n */\nconst WRITE_EDIT_HOOKS: WriteEditHookConfig[] = [\n  { name: 'content-secret-scanner', fn: contentSecretScanner },\n  { name: 'file-guard', fn: fileGuard },\n  { name: 'write-headers', fn: writeHeaders },\n  { name: 'unified-quality-dispatcher', fn: unifiedWriteEditQualityDispatcher },\n];\n\n/**\n * Build the merged HookResult from collected context parts and optional updatedInput.\n */\nfunction buildMergedResult(\n  contextParts: string[],\n  updatedInput: Record<string, unknown> | undefined,\n): HookResult {\n  const mergedContext = contextParts.length > 0 ? contextParts.join('\\n\\n---\\n\\n') : null;\n\n  if (updatedInput && mergedContext) {\n    logHook(HOOK_NAME, `Merged ${contextParts.length} context(s) + updatedInput`);\n    return {\n      continue: true,\n      suppressOutput: true,\n      hookSpecificOutput: { hookEventName: 'PreToolUse', updatedInput, additionalContext: mergedContext },\n    };\n  }\n\n  if (updatedInput) {\n    logHook(HOOK_NAME, 'updatedInput only \u2014 no context');\n    return outputWithUpdatedInput(updatedInput);\n  }\n\n  if (mergedContext) {\n    logHook(HOOK_NAME, `Merged ${contextParts.length} context(s)`);\n    return {\n      continue: true,\n      suppressOutput: true,\n      hookSpecificOutput: { additionalContext: mergedContext, hookEventName: 'PreToolUse' },\n    };\n  }\n\n  logHook(HOOK_NAME, 'All hooks silent');\n  return outputSilentSuccess();\n}\n\n/**\n * Consolidated sync Write|Edit PreToolUse dispatcher.\n *\n * Execution order:\n * 1. content-secret-scanner (can block \u2014 security critical)\n * 2. file-guard (can block \u2014 security critical)\n * 3. write-headers (input modifier \u2014 adds headers to new files)\n * 4. unified-quality-dispatcher (context producer)\n *\n * On first block: SHORT-CIRCUIT immediately.\n * On pass: merge additionalContext and updatedInput from all hooks.\n */\nexport function syncWriteEditDispatcher(input: HookInput): HookResult {\n  const contextParts: string[] = [];\n  let updatedInput: Record<string, unknown> | undefined;\n\n  for (const hook of WRITE_EDIT_HOOKS) {\n    try {\n      const result = hook.fn(input);\n\n      if (!result.continue) {\n        logHook(HOOK_NAME, `${hook.name} blocked \u2014 short-circuiting`);\n        return result;\n      }\n\n      if (result.hookSpecificOutput?.updatedInput) {\n        updatedInput = result.hookSpecificOutput.updatedInput as Record<string, unknown>;\n        logHook(HOOK_NAME, `${hook.name}: updatedInput collected`);\n      }\n\n      const context = extractContext(result);\n      if (context) {\n        contextParts.push(context);\n        logHook(HOOK_NAME, `${hook.name}: additionalContext collected`);\n      }\n    } catch (error) {\n      const msg = error instanceof Error ? error.message : String(error);\n      logHook(HOOK_NAME, `${hook.name} failed: ${msg}`, 'warn');\n    }\n  }\n\n  return buildMergedResult(contextParts, updatedInput);\n}\n", "// Generated by OrchestKit Claude Plugin\n// Created: 2026-02-28\n\n/**\n * Sync Task Dispatcher \u2014 PreToolUse Task Hook\n * Consolidates 2 Task PreToolUse hooks into a single dispatcher.\n *\n * Consolidated hooks (security-first order):\n * - unified-agent-safety-dispatcher (agent safety checks \u2014 FIRST)\n * - team-size-gate (limits team size \u2014 SECOND)\n *\n * SHORT-CIRCUIT: On first block, returns immediately without running remaining hooks.\n * Merges additionalContext from all passing hooks into a single output.\n *\n * CC 2.1.9 Compliant: Single PreToolUse dispatcher with merged additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, logHook, extractContext } from '../../lib/common.js';\n\n// Import consolidated hook implementations\nimport { unifiedAgentSafetyDispatcher } from './unified-agent-safety-dispatcher.js';\nimport { teamSizeGate } from './team-size-gate.js';\n\nconst HOOK_NAME = 'sync-task-dispatcher';\n\ninterface TaskHookConfig {\n  name: string;\n  fn: (input: HookInput) => HookResult;\n}\n\n/**\n * Registry of Task PreToolUse hooks, executed in security-first order.\n * Agent safety dispatcher runs first to catch all safety violations.\n */\nconst TASK_HOOKS: TaskHookConfig[] = [\n  { name: 'unified-agent-safety-dispatcher', fn: unifiedAgentSafetyDispatcher },\n  { name: 'team-size-gate', fn: teamSizeGate },\n];\n\n/**\n * Consolidated sync Task PreToolUse dispatcher.\n *\n * Execution order:\n * 1. unified-agent-safety-dispatcher (can block \u2014 agent safety checks)\n * 2. team-size-gate (can block \u2014 team size limits)\n *\n * On first block: SHORT-CIRCUIT immediately.\n * On pass: merge additionalContext from all hooks.\n */\nexport function syncTaskDispatcher(input: HookInput): HookResult {\n  const contextParts: string[] = [];\n\n  for (const hook of TASK_HOOKS) {\n    try {\n      const result = hook.fn(input);\n\n      if (!result.continue) {\n        logHook(HOOK_NAME, `${hook.name} blocked \u2014 short-circuiting`);\n        return result;\n      }\n\n      const context = extractContext(result);\n      if (context) {\n        contextParts.push(context);\n        logHook(HOOK_NAME, `${hook.name}: additionalContext collected`);\n      }\n    } catch (error) {\n      const msg = error instanceof Error ? error.message : String(error);\n      logHook(HOOK_NAME, `${hook.name} failed: ${msg}`, 'warn');\n    }\n  }\n\n  if (contextParts.length === 0) {\n    logHook(HOOK_NAME, 'All hooks silent');\n    return outputSilentSuccess();\n  }\n\n  const mergedContext = contextParts.join('\\n\\n---\\n\\n');\n  logHook(HOOK_NAME, `Merged ${contextParts.length} context(s)`);\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      additionalContext: mergedContext,\n      hookEventName: 'PreToolUse',\n    },\n  };\n}\n", "/**\n * PreTool Hooks Entry Point\n *\n * Hooks that run before tool execution (PreToolUse validation/modification)\n * Bundle: pretool.mjs (~70 KB estimated - largest bundle)\n */\n\n// Re-export types and utilities\nexport * from '../types.js';\nexport * from '../lib/common.js';\nexport * from '../lib/git.js';\nexport * from '../lib/guards.js';\n\n// PreTool/Bash hooks (20)\nimport { dangerousCommandBlocker } from '../pretool/bash/dangerous-command-blocker.js';\nimport { gitValidator } from '../pretool/bash/git-validator.js';\nimport { compoundCommandValidator } from '../pretool/bash/compound-command-validator.js';\nimport { defaultTimeoutSetter } from '../pretool/bash/default-timeout-setter.js';\nimport { errorPatternWarner } from '../pretool/bash/error-pattern-warner.js';\nimport { conflictPredictor } from '../pretool/bash/conflict-predictor.js';\nimport { affectedTestsFinder } from '../pretool/bash/affected-tests-finder.js';\nimport { ciSimulation } from '../pretool/bash/ci-simulation.js';\nimport { preCommitSimulation } from '../pretool/bash/pre-commit-simulation.js';\nimport { prMergeGate } from '../pretool/bash/pr-merge-gate.js';\nimport { changelogGenerator } from '../pretool/bash/changelog-generator.js';\nimport { versionSync } from '../pretool/bash/version-sync.js';\nimport { licenseCompliance } from '../pretool/bash/license-compliance.js';\nimport { ghIssueCreationGuide } from '../pretool/bash/gh-issue-creation-guide.js';\nimport { issueDocsRequirement } from '../pretool/bash/issue-docs-requirement.js';\nimport { multiInstanceQualityGate } from '../pretool/bash/multi-instance-quality-gate.js';\nimport { agentBrowserSafety } from '../pretool/bash/agent-browser-safety.js';\nimport { commitAtomicityChecker } from '../pretool/bash/commit-atomicity-checker.js';\nimport { issueReferenceChecker } from '../pretool/bash/issue-reference-checker.js';\n\n// PreTool/Write-Edit hooks (2)\nimport { contentSecretScanner } from '../pretool/write-edit/content-secret-scanner.js';\nimport { fileGuard } from '../pretool/write-edit/file-guard.js';\n\n// PreTool/Write hooks (4)\nimport { architectureChangeDetector } from '../pretool/Write/architecture-change-detector.js';\nimport { codeQualityGate } from '../pretool/Write/code-quality-gate.js';\nimport { docstringEnforcer } from '../pretool/Write/docstring-enforcer.js';\nimport { securityPatternValidator } from '../pretool/Write/security-pattern-validator.js';\n\n// PreTool/MCP hooks (3)\nimport { context7Tracker } from '../pretool/mcp/context7-tracker.js';\nimport { memoryValidator } from '../pretool/mcp/memory-validator.js';\nimport { notebooklmAdvisor } from '../pretool/mcp/notebooklm-advisor.js';\n\n// PreTool/InputMod hooks (1)\nimport { writeHeaders } from '../pretool/input-mod/write-headers.js';\n\n// PreTool/Skill hooks (1)\nimport { skillTracker } from '../pretool/skill/skill-tracker.js';\n\n// PreTool/Read hooks (1)\nimport { tldrSummary } from '../pretool/read/tldr-summary.js';\n\n// PreTool/Task hooks (1) \u2014 Agent Teams\nimport { teamSizeGate } from '../pretool/task/team-size-gate.js';\n\n// Unified dispatchers (3) \u2014 consolidate sequential hooks into single process\nimport { unifiedBashAdvisoryDispatcher } from '../pretool/bash/unified-advisory-dispatcher.js';\nimport { unifiedWriteEditQualityDispatcher } from '../pretool/write-edit/unified-quality-dispatcher.js';\nimport { unifiedAgentSafetyDispatcher } from '../pretool/task/unified-agent-safety-dispatcher.js';\n\n// Sync dispatchers (3) \u2014 consolidate per-matcher hooks into single process (#868)\nimport { syncBashDispatcher } from '../pretool/bash/sync-bash-dispatcher.js';\nimport { syncWriteEditDispatcher } from '../pretool/write-edit/sync-write-edit-dispatcher.js';\nimport { syncTaskDispatcher } from '../pretool/task/sync-task-dispatcher.js';\n\nimport type { HookFn } from '../types.js';\n\n/**\n * PreTool hooks registry\n */\nexport const hooks: Record<string, HookFn> = {\n  // PreTool/Bash hooks (20)\n  'pretool/bash/dangerous-command-blocker': dangerousCommandBlocker,\n  'pretool/bash/git-validator': gitValidator,\n  'pretool/bash/compound-command-validator': compoundCommandValidator,\n  'pretool/bash/default-timeout-setter': defaultTimeoutSetter,\n  'pretool/bash/error-pattern-warner': errorPatternWarner,\n  'pretool/bash/conflict-predictor': conflictPredictor,\n  'pretool/bash/affected-tests-finder': affectedTestsFinder,\n  'pretool/bash/ci-simulation': ciSimulation,\n  'pretool/bash/pre-commit-simulation': preCommitSimulation,\n  'pretool/bash/pr-merge-gate': prMergeGate,\n  'pretool/bash/changelog-generator': changelogGenerator,\n  'pretool/bash/version-sync': versionSync,\n  'pretool/bash/license-compliance': licenseCompliance,\n  'pretool/bash/gh-issue-creation-guide': ghIssueCreationGuide,\n  'pretool/bash/issue-docs-requirement': issueDocsRequirement,\n  'pretool/bash/multi-instance-quality-gate': multiInstanceQualityGate,\n  'pretool/bash/agent-browser-safety': agentBrowserSafety,\n  'pretool/bash/commit-atomicity-checker': commitAtomicityChecker,\n  'pretool/bash/issue-reference-checker': issueReferenceChecker,\n\n  // PreTool/Write-Edit hooks (2)\n  'pretool/write-edit/content-secret-scanner': contentSecretScanner,\n  'pretool/write-edit/file-guard': fileGuard,\n\n  // PreTool/Write hooks (4)\n  'pretool/Write/architecture-change-detector': architectureChangeDetector,\n  'pretool/Write/code-quality-gate': codeQualityGate,\n  'pretool/Write/docstring-enforcer': docstringEnforcer,\n  'pretool/Write/security-pattern-validator': securityPatternValidator,\n\n  // PreTool/MCP hooks (3)\n  'pretool/mcp/context7-tracker': context7Tracker,\n  'pretool/mcp/memory-validator': memoryValidator,\n  'pretool/mcp/notebooklm-advisor': notebooklmAdvisor,\n\n  // PreTool/InputMod hooks (1)\n  'pretool/input-mod/write-headers': writeHeaders,\n\n  // PreTool/Skill hooks (1)\n  'pretool/skill/skill-tracker': skillTracker,\n\n  // PreTool/Read hooks (1)\n  'pretool/read/tldr-summary': tldrSummary,\n\n  // PreTool/Task hooks (1) \u2014 Agent Teams\n  'pretool/task/team-size-gate': teamSizeGate,\n\n  // Unified dispatchers (3) \u2014 consolidate sequential hooks into single process\n  'pretool/bash/unified-advisory-dispatcher': unifiedBashAdvisoryDispatcher,\n  'pretool/write-edit/unified-quality-dispatcher': unifiedWriteEditQualityDispatcher,\n  'pretool/task/unified-agent-safety-dispatcher': unifiedAgentSafetyDispatcher,\n\n  // Sync dispatchers (3) \u2014 per-matcher consolidation (#868)\n  'pretool/bash/sync-bash-dispatcher': syncBashDispatcher,\n  'pretool/write-edit/sync-write-edit-dispatcher': syncWriteEditDispatcher,\n  'pretool/task/sync-task-dispatcher': syncTaskDispatcher,\n};\n\nexport function getHook(name: string): HookFn | undefined {\n  return hooks[name];\n}\n\nexport function listHooks(): string[] {\n  return Object.keys(hooks);\n}\n"],
  "mappings": "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",
  "names": ["isBashInput", "input", "isWriteInput", "isEditInput", "isReadInput", "existsSync", "statSync", "renameSync", "mkdirSync", "readSync", "appendFileSync", "mkdirSync", "dirname", "buffer", "flushing", "handlersRegistered", "bufferWrite", "filePath", "content", "ensureHandlers", "flush", "grouped", "entry", "arr", "path", "contents", "ensureHandlers", "handlersRegistered", "flush", "execSync", "os", "path", "getHomeDir", "getProjectDir", "getPluginRoot", "getLogDir", "path", "getHomeDir", "joinPath", "path", "pathSeparator", "execSync", "createHash", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "join", "basename", "MAX_PROJECT_LENGTH", "MAX_BRANCH_LENGTH", "SAFE_CHARS", "getProjectName", "projectDir", "dir", "name", "sanitizeName", "getGitBranchForSession", "branch", "sanitized", "formatDateComponent", "date", "d", "month", "day", "formatTimeComponent", "hours", "minutes", "generateShortHash", "entropy", "maxLength", "generateSmartSessionId", "project", "dateStr", "timeStr", "hash", "getCachedSessionId", "cachePath", "data", "age", "maxAge", "cacheSessionId", "sessionId", "instanceDir", "getOrGenerateSessionId", "cached", "newId", "getLogDir", "getProjectDir", "getPluginRoot", "getEnvFile", "getSessionId", "getOrGenerateSessionId", "getCachedBranch", "projectDir", "branch", "execSync", "getLogLevel", "normalizeLineEndings", "content", "shouldLog", "level", "levels", "outputSilentSuccess", "outputSilentAllow", "outputBlock", "reason", "outputWithContext", "ctx", "outputPromptContext", "outputWithNotification", "userMessage", "claudeContext", "result", "outputAllowWithContext", "systemMessage", "outputError", "message", "outputWarning", "outputStderrWarning", "outputDeny", "outputWithUpdatedInput", "updatedInput", "LOG_ROTATION_MAX_SIZE", "PERMISSION_LOG_MAX_SIZE", "rotateLogFile", "logFile", "maxSize", "existsSync", "statSync", "rotated", "renameSync", "ensureDir", "dir", "mkdirSync", "logHook", "hookName", "logDir", "timestamp", "bufferWrite", "logPermissionFeedback", "decision", "input", "toolName", "sessionId", "extractContext", "estimateTokenCount", "charsPerToken", "outputPromptContextBudgeted", "category", "budgetChecker", "tokenTracker", "tokens", "readHookInput", "chunks", "buf", "bytesRead", "fd", "readSync", "getField", "path", "parts", "value", "part", "lineContainsAll", "terms", "line", "t", "lineContainsAllCI", "lower", "normalizeCommand", "command", "escapeRegex", "str", "execSync", "getCurrentBranch", "projectDir", "dir", "getProjectDir", "execSync", "isProtectedBranch", "branch", "currentBranch", "getRepoRoot", "isGitRepo", "getGitStatus", "hasUncommittedChanges", "getDefaultBranch", "extractIssueNumber", "patterns", "pattern", "match", "getStagedFiles", "output", "f", "analyzeStagedChanges", "files", "directories", "extensions", "hasTests", "hasConfig", "hasDocs", "hasSource", "file", "parts", "ext", "validateBranchName", "validPrefixes", "prefix", "existsSync", "readFileSync", "readdirSync", "statSync", "rmSync", "join", "isAgentTeamsActive", "getTeamName", "getTeamMembers", "teamName", "homeDir", "configPath", "join", "existsSync", "members", "readFileSync", "m", "isStaleTeam", "teamName", "maxAgeHours", "homeDir", "teamPath", "join", "existsSync", "configPath", "statSync", "cleanupTeam", "ok", "sub", "dir", "rmSync", "globMatch", "glob", "str", "parts", "pos", "part", "searchPart", "matched", "i", "ok", "j", "idx", "createGuard", "predicate", "input", "outputSilentSuccess", "guardFileExtension", "extensions", "filePath", "ext", "e", "guardCodeFiles", "guardPythonFiles", "guardTypescriptFiles", "guardTestFiles", "p", "guardSkipInternal", "guardPathPattern", "patterns", "pattern", "guardTool", "tools", "toolName", "guardWriteEdit", "guardBash", "guardNontrivialBash", "command", "guardGitCommand", "guardMultiInstance", "isAgentTeamsActive", "dbPath", "existsSync", "runGuards", "guards", "guard", "result", "isDontAskMode", "expandHexEscapes", "cmd", "_match", "hex", "expandOctalEscapes", "oct", "stripBackslashEscapes", "stripQuotes", "result", "normalizeSingle", "cmd", "result", "expandHexEscapes", "expandOctalEscapes", "stripBackslashEscapes", "stripQuotes", "normalizeCommand", "preprocessed", "p", "containsDangerousCommand", "patterns", "subCommands", "sub", "lowerSub", "pattern", "detectSuspiciousShellFeatures", "findings", "braceMatch", "m", "firstElement", "isLikelyExtension", "hasPathChars", "braceIdx", "charBefore", "DANGEROUS_PATTERNS", "DANGEROUS_REGEX_PATTERNS", "PIPE_TO_SHELL_RE", "GIT_FORCE_PUSH_RE", "dangerousCommandBlocker", "input", "command", "outputSilentSuccess", "dangerousCheck", "containsDangerousCommand", "pattern", "logHook", "logPermissionFeedback", "outputDeny", "normalizedForRegex", "normalizeCommand", "label", "normalizedCommand", "reason", "VALID_COMMIT_TYPES", "STAGED_FILE_WARNING_THRESHOLD", "extractCommitMessage", "command", "quotedMatch", "unquotedMatch", "extractNewBranchName", "checkoutMatch", "branchMatch", "validateBranchProtection", "currentBranch", "isProtectedBranch", "errorMsg", "logPermissionFeedback", "outputDeny", "outputWithContext", "validateBranchNaming", "branchName", "validationError", "validateBranchName", "context", "outputAllowWithContext", "validateCommitMessage", "commitMsg", "typesPattern", "conventionalPattern", "simplePattern", "titleLen", "validateAtomicCommit", "projectDir", "analysis", "analyzeStagedChanges", "warnings", "concerns", "topLevelDirs", "f", "d", "declaredType", "w", "gitValidator", "input", "outputSilentSuccess", "getCachedBranch", "logHook", "protectionResult", "commitMsgResult", "branchNameResult", "atomicResult", "contexts", "compoundCommandValidator", "input", "command", "outputSilentSuccess", "suspiciousFeatures", "detectSuspiciousShellFeatures", "reason", "logPermissionFeedback", "logHook", "outputDeny", "DEFAULT_TIMEOUT", "defaultTimeoutSetter", "input", "command", "timeout", "description", "updated", "logHook", "outputWithUpdatedInput", "existsSync", "readFileSync", "join", "loadErrorRules", "projectDir", "rulesFile", "countCommonWords", "str1", "str2", "words1", "words2", "count", "word", "errorPatternWarner", "input", "getProjectDir", "command", "outputSilentSuccess", "rules", "hints", "r", "rule", "sampleCommand", "logHook", "contextMsg", "outputWithContext", "execSync", "SAFE_ARG_RE", "assertSafeShellArg", "arg", "label", "assertSafeGitRef", "ref", "label", "getPotentialConflicts", "projectDir", "targetBranch", "safeBranch", "assertSafeGitRef", "changedFiles", "execSync", "conflicts", "file", "safeFile", "assertSafeShellArg", "conflictPredictor", "input", "command", "getProjectDir", "outputSilentSuccess", "branchMatch", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "execSync", "existsSync", "join", "basename", "dirname", "findRelatedTests", "projectDir", "sourceFile", "tests", "baseName", "dirName", "testPatterns", "pattern", "fullPath", "getChangedFiles", "line", "file", "affectedTestsFinder", "input", "command", "getProjectDir", "outputSilentSuccess", "changedFiles", "relatedTests", "uniqueTests", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "join", "detectCIChecks", "projectDir", "checks", "ciSimulation", "input", "command", "getProjectDir", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "join", "hasPreCommitConfig", "projectDir", "hasHuskyConfig", "preCommitSimulation", "input", "command", "getProjectDir", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "execSync", "getPRStatus", "projectDir", "prNumber", "prArg", "result", "prMergeGate", "input", "command", "getProjectDir", "outputSilentSuccess", "prMatch", "status", "context", "logPermissionFeedback", "outputAllowWithContext", "issues", "logHook", "execSync", "getRecentCommits", "projectDir", "since", "sinceArg", "groupCommitsByType", "commits", "groups", "commit", "match", "type", "changelogGenerator", "input", "command", "getProjectDir", "outputSilentSuccess", "sections", "combined", "c", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "getPackageJsonVersion", "projectDir", "filePath", "getPyprojectVersion", "match", "getVersionSources", "sources", "pkgVersion", "pyVersion", "versionSync", "input", "command", "getProjectDir", "outputSilentSuccess", "versions", "s", "uniqueVersions", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "PROBLEMATIC_LICENSES", "checkNpmLicenses", "projectDir", "issues", "lockFile", "content", "license", "licenseCompliance", "input", "command", "getProjectDir", "outputSilentSuccess", "pkgMatch", "pkgName", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "ISSUE_TEMPLATES", "detectIssueType", "command", "ghIssueCreationGuide", "input", "outputSilentSuccess", "issueType", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "DOCS_CHECKLIST", "issueDocsRequirement", "input", "command", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "isMultiInstanceEnabled", "projectDir", "dbPath", "getQualityGateStatus", "registryPath", "multiInstanceQualityGate", "input", "isAgentTeamsActive", "outputSilentSuccess", "command", "getProjectDir", "gates", "failedGates", "gate", "context", "g", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "join", "execFileSync", "RATE_LIMITS", "ROBOTS_CACHE_TTL", "BLOCKED_URL_PATTERNS", "SENSITIVE_ACTIONS", "getRateLimitFile", "logDir", "getLogDir", "rateDir", "loadRateLimitStore", "file", "saveRateLimitStore", "store", "extractDomain", "url", "checkRateLimit", "domain", "now", "record", "oneMinuteAgo", "oneHourAgo", "t", "requestsLastMinute", "requestsLastHour", "lastThreeSeconds", "getRobotsCacheFile", "cacheDir", "loadRobotsCache", "saveRobotsCache", "cache", "parseRobotsTxt", "content", "disallowed", "inWildcardSection", "lines", "line", "trimmed", "path", "fetchRobotsTxt", "origin", "cached", "robotsUrl", "result", "entry", "isAllowedByRobots", "parsed", "robots", "escaped", "extractUrl", "command", "urlMatch", "isBlockedUrl", "pattern", "isSensitiveAction", "agentBrowserSafety", "input", "outputSilentSuccess", "logPermissionFeedback", "logHook", "outputDeny", "rateCheck", "robotsCheck", "context", "outputAllowWithContext", "execSync", "HOOK_NAME", "MAX_FILES", "MAX_DIRS", "CATEGORY_PREFIXES", "getCategory", "filePath", "prefix", "category", "extractCommitMessage", "command", "patterns", "pattern", "match", "getStagedFiles", "cwd", "execSync", "logHook", "collectWarnings", "stagedFiles", "warnings", "topLevelDirs", "f", "categories", "message", "commitAtomicityChecker", "input", "outputSilentSuccess", "getProjectDir", "context", "w", "outputAllowWithContext", "extractCommitMessage", "command", "match", "extractIssueNumber", "branch", "messageReferencesIssue", "message", "issueNum", "issueReferenceChecker", "input", "outputSilentSuccess", "commitMessage", "getCachedBranch", "outputAllowWithContext", "basename", "extname", "SECRET_PATTERNS", "CONTEXTUAL_SECRET_PATTERN", "EXCLUDED_EXTENSIONS", "isExcludedPath", "filePath", "ext", "lowerPath", "scanForSecrets", "content", "name", "regex", "match", "snippet", "ctxMatch", "contentSecretScanner", "input", "toolName", "outputSilentSuccess", "finding", "fileName", "logPermissionFeedback", "logHook", "outputDeny", "realpathSync", "existsSync", "resolve", "isAbsolute", "extname", "basename", "MAX_FILE_LINES", "MAX_TEST_FILE_LINES", "CODE_EXTENSIONS", "isTestFile", "filePath", "name", "detectBloatPatterns", "content", "signals", "lines", "exportCount", "l", "hasTypes", "hasFunctions", "hasClasses", "importCount", "classCount", "componentCount", "s", "checkFileSizeAndBloat", "input", "ext", "lineCount", "limit", "bloatSignals", "fileType", "bloatDetails", "outputDeny", "logHook", "PROTECTED_PATTERNS", "CONFIG_PATTERNS", "resolveRealPath", "projectDir", "absolutePath", "isProtected", "realPath", "pattern", "isConfigFile", "fileGuard", "getProjectDir", "outputSilentSuccess", "matchedPattern", "logPermissionFeedback", "sizeResult", "existsSync", "readFileSync", "join", "LAYER_PATTERNS", "detectArchLayer", "filePath", "layer", "patterns", "p", "loadPatternHints", "projectDir", "patternsDir", "layerPatternFile", "content", "count", "architectureChangeDetector", "input", "getProjectDir", "outputSilentSuccess", "guardResult", "guardPathPattern", "archLayer", "patternHints", "isNewFile", "archContext", "logPermissionFeedback", "logHook", "isDontAskMode", "outputWarning", "outputWithContext", "existsSync", "readFileSync", "join", "extname", "basename", "MAX_FUNCTION_LINES", "MAX_NESTING_DEPTH", "MAX_CONDITIONALS_PER_FUNCTION", "getFileExt", "filePath", "checkFunctionLength", "content", "ext", "warnings", "lines", "inFunction", "functionName", "functionLines", "line", "defMatch", "classMatch", "braceCount", "funcMatch", "constFuncMatch", "openBraces", "closeBraces", "checkNestingDepth", "maxDepth", "match", "indent", "depth", "braceDepth", "checkConditionals", "ifCount", "switchCount", "ternaryCount", "totalConditionals", "functionCount", "avgConditionals", "getCachedTypeErrors", "projectDir", "cacheFile", "cache", "fileBasename", "codeQualityGate", "input", "getProjectDir", "guardResult", "runGuards", "guardCodeFiles", "guardSkipInternal", "outputSilentSuccess", "allWarnings", "typeErrors", "logHook", "qualityMsg", "isDontAskMode", "outputWarning", "outputWithContext", "extname", "getFileExt", "filePath", "isTestFile", "p", "findMissingPythonDocstrings", "content", "missing", "lines", "i", "trimmed", "funcMatch", "funcName", "hasDocstring", "j", "nextLine", "findMissingJSDoc", "hasJSDoc", "line", "exportMatch", "docstringEnforcer", "input", "guardResult", "runGuards", "guardCodeFiles", "guardSkipInternal", "outputSilentSuccess", "ext", "missingDocstrings", "funcList", "contextMsg", "logHook", "isDontAskMode", "outputWarning", "outputWithContext", "basename", "SECURITY_PATTERNS", "s", "detectSecurityIssues", "content", "issues", "name", "pattern", "securityPatternValidator", "input", "filePath", "guardResult", "runGuards", "guardCodeFiles", "outputSilentSuccess", "securityIssues", "logHook", "warningMsg", "logPermissionFeedback", "outputWithContext", "existsSync", "readFileSync", "statSync", "renameSync", "mkdirSync", "join", "MAX_LOG_SIZE", "MAX_QUERIES_PER_SESSION", "MAX_QUERIES_PER_MINUTE", "RATE_WINDOW_MS", "getTelemetryLog", "logDir", "getLogDir", "rotateLogIfNeeded", "logFile", "existsSync", "statSync", "renameSync", "calculateCacheContext", "lines", "readFileSync", "totalQueries", "librarySet", "line", "match", "recentLibraries", "i", "recentStr", "checkRateLimits", "now", "recentCount", "tsMatch", "ts", "context7Tracker", "input", "toolName", "outputSilentSuccess", "libraryId", "query", "mkdirSync", "telemetryLog", "rateLimitMsg", "logPermissionFeedback", "logHook", "outputDeny", "logEntry", "bufferWrite", "cacheContext", "outputWithContext", "MAX_ENTITY_NAME_LENGTH", "MAX_OBSERVATION_LENGTH", "MAX_OBSERVATIONS_PER_ENTITY", "KNOWN_ENTITY_TYPES", "validateEntitySizes", "entities", "entity", "name", "observations", "obs", "obsStr", "checkEntityTypes", "unknownTypes", "entityType", "validateObservationSizes", "observationsInput", "entry", "contents", "memoryValidator", "input", "toolName", "outputSilentSuccess", "entityNames", "entityCount", "logPermissionFeedback", "logHook", "outputWarning", "relations", "relationCount", "invalidCount", "e", "sizeError", "outputDeny", "obsError", "HOOK_NAME", "SLOW_OPS", "WARN_OPS", "notebooklmAdvisor", "input", "toolName", "outputSilentSuccess", "op", "logHook", "outputWithContext", "outputWarning", "text", "existsSync", "extname", "getCurrentDate", "addHeader", "ext", "content", "date", "firstNewline", "shebang", "rest", "createUpdatedInputResult", "filePath", "outputWithUpdatedInput", "writeHeaders", "input", "toolName", "outputSilentSuccess", "logHook", "updatedContent", "existsSync", "mkdirSync", "join", "dirname", "basename", "ensureDir", "dir", "existsSync", "mkdirSync", "appendSafe", "file", "content", "bufferWrite", "skillTracker", "input", "skillName", "skillArgs", "projectDir", "getProjectDir", "outputSilentSuccess", "logHook", "usageLog", "timestamp", "analyticsLog", "analyticsEntry", "existsSync", "readFileSync", "statSync", "EXT_TO_LANG", "isSummarizable", "ext", "extractTypeScript", "content", "lines", "imports", "functions", "classes", "types", "exports", "line", "trimmed", "extractPython", "prevLineDecorator", "m", "sig", "className", "extractGo", "inImportBlock", "extractRust", "extractShell", "variables", "varSet", "extractMarkdown", "sections", "EXTRACTORS", "SUMMARY_CHAR_BUDGET", "langLabel", "lang", "formatSection", "label", "items", "indent", "header", "itemLines", "i", "truncateToFit", "budget", "result", "section", "summarizeCode", "filePath", "dotIdx", "extractor", "structure", "lineCount", "tokenEst", "estimateTokenCount", "bodySections", "bodyBudget", "body", "HOOK_NAME", "LINE_THRESHOLD", "TOKEN_THRESHOLD", "MAX_FILE_SIZE", "summarizedThisSession", "tldrSummary", "input", "toolInput", "filePath", "outputSilentSuccess", "logHook", "dotIdx", "ext", "isSummarizable", "existsSync", "stats", "statSync", "content", "readFileSync", "lineCount", "tokenCount", "estimateTokenCount", "summary", "summarizeCode", "outputAllowWithContext", "err", "MAX_TEAM_SIZE", "MAX_OPUS_MEMBERS", "teamSizeGate", "input", "toolInput", "teamName", "outputSilentSuccess", "isStaleTeam", "cleanupTeam", "logHook", "model", "description", "members", "getTeamMembers", "currentSize", "outputDeny", "opusCount", "m", "HOOK_NAME", "MAX_OUTPUT_TOKENS", "ADVISORY_HOOKS", "errorPatternWarner", "issueDocsRequirement", "multiInstanceQualityGate", "ghIssueCreationGuide", "affectedTestsFinder", "unifiedBashAdvisoryDispatcher", "input", "updatedInput", "timeoutResult", "defaultTimeoutSetter", "error", "message", "logHook", "HOOK_NAME", "browserResult", "agentBrowserSafety", "browserContext", "extractContext", "mergeAdvisoryContext", "prependContext", "contextParts", "totalTokens", "tokens", "estimateTokenCount", "hook", "ADVISORY_HOOKS", "result", "context", "contextTokens", "MAX_OUTPUT_TOKENS", "consolidated", "outputWithUpdatedInput", "outputAllowWithContext", "outputSilentSuccess", "HOOK_NAME", "MAX_OUTPUT_TOKENS", "QUALITY_HOOKS", "architectureChangeDetector", "unifiedWriteEditQualityDispatcher", "input", "securityResult", "securityPatternValidator", "securityContext", "extractContext", "mergeQualityContext", "error", "message", "logHook", "HOOK_NAME", "prependContext", "contextParts", "totalTokens", "tokens", "estimateTokenCount", "hook", "QUALITY_HOOKS", "result", "context", "contextTokens", "MAX_OUTPUT_TOKENS", "outputSilentSuccess", "consolidated", "outputAllowWithContext", "blockWrites", "input", "toolName", "agentId", "outputDeny", "outputSilentSuccess", "DANGEROUS_PATTERNS", "s", "migrationSafetyCheck", "input", "outputSilentSuccess", "rawCommand", "command", "normalizeSingle", "pattern", "outputDeny", "mkdirSync", "securityCommandAudit", "input", "agentId", "toolName", "sessionId", "getSessionId", "projectDir", "getProjectDir", "logFile", "outputSilentSuccess", "command", "timestamp", "mkdirSync", "bufferWrite", "DANGEROUS_PATTERNS", "cmd", "lineContainsAllCI", "ciSafetyCheck", "input", "rawCommand", "command", "normalizeSingle", "pattern", "outputDeny", "outputWithContext", "outputSilentSuccess", "PRODUCTION_PATTERNS", "cmd", "deploymentSafetyCheck", "input", "command", "pattern", "outputDeny", "outputWithContext", "outputSilentSuccess", "HOOK_NAME", "MAX_OUTPUT_TOKENS", "SAFETY_HOOKS", "blockWrites", "migrationSafetyCheck", "ciSafetyCheck", "deploymentSafetyCheck", "securityCommandAudit", "unifiedAgentSafetyDispatcher", "input", "contextParts", "totalTokens", "hook", "SAFETY_HOOKS", "result", "logHook", "HOOK_NAME", "context", "extractContext", "contextTokens", "estimateTokenCount", "MAX_OUTPUT_TOKENS", "error", "message", "outputSilentSuccess", "consolidated", "outputAllowWithContext", "HOOK_NAME", "BASH_HOOKS", "dangerousCommandBlocker", "compoundCommandValidator", "unifiedBashAdvisoryDispatcher", "buildMergedResult", "contextParts", "updatedInput", "mergedContext", "logHook", "outputWithUpdatedInput", "outputSilentSuccess", "syncBashDispatcher", "input", "hook", "result", "context", "extractContext", "error", "msg", "HOOK_NAME", "WRITE_EDIT_HOOKS", "contentSecretScanner", "fileGuard", "writeHeaders", "unifiedWriteEditQualityDispatcher", "buildMergedResult", "contextParts", "updatedInput", "mergedContext", "logHook", "outputWithUpdatedInput", "outputSilentSuccess", "syncWriteEditDispatcher", "input", "hook", "result", "context", "extractContext", "error", "msg", "HOOK_NAME", "TASK_HOOKS", "unifiedAgentSafetyDispatcher", "teamSizeGate", "syncTaskDispatcher", "input", "contextParts", "hook", "result", "logHook", "context", "extractContext", "error", "msg", "outputSilentSuccess", "mergedContext", "hooks", "dangerousCommandBlocker", "gitValidator", "compoundCommandValidator", "defaultTimeoutSetter", "errorPatternWarner", "conflictPredictor", "affectedTestsFinder", "ciSimulation", "preCommitSimulation", "prMergeGate", "changelogGenerator", "versionSync", "licenseCompliance", "ghIssueCreationGuide", "issueDocsRequirement", "multiInstanceQualityGate", "agentBrowserSafety", "commitAtomicityChecker", "issueReferenceChecker", "contentSecretScanner", "fileGuard", "architectureChangeDetector", "codeQualityGate", "docstringEnforcer", "securityPatternValidator", "context7Tracker", "memoryValidator", "notebooklmAdvisor", "writeHeaders", "skillTracker", "tldrSummary", "teamSizeGate", "unifiedBashAdvisoryDispatcher", "unifiedWriteEditQualityDispatcher", "unifiedAgentSafetyDispatcher", "syncBashDispatcher", "syncWriteEditDispatcher", "syncTaskDispatcher", "getHook", "name", "listHooks"]
}
