// OrchestKit Hooks - pretool bundle
// Generated: 2026-02-06T18:21:40.191Z

var ye=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Cr(t){return typeof t.command=="string"}function Ir(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function Hr(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Er(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as tt,existsSync as et,statSync as je,renameSync as Ne,mkdirSync as Fe,readSync as Me}from"node:fs";import{execSync as Be}from"node:child_process";import ke from"node:os";import E from"node:path";function Se(){return process.env.HOME||process.env.USERPROFILE||ke.homedir()}function N(){return process.env.CLAUDE_PROJECT_DIR||"."}function Z(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function Q(){return process.env.CLAUDE_PLUGIN_ROOT?E.join(Se(),".claude","logs","ork"):E.join(N(),".claude","logs")}var Dr=E.join,Or=E.sep;import{execSync as _e}from"node:child_process";import{createHash as xe}from"node:crypto";import{existsSync as X,readFileSync as be,writeFileSync as Re,mkdirSync as $e}from"node:fs";import{join as F,basename as we}from"node:path";var Ce=20,Ie=15,He=/[^a-z0-9-]/g;function Ee(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=we(e);return Y(n,Ce)}function ve(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=_e("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=Y(n||"detached",Ie);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function Pe(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function Te(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function De(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return xe("sha256").update(t).digest("hex").slice(0,4)}function Y(t,e){return t.toLowerCase().replace(He,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function Oe(t,e){let n=Ee(t),o=ve(t),s=Pe(e),r=Te(e),i=De();return`${n}-${o}-${s}-${r}-${i}`}function Ae(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=F(e,".instance","session-id.json");if(X(n))try{let o=JSON.parse(be(n,"utf8"));if(o.session_id&&o.created_at){let s=Date.now()-new Date(o.created_at).getTime(),r=1440*60*1e3;if(s<r)return o.session_id}}catch{}}function Le(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=F(n,".instance"),s=F(o,"session-id.json");try{X(o)||$e(o,{recursive:!0}),Re(s,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function v(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=Ae(t);if(e)return e;let n=Oe(t);return Le(n,t),n}function x(){return Q()}function m(){return N()}function Ge(){return Z()}function qr(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${Ge()}/.claude/.instance_env`}function I(){return v()}function nt(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=Be("git branch --show-current",{cwd:t||m(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function We(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function zr(t){return t.replace(/\r\n/g,`
`)}function Ue(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(We())}function c(){return{continue:!0,suppressOutput:!0}}function Kr(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function Jr(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function h(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function qe(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function Vr(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function d(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function Zr(t){return{continue:!0,systemMessage:t}}function k(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function f(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function P(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var ze=200*1024,Ke=100*1024;function ot(t,e){if(et(t))try{if(je(t).size>e){let o=`${t}.old.${Date.now()}`;Ne(t,o)}}catch{}}function rt(t){et(t)||Fe(t,{recursive:!0})}function u(t,e,n="debug"){if(!Ue(n))return;let o=x(),s=`${o}/hooks.log`;try{rt(o),ot(s,ze);let r=new Date().toISOString().replace("T"," ").slice(0,19);tt(s,`[${r}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function l(t,e,n){let o=x(),s=`${o}/permission-feedback.log`;try{rt(o),ot(s,Ke);let r=new Date().toISOString(),i=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=n?.session_id||I();tt(s,`${r} | ${t} | ${e} | tool=${i} | session=${a}
`)}catch{}}function Je(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function Qr(t,e,n,o,s){let r=Je(t);return o&&o.isOverBudget(n)?(u(e,`Budget exhausted for ${n}, suppressing ${r}t`),c()):(s&&s.trackTokenUsage(e,n,r),qe(t))}function Xr(){try{let t=[],n=Buffer.allocUnsafe(256),o,s=0;for(;;)try{if(o=Me(s,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let r=Buffer.concat(t).toString("utf8").trim();return r?JSON.parse(r):{tool_name:"",session_id:I(),tool_input:{}}}catch{return{tool_name:"",session_id:I(),tool_input:{}}}}function Yr(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let s of n){if(o==null)return;o=o[s]}return o}function T(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function ts(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as R}from"node:child_process";function Ve(t){let e=t||m();try{return R("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function M(t){let e=t||Ve();return["dev","main","master"].includes(e)}function rs(t){let e=t||m();try{return R("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function ss(t){let e=t||m();try{return R("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function B(t){let e=t||m();try{return R("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function is(t){return B(t).length>0}function cs(t){let e=t||m();try{return R("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return R("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function Ze(t){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let n of e){let o=t.match(n);if(o)return parseInt(o[1],10)}return null}function st(t){if(M(t))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(o=>t.startsWith(o))?t.startsWith("issue/")&&!Ze(t)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}function ls(t){return e=>t(e)?null:c()}function G(t,...e){let n=t.tool_input.file_path;if(!n)return c();let o=n.split(".").pop()?.toLowerCase()||"";return e.map(r=>r.toLowerCase().replace(/^\./,"")).includes(o)?null:c()}function $(t){return G(t,"py","ts","tsx","js","jsx","go","rs","java")}function ps(t){return G(t,"py")}function ms(t){return G(t,"ts","tsx","js","jsx")}function ds(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(o=>o.test(e))?null:c():c()}function D(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(o=>o.test(e))?c():null}function it(t,...e){let n=t.tool_input.file_path;if(!n)return c();for(let o of e)if(typeof o=="string"){if(new RegExp(o.replace(/\*/g,".*").replace(/\?/g,".")).test(n))return null}else if(o.test(n))return null;return c()}function ct(t,...e){let n=t.tool_name;return n?e.includes(n)?null:c():c()}function at(t){return ct(t,"Write","Edit")}function fs(t){return ct(t,"Bash")}function gs(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(o=>o.test(e))?c():null}function hs(t){return(t.tool_input.command||"").startsWith("git")?null:c()}function ys(t){let n=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:o}=ye("node:fs");if(o(n))return null}catch{}return c()}function w(t,...e){for(let n of e){let o=n(t);if(o!==null)return o}return null}function C(t){return t.permissionMode==="dontAsk"}var Qe=["rm -rf /","rm -rf ~","rm -fr /","rm -fr ~","mv /* /dev/null","> /dev/sda","mkfs.","dd if=/dev/zero of=/dev/","dd if=/dev/random of=/dev/","chmod -R 777 /",":(){:|:&};:","git reset --hard","git clean -fd","drop database","drop schema","truncate table"],Xe=/\|\s*(sh|bash|zsh|dash)\b/i,Ye=/git\s+push\s+.*(-f|--force)\b/i;function ut(t){let e=t.tool_input.command||"";if(!e)return c();let n=T(e).toLowerCase();for(let o of Qe)if(n.includes(o.toLowerCase()))return u("dangerous-command-blocker",`BLOCKED: Dangerous pattern: ${o}`),l("deny",`Dangerous pattern: ${o}`,t),f(`Command matches dangerous pattern: ${o}

This command could cause severe system damage and has been blocked.`);if(Xe.test(n)){let o="Piping to shell interpreter detected";return u("dangerous-command-blocker",`BLOCKED: ${o}`),l("deny",o,t),f(`${o}

Piping untrusted content to a shell interpreter is dangerous and has been blocked.`)}if(Ye.test(n)){let o="Git force-push detected (rewrites remote history)";return u("dangerous-command-blocker",`BLOCKED: ${o}`),l("deny",o,t),f(`${o}

Force-pushing can destroy remote commit history and has been blocked.`)}return c()}var W=["feat","fix","refactor","docs","test","chore","style","perf","ci","build"],tn=10;function en(t){let e=t.match(/-m\s+["']([^"']+)["']/);if(e)return e[1];let n=t.match(/-m\s+(\S+)/);return n?n[1]:null}function nn(t){let e=t.match(/checkout\s+-b\s+(\S+)/);if(e)return e[1];let n=t.match(/git\s+branch\s+(\S+)/);return n?n[1]:null}function on(t,e){if(!M(e))return null;if(/git\s+(commit|push)/.test(t)){let n=`BLOCKED: Cannot commit or push directly to '${e}' branch.

Required workflow:
1. git checkout -b issue/<number>-<description>
2. git commit -m "feat(#<number>): Description"
3. git push -u origin issue/<number>-<description>
4. gh pr create --base dev`;return l("deny",`Blocked on protected branch: ${e}`),f(n)}return h(`On protected branch '${e}'. Create feature branch for changes.`)}function rn(t){if(!/git\s+(checkout\s+-b|branch\s+)/.test(t))return null;let e=nn(t);if(!e)return null;let n=st(e);if(n){let o=`Branch naming: ${n}

Recommended: issue/123-description, feature/xyz, fix/bug-name`;return l("allow",`Branch naming guidance: ${e}`),d(o)}return null}function sn(t){if(!/^git\s+commit/.test(t))return null;if(/<<['"]?EOF/.test(t))return d(`Heredoc commit. Use: type(#issue): description
Types: ${W.join(", ")}
End with: Co-Authored-By: Claude <noreply@anthropic.com>`);let e=en(t);if(!e)return d("Interactive commit. Use: type(#issue): description");let n=W.join("|"),o=new RegExp(`^(${n})(\\(#?[0-9]+\\)|(\\([a-z-]+\\)))?: .+`),s=new RegExp(`^(${n}): .+`);if(o.test(e)||s.test(e)){let i=e.split(`
`)[0].length;return i>72?d(`Commit title is ${i} chars (max 72 recommended)`):null}let r=`INVALID COMMIT FORMAT: "${e}"

Required: type(#issue): description
Types: ${W.join(", ")}
Example: feat(#123): Add user authentication`;return l("deny",`Invalid commit: ${e}`),f(r)}function cn(t,e){if(!/^git\s+commit/.test(t))return null;let o=B(e).split(`
`).filter(s=>s.trim()).length;return o>tn?d(`Large commit: ${o} files. Consider splitting into smaller commits.`):null}function lt(t){let e=t.tool_input.command||"";if(!e.startsWith("git"))return c();let n=nt(t.project_dir);u("git-validator",`Validating: ${e.slice(0,50)}...`);let o=on(e,n);if(o?.continue===!1)return o;let s=sn(e);if(s?.continue===!1)return s;let r=rn(e),i=cn(e,t.project_dir),a=[];return o?.hookSpecificOutput?.additionalContext&&a.push(o.hookSpecificOutput.additionalContext),s?.hookSpecificOutput?.additionalContext&&a.push(s.hookSpecificOutput.additionalContext),r?.hookSpecificOutput?.additionalContext&&a.push(r.hookSpecificOutput.additionalContext),i?.hookSpecificOutput?.additionalContext&&a.push(i.hookSpecificOutput.additionalContext),a.length>0?h(a.join(`

`)):c()}var an=["rm -rf /","rm -rf ~","rm -fr /","rm -fr ~","mkfs","dd if=/dev","> /dev/sd","chmod -R 777 /"];function un(t){let e=t.trim();if(!e)return!0;for(let n of an)if(e.includes(n))return!1;return!0}function ln(t){if(/curl.*\|.*(sh|bash)/.test(t)||/wget.*\|.*(sh|bash)/.test(t))return"pipe-to-shell execution (curl/wget piped to sh/bash)";if(!t.includes("&&")&&!t.includes("||")&&!t.includes("|")&&!t.includes(";"))return null;let e=t.split(/&&|\|\||[|;]/);for(let n of e)if(!un(n))return n.trim();return null}function pt(t){let e=t.tool_input.command||"";if(!e)return c();let n=T(e),o=ln(n);if(o){let s=`BLOCKED: Dangerous compound command detected.

Blocked segment: ${o}

The command contains a potentially destructive operation.

Please review and modify your command to remove the dangerous operation.`;return l("deny",`Dangerous compound command: ${o}`,t),u("compound-command-validator",`BLOCKED: ${o}`),f(s)}return l("allow","Compound command validated: safe",t),c()}var mt=12e4;function dt(t){let e=t.tool_input.command||"",n=t.tool_input.timeout,o=t.tool_input.description;if(typeof n=="number"&&n>0)return{continue:!0,suppressOutput:!0};let s={command:e,timeout:mt};return o&&typeof o=="string"&&(s.description=o),u("default-timeout-setter",`Setting default timeout: ${mt}ms`),P(s)}import{existsSync as pn,readFileSync as mn}from"node:fs";import{join as dn}from"node:path";function fn(t){let e=dn(t,".claude","rules","error_rules.json");try{if(pn(e))return JSON.parse(mn(e,"utf8")).rules||[]}catch{}return[]}function gn(t,e){let n=new Set(t.toLowerCase().split(/\s+/)),o=new Set(e.toLowerCase().split(/\s+/)),s=0;for(let r of n)o.has(r)&&r.length>2&&s++;return s}function ft(t){let e=m(),n=t.tool_input.command||"";if(!n)return c();let o=fn(e);if(o.length===0)return c();let s=[];/psql.*-U\s+(postgres|orchestkit|root)/.test(n)&&o.filter(i=>i.tool==="Bash"&&i.signature?.includes("role")).length>0&&s.push("DB role error: use docker exec -it <container> psql -U orchestkit_user"),n.includes("mcp__postgres")&&o.filter(i=>i.tool?.includes("postgres-mcp")).length>0&&s.push("MCP postgres: verify connection to correct database");for(let r of o){if(!r.pattern||(r.occurrence_count||0)<5)continue;let i=r.sample_input?.command;i&&gn(n,i)>3&&(u("error-pattern-warner",`Pattern match: ${r.signature}`),r.suggested_fix?s.push(`${r.signature} (${r.occurrence_count}x): ${r.suggested_fix}`):s.push(`${r.signature} (${r.occurrence_count}x)`))}if(s.length>0){let r="Learned error patterns | "+s.join(" | ");return r.length>200&&(r=r.slice(0,197)+"..."),h(r)}return c()}import{execSync as gt}from"node:child_process";function hn(t,e){try{let o=gt(`git diff --name-only ${e}...HEAD 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim().split(`
`).filter(Boolean),s=[];for(let r of o.slice(0,20))try{gt(`git log -1 --pretty=format:"%h" ${e} -- "${r}" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()&&s.push(r)}catch{}return s}catch{return[]}}function ht(t){let e=t.tool_input.command||"",n=m();if(!/git\s+(merge|rebase|pull)/.test(e))return c();let o=null,s=e.match(/git\s+(merge|rebase)\s+(\S+)/);if(s&&(o=s[2]),e.includes("git pull")&&(o="origin/dev"),!o)return c();let r=hn(n,o);if(r.length>0){let i=`Potential conflicts detected: ${r.length} file(s)
Files: ${r.slice(0,5).join(", ")}${r.length>5?"...":""}

Consider:
1. Review changes in these files before merging
2. Run: git diff ${o}...HEAD -- <file>
3. Prepare conflict resolution strategy`;return l("allow",`Conflict prediction: ${r.length} files`,t),u("conflict-predictor",`Potential conflicts: ${r.join(", ")}`),d(i)}return l("allow","No conflicts predicted",t),c()}import{execSync as yn}from"node:child_process";import{existsSync as kn}from"node:fs";import{join as Sn,basename as _n,dirname as xn}from"node:path";function bn(t,e){let n=[],o=_n(e).replace(/\.(ts|tsx|js|jsx|py)$/,""),s=xn(e),r=[`${s}/${o}.test.ts`,`${s}/${o}.test.tsx`,`${s}/${o}.spec.ts`,`${s}/${o}.spec.tsx`,`${s}/__tests__/${o}.test.ts`,`${s}/__tests__/${o}.test.tsx`,`tests/${e.replace(/\.(ts|tsx|js|jsx)$/,".test.ts")}`,`test_${o}.py`,`tests/test_${o}.py`];for(let i of r){let a=Sn(t,i);kn(a)&&n.push(i)}return n}function Rn(t){try{return yn('git status --short 2>/dev/null || echo ""',{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(n=>n.trim()).map(n=>n.slice(3).trim()).filter(n=>/\.(ts|tsx|js|jsx|py)$/.test(n))}catch{return[]}}function yt(t){let e=t.tool_input.command||"",n=m();if(!/git\s+push|npm\s+run\s+test|pytest/.test(e))return c();if(/npm\s+run\s+test|pytest/.test(e))return c();let o=Rn(n);if(o.length===0)return c();let s=[];for(let i of o.slice(0,10)){let a=bn(n,i);s.push(...a)}let r=[...new Set(s)];if(r.length>0){let i=`Related tests for changed files:
${r.slice(0,5).join(`
`)}${r.length>5?`
...`:""}

Consider running: npm run test -- ${r[0]}`;return l("allow",`Found ${r.length} related tests`,t),u("affected-tests-finder",`Tests: ${r.join(", ")}`),d(i)}return c()}import{existsSync as U}from"node:fs";import{join as q}from"node:path";function $n(t){let e=[];return U(q(t,"package.json"))&&(e.push("npm run lint"),e.push("npm run typecheck"),e.push("npm run test")),U(q(t,"pyproject.toml"))&&(e.push("ruff check ."),e.push("mypy ."),e.push("pytest")),U(q(t,"go.mod"))&&(e.push("go vet ./..."),e.push("go test ./...")),e}function kt(t){let e=t.tool_input.command||"",n=m();if(!/git\s+push/.test(e))return c();let o=$n(n);if(o.length===0)return c();let s=`Pre-push CI simulation suggested:
${o.slice(0,3).join(`
`)}

Run these locally to catch issues before CI fails.
Or: git push --no-verify to skip (not recommended)`;return l("allow","CI simulation suggested",t),u("ci-simulation",`Suggested checks: ${o.join(", ")}`),d(s)}import{existsSync as z}from"node:fs";import{join as K}from"node:path";function wn(t){return z(K(t,".pre-commit-config.yaml"))||z(K(t,".pre-commit-config.yml"))}function Cn(t){return z(K(t,".husky"))}function St(t){let e=t.tool_input.command||"",n=m();if(!/git\s+commit/.test(e))return c();if(/--no-verify/.test(e)){let o=`WARNING: --no-verify will skip pre-commit hooks.
Consider removing it unless intentional.
Skipped checks may cause CI failures.`;return l("allow","Skip pre-commit detected",t),u("pre-commit-simulation","--no-verify used"),d(o)}if(wn(n)){let o=`Pre-commit hooks will run: .pre-commit-config.yaml
If hooks fail, fix issues and retry.
Run manually: pre-commit run --all-files`;return l("allow","pre-commit config found",t),d(o)}if(Cn(n)){let o=`Husky hooks will run: .husky/
If hooks fail, fix issues and retry.`;return l("allow","husky config found",t),d(o)}return c()}import{execSync as In}from"node:child_process";function Hn(t,e){try{let n=e?`${e}`:"",o=In(`gh pr view ${n} --json number,state,mergeable,statusCheckRollup,reviewDecision 2>/dev/null`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]});return JSON.parse(o)}catch{return null}}function _t(t){let e=t.tool_input.command||"",n=m();if(!/gh\s+pr\s+merge/.test(e))return c();let o=e.match(/gh\s+pr\s+merge\s+(\d+)/),s=o?parseInt(o[1],10):void 0,r=Hn(n,s);if(!r){let a=`Could not fetch PR status. Ensure:
1. gh CLI is installed and authenticated
2. You're in a git repository
3. PR exists and is accessible`;return l("allow","PR status unavailable",t),d(a)}let i=[];if(r.state!=="OPEN"&&i.push(`PR state: ${r.state} (expected OPEN)`),r.mergeable||i.push("PR has merge conflicts"),r.statusCheckRollup!=="SUCCESS"&&r.statusCheckRollup!=="PENDING"&&i.push(`Status checks: ${r.statusCheckRollup}`),r.reviewDecision==="CHANGES_REQUESTED"&&i.push("Changes requested by reviewer"),i.length>0){let a=`PR #${r.number} has issues:
${i.join(`
`)}

Resolve these before merging.`;return l("allow",`PR issues: ${i.join(", ")}`,t),u("pr-merge-gate",`PR #${r.number} has ${i.length} issues`),d(a)}return l("allow",`PR #${r.number} ready to merge`,t),c()}import{execSync as En}from"node:child_process";function vn(t,e){try{let n=e?`--since="${e}"`:"--max-count=20";return En(`git log ${n} --pretty=format:"%s" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(Boolean)}catch{return[]}}function Pn(t){let e={feat:[],fix:[],refactor:[],docs:[],test:[],chore:[],other:[]};for(let n of t){let o=n.match(/^(feat|fix|refactor|docs|test|chore|perf|ci|build)/);if(o){let s=o[1]==="perf"||o[1]==="ci"||o[1]==="build"?"chore":o[1];e[s].push(n)}else e.other.push(n)}return e}function xt(t){let e=t.tool_input.command||"",n=m();if(!/npm\s+version|poetry\s+version|changelog/.test(e))return c();let o=vn(n);if(o.length===0)return c();let s=Pn(o),r=[];if(s.feat.length>0&&r.push(`### Features
${s.feat.slice(0,5).map(a=>`- ${a}`).join(`
`)}`),s.fix.length>0&&r.push(`### Bug Fixes
${s.fix.slice(0,5).map(a=>`- ${a}`).join(`
`)}`),s.refactor.length>0||s.chore.length>0){let a=[...s.refactor,...s.chore];r.push(`### Maintenance
${a.slice(0,3).map(p=>`- ${p}`).join(`
`)}`)}if(r.length===0)return c();let i=`Suggested changelog entries:

${r.join(`

`)}

Update CHANGELOG.md before releasing.`;return l("allow","Changelog suggestions generated",t),u("changelog-generator",`Generated ${r.length} sections`),d(i)}import{existsSync as bt,readFileSync as Rt}from"node:fs";import{join as $t}from"node:path";function Tn(t){let e=$t(t,"package.json");try{if(bt(e))return JSON.parse(Rt(e,"utf8")).version||null}catch{}return null}function Dn(t){let e=$t(t,"pyproject.toml");try{if(bt(e)){let o=Rt(e,"utf8").match(/version\s*=\s*["']([^"']+)["']/);return o?o[1]:null}}catch{}return null}function On(t){let e=[],n=Tn(t);n&&e.push({file:"package.json",version:n});let o=Dn(t);return o&&e.push({file:"pyproject.toml",version:o}),e}function wt(t){let e=t.tool_input.command||"",n=m();if(!/npm\s+version|poetry\s+version/.test(e))return c();let o=On(n);if(o.length<2)return c();let s=o.map(i=>i.version),r=[...new Set(s)];if(r.length>1){let i=`Version mismatch detected:
${o.map(a=>`${a.file}: ${a.version}`).join(`
`)}

Consider syncing versions across all files.`;return l("allow","Version mismatch detected",t),u("version-sync",`Versions: ${s.join(", ")}`),d(i)}return l("allow",`Versions in sync: ${r[0]}`,t),c()}import{existsSync as An,readFileSync as Ln}from"node:fs";import{join as jn}from"node:path";var Nn=["GPL","AGPL","LGPL","CC-BY-NC","SSPL"];function Fn(t){let e=[],n=jn(t,"package-lock.json");try{if(An(n)){let o=Ln(n,"utf8");for(let s of Nn)o.includes(`"license": "${s}`)&&e.push(`Found ${s} license in npm dependencies`)}}catch{}return e}function Ct(t){let e=t.tool_input.command||"",n=m();if(!/npm\s+install|yarn\s+add|pip\s+install|poetry\s+add/.test(e))return c();if(/npm\s+ci|npm\s+install\s*$/.test(e))return c();let o=e.match(/(?:npm\s+install|yarn\s+add|pip\s+install|poetry\s+add)\s+(\S+)/),s=o?o[1]:null;if(!s)return c();let r=Fn(n);if(r.length>0){let a=`License compliance check:
${r.join(`
`)}

New dependency: ${s}
Consider checking its license before adding.

Use: npm view ${s} license`;return l("allow","License compliance warning",t),u("license-compliance",`Checking: ${s}`),d(a)}let i=`Installing: ${s}
Verify license compatibility before production use.
Check: npm view ${s} license`;return l("allow",`Installing package: ${s}`,t),d(i)}var It={bug:`## Description
<!-- Clear description of the bug -->

## Steps to Reproduce
1.
2.
3.

## Expected Behavior
<!-- What should happen -->

## Actual Behavior
<!-- What actually happens -->

## Environment
- OS:
- Version:`,feature:`## Description
<!-- Clear description of the feature -->

## Motivation
<!-- Why is this feature needed? -->

## Proposed Solution
<!-- How should this be implemented? -->

## Alternatives Considered
<!-- Other approaches considered -->`,chore:`## Description
<!-- What maintenance task needs to be done? -->

## Impact
<!-- What does this affect? -->

## Checklist
- [ ] Task 1
- [ ] Task 2`};function Mn(t){return/--label.*bug|bug\s+report/i.test(t)?"bug":/--label.*feature|feature\s+request/i.test(t)?"feature":/--label.*chore|maintenance/i.test(t)?"chore":null}function Ht(t){let e=t.tool_input.command||"";if(!/gh\s+issue\s+create/.test(e))return c();if(/--body|--body-file|-b\s/.test(e))return c();let n=Mn(e);if(n&&It[n]){let s=`Issue type detected: ${n}

Suggested template:
${It[n].slice(0,200)}...

Add --body with template or use --web for interactive creation.`;return l("allow",`Issue creation: ${n}`,t),u("gh-issue-creation-guide",`Type: ${n}`),d(s)}let o=`Creating GitHub issue. Consider:
- Clear, descriptive title
- Add appropriate labels (bug, feature, chore)
- Include reproduction steps for bugs
- Reference related issues/PRs

Use --web for interactive creation with templates.`;return l("allow","Issue creation guidance",t),d(o)}var Bn=`Documentation checklist for features:
- [ ] Update README.md if public API changes
- [ ] Add/update JSDoc or docstrings
- [ ] Update CHANGELOG.md
- [ ] Add usage examples
- [ ] Update API documentation`;function Et(t){let e=t.tool_input.command||"";if(!/gh\s+(issue\s+close|pr\s+merge)/.test(e))return c();if(!(/--label.*feat/i.test(e)||/feat|feature/.test(e)))return c();let o=`Feature completion detected. Ensure documentation is updated.

${Bn}

Skip with --no-edit if docs are already complete.`;return l("allow","Feature docs reminder",t),u("issue-docs-requirement","Feature completion - docs reminder"),d(o)}import{existsSync as vt,readFileSync as Gn}from"node:fs";import{join as Pt}from"node:path";function Wn(t){let e=Pt(t,".claude","coordination",".claude.db");return vt(e)}function Un(t){let e=Pt(t,".claude","coordination","work-registry.json");try{if(vt(e))return JSON.parse(Gn(e,"utf8")).qualityGates||{}}catch{}return{}}function Tt(t){let e=t.tool_input.command||"",n=m();if(!/gh\s+pr\s+merge|git\s+merge|deploy/.test(e))return c();if(!Wn(n))return c();let o=Un(n),r=["tests","lint","typecheck"].filter(i=>!o[i]);if(r.length>0){let i=`Multi-instance quality gate check:
Failed/missing gates: ${r.join(", ")}

Run these checks before merging:
${r.map(a=>`- npm run ${a}`).join(`
`)}

Quality gates ensure consistency across instances.`;return l("allow",`Quality gates failed: ${r.join(", ")}`,t),u("multi-instance-quality-gate",`Failed: ${r.join(", ")}`),d(i)}return l("allow","All quality gates passed",t),c()}import{existsSync as A,readFileSync as jt,writeFileSync as Nt,mkdirSync as Ft}from"node:fs";import{join as O}from"node:path";import{execSync as qn}from"node:child_process";var S={requestsPerMinute:parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_MIN||"10",10),requestsPerHour:parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_HOUR||"100",10),burstLimit:parseInt(process.env.AGENT_BROWSER_BURST_LIMIT||"3",10)},Dt=parseInt(process.env.AGENT_BROWSER_ROBOTS_CACHE_TTL||"3600000",10),zn=[/localhost.*admin/i,/127\.0\.0\.1.*admin/i,/internal\./i,/intranet\./i,/\.local\//i,/file:\/\//i,/accounts\.google\.com/i,/login\.microsoftonline\.com/i,/auth0\.com/i,/okta\.com/i,/login\.live\.com/i,/appleid\.apple\.com/i,/github\.com\/login/i,/gitlab\.com\/users\/sign_in/i],Kn=["click.*delete","click.*remove","fill.*password","fill.*credit","submit.*payment"];function Mt(){let t=x(),e=O(t,"agent-browser");return A(e)||Ft(e,{recursive:!0}),O(e,"rate-limits.json")}function Jn(){let t=Mt();try{if(A(t))return JSON.parse(jt(t,"utf-8"))}catch{}return{domains:{}}}function Vn(t){let e=Mt();try{Nt(e,JSON.stringify(t,null,2))}catch{}}function Ot(t){try{return new URL(t).hostname}catch{return null}}function At(t){let e=Date.now(),n=Jn(),o=n.domains[t]||{timestamps:[],lastUpdated:e},s=e-6e4,r=e-36e5;o.timestamps=o.timestamps.filter(g=>g>r);let i=o.timestamps.filter(g=>g>s).length,a=o.timestamps.length;if(i>=S.requestsPerMinute)return{allowed:!1,reason:`Rate limited: ${i}/${S.requestsPerMinute} requests per minute to ${t}`,remaining:0};if(a>=S.requestsPerHour)return{allowed:!1,reason:`Rate limited: ${a}/${S.requestsPerHour} requests per hour to ${t}`,remaining:0};let p=e-3e3;return o.timestamps.filter(g=>g>p).length>=S.burstLimit?{allowed:!1,reason:`Burst limited: Too many rapid requests to ${t}. Wait a moment.`,remaining:0}:(o.timestamps.push(e),o.lastUpdated=e,n.domains[t]=o,Vn(n),{allowed:!0,remaining:S.requestsPerMinute-i-1})}function Bt(){let t=x(),e=O(t,"agent-browser");return A(e)||Ft(e,{recursive:!0}),O(e,"robots-cache.json")}function Zn(){let t=Bt();try{if(A(t))return JSON.parse(jt(t,"utf-8"))}catch{}return{entries:{}}}function Lt(t){let e=Bt();try{Nt(e,JSON.stringify(t,null,2))}catch{}}function Qn(t){let e=[],n=!1,o=t.split(`
`);for(let s of o){let r=s.trim().toLowerCase();if(r.startsWith("user-agent:")&&(n=r.replace("user-agent:","").trim()==="*"),n&&r.startsWith("disallow:")){let i=s.trim().replace(/^disallow:\s*/i,"").trim();i&&e.push(i)}}return e}function Xn(t){let e=Zn(),n=Date.now(),o=e.entries[t];if(o&&o.expires>n)return o;let s=`${t}/robots.txt`;try{let r=qn(`curl -sL --max-time 5 "${s}"`,{encoding:"utf-8",timeout:6e3,stdio:["pipe","pipe","pipe"]}),i=Qn(r),a={rules:r.split(`
`).slice(0,50),disallowedPaths:i,expires:n+Dt,fetchedAt:n};return e.entries[t]=a,Lt(e),a}catch{let r={rules:[],disallowedPaths:[],expires:n+Dt,fetchedAt:n};return e.entries[t]=r,Lt(e),r}}function Yn(t){if(process.env.AGENT_BROWSER_IGNORE_ROBOTS==="true")return{allowed:!0};try{let e=new URL(t),n=e.origin,o=e.pathname,s=Xn(n);if(!s||s.disallowedPaths.length===0)return{allowed:!0};for(let r of s.disallowedPaths)if(r.includes("*")){if(new RegExp("^"+r.replace(/\*/g,".*")).test(o))return{allowed:!1,reason:`Blocked by robots.txt: ${r}`}}else if(o.startsWith(r))return{allowed:!1,reason:`Blocked by robots.txt: ${r}`};return{allowed:!0}}catch{return{allowed:!0}}}function to(t){let e=t.match(/(?:navigate|goto|open)\s+["']?([^"'\s]+)["']?/i);return e?e[1]:null}function eo(t){return zn.some(e=>e.test(t))}function no(t){return Kn.some(e=>new RegExp(e,"i").test(t))}function Gt(t){let e=t.tool_input.command||"";if(!/agent-browser|ab\s/.test(e))return c();let n=to(e);if(n&&eo(n))return l("deny",`Blocked URL: ${n}`,t),u("agent-browser-safety",`BLOCKED: ${n}`),f(`agent-browser blocked: URL matches blocked pattern.

URL: ${n}

Blocked patterns include internal, localhost admin, and file:// URLs.
If this is intentional, use direct browser access instead.`);if(n){let o=Ot(n);if(o){let s=At(o);if(!s.allowed)return l("deny",s.reason||"Rate limited",t),u("agent-browser-safety",`RATE LIMITED: ${o}`),f(`agent-browser rate limited.

${s.reason}

Limits: ${S.requestsPerMinute}/min, ${S.requestsPerHour}/hour
Configure via AGENT_BROWSER_RATE_LIMIT_PER_MIN and AGENT_BROWSER_RATE_LIMIT_PER_HOUR env vars.

Wait a moment before retrying, or use --session <name> for isolated sessions.`)}}if(n){let o=Yn(n);if(!o.allowed)return l("deny",o.reason||"Blocked by robots.txt",t),u("agent-browser-safety",`ROBOTS BLOCKED: ${n}`),f(`agent-browser blocked by robots.txt.

URL: ${n}
${o.reason}

The website's robots.txt disallows automated access to this path.
Set AGENT_BROWSER_IGNORE_ROBOTS=true to override (not recommended).`)}if(no(e)){let o=n?Ot(n):"unknown",s=n&&o?At(o):{remaining:"?"},r=`Sensitive browser action detected:
${e.slice(0,100)}...

This may interact with:
- Delete/remove buttons
- Password fields
- Payment forms

Rate limit remaining: ${s.remaining}/${S.requestsPerMinute} per minute

Proceed with caution. Verify target elements.`;return l("allow","Sensitive action warning",t),u("agent-browser-safety","Sensitive action detected"),d(r)}return l("allow","agent-browser command validated",t),c()}import{realpathSync as oo,existsSync as ro}from"node:fs";import{resolve as so,isAbsolute as io}from"node:path";var co=[/\.env$/,/\.env\.local$/,/\.env\.production$/,/credentials\.json$/,/secrets\.json$/,/private\.key$/,/\.pem$/,/id_rsa$/,/id_ed25519$/],ao=[/package\.json$/,/pyproject\.toml$/,/tsconfig\.json$/];function uo(t,e){try{let n=io(t)?t:so(e,t);return ro(n)?oo(n):n}catch{return t}}function lo(t){for(let e of co)if(e.test(t))return e;return null}function po(t){return ao.some(e=>e.test(t))}function Wt(t){let e=t.tool_input.file_path||"",n=m();if(!e)return c();u("file-guard",`File write/edit: ${e}`);let o=uo(e,n);u("file-guard",`Resolved path: ${o}`);let s=lo(o);return s?(l("deny",`Protected file blocked: ${e} (pattern: ${s})`,t),u("file-guard",`BLOCKED: ${e} matches ${s}`),f(`Cannot modify protected file: ${e}

Resolved path: ${o}
Matched pattern: ${s}

Protected files include:
- Environment files (.env, .env.local, .env.production)
- Credential files (credentials.json, secrets.json)
- Private keys (.pem, id_rsa, id_ed25519)

If you need to modify this file, do it manually outside Claude Code.`)):(po(o)&&(u("file-guard",`WARNING: Config file modification: ${o}`),l("warn",`Config file modification: ${e}`,t)),l("allow",`File write allowed: ${e}`,t),c())}import{existsSync as J,readFileSync as mo,writeFileSync as fo,mkdirSync as go,renameSync as ho}from"node:fs";import{join as Ut,dirname as yo}from"node:path";function qt(t){return Ut(t,".claude","coordination","locks.json")}function zt(t){return J(Ut(t,".claude","coordination"))}function Kt(t){try{if(J(t)){let e=JSON.parse(mo(t,"utf8"));return{locks:Array.isArray(e.locks)?e.locks:[]}}}catch{}return{locks:[]}}function L(t,e){let n=yo(t);J(n)||go(n,{recursive:!0});let o=`${t}.${process.pid}.tmp`;fo(o,JSON.stringify(e,null,2)),ho(o,t)}function Jt(t){let e=new Date().toISOString();return t.filter(n=>n.expires_at>e)}function ko(){return`lock-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function So(){return v()}function _o(){return new Date(Date.now()+3e5).toISOString()}function xo(t,e,n){return t.find(o=>o.file_path===e&&o.instance_id!==n)||null}function bo(t,e,n){return t.find(o=>o.lock_type==="directory"&&e.startsWith(o.file_path)&&o.instance_id!==n)||null}function Ro(t,e,n,o){let s=new Date().toISOString();t.locks=t.locks.filter(r=>!(r.file_path===e&&r.instance_id===n)),t.locks.push({lock_id:ko(),file_path:e,lock_type:"exclusive_write",instance_id:n,acquired_at:s,expires_at:_o(),reason:o})}function Vt(t){let e=at(t);if(e)return e;let n=t.tool_input.file_path||"",o=m(),s=t.tool_name;if(!n)return c();if(!zt(o))return u("multi-instance-lock","Coordination not enabled, passing through"),c();if(n.includes(".claude/coordination"))return c();let r=qt(o),i=n.startsWith(o)?n.slice(o.length+1):n,a=So(),p=Kt(r),y=p.locks.length;p.locks=Jt(p.locks),p.locks.length<y&&u("multi-instance-lock",`Cleaned ${y-p.locks.length} expired locks`);let g=bo(p.locks,i,a);if(g)return L(r,p),l("deny",`Directory ${g.file_path} locked by ${g.instance_id}`,t),u("multi-instance-lock",`BLOCKED: Directory lock by ${g.instance_id}`),f(`Directory ${g.file_path} is locked by another Claude instance (${g.instance_id}).

Lock acquired at: ${g.acquired_at}
Expires at: ${g.expires_at}

You may want to wait or check the work registry:
.claude/coordination/work-registry.json`);let _=xo(p.locks,i,a);return _?(L(r,p),l("deny",`File ${i} locked by ${_.instance_id}`,t),u("multi-instance-lock",`BLOCKED: ${i} locked by ${_.instance_id}`),f(`File ${i} is locked by instance ${_.instance_id}.

Lock acquired at: ${_.acquired_at}
Expires at: ${_.expires_at}

You may want to wait or check the work registry:
.claude/coordination/work-registry.json`)):(Ro(p,i,a,`Modifying via ${s}`),L(r,p),u("multi-instance-lock",`Lock acquired: ${i}`),l("allow",`Lock acquired for ${i}`,t),c())}import{existsSync as Qt,readFileSync as $o}from"node:fs";import{join as Zt}from"node:path";var wo={"api-layer":[/\/api\//,/\/routes\//,/\/endpoints\//],"service-layer":[/\/services\//],"data-layer":[/\/db\//,/\/models\//,/\/repositories\//],"workflow-layer":[/\/workflows\//,/\/agents\//],unknown:[]};function Co(t){for(let[e,n]of Object.entries(wo))if(e!=="unknown"&&n.some(o=>o.test(t)))return e;return"unknown"}function Io(t,e){let n=Zt(e,".claude","context","patterns"),o=Zt(n,`${t}.json`);try{if(Qt(o)){let s=$o(o,"utf8"),r=JSON.parse(s),i=Array.isArray(r)?r.length:Object.keys(r).length;if(i>0)return` | Patterns loaded: ${i}`}}catch{}return""}function Xt(t){let e=t.tool_input.file_path||"",n=t.project_dir||m();if(!e)return c();let s=it(t,...["**/api/**","**/services/**","**/db/**","**/models/**","**/workflows/**"]);if(s!==null)return s;let r=Co(e);if(r==="unknown")return c();let i=Io(r,n),a=!Qt(e),p;return a?p=`New ${r} file. Follow layer conventions: dependency injection, interface contracts${i}`:p=`Modifying ${r}. Ensure: no breaking API changes, maintain layer boundaries${i}`,l("allow",`Architectural change: ${e} (${r})`,t),u("architecture-change-detector",`ARCH_DETECT: ${e} (layer=${r})`),C(t)?k(`[Quality Gate] ${p}`):h(p)}import{existsSync as Ho,readFileSync as Eo}from"node:fs";import{join as vo,extname as Po,basename as To}from"node:path";var b=50,Yt=4,Do=10;function Oo(t){return Po(t).toLowerCase().replace(".","")}function Ao(t,e){let n=[],o=t.split(`
`);if(e==="py"){let s=!1,r="",i=0;for(let a of o){let p=a.match(/^(\s*)(?:async\s+)?def\s+([a-zA-Z_][a-zA-Z0-9_]*)/),y=a.match(/^(\s*)class\s+/);p?(s&&i>b&&n.push(`Function '${r}' is ${i} lines (max: ${b})`),s=!0,r=p[2],i=1):y?(s&&i>b&&n.push(`Function '${r}' is ${i} lines (max: ${b})`),s=!1):s&&a.trim()&&i++}s&&i>b&&n.push(`Function '${r}' is ${i} lines (max: ${b})`)}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let s=0,r=0,i=!1,a="";for(let p of o){let y=p.match(/(?:function|func|fn)\s+([a-zA-Z_][a-zA-Z0-9_]*)/),g=p.match(/const\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*=\s*(?:async\s*)?\(/);if(y?(a=y[1],i=!0,r=0,s=0):g&&(a=g[1],i=!0,r=0,s=0),i){let _=(p.match(/\{/g)||[]).length,he=(p.match(/\}/g)||[]).length;s+=_-he,p.trim()&&r++,s<=0&&r>0&&(r>b&&n.push(`Function '${a}' is ${r} lines (max: ${b})`),i=!1)}}}return n}function Lo(t,e){let n=[],o=t.split(`
`),s=0;if(e==="py")for(let r of o){let i=r.match(/^(\s*)(if|for|while|with|try|elif|else|except|finally)[\s:]/);if(i){let a=i[1].length,p=Math.floor(a/4);p>s&&(s=p)}}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let r=0;for(let i of o){let a=(i.match(/\{/g)||[]).length,p=(i.match(/\}/g)||[]).length;r+=a-p,/(?:if|for|while|switch|try)\s*\(/.test(i)&&r>s&&(s=r)}}return s>Yt&&n.push(`Deep nesting detected (depth: ${s}, max: ${Yt})`),n}function jo(t){let e=[],n=(t.match(/\b(if|elif|else if)\b/g)||[]).length,o=(t.match(/\b(switch|match)\b/g)||[]).length,s=(t.match(/\?[^:]+:/g)||[]).length,r=n+o+s,i=Math.max((t.match(/\b(def|function|func|fn)\b/g)||[]).length,1),a=Math.floor(r/i);return a>Do&&e.push(`High cyclomatic complexity (~${a} conditionals/function, consider refactoring)`),e}function No(t,e){let n=vo(e,".claude","cache","type-errors.json");if(!Ho(n))return"";try{let o=JSON.parse(Eo(n,"utf8")),s=To(t);return o[s]||""}catch{return""}}function te(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=t.project_dir||m(),s=w(t,$,D);if(s!==null)return s;if(!e||!n)return c();let r=Oo(e),i=[];i.push(...Ao(n,r)),i.push(...Lo(n,r)),i.push(...jo(n));let a=No(e,o);if(a&&i.push(a),i.length>0){u("code-quality-gate",`Quality warnings for ${e}: ${i.join(", ")}`);let p=`Code quality: ${i.join(" | ")}`;return p.length>350&&(p=p.slice(0,347)+"..."),C(t)?k(`[Quality Gate] ${p}`):h(p)}return u("code-quality-gate",`No quality issues in ${e}`),c()}import{extname as Fo}from"node:path";function Mo(t){return Fo(t).toLowerCase().replace(".","")}function Bo(t){return[/test/i,/spec/i,/__tests__/i,/_test\.py$/,/\.test\.ts$/,/\.spec\.ts$/].some(n=>n.test(t))}function Go(t){let e=[],n=t.split(`
`);for(let o=0;o<n.length;o++){let r=n[o].match(/^(?:\s*)(?:async\s+)?def\s+([^_][a-zA-Z0-9_]*)\s*\(/);if(r){let i=r[1],a=!1;for(let p=o+1;p<n.length;p++){let y=n[p].trim();if(y){(y.startsWith('"""')||y.startsWith("'''"))&&(a=!0);break}}if(!a&&(e.push(i),e.length>=5))break}}return e}function Wo(t){let e=[],n=t.split(`
`),o=!1;for(let s=0;s<n.length;s++){let r=n[s];(s>0?n[s-1].trim():"").endsWith("*/")&&(o=!0);let a=r.match(/^export\s+(?:async\s+)?(?:function\s+([a-zA-Z][a-zA-Z0-9_]*)|const\s+([a-zA-Z][a-zA-Z0-9_]*)\s*=)/);if(a){let p=a[1]||a[2];if(!o&&(e.push(p),e.length>=5))break;o=!1}else r.trim().endsWith("*/")||(o=!1)}return e}function ee(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=w(t,$,D);if(o!==null)return o;if(!e||!n)return c();if(Bo(e))return c();let s=Mo(e),r=[];if(s==="py"?r=Go(n):["ts","tsx","js","jsx"].includes(s)&&(r=Wo(n)),r.length>0){let i=r.join(", "),a;return s==="py"?a=`Documentation: ${r.length} public function(s) missing docstrings: ${i}. Consider adding """docstrings""" for better code documentation.`:a=`Documentation: ${r.length} exported function(s) missing JSDoc: ${i}. Consider adding /** JSDoc */ comments for better IDE support.`,a.length>200&&(s==="py"?a=`Documentation: ${r.length} public function(s) missing docstrings. Add """docstrings""" for better documentation.`:a=`Documentation: ${r.length} exported function(s) missing JSDoc. Add /** JSDoc */ for better IDE support.`),u("docstring-enforcer",`DOCSTRING_WARN: ${r.length} functions missing docs in ${e}`),C(t)?k(`[Quality Gate] ${a}`):h(a)}return u("docstring-enforcer",`DOCSTRING_OK: All public functions documented in ${e}`),c()}import{basename as Uo}from"node:path";var qo=[{name:"Potential hardcoded secret detected",pattern:/(api[_-]?key|password|secret|token)\s*[=:]\s*['"][^'"]+['"]/i,severity:"high"},{name:"Potential SQL injection vulnerability",pattern:/execute\s*\(\s*['"].*\+|f['"].*SELECT.*\{/,severity:"high"},{name:"Dangerous eval/exec usage detected",pattern:/eval\s*\(|exec\s*\(/,severity:"high"},{name:"Subprocess with shell=True detected",pattern:/subprocess\.(run|call|Popen).*shell\s*=\s*True/,severity:"medium"},{name:"Potential XSS vulnerability (innerHTML)",pattern:/\.innerHTML\s*=|dangerouslySetInnerHTML/,severity:"medium"},{name:"Insecure random number generation",pattern:/Math\.random\(\).*(?:password|token|secret|key)/i,severity:"medium"},{name:"Potential command injection",pattern:/os\.system\s*\(|os\.popen\s*\(/,severity:"high"},{name:"Insecure HTTP (should use HTTPS)",pattern:/http:\/\/(?!localhost|127\.0\.0\.1)/,severity:"low"}];function zo(t){let e=[];for(let{name:n,pattern:o}of qo)o.test(t)&&e.push(n);return e}function ne(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=w(t,$);if(o!==null)return o;if(!e)return c();let s=zo(n);if(s.length>0){u("security-pattern-validator",`SECURITY_WARN: ${e} - ${s.join(", ")}`);let r=`Security warnings for ${Uo(e)}: ${s.join(", ")}`;return l("warn",`Security issues in ${e}: ${s.join(", ")}`,t),h(r)}return u("security-pattern-validator",`SECURITY_OK: ${e}`),l("allow",`No security issues in ${e}`,t),c()}import{existsSync as oe,readFileSync as Ko,appendFileSync as Jo,statSync as Vo,renameSync as Zo,mkdirSync as Qo}from"node:fs";import{join as Xo}from"node:path";var Yo=102400;function tr(){let t=x();return Xo(t,"context7-telemetry.log")}function er(t){try{oe(t)&&Vo(t).size>Yo&&Zo(t,`${t}.old`)}catch{}}function nr(t){if(!oe(t))return"";try{let n=Ko(t,"utf8").trim().split(`
`).filter(Boolean),o=n.length;if(o===0)return"";let s=new Set;for(let a of n){let p=a.match(/library=([^| ]+)/);p&&p[1]&&p[1]!==""&&s.add(p[1])}let r=[];for(let a=n.length-1;a>=0&&r.length<3;a--){let p=n[a].match(/library=([^| ]+)/);p&&p[1]&&!r.includes(p[1])&&r.push(p[1])}let i=r.length>0?r.join(", "):"none";return`Context7: ${o} queries, ${s.size} libraries. Recent: ${i}`}catch{return""}}function re(t){let e=t.tool_name||"";if(!e.startsWith("mcp__context7__"))return c();let n=t.tool_input.libraryId||"",o=t.tool_input.query||"",s=x();try{Qo(s,{recursive:!0})}catch{}let r=tr();er(r);let a=`${new Date().toISOString()} | tool=${e} | library=${n} | query_length=${o.length}
`;try{Jo(r,a)}catch{}let p=nr(r);return l("allow",`Documentation lookup: ${n}`,t),u("context7-tracker",`Query: ${e} library=${n}`),p?h(p):c()}import{existsSync as se,mkdirSync as ie,readFileSync as or,writeFileSync as rr,readdirSync as sr}from"node:fs";import{join as H}from"node:path";function ir(t,e){let n=H(t,".claude","logs"),o=0;if(!se(n))return 0;try{let s=sr(n);for(let r of s)if(r.startsWith(".mem0-pending-sync-")&&r.endsWith(".json")){let i=r.replace(".mem0-pending-sync-","").replace(".json","");i!==e&&i!=="unknown"&&o++}}catch{}return o}function cr(t){let e=[H(t,".claude","logs","mem0-processed"),H(t,".claude","context","session")];for(let n of e)try{ie(n,{recursive:!0})}catch{}}function ar(){return process.env.MEM0_API_KEY?"enhanced":"ready"}function ur(t,e){let n=H(t,".claude","logs",".memory-fabric-sessions.json"),o=new Date().toISOString();try{ie(H(t,".claude","logs"),{recursive:!0});let s={};if(se(n)){let r=or(n,"utf8");s=JSON.parse(r).sessions||{}}s[e]={active:!0,last_seen:o},rr(n,JSON.stringify({sessions:s},null,2))}catch{}}function ce(t){let e=t.project_dir||m(),n=t.session_id||I();u("memory-fabric-init","Memory Fabric lazy initialization triggered"),cr(e),ur(e,n);let o=ir(e,n),s=ar();u("memory-fabric-init",`Initialization complete: health=${s}, orphaned=${o}`);let r="";return o>0&&(r=`[Memory Fabric] Detected ${o} orphaned session(s) with pending syncs.
Consider running maintenance: claude --maintenance`),s==="enhanced"?u("memory-fabric-init","Memory Fabric ready (enhanced mode with mem0)"):u("memory-fabric-init","Memory Fabric ready (graph mode)"),r?h(r):c()}function ae(t){let e=t.tool_name||"";if(!e.startsWith("mcp__memory__"))return c();switch(e){case"mcp__memory__delete_entities":{let n=t.tool_input.entityNames,o=Array.isArray(n)?n.length:0;if(o>5)return l("warn",`Bulk delete: ${o} entities`,t),u("memory-validator",`WARN: Bulk entity delete: ${o} entities`),k(`Deleting ${o} entities from knowledge graph`);break}case"mcp__memory__delete_relations":{let n=t.tool_input.relations,o=Array.isArray(n)?n.length:0;if(o>10)return l("warn",`Bulk relation delete: ${o} relations`,t),u("memory-validator",`WARN: Bulk relation delete: ${o} relations`),k(`Deleting ${o} relations from knowledge graph`);break}case"mcp__memory__create_entities":{let n=t.tool_input.entities;if(!Array.isArray(n))return l("allow","Creating entities (non-array input)",t),c();let o=n.length,s=n.filter(r=>!r.name||r.name===""||!r.entityType||r.entityType==="").length;if(s>0)return l("warn",`Invalid entities: ${s} missing name or entityType`,t),u("memory-validator",`WARN: ${s} entities missing required fields`),k(`${s} entities missing required fields (name, entityType)`);l("allow",`Creating ${o} valid entities`,t);break}case"mcp__memory__create_relations":{let n=t.tool_input.relations;if(!Array.isArray(n))return l("allow","Creating relations (non-array input)",t),c();let o=n.length,s=n.filter(r=>!r.from||!r.to||!r.relationType).length;if(s>0)return l("warn",`Invalid relations: ${s} missing from/to/relationType`,t),u("memory-validator",`WARN: ${s} relations missing required fields`),k(`${s} relations missing required fields`);l("allow",`Creating ${o} valid relations`,t);break}default:l("allow",`Read operation: ${e}`,t);break}return c()}import{existsSync as lr}from"node:fs";import{extname as pr}from"node:path";function mr(){return new Date().toISOString().split("T")[0]}function dr(t,e){let n=mr();switch(t.toLowerCase()){case"py":return`# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`;case"js":case"ts":return`// Generated by OrchestKit Claude Plugin
// Created: ${n}

${e}`;case"sh":{if(e.startsWith("#!/")){let o=e.indexOf(`
`),s=e.slice(0,o),r=e.slice(o+1);return`${s}
# Generated by OrchestKit Claude Plugin
# Created: ${n}

${r}`}return`#!/bin/bash
# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`}case"sql":return`-- Generated by OrchestKit Claude Plugin
-- Created: ${n}

${e}`;case"html":case"xml":return`<!-- Generated by OrchestKit Claude Plugin - ${n} -->

${e}`;case"css":case"scss":case"sass":return`/* Generated by OrchestKit Claude Plugin - ${n} */

${e}`;case"yaml":case"yml":return`# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`;case"json":return e;default:return e}}function fr(t,e){return P({file_path:t,content:e})}function ue(t){let e=t.tool_name||"",n=t.tool_input.file_path||"",o=t.tool_input.content||"";if(e!=="Write")return c();if(lr(n))return c();let s=pr(n).replace(".","");if(o.includes("OrchestKit"))return u("write-headers",`Skipping header for ${n} (already has OrchestKit marker)`),c();let r=dr(s,o);return r!==o?(u("write-headers",`Added header to ${n}`),fr(n,r)):c()}import{existsSync as gr,appendFileSync as hr,mkdirSync as yr}from"node:fs";import{join as le,dirname as kr,basename as Sr}from"node:path";function _r(t){try{gr(t)||yr(t,{recursive:!0})}catch{}}function pe(t,e){try{_r(kr(t)),hr(t,e)}catch{}}function me(t){let e=t.tool_input.skill||"",n=t.tool_input.args||"",o=t.project_dir||m();if(!e)return c();u("skill-tracker",`Skill invocation: ${e}${n?` (args: ${n})`:""}`);let s=le(o,".claude","logs","skill-usage.log"),r=new Date().toISOString();pe(s,`${r} | ${e} | ${n||"no args"}
`);let i=le(o,".claude","logs","skill-analytics.jsonl"),a=JSON.stringify({skill:e,args:n||"",timestamp:r,project:Sr(o),phase:"start"});return pe(i,a+`
`),u("skill-tracker",`Skill usage logged for ${e}`),c()}import{existsSync as xr,readFileSync as br}from"node:fs";import{join as Rr}from"node:path";function $r(){return process.env.CLAUDE_CODE_TEAM_NAME||null}function de(){let t=$r();if(!t)return[];let e=process.env.HOME||process.env.USERPROFILE||"";if(!e)return[];let n=Rr(e,".claude","teams",t,"config.json");if(!xr(n))return[];try{let s=JSON.parse(br(n,"utf-8")).members;return Array.isArray(s)?s.map(r=>({name:r.name||"unknown",agentType:r.agentType||"unknown"})):[]}catch{return[]}}var j=6,V=3;function fe(t){let e=t.tool_input||{},n=e.team_name;if(!n)return c();let o=e.model||"",s=e.description||"",r=de(),i=r.length;if(u("team-size-gate",`Team "${n}": ${i} members, spawning model="${o}"`),i>=j)return u("team-size-gate",`BLOCKED: Team size limit (${i} >= ${j})`),f(`Team Size Limit

Team "${n}" has ${i} members (max ${j}).

Wait for existing teammates to complete before spawning more.

Attempted: ${s}`);if(o==="opus"){let a=r.filter(p=>p.agentType.toLowerCase().includes("opus")).length;if(a>=V)return u("team-size-gate",`BLOCKED: Opus limit (${a} >= ${V})`),f(`Opus Model Limit

Team "${n}" already has ${a} Opus members (max ${V}).

Use a lighter model (sonnet/haiku) or wait for Opus teammates to finish.

Attempted: ${s}`)}return u("team-size-gate",`Team spawn allowed: ${i+1}/${j}`),c()}var ge={"pretool/bash/dangerous-command-blocker":ut,"pretool/bash/git-validator":lt,"pretool/bash/compound-command-validator":pt,"pretool/bash/default-timeout-setter":dt,"pretool/bash/error-pattern-warner":ft,"pretool/bash/conflict-predictor":ht,"pretool/bash/affected-tests-finder":yt,"pretool/bash/ci-simulation":kt,"pretool/bash/pre-commit-simulation":St,"pretool/bash/pr-merge-gate":_t,"pretool/bash/changelog-generator":xt,"pretool/bash/version-sync":wt,"pretool/bash/license-compliance":Ct,"pretool/bash/gh-issue-creation-guide":Ht,"pretool/bash/issue-docs-requirement":Et,"pretool/bash/multi-instance-quality-gate":Tt,"pretool/bash/agent-browser-safety":Gt,"pretool/write-edit/file-guard":Wt,"pretool/write-edit/multi-instance-lock":Vt,"pretool/Write/architecture-change-detector":Xt,"pretool/Write/code-quality-gate":te,"pretool/Write/docstring-enforcer":ee,"pretool/Write/security-pattern-validator":ne,"pretool/mcp/context7-tracker":re,"pretool/mcp/memory-fabric-init":ce,"pretool/mcp/memory-validator":ae,"pretool/input-mod/write-headers":ue,"pretool/skill/skill-tracker":me,"pretool/task/team-size-gate":fe};function Yc(t){return ge[t]}function ta(){return Object.keys(ge)}export{ls as createGuard,ts as escapeRegex,Je as estimateTokenCount,Ze as extractIssueNumber,nt as getCachedBranch,Ve as getCurrentBranch,cs as getDefaultBranch,qr as getEnvFile,Yr as getField,B as getGitStatus,Yc as getHook,x as getLogDir,We as getLogLevel,Ge as getPluginRoot,m as getProjectDir,rs as getRepoRoot,I as getSessionId,fs as guardBash,$ as guardCodeFiles,G as guardFileExtension,hs as guardGitCommand,ys as guardMultiInstance,gs as guardNontrivialBash,it as guardPathPattern,ps as guardPythonFiles,D as guardSkipInternal,ds as guardTestFiles,ct as guardTool,ms as guardTypescriptFiles,at as guardWriteEdit,is as hasUncommittedChanges,ge as hooks,Cr as isBashInput,C as isDontAskMode,Hr as isEditInput,ss as isGitRepo,M as isProtectedBranch,Er as isReadInput,Ir as isWriteInput,ta as listHooks,u as logHook,l as logPermissionFeedback,T as normalizeCommand,zr as normalizeLineEndings,d as outputAllowWithContext,Jr as outputBlock,f as outputDeny,Zr as outputError,qe as outputPromptContext,Qr as outputPromptContextBudgeted,Kr as outputSilentAllow,c as outputSilentSuccess,k as outputWarning,h as outputWithContext,Vr as outputWithNotification,P as outputWithUpdatedInput,Xr as readHookInput,w as runGuards,Ue as shouldLog,st as validateBranchName};
//# sourceMappingURL=pretool.mjs.map
