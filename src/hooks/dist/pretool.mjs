// OrchestKit Hooks - pretool bundle
// Generated: 2026-03-01T09:37:00.276Z

var _n=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Si(t){return typeof t.command=="string"}function xi(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function bi(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function _i(t){return typeof t.file_path=="string"&&t.content===void 0}import{existsSync as W,statSync as Kn,renameSync as qn,mkdirSync as Gt,readSync as Vn,readFileSync as Zn,writeFileSync as Jn}from"node:fs";import{join as Xn}from"node:path";import{appendFileSync as Rn,mkdirSync as $n}from"node:fs";import{dirname as Cn}from"node:path";var F=[],xt=!1,Lt=!1;function R(t,e){F.push({filePath:t,content:e}),En()}function bt(){if(xt||F.length===0)return;xt=!0;let t=new Map;for(let e of F){let n=t.get(e.filePath);n?n.push(e.content):t.set(e.filePath,[e.content])}for(let[e,n]of t)try{$n(Cn(e),{recursive:!0}),Rn(e,n.join(""))}catch{}F.length=0,xt=!1}function En(){Lt||(Lt=!0,process.on("exit",bt),process.on("SIGTERM",()=>{bt(),process.exit(0)}),process.on("SIGINT",()=>{bt(),process.exit(0)}))}import{execSync as Qn}from"node:child_process";import wn from"node:os";import B from"node:path";function In(){return process.env.HOME||process.env.USERPROFILE||wn.homedir()}function _t(){return process.env.CLAUDE_PROJECT_DIR||"."}function jt(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function Mt(){return process.env.CLAUDE_PLUGIN_ROOT?B.join(In(),".claude","logs","ork"):B.join(_t(),".claude","logs")}var Hi=B.join,Ti=B.sep;import{execSync as Hn}from"node:child_process";import{createHash as Tn}from"node:crypto";import{existsSync as Ft,readFileSync as An,writeFileSync as vn,mkdirSync as On}from"node:fs";import{join as Rt,basename as Pn}from"node:path";var Dn=20,Nn=15,Ln=/[^a-z0-9-]/g;function jn(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=Pn(e);return Bt(n,Dn)}function Mn(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=Hn("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=Bt(n||"detached",Nn);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function Fn(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function Bn(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function Wn(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return Tn("sha256").update(t).digest("hex").slice(0,4)}function Bt(t,e){return t.toLowerCase().replace(Ln,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function Un(t,e){let n=jn(t),o=Mn(t),s=Fn(e),r=Bn(e),i=Wn();return`${n}-${o}-${s}-${r}-${i}`}function Gn(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=Rt(e,".instance","session-id.json");if(Ft(n))try{let o=JSON.parse(An(n,"utf8"));if(o.session_id&&o.created_at){let s=Date.now()-new Date(o.created_at).getTime(),r=1440*60*1e3;if(s<r)return o.session_id}}catch{}}function zn(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=Rt(n,".instance"),s=Rt(o,"session-id.json");try{Ft(o)||On(o,{recursive:!0}),vn(s,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function Wt(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=Gn(t);if(e)return e;let n=Un(t);return zn(n,t),n}function C(){return Mt()}function g(){return _t()}function Yn(){return jt()}function Ui(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${Yn()}/.claude/.instance_env`}function D(){return Wt()}function U(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=Qn("git branch --show-current",{cwd:t||g(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function to(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function Gi(t){return t.replace(/\r\n/g,`
`)}function eo(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(to())}function a(){return{continue:!0,suppressOutput:!0}}function zi(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function Ki(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function y(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function no(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function qi(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function f(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function Vi(t){return{continue:!0,systemMessage:t}}function k(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function zt(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function h(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function _(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var oo=200*1024,ro=100*1024;function Kt(t,e){if(W(t))try{if(Kn(t).size>e){let o=`${t}.old.${Date.now()}`;qn(t,o)}}catch{}}function qt(t){W(t)||Gt(t,{recursive:!0})}function u(t,e,n="debug"){if(!eo(n))return;let o=C(),s=`${o}/hooks.log`;try{qt(o),Kt(s,oo);let r=new Date().toISOString().replace("T"," ").slice(0,19);R(s,`[${r}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function p(t,e,n){let o=C(),s=`${o}/permission-feedback.log`;try{qt(o),Kt(s,ro);let r=new Date().toISOString(),i=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",c=n?.session_id||D();R(s,`${r} | ${t} | ${e} | tool=${i} | session=${c}
`)}catch{}}function S(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function x(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function Zi(t,e,n,o,s){let r=x(t);return o?.isOverBudget(n)?(u(e,`Budget exhausted for ${n}, suppressing ${r}t`),a()):(s&&s.trackTokenUsage(e,n,r),no(t))}function Ut(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e=Math.imul(e,16777619);return(e>>>0).toString(16).padStart(8,"0")}function Ji(t,e,n,o){let s=Xn(t,e);if(W(s))try{let r=Zn(s,"utf8");if(Ut(r)===Ut(n))return u(o,`Rules file ${e} unchanged, skipping write`),!1}catch{}return W(t)||Gt(t,{recursive:!0}),Jn(s,n,"utf8"),u(o,`Wrote rules file: ${s}`),!0}function Xi(){try{let t=[],n=Buffer.allocUnsafe(256),o,s=0;for(;;)try{if(o=Vn(s,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let r=Buffer.concat(t).toString("utf8").trim();return r?JSON.parse(r):{tool_name:"",session_id:D(),tool_input:{}}}catch{return{tool_name:"",session_id:D(),tool_input:{}}}}function Qi(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let s of n){if(o==null)return;o=o[s]}return o}function Yi(t,...e){return t.split(`
`).some(n=>e.every(o=>n.includes(o)))}function N(t,...e){return t.split(`
`).some(n=>{let o=n.toLowerCase();return e.every(s=>o.includes(s.toLowerCase()))})}function $t(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function tc(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as H}from"node:child_process";function so(t){let e=t||g();try{return H("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function Ct(t){let e=t||so();return["dev","main","master"].includes(e)}function rc(t){let e=t||g();try{return H("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function sc(t){let e=t||g();try{return H("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function io(t){let e=t||g();try{return H("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function ic(t){return io(t).length>0}function cc(t){let e=t||g();try{return H("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return H("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function co(t){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let n of e){let o=t.match(n);if(o)return parseInt(o[1],10)}return null}function ao(t){let e=t||g();try{let n=H("git diff --cached --name-only",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim();return n?n.split(`
`).filter(o=>o.trim()):[]}catch{return[]}}function Vt(t){let e=ao(t),n=new Set,o=new Set,s=!1,r=!1,i=!1,c=!1;for(let l of e){let m=l.split("/");m.length>1&&(n.add(m[0]),m.length>2&&n.add(`${m[0]}/${m[1]}`));let d=l.split(".").pop()||"";o.add(d),/\.(test|spec)\.\w+$/.test(l)||/^tests?\//.test(l)||/__tests__\//.test(l)?s=!0:/\.(md|mdx|txt|rst)$/.test(l)||/^docs?\//.test(l)||l==="README.md"?i=!0:/\.(json|ya?ml|toml|ini|cfg|env)$/.test(l)||/config/i.test(l)||l==="package.json"||l==="tsconfig.json"?r=!0:c=!0}return{files:e,directories:n,extensions:o,hasTests:s,hasConfig:r,hasDocs:i,hasSource:c}}function Zt(t){if(Ct(t))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(o=>t.startsWith(o))?t.startsWith("issue/")&&!co(t)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}import{existsSync as G,readFileSync as uo,readdirSync as lc,statSync as lo,rmSync as po}from"node:fs";import{join as z}from"node:path";function K(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function mo(){return process.env.CLAUDE_CODE_TEAM_NAME||null}function Jt(){let t=mo();if(!t)return[];let e=process.env.HOME||process.env.USERPROFILE||"";if(!e)return[];let n=z(e,".claude","teams",t,"config.json");if(!G(n))return[];try{let s=JSON.parse(uo(n,"utf-8")).members;return Array.isArray(s)?s.map(r=>({name:r.name||"unknown",agentType:r.agentType||"unknown"})):[]}catch{return[]}}function Xt(t,e=4){let n=process.env.HOME||process.env.USERPROFILE||"";if(!n)return!1;let o=z(n,".claude","teams",t);if(!G(o))return!1;let s=z(o,"config.json");if(!G(s))return!0;try{return Date.now()-lo(o).mtimeMs>e*36e5}catch{return!0}}function Qt(t){let e=process.env.HOME||process.env.USERPROFILE||"";if(!e)return!1;let n=!0;for(let o of["teams","tasks"]){let s=z(e,".claude",o,t);if(G(s))try{po(s,{recursive:!0,force:!0})}catch{n=!1}}return n}function fo(t,e){let n=t.split("*"),o=0;for(let s of n){if(s==="")continue;let r=s;if(r.indexOf("?")>=0){let c=!1;for(let l=o;l<=e.length-r.length;l++){let m=!0;for(let d=0;d<r.length;d++)if(r[d]!=="?"&&r[d]!==e[l+d]){m=!1;break}if(m){o=l+r.length,c=!0;break}}if(!c)return!1}else{let c=e.indexOf(r,o);if(c===-1)return!1;o=c+r.length}}return!0}function gc(t){return e=>t(e)?null:a()}function Et(t,...e){let n=t.tool_input.file_path;if(!n)return a();let o=n.split(".").pop()?.toLowerCase()||"";return e.map(r=>r.toLowerCase().replace(/^\./,"")).includes(o)?null:a()}function v(t){return Et(t,"py","ts","tsx","js","jsx","go","rs","java")}function hc(t){return Et(t,"py")}function yc(t){return Et(t,"ts","tsx","js","jsx")}function kc(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(o=>o.test(e))?null:a():a()}function q(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(o=>o.test(e))?a():null}function Yt(t,...e){let n=t.tool_input.file_path;if(!n)return a();for(let o of e)if(typeof o=="string"){if(fo(o,n))return null}else if(o.test(n))return null;return a()}function te(t,...e){let n=t.tool_name;return n?e.includes(n)?null:a():a()}function Sc(t){return te(t,"Write","Edit")}function xc(t){return te(t,"Bash")}function bc(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(o=>o.test(e))?a():null}function _c(t){return(t.tool_input.command||"").startsWith("git")?null:a()}function Rc(t){if(K())return a();let n=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:o}=_n("node:fs");if(o(n))return null}catch{}return a()}function O(t,...e){for(let n of e){let o=n(t);if(o!==null)return o}return null}function P(t){return t.permissionMode==="dontAsk"}function ee(t){return t.replace(/\\x([0-9a-fA-F]{2})/g,(e,n)=>String.fromCharCode(parseInt(n,16)))}function ne(t){return t.replace(/\\([0-7]{3})/g,(e,n)=>String.fromCharCode(parseInt(n,8)))}function oe(t){return t.replace(/\\([^\s])/g,"$1")}function re(t){let e=t;return e=e.replace(/"([^"]*)"/g,"$1"),e=e.replace(/'([^']*)'/g,"$1"),e}function V(t){let e=t;return e=ee(e),e=ne(e),e=oe(e),e=re(e),e=e.replace(/\\\s*[\r\n]+/g," "),e=e.replace(/\n/g," "),e=e.replace(/\s+/g," "),e.trim()}function go(t){if(!t||!t.trim())return[];let e=t;return e=ee(e),e=ne(e),e=oe(e),e=re(e),e=e.replace(/\\\s*[\r\n]+/g," "),e.split(/\s*(?:&&|\|\||\||;|\n)\s*/).map(o=>o.replace(/\s+/g," ").trim()).filter(Boolean)}function se(t,e){let n=go(t);for(let o of n){let s=o.toLowerCase();for(let r of e)if(s.includes(r.toLowerCase()))return{matches:!0,matched:r,subCommand:o}}return{matches:!1}}function ie(t){let e=[];/[<>]\([^)]+\)/.test(t)&&e.push("process substitution detected (<(...) or >(...))");let n=t.match(/\{([^},]+),([^}]+)\}/g);if(n)for(let o of n){let r=o.slice(1,-1).split(",")[0].trim(),i=r.length<=2,c=r.includes(".")||r.includes("/"),l=t.indexOf(o),m=l>0?t[l-1]:"";r&&!i&&!c&&!(m==="."||m==="*"||m==="/")&&/^[a-zA-Z]/.test(r)&&e.push(`brace expansion with command-like pattern: ${o}`)}return/<<</.test(t)&&e.push("here-string detected (<<<)"),(/\$\{?IFS\}?/.test(t)||/\bIFS=/.test(t))&&e.push("IFS manipulation detected"),/\$\([^)]*`[^`]*`[^)]*\)/.test(t)&&e.push("nested command substitution detected ($(..`..`..))"),e}var ho=["rm -rf ~","rm -fr ~","mv /* /dev/null","> /dev/sda","mkfs.","dd if=/dev/zero of=/dev/","dd if=/dev/random of=/dev/","chmod -R 777 /",":(){:|:&};:","git reset --hard","git clean -fd","drop database","drop schema","truncate table"],yo=[{pattern:/\brm\s+-r[f]\s+\/(\s|$|\*|\))/i,label:"rm -rf /"},{pattern:/\brm\s+-[f]r\s+\/(\s|$|\*|\))/i,label:"rm -fr /"}],ko=/\|\s*(sh|bash|zsh|dash|python[23]?|node|perl|ruby|tclsh)\b/i,So=/git\s+push\s+.*(-f|--force)\b/i;function Z(t){let e=t.tool_input.command||"";if(!e)return a();let n=se(e,ho);if(n.matches){let r=n.matched;return u("dangerous-command-blocker",`BLOCKED: Dangerous pattern: ${r}`),p("deny",`Dangerous pattern: ${r}`,t),h(`Command matches dangerous pattern: ${r}

This command could cause severe system damage and has been blocked.`)}let o=$t(e);for(let{pattern:r,label:i}of yo)if(r.test(o))return u("dangerous-command-blocker",`BLOCKED: Dangerous pattern: ${i}`),p("deny",`Dangerous pattern: ${i}`,t),h(`Command matches dangerous pattern: ${i}

This command could cause severe system damage and has been blocked.`);let s=$t(e).toLowerCase();if(s.includes(":(){:|:&};:")){let r="Fork bomb detected";return u("dangerous-command-blocker",`BLOCKED: ${r}`),p("deny",r,t),h(`Command matches dangerous pattern: :(){:|:&};:

This command could cause severe system damage and has been blocked.`)}if(ko.test(s)){let r="Piping to shell interpreter detected";return u("dangerous-command-blocker",`BLOCKED: ${r}`),p("deny",r,t),h(`${r}

Piping untrusted content to a shell interpreter is dangerous and has been blocked.`)}if(So.test(s)){let r="Git force-push detected (rewrites remote history)";return u("dangerous-command-blocker",`BLOCKED: ${r}`),p("deny",r,t),h(`${r}

Force-pushing can destroy remote commit history and has been blocked.`)}return a()}var wt=["feat","fix","refactor","docs","test","chore","style","perf","ci","build"],xo=10;function ce(t){let e=t.match(/-m\s+["']([^"']+)["']/);if(e)return e[1];let n=t.match(/-m\s+(\S+)/);return n?n[1]:null}function bo(t){let e=t.match(/checkout\s+-b\s+(\S+)/);if(e)return e[1];let n=t.match(/git\s+branch\s+(\S+)/);return n?n[1]:null}function _o(t,e){if(!Ct(e))return null;if(/git\s+(commit|push)/.test(t)){let n=`BLOCKED: Cannot commit or push directly to '${e}' branch.

Required workflow:
1. git checkout -b issue/<number>-<description>
2. git commit -m "feat(#<number>): Description"
3. git push -u origin issue/<number>-<description>
4. gh pr create --base dev`;return p("deny",`Blocked on protected branch: ${e}`),h(n)}return y(`On protected branch '${e}'. Create feature branch for changes.`)}function Ro(t){if(!/git\s+(checkout\s+-b|branch\s+)/.test(t))return null;let e=bo(t);if(!e)return null;let n=Zt(e);if(n){let o=`Branch naming: ${n}

Recommended: issue/123-description, feature/xyz, fix/bug-name`;return p("allow",`Branch naming guidance: ${e}`),f(o)}return null}function $o(t){if(!/^git\s+commit/.test(t))return null;if(/<<['"]?EOF/.test(t))return f(`Heredoc commit. Use: type(#issue): description
Types: ${wt.join(", ")}
End with: Co-Authored-By: Claude <noreply@anthropic.com>`);let e=ce(t);if(!e)return f("Interactive commit. Use: type(#issue): description");let n=wt.join("|"),o=new RegExp(`^(${n})(\\(#?[0-9]+\\)|(\\([a-z-]+\\)))?: .+`),s=new RegExp(`^(${n}): .+`);if(o.test(e)||s.test(e)){let i=e.split(`
`)[0].length;return i>72?f(`Commit title is ${i} chars (max 72 recommended)`):null}let r=`INVALID COMMIT FORMAT: "${e}"

Required: type(#issue): description
Types: ${wt.join(", ")}
Example: feat(#123): Add user authentication`;return p("deny",`Invalid commit: ${e}`),h(r)}function Co(t,e){if(!/^git\s+commit/.test(t))return null;let n=Vt(e),o=[];if(n.files.length>xo&&o.push(`Large commit: ${n.files.length} staged files.`),[n.hasSource,n.hasDocs,n.hasConfig].filter(Boolean).length>1&&!n.hasTests){let l=[];n.hasSource&&l.push("source code"),n.hasDocs&&l.push("documentation"),n.hasConfig&&l.push("configuration"),o.push(`Mixed concerns: ${l.join(" + ")}. Consider separate commits for each.`)}let r=new Set(n.files.map(l=>l.split("/")[0]).filter(l=>l&&l!=="."));r.size>=4&&o.push(`Changes span ${r.size} top-level directories (${[...r].slice(0,5).join(", ")}). Verify all changes are related.`);let c=ce(t);if(c){let l=c.match(/^(feat|fix|refactor|docs|test|chore|style|perf|ci|build)/)?.[1];l==="feat"&&n.hasConfig&&!n.hasSource&&o.push('Commit type is "feat" but only config files are staged. Use "chore" instead?'),l==="docs"&&n.hasSource&&o.push('Commit type is "docs" but source files are staged. Split docs from code changes.'),l==="test"&&n.hasSource&&!n.hasTests&&o.push('Commit type is "test" but no test files found in staged changes.')}if(o.length>0){let l=`Atomic commit check:
${o.map(m=>`- ${m}`).join(`
`)}

Tip: Use \`git add -p\` to stage changes interactively. See commit/rules/atomic-commit.md for guidelines.`;return f(l)}return null}function ae(t){let e=t.tool_input.command||"";if(!e.startsWith("git"))return a();let n=U(t.project_dir);u("git-validator",`Validating: ${e.slice(0,50)}...`);let o=_o(e,n);if(o?.continue===!1)return o;let s=$o(e);if(s?.continue===!1)return s;let r=Ro(e),i=Co(e,t.project_dir),c=[];return o?.hookSpecificOutput?.additionalContext&&c.push(o.hookSpecificOutput.additionalContext),s?.hookSpecificOutput?.additionalContext&&c.push(s.hookSpecificOutput.additionalContext),r?.hookSpecificOutput?.additionalContext&&c.push(r.hookSpecificOutput.additionalContext),i?.hookSpecificOutput?.additionalContext&&c.push(i.hookSpecificOutput.additionalContext),c.length>0?y(c.join(`

`)):a()}function J(t){let e=t.tool_input.command||"";if(!e)return a();let n=ie(e);if(n.length>0){let o=n.join("; ");return p("deny",`Suspicious shell feature: ${o}`,t),u("compound-command-validator",`BLOCKED: ${o}`),h(`BLOCKED: Suspicious shell feature detected.

Finding: ${o}

These shell features can bypass command validation and are not permitted.
Please rewrite the command using standard shell syntax.`)}return p("allow","Compound command validated: safe",t),a()}var ue=12e4;function X(t){let e=t.tool_input.command||"",n=t.tool_input.timeout,o=t.tool_input.description;if(typeof n=="number"&&n>0)return{continue:!0,suppressOutput:!0};let s={command:e,timeout:ue};return o&&typeof o=="string"&&(s.description=o),u("default-timeout-setter",`Setting default timeout: ${ue}ms`),_(s)}import{existsSync as Eo,readFileSync as wo}from"node:fs";import{join as Io}from"node:path";function Ho(t){let e=Io(t,".claude","rules","error_rules.json");try{if(Eo(e))return JSON.parse(wo(e,"utf8")).rules||[]}catch{}return[]}function To(t,e){let n=new Set(t.toLowerCase().split(/\s+/)),o=new Set(e.toLowerCase().split(/\s+/)),s=0;for(let r of n)o.has(r)&&r.length>2&&s++;return s}function Q(t){let e=g(),n=t.tool_input.command||"";if(!n)return a();let o=Ho(e);if(o.length===0)return a();let s=[];n.includes("psql")&&/-U\s+(postgres|orchestkit|root)/.test(n)&&o.filter(i=>i.tool==="Bash"&&i.signature?.includes("role")).length>0&&s.push("DB role error: use docker exec -it <container> psql -U orchestkit_user"),n.includes("mcp__postgres")&&o.filter(i=>i.tool?.includes("postgres-mcp")).length>0&&s.push("MCP postgres: verify connection to correct database");for(let r of o){if(!r.pattern||(r.occurrence_count||0)<5)continue;let i=r.sample_input?.command;i&&To(n,i)>3&&(u("error-pattern-warner",`Pattern match: ${r.signature}`),r.suggested_fix?s.push(`${r.signature} (${r.occurrence_count}x): ${r.suggested_fix}`):s.push(`${r.signature} (${r.occurrence_count}x)`))}if(s.length>0){let r=`Learned error patterns | ${s.join(" | ")}`;return r.length>200&&(r=`${r.slice(0,197)}...`),y(r)}return a()}import{execSync as me}from"node:child_process";var Ao=/^[a-zA-Z0-9._/~=:@-]+$/;function le(t,e="argument"){if(!t||!Ao.test(t))throw new Error(`Unsafe shell ${e}: ${JSON.stringify(t)}`);return t}function pe(t,e="git ref"){if(!t||!/^[a-zA-Z0-9._/-]+$/.test(t))throw new Error(`Unsafe ${e}: ${JSON.stringify(t)}`);return t}function vo(t,e){try{let n=pe(e,"target branch"),s=me(`git diff --name-only ${n}...HEAD 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim().split(`
`).filter(Boolean),r=[];for(let i of s.slice(0,20))try{let c=le(i,"file path");me(`git log -1 --pretty=format:"%h" ${n} -- "${c}" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()&&r.push(i)}catch{}return r}catch{return[]}}function fe(t){let e=t.tool_input.command||"",n=g();if(!/git\s+(merge|rebase|pull)/.test(e))return a();let o=null,s=e.match(/git\s+(merge|rebase)\s+(\S+)/);if(s&&(o=s[2]),e.includes("git pull")&&(o="origin/dev"),!o)return a();let r=vo(n,o);if(r.length>0){let i=`Potential conflicts detected: ${r.length} file(s)
Files: ${r.slice(0,5).join(", ")}${r.length>5?"...":""}

Consider:
1. Review changes in these files before merging
2. Run: git diff ${o}...HEAD -- <file>
3. Prepare conflict resolution strategy`;return p("allow",`Conflict prediction: ${r.length} files`,t),u("conflict-predictor",`Potential conflicts: ${r.join(", ")}`),f(i)}return p("allow","No conflicts predicted",t),a()}import{execSync as Oo}from"node:child_process";import{existsSync as Po}from"node:fs";import{join as Do,basename as No,dirname as Lo}from"node:path";function jo(t,e){let n=[],o=No(e).replace(/\.(ts|tsx|js|jsx|py)$/,""),s=Lo(e),r=[`${s}/${o}.test.ts`,`${s}/${o}.test.tsx`,`${s}/${o}.spec.ts`,`${s}/${o}.spec.tsx`,`${s}/__tests__/${o}.test.ts`,`${s}/__tests__/${o}.test.tsx`,`tests/${e.replace(/\.(ts|tsx|js|jsx)$/,".test.ts")}`,`test_${o}.py`,`tests/test_${o}.py`];for(let i of r){let c=Do(t,i);Po(c)&&n.push(i)}return n}function Mo(t){try{return Oo('git status --short 2>/dev/null || echo ""',{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(n=>n.trim()).map(n=>n.slice(3).trim()).filter(n=>/\.(ts|tsx|js|jsx|py)$/.test(n))}catch{return[]}}function Y(t){let e=t.tool_input.command||"",n=g();if(!/git\s+push|npm\s+run\s+test|pytest/.test(e))return a();if(/npm\s+run\s+test|pytest/.test(e))return a();let o=Mo(n);if(o.length===0)return a();let s=[];for(let i of o.slice(0,10)){let c=jo(n,i);s.push(...c)}let r=[...new Set(s)];if(r.length>0){let i=`Related tests for changed files:
${r.slice(0,5).join(`
`)}${r.length>5?`
...`:""}

Consider running: npm run test -- ${r[0]}`;return p("allow",`Found ${r.length} related tests`,t),u("affected-tests-finder",`Tests: ${r.join(", ")}`),f(i)}return a()}import{existsSync as It}from"node:fs";import{join as Ht}from"node:path";function Fo(t){let e=[];return It(Ht(t,"package.json"))&&(e.push("npm run lint"),e.push("npm run typecheck"),e.push("npm run test")),It(Ht(t,"pyproject.toml"))&&(e.push("ruff check ."),e.push("mypy ."),e.push("pytest")),It(Ht(t,"go.mod"))&&(e.push("go vet ./..."),e.push("go test ./...")),e}function de(t){let e=t.tool_input.command||"",n=g();if(!/git\s+push/.test(e))return a();let o=Fo(n);if(o.length===0)return a();let s=`Pre-push CI simulation suggested:
${o.slice(0,3).join(`
`)}

Run these locally to catch issues before CI fails.
Or: git push --no-verify to skip (not recommended)`;return p("allow","CI simulation suggested",t),u("ci-simulation",`Suggested checks: ${o.join(", ")}`),f(s)}import{existsSync as Tt}from"node:fs";import{join as At}from"node:path";function Bo(t){return Tt(At(t,".pre-commit-config.yaml"))||Tt(At(t,".pre-commit-config.yml"))}function Wo(t){return Tt(At(t,".husky"))}function ge(t){let e=t.tool_input.command||"",n=g();if(!/git\s+commit/.test(e))return a();if(/--no-verify/.test(e)){let o=`WARNING: --no-verify will skip pre-commit hooks.
Consider removing it unless intentional.
Skipped checks may cause CI failures.`;return p("allow","Skip pre-commit detected",t),u("pre-commit-simulation","--no-verify used"),f(o)}if(Bo(n)){let o=`Pre-commit hooks will run: .pre-commit-config.yaml
If hooks fail, fix issues and retry.
Run manually: pre-commit run --all-files`;return p("allow","pre-commit config found",t),f(o)}if(Wo(n)){let o=`Husky hooks will run: .husky/
If hooks fail, fix issues and retry.`;return p("allow","husky config found",t),f(o)}return a()}import{execSync as Uo}from"node:child_process";function Go(t,e){try{let n=e?`${e}`:"",o=Uo(`gh pr view ${n} --json number,state,mergeable,statusCheckRollup,reviewDecision 2>/dev/null`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]});return JSON.parse(o)}catch{return null}}function he(t){let e=t.tool_input.command||"",n=g();if(!/gh\s+pr\s+merge/.test(e))return a();let o=e.match(/gh\s+pr\s+merge\s+(\d+)/),s=o?parseInt(o[1],10):void 0,r=Go(n,s);if(!r){let c=`Could not fetch PR status. Ensure:
1. gh CLI is installed and authenticated
2. You're in a git repository
3. PR exists and is accessible`;return p("allow","PR status unavailable",t),f(c)}let i=[];if(r.state!=="OPEN"&&i.push(`PR state: ${r.state} (expected OPEN)`),r.mergeable||i.push("PR has merge conflicts"),r.statusCheckRollup!=="SUCCESS"&&r.statusCheckRollup!=="PENDING"&&i.push(`Status checks: ${r.statusCheckRollup}`),r.reviewDecision==="CHANGES_REQUESTED"&&i.push("Changes requested by reviewer"),i.length>0){let c=`PR #${r.number} has issues:
${i.join(`
`)}

Resolve these before merging.`;return p("allow",`PR issues: ${i.join(", ")}`,t),u("pr-merge-gate",`PR #${r.number} has ${i.length} issues`),f(c)}return p("allow",`PR #${r.number} ready to merge`,t),a()}import{execSync as zo}from"node:child_process";function Ko(t,e){try{let n=e?`--since="${e}"`:"--max-count=20";return zo(`git log ${n} --pretty=format:"%s" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(Boolean)}catch{return[]}}function qo(t){let e={feat:[],fix:[],refactor:[],docs:[],test:[],chore:[],other:[]};for(let n of t){let o=n.match(/^(feat|fix|refactor|docs|test|chore|perf|ci|build)/);if(o){let s=o[1]==="perf"||o[1]==="ci"||o[1]==="build"?"chore":o[1];e[s].push(n)}else e.other.push(n)}return e}function ye(t){let e=t.tool_input.command||"",n=g();if(!/npm\s+version|poetry\s+version|changelog/.test(e))return a();let o=Ko(n);if(o.length===0)return a();let s=qo(o),r=[];if(s.feat.length>0&&r.push(`### Features
${s.feat.slice(0,5).map(c=>`- ${c}`).join(`
`)}`),s.fix.length>0&&r.push(`### Bug Fixes
${s.fix.slice(0,5).map(c=>`- ${c}`).join(`
`)}`),s.refactor.length>0||s.chore.length>0){let c=[...s.refactor,...s.chore];r.push(`### Maintenance
${c.slice(0,3).map(l=>`- ${l}`).join(`
`)}`)}if(r.length===0)return a();let i=`Suggested changelog entries:

${r.join(`

`)}

Update CHANGELOG.md before releasing.`;return p("allow","Changelog suggestions generated",t),u("changelog-generator",`Generated ${r.length} sections`),f(i)}import{existsSync as ke,readFileSync as Se}from"node:fs";import{join as xe}from"node:path";function Vo(t){let e=xe(t,"package.json");try{if(ke(e))return JSON.parse(Se(e,"utf8")).version||null}catch{}return null}function Zo(t){let e=xe(t,"pyproject.toml");try{if(ke(e)){let o=Se(e,"utf8").match(/version\s*=\s*["']([^"']+)["']/);return o?o[1]:null}}catch{}return null}function Jo(t){let e=[],n=Vo(t);n&&e.push({file:"package.json",version:n});let o=Zo(t);return o&&e.push({file:"pyproject.toml",version:o}),e}function be(t){let e=t.tool_input.command||"",n=g();if(!/npm\s+version|poetry\s+version/.test(e))return a();let o=Jo(n);if(o.length<2)return a();let s=o.map(i=>i.version),r=[...new Set(s)];if(r.length>1){let i=`Version mismatch detected:
${o.map(c=>`${c.file}: ${c.version}`).join(`
`)}

Consider syncing versions across all files.`;return p("allow","Version mismatch detected",t),u("version-sync",`Versions: ${s.join(", ")}`),f(i)}return p("allow",`Versions in sync: ${r[0]}`,t),a()}import{existsSync as Xo,readFileSync as Qo}from"node:fs";import{join as Yo}from"node:path";var tr=["GPL","AGPL","LGPL","CC-BY-NC","SSPL"];function er(t){let e=[],n=Yo(t,"package-lock.json");try{if(Xo(n)){let o=Qo(n,"utf8");for(let s of tr)o.includes(`"license": "${s}`)&&e.push(`Found ${s} license in npm dependencies`)}}catch{}return e}function _e(t){let e=t.tool_input.command||"",n=g();if(!/npm\s+install|yarn\s+add|pip\s+install|poetry\s+add/.test(e))return a();if(/npm\s+ci|npm\s+install\s*$/.test(e))return a();let o=e.match(/(?:npm\s+install|yarn\s+add|pip\s+install|poetry\s+add)\s+(\S+)/),s=o?o[1]:null;if(!s)return a();let r=er(n);if(r.length>0){let c=`License compliance check:
${r.join(`
`)}

New dependency: ${s}
Consider checking its license before adding.

Use: npm view ${s} license`;return p("allow","License compliance warning",t),u("license-compliance",`Checking: ${s}`),f(c)}let i=`Installing: ${s}
Verify license compatibility before production use.
Check: npm view ${s} license`;return p("allow",`Installing package: ${s}`,t),f(i)}var Re={bug:`## Description
<!-- Clear description of the bug -->

## Steps to Reproduce
1.
2.
3.

## Expected Behavior
<!-- What should happen -->

## Actual Behavior
<!-- What actually happens -->

## Environment
- OS:
- Version:`,feature:`## Description
<!-- Clear description of the feature -->

## Motivation
<!-- Why is this feature needed? -->

## Proposed Solution
<!-- How should this be implemented? -->

## Alternatives Considered
<!-- Other approaches considered -->`,chore:`## Description
<!-- What maintenance task needs to be done? -->

## Impact
<!-- What does this affect? -->

## Checklist
- [ ] Task 1
- [ ] Task 2`};function nr(t){return t.includes("--label")&&/bug/i.test(t)||/bug\s+report/i.test(t)?"bug":t.includes("--label")&&/feature/i.test(t)||/feature\s+request/i.test(t)?"feature":t.includes("--label")&&/chore/i.test(t)||/maintenance/i.test(t)?"chore":null}function tt(t){let e=t.tool_input.command||"";if(!/gh\s+issue\s+create/.test(e))return a();if(/--body|--body-file|-b\s/.test(e))return a();let n=nr(e);if(n&&Re[n]){let s=`Issue type detected: ${n}

Suggested template:
${Re[n].slice(0,200)}...

Add --body with template or use --web for interactive creation.`;return p("allow",`Issue creation: ${n}`,t),u("gh-issue-creation-guide",`Type: ${n}`),f(s)}let o=`Creating GitHub issue. Consider:
- Clear, descriptive title
- Add appropriate labels (bug, feature, chore)
- Include reproduction steps for bugs
- Reference related issues/PRs

Use --web for interactive creation with templates.`;return p("allow","Issue creation guidance",t),f(o)}var or=`Documentation checklist for features:
- [ ] Update README.md if public API changes
- [ ] Add/update JSDoc or docstrings
- [ ] Update CHANGELOG.md
- [ ] Add usage examples
- [ ] Update API documentation`;function et(t){let e=t.tool_input.command||"";if(!/gh\s+(issue\s+close|pr\s+merge)/.test(e))return a();if(!(e.includes("--label")&&/feat/i.test(e)||/feat|feature/.test(e)))return a();let o=`Feature completion detected. Ensure documentation is updated.

${or}

Skip with --no-edit if docs are already complete.`;return p("allow","Feature docs reminder",t),u("issue-docs-requirement","Feature completion - docs reminder"),f(o)}import{existsSync as $e,readFileSync as rr}from"node:fs";import{join as Ce}from"node:path";function sr(t){let e=Ce(t,".claude","coordination",".claude.db");return $e(e)}function ir(t){let e=Ce(t,".claude","coordination","work-registry.json");try{if($e(e))return JSON.parse(rr(e,"utf8")).qualityGates||{}}catch{}return{}}function nt(t){if(K())return a();let e=t.tool_input.command||"",n=g();if(!/gh\s+pr\s+merge|git\s+merge|deploy/.test(e))return a();if(!sr(n))return a();let o=ir(n),r=["tests","lint","typecheck"].filter(i=>!o[i]);if(r.length>0){let i=`Multi-instance quality gate check:
Failed/missing gates: ${r.join(", ")}

Run these checks before merging:
${r.map(c=>`- npm run ${c}`).join(`
`)}

Quality gates ensure consistency across instances.`;return p("allow",`Quality gates failed: ${r.join(", ")}`,t),u("multi-instance-quality-gate",`Failed: ${r.join(", ")}`),f(i)}return p("allow","All quality gates passed",t),a()}import{existsSync as rt,readFileSync as Te,writeFileSync as Ae,mkdirSync as ve}from"node:fs";import{join as ot}from"node:path";import{execFileSync as cr}from"node:child_process";var $={requestsPerMinute:parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_MIN||"10",10),requestsPerHour:parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_HOUR||"100",10),burstLimit:parseInt(process.env.AGENT_BROWSER_BURST_LIMIT||"3",10)},Ee=parseInt(process.env.AGENT_BROWSER_ROBOTS_CACHE_TTL||"3600000",10),ar=[/localhost/i,/127\.0\.0\.1/i,/internal\./i,/intranet\./i,/\.local\//i,/file:\/\//i,/169\.254\.169\.254/i,/metadata\.google\.internal/i,/100\.100\.100\.200/i,/\[::1\]/i,/^https?:\/\/0\.0\.0\.0/i,/^https?:\/\/10\.\d+\.\d+\.\d+/i,/^https?:\/\/172\.(1[6-9]|2\d|3[01])\.\d+\.\d+/i,/^https?:\/\/192\.168\.\d+\.\d+/i,/accounts\.google\.com/i,/login\.microsoftonline\.com/i,/auth0\.com/i,/okta\.com/i,/login\.live\.com/i,/appleid\.apple\.com/i,/github\.com\/login/i,/gitlab\.com\/users\/sign_in/i],ur=["click.*delete","click.*remove","fill.*password","fill.*credit","submit.*payment"];function Oe(){let t=C(),e=ot(t,"agent-browser");return rt(e)||ve(e,{recursive:!0}),ot(e,"rate-limits.json")}function lr(){let t=Oe();try{if(rt(t))return JSON.parse(Te(t,"utf-8"))}catch{}return{domains:{}}}function pr(t){let e=Oe();try{Ae(e,JSON.stringify(t,null,2))}catch{}}function we(t){try{return new URL(t).hostname}catch{return null}}function Ie(t){let e=Date.now(),n=lr(),o=n.domains[t]||{timestamps:[],lastUpdated:e},s=e-6e4,r=e-36e5;o.timestamps=o.timestamps.filter(d=>d>r);let i=o.timestamps.filter(d=>d>s).length,c=o.timestamps.length;if(i>=$.requestsPerMinute)return{allowed:!1,reason:`Rate limited: ${i}/${$.requestsPerMinute} requests per minute to ${t}`,remaining:0};if(c>=$.requestsPerHour)return{allowed:!1,reason:`Rate limited: ${c}/${$.requestsPerHour} requests per hour to ${t}`,remaining:0};let l=e-3e3;return o.timestamps.filter(d=>d>l).length>=$.burstLimit?{allowed:!1,reason:`Burst limited: Too many rapid requests to ${t}. Wait a moment.`,remaining:0}:(o.timestamps.push(e),o.lastUpdated=e,n.domains[t]=o,pr(n),{allowed:!0,remaining:$.requestsPerMinute-i-1})}function Pe(){let t=C(),e=ot(t,"agent-browser");return rt(e)||ve(e,{recursive:!0}),ot(e,"robots-cache.json")}function mr(){let t=Pe();try{if(rt(t))return JSON.parse(Te(t,"utf-8"))}catch{}return{entries:{}}}function He(t){let e=Pe();try{Ae(e,JSON.stringify(t,null,2))}catch{}}function fr(t){let e=[],n=!1,o=t.split(`
`);for(let s of o){let r=s.trim().toLowerCase();if(r.startsWith("user-agent:")&&(n=r.replace("user-agent:","").trim()==="*"),n&&r.startsWith("disallow:")){let i=s.trim().replace(/^disallow:\s*/i,"").trim();i&&e.push(i)}}return e}function dr(t){let e=mr(),n=Date.now(),o=e.entries[t];if(o&&o.expires>n)return o;let s=`${t}/robots.txt`;try{let r=cr("curl",["-sL","--max-time","5",s],{encoding:"utf-8",timeout:6e3,stdio:["pipe","pipe","pipe"]}),i=fr(r),c={rules:r.split(`
`).slice(0,50),disallowedPaths:i,expires:n+Ee,fetchedAt:n};return e.entries[t]=c,He(e),c}catch{let r={rules:[],disallowedPaths:[],expires:n+Ee,fetchedAt:n};return e.entries[t]=r,He(e),r}}function gr(t){if(process.env.AGENT_BROWSER_IGNORE_ROBOTS==="true")return{allowed:!0};try{let e=new URL(t),n=e.origin,o=e.pathname,s=dr(n);if(!s||s.disallowedPaths.length===0)return{allowed:!0};for(let r of s.disallowedPaths)if(r.includes("*")){let i=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\\\*/g,".*");if(new RegExp(`^${i}`).test(o))return{allowed:!1,reason:`Blocked by robots.txt: ${r}`}}else if(o.startsWith(r))return{allowed:!1,reason:`Blocked by robots.txt: ${r}`};return{allowed:!0}}catch{return{allowed:!0}}}function hr(t){let e=t.match(/(?:navigate|goto|open)\s+["']?([^"'\s]+)["']?/i);return e?e[1]:null}function yr(t){return ar.some(e=>e.test(t))}function kr(t){return ur.some(e=>new RegExp(e,"i").test(t))}function st(t){let e=t.tool_input.command||"";if(!/agent-browser|ab\s/.test(e))return a();let n=hr(e);if(n&&yr(n))return p("deny",`Blocked URL: ${n}`,t),u("agent-browser-safety",`BLOCKED: ${n}`),h(`agent-browser blocked: URL matches blocked pattern.

URL: ${n}

Blocked patterns include internal, localhost admin, and file:// URLs.
If this is intentional, use direct browser access instead.`);if(n){let o=we(n);if(o){let s=Ie(o);if(!s.allowed)return p("deny",s.reason||"Rate limited",t),u("agent-browser-safety",`RATE LIMITED: ${o}`),h(`agent-browser rate limited.

${s.reason}

Limits: ${$.requestsPerMinute}/min, ${$.requestsPerHour}/hour
Configure via AGENT_BROWSER_RATE_LIMIT_PER_MIN and AGENT_BROWSER_RATE_LIMIT_PER_HOUR env vars.

Wait a moment before retrying, or use --session <name> for isolated sessions.`)}}if(n){let o=gr(n);if(!o.allowed)return p("deny",o.reason||"Blocked by robots.txt",t),u("agent-browser-safety",`ROBOTS BLOCKED: ${n}`),h(`agent-browser blocked by robots.txt.

URL: ${n}
${o.reason}

The website's robots.txt disallows automated access to this path.
Set AGENT_BROWSER_IGNORE_ROBOTS=true to override (not recommended).`)}if(kr(e)){let o=n?we(n):"unknown",s=n&&o?Ie(o):{remaining:"?"},r=`Sensitive browser action detected:
${e.slice(0,100)}...

This may interact with:
- Delete/remove buttons
- Password fields
- Payment forms

Rate limit remaining: ${s.remaining}/${$.requestsPerMinute} per minute

Proceed with caution. Verify target elements.`;return p("allow","Sensitive action warning",t),u("agent-browser-safety","Sensitive action detected"),f(r)}return p("allow","agent-browser command validated",t),a()}import{execSync as Sr}from"node:child_process";var vt="commit-atomicity-checker",De=10,xr=3,br={"src/":"source","lib/":"source","app/":"source","docs/":"docs","doc/":"docs","test/":"tests","tests/":"tests","__tests__/":"tests","spec/":"tests","config/":"config",".github/":"config","scripts/":"config"};function _r(t){for(let[e,n]of Object.entries(br))if(t.startsWith(e))return n;return"other"}function Rr(t){let e=[/-m\s+"([^"]+)"/,/-m\s+'([^']+)'/,/--message="([^"]+)"/,/--message='([^']+)'/,/--message\s+"([^"]+)"/,/--message\s+'([^']+)'/,/-m\s+([^\s"'-][^\s]*)/];for(let n of e){let o=t.match(n);if(o)return o[1]}return null}function $r(t){try{return Sr("git diff --cached --name-only",{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim().split(`
`).filter(Boolean)}catch{return u(vt,"Failed to get staged files, skipping check","warn"),null}}function Cr(t,e){let n=[];t.length>De&&n.push(`${t.length} staged files (>${De}) \u2014 verify all changes are related`);let o=new Set(t.map(i=>i.includes("/")?i.split("/")[0]:"(root)"));o.size>xr&&n.push(`Changes span ${o.size} top-level dirs (${[...o].join(", ")}) \u2014 may mix concerns`);let s=new Set(t.map(_r));s.size>=3&&n.push(`Mixed change types: ${[...s].join(", ")} \u2014 consider splitting`);let r=Rr(e);return r&&/\band\b/i.test(r)&&n.push('Commit message contains "and" \u2014 may describe multiple concerns'),n}function Ne(t){try{let e=t.tool_input.command||"";if(!e)return a();let n=t.project_dir||g(),o=$r(n);if(!o||o.length===0)return a();let s=Cr(o,e);if(s.length===0)return a();let r=`Atomicity check:
${s.map(i=>`- ${i}`).join(`
`)}

Consider splitting into atomic commits if these are unrelated changes.`;return u(vt,`${s.length} warning(s) for commit`),f(r)}catch{return u(vt,"Unexpected error, falling back to silent success","warn"),a()}}function Er(t){let e=t.match(/-m\s+(?:"([^"\\]*(?:\\[\s\S][^"\\]*)*)"|'([^']*)'|(\S+))/);return e?e[1]??e[2]??e[3]??null:null}function wr(t){let e=t.match(/(?:^|\/)(#?\d+)(?:-|$)/);return e?e[1].replace(/^#/,""):null}function Ir(t,e){return t.includes(`#${e}`)||t.includes(e)}function Le(t){try{let e=t.tool_input.command||"";if(!e)return a();let n=Er(e);if(!n)return a();let o=U();if(!o||o==="unknown")return a();let s=wr(o);if(!s)return a();if(Ir(n,s))return a();zt(`Reminder: You're on branch \`${o}\` \u2014 include #${s} in the commit message to link it to the issue.`)}catch{return a()}}import{basename as je,extname as Hr}from"node:path";var Tr=[{name:"OpenAI API Key",regex:/sk-[A-Za-z0-9]{20,}/},{name:"Anthropic API Key",regex:/sk-ant-[A-Za-z0-9_-]{20,}/},{name:"GitHub PAT (classic)",regex:/ghp_[A-Za-z0-9]{36,}/},{name:"GitHub PAT (fine-grained)",regex:/github_pat_[A-Za-z0-9_]{30,}/},{name:"AWS Access Key",regex:/(?:AKIA|ASIA)[A-Z0-9]{16}/},{name:"GCP API Key",regex:/AIza[A-Za-z0-9_-]{35}/},{name:"Stripe Secret Key",regex:/sk_live_[A-Za-z0-9]{24,}/},{name:"Stripe Publishable Key",regex:/pk_live_[A-Za-z0-9]{24,}/},{name:"Twilio API Key",regex:/SK[0-9a-f]{32}/},{name:"SendGrid API Key",regex:/SG\.[A-Za-z0-9_-]{22,}\.[A-Za-z0-9_-]{22,}/},{name:"Slack Token",regex:/xox[bpras]-[A-Za-z0-9-]{10,}/},{name:"Tavily API Key",regex:/tvly-[A-Za-z0-9]{20,}/},{name:"Mem0 API Key",regex:/m0-[A-Za-z0-9]{20,}/},{name:"JWT Token",regex:/eyJ[A-Za-z0-9_-]{10,}\.eyJ[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]{10,}/},{name:"Private Key Block",regex:/-----BEGIN\s+(?:RSA|DSA|EC|OPENSSH|PGP)?\s*PRIVATE KEY-----/}],Ar=/(?:api_key|secret_key|api_secret|access_token|auth_token|private_key)\s*[=:]\s*["'][A-Za-z0-9_\-/.+]{16,}["']/i,vr=new Set([".md",".txt",".rst",".adoc"]);function Or(t){let e=Hr(t).toLowerCase();if(vr.has(e))return!0;let n=t.toLowerCase();return n.includes("fixtures/")||n.includes("__tests__/")||n.includes("test-data/")||n.includes("testdata/")||n.includes("/tests/")&&n.includes("/fixtures/")}function Pr(t){for(let{name:n,regex:o}of Tr){let s=t.match(o);if(s){let r=s[0].length>12?`${s[0].substring(0,8)}...`:s[0].substring(0,4)+"...";return{name:n,snippet:r}}}let e=t.match(Ar);return e?{name:"Secret Assignment",snippet:e[0].length>20?`${e[0].substring(0,16)}...`:e[0]}:null}function it(t){let e=t.tool_name,n=t.tool_input.file_path||"",o="";if(e==="Write"?o=t.tool_input.content||"":e==="Edit"&&(o=t.tool_input.new_string||""),!o||!n)return a();if(Or(n))return a();let s=Pr(o);if(s){let r=je(n);return p("deny",`Secret detected in ${r}: ${s.name}`,t),u("content-secret-scanner",`BLOCKED: ${s.name} in ${n} (${s.snippet})`),h(`BLOCKED: Potential secret detected in file content.

Type: ${s.name}
File: ${n}
Match: ${s.snippet}

Secrets must NEVER be committed to source code. Use:
- Environment variables (.env files \u2014 which are gitignored)
- Secret managers (AWS Secrets Manager, Vault, etc.)
- CI/CD secret injection

If this is a false positive (e.g., test fixture or documentation),
move the file to a test-data/ or fixtures/ directory.`)}return p("allow",`Content scan clean: ${je(n)}`,t),a()}import{realpathSync as Dr,existsSync as Nr}from"node:fs";import{resolve as Lr,isAbsolute as jr,extname as Mr,basename as Fr}from"node:path";var Br=parseInt(process.env.ORCHESTKIT_MAX_FILE_LINES||"300",10),Wr=parseInt(process.env.ORCHESTKIT_MAX_TEST_FILE_LINES||"500",10),Ur=new Set(["py","ts","tsx","js","jsx","go","rs","java"]);function Me(t){let e=Fr(t);return/\.(test|spec)\.[^.]+$/.test(e)||/^test_/.test(e)||/_test\.[^.]+$/.test(e)||t.includes("__tests__/")}function Gr(t){let e=[],n=t.split(`
`),o=n.filter(d=>/^export\s/.test(d.trim())).length;o>15&&e.push({name:"god-file",detected:!0,detail:`${o} exports \u2014 split by domain`});let s=n.some(d=>/^(export\s+)?(type|interface)\s/.test(d.trim())),r=n.some(d=>/^(export\s+)?(async\s+)?function\s/.test(d.trim())),i=n.some(d=>/^(export\s+)?class\s/.test(d.trim()));s&&(r||i)&&n.length>150&&e.push({name:"mixed-concerns",detected:!0,detail:"types + logic in same file \u2014 extract types to types.ts"});let c=n.filter(d=>/^import\s/.test(d.trim())).length;c>20&&e.push({name:"high-coupling",detected:!0,detail:`${c} imports \u2014 file does too much, split by responsibility`});let l=n.filter(d=>/^(export\s+)?(default\s+)?class\s/.test(d.trim())).length,m=n.filter(d=>/^(export\s+)?(default\s+)?(const|function)\s+[A-Z]/.test(d.trim())).length;return l>1&&e.push({name:"multi-class",detected:!0,detail:`${l} classes \u2014 one class per file`}),m>3&&e.push({name:"multi-component",detected:!0,detail:`${m} components \u2014 one per file`}),e.filter(d=>d.detected)}function zr(t){if(t.tool_name!=="Write")return null;let e=t.tool_input.file_path||"",n=t.tool_input.content||"";if(!e||!n)return null;let o=Mr(e).toLowerCase().replace(".","");if(!Ur.has(o))return null;let s=n.split(`
`).length,r=Me(e)?Wr:Br,i=Gr(n);if(s>r){let c=Me(e)?"test":"source",l=i.length>0?`

Bloat patterns detected:
${i.map(m=>`- ${m.name}: ${m.detail}`).join(`
`)}`:"";return h(`File too long: ${s} lines (limit: ${r} for ${c} files)${l}

Split this file into smaller modules. Override with:
  ORCHESTKIT_MAX_FILE_LINES=500 (source)
  ORCHESTKIT_MAX_TEST_FILE_LINES=800 (tests)`)}return i.length>=2&&u("file-guard",`Bloat detected in ${e}: ${i.map(c=>c.name).join(", ")}`),null}var Kr=[/\.env$/,/\.env\.local$/,/\.env\.production$/,/credentials\.json$/,/secrets\.json$/,/private\.key$/,/\.pem$/,/id_rsa$/,/id_ed25519$/],qr=[/package\.json$/,/pyproject\.toml$/,/tsconfig\.json$/];function Vr(t,e){try{let n=jr(t)?t:Lr(e,t);return Nr(n)?Dr(n):n}catch{return t}}function Zr(t){for(let e of Kr)if(e.test(t))return e;return null}function Jr(t){return qr.some(e=>e.test(t))}function ct(t){let e=t.tool_input.file_path||"",n=g();if(!e)return a();u("file-guard",`File write/edit: ${e}`);let o=Vr(e,n);u("file-guard",`Resolved path: ${o}`);let s=Zr(o);if(s)return p("deny",`Protected file blocked: ${e} (pattern: ${s})`,t),u("file-guard",`BLOCKED: ${e} matches ${s}`),h(`Cannot modify protected file: ${e}

Resolved path: ${o}
Matched pattern: ${s}

Protected files include:
- Environment files (.env, .env.local, .env.production)
- Credential files (credentials.json, secrets.json)
- Private keys (.pem, id_rsa, id_ed25519)

If you need to modify this file, do it manually outside Claude Code.`);let r=zr(t);return r||(Jr(o)&&(u("file-guard",`WARNING: Config file modification: ${o}`),p("warn",`Config file modification: ${e}`,t)),p("allow",`File write allowed: ${e}`,t),a())}import{existsSync as Be,readFileSync as Xr}from"node:fs";import{join as Fe}from"node:path";var Qr={"api-layer":[/\/api\//,/\/routes\//,/\/endpoints\//],"service-layer":[/\/services\//],"data-layer":[/\/db\//,/\/models\//,/\/repositories\//],"workflow-layer":[/\/workflows\//,/\/agents\//],unknown:[]};function Yr(t){for(let[e,n]of Object.entries(Qr))if(e!=="unknown"&&n.some(o=>o.test(t)))return e;return"unknown"}function ts(t,e){let n=Fe(e,".claude","context","patterns"),o=Fe(n,`${t}.json`);try{if(Be(o)){let s=Xr(o,"utf8"),r=JSON.parse(s),i=Array.isArray(r)?r.length:Object.keys(r).length;if(i>0)return` | Patterns loaded: ${i}`}}catch{}return""}function at(t){let e=t.tool_input.file_path||"",n=t.project_dir||g();if(!e)return a();let s=Yt(t,...["**/api/**","**/services/**","**/db/**","**/models/**","**/workflows/**"]);if(s!==null)return s;let r=Yr(e);if(r==="unknown")return a();let i=ts(r,n),c=!Be(e),l;return c?l=`New ${r} file. Follow layer conventions: dependency injection, interface contracts${i}`:l=`Modifying ${r}. Ensure: no breaking API changes, maintain layer boundaries${i}`,p("allow",`Architectural change: ${e} (${r})`,t),u("architecture-change-detector",`ARCH_DETECT: ${e} (layer=${r})`),P(t)?k(`[Quality Gate] ${l}`):y(l)}import{existsSync as es,readFileSync as ns}from"node:fs";import{join as os,extname as rs,basename as ss}from"node:path";var E=50,We=4,is=10;function cs(t){return rs(t).toLowerCase().replace(".","")}function as(t,e){let n=[],o=t.split(`
`);if(e==="py"){let s=!1,r="",i=0;for(let c of o){let l=c.match(/^(\s*)(?:async\s+)?def\s+([a-zA-Z_][a-zA-Z0-9_]*)/),m=c.match(/^(\s*)class\s+/);l?(s&&i>E&&n.push(`Function '${r}' is ${i} lines (max: ${E})`),s=!0,r=l[2],i=1):m?(s&&i>E&&n.push(`Function '${r}' is ${i} lines (max: ${E})`),s=!1):s&&c.trim()&&i++}s&&i>E&&n.push(`Function '${r}' is ${i} lines (max: ${E})`)}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let s=0,r=0,i=!1,c="";for(let l of o){let m=l.match(/(?:function|func|fn)\s+([a-zA-Z_][a-zA-Z0-9_]*)/),d=l.match(/const\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*=\s*(?:async\s*)?\(/);if(m?(c=m[1],i=!0,r=0,s=0):d&&(c=d[1],i=!0,r=0,s=0),i){let b=(l.match(/\{/g)||[]).length,St=(l.match(/\}/g)||[]).length;s+=b-St,l.trim()&&r++,s<=0&&r>0&&(r>E&&n.push(`Function '${c}' is ${r} lines (max: ${E})`),i=!1)}}}return n}function us(t,e){let n=[],o=t.split(`
`),s=0;if(e==="py")for(let r of o){let i=r.match(/^(\s*)(if|for|while|with|try|elif|else|except|finally)[\s:]/);if(i){let c=i[1].length,l=Math.floor(c/4);l>s&&(s=l)}}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let r=0;for(let i of o){let c=(i.match(/\{/g)||[]).length,l=(i.match(/\}/g)||[]).length;r+=c-l,/(?:if|for|while|switch|try)\s*\(/.test(i)&&r>s&&(s=r)}}return s>We&&n.push(`Deep nesting detected (depth: ${s}, max: ${We})`),n}function ls(t){let e=[],n=(t.match(/\b(if|elif|else if)\b/g)||[]).length,o=(t.match(/\b(switch|match)\b/g)||[]).length,s=t.split(`
`).filter(l=>l.includes("?")&&l.includes(":")&&/\?/.test(l.split(":")[0])).length,r=n+o+s,i=Math.max((t.match(/\b(def|function|func|fn)\b/g)||[]).length,1),c=Math.floor(r/i);return c>is&&e.push(`High cyclomatic complexity (~${c} conditionals/function, consider refactoring)`),e}function ps(t,e){let n=os(e,".claude","cache","type-errors.json");if(!es(n))return"";try{let o=JSON.parse(ns(n,"utf8")),s=ss(t);return o[s]||""}catch{return""}}function Ue(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=t.project_dir||g(),s=O(t,v,q);if(s!==null)return s;if(!e||!n)return a();let r=cs(e),i=[];i.push(...as(n,r)),i.push(...us(n,r)),i.push(...ls(n));let c=ps(e,o);if(c&&i.push(c),i.length>0){u("code-quality-gate",`Quality warnings for ${e}: ${i.join(", ")}`);let l=`Code quality: ${i.join(" | ")}`;return l.length>350&&(l=`${l.slice(0,347)}...`),P(t)?k(`[Quality Gate] ${l}`):y(l)}return u("code-quality-gate",`No quality issues in ${e}`),a()}import{extname as ms}from"node:path";function fs(t){return ms(t).toLowerCase().replace(".","")}function ds(t){return[/test/i,/spec/i,/__tests__/i,/_test\.py$/,/\.test\.ts$/,/\.spec\.ts$/].some(n=>n.test(t))}function gs(t){let e=[],n=t.split(`
`);for(let o=0;o<n.length;o++){let r=n[o].trimStart(),i=r.startsWith("def ")||r.startsWith("async def ")?r.replace(/^async\s+/,"").match(/^def\s+([^_][a-zA-Z0-9_]*)\s*\(/):null;if(i){let c=i[1],l=!1;for(let m=o+1;m<n.length;m++){let d=n[m].trim();if(d){(d.startsWith('"""')||d.startsWith("'''"))&&(l=!0);break}}if(!l&&(e.push(c),e.length>=5))break}}return e}function hs(t){let e=[],n=t.split(`
`),o=!1;for(let s=0;s<n.length;s++){let r=n[s];(s>0?n[s-1].trim():"").endsWith("*/")&&(o=!0);let c=r.match(/^export\s+(?:async\s+)?(?:function\s+([a-zA-Z][a-zA-Z0-9_]*)|const\s+([a-zA-Z][a-zA-Z0-9_]*)\s*=)/);if(c){let l=c[1]||c[2];if(!o&&(e.push(l),e.length>=5))break;o=!1}else r.trim().endsWith("*/")||(o=!1)}return e}function Ge(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=O(t,v,q);if(o!==null)return o;if(!e||!n)return a();if(ds(e))return a();let s=fs(e),r=[];if(s==="py"?r=gs(n):["ts","tsx","js","jsx"].includes(s)&&(r=hs(n)),r.length>0){let i=r.join(", "),c;return s==="py"?c=`Documentation: ${r.length} public function(s) missing docstrings: ${i}. Consider adding """docstrings""" for better code documentation.`:c=`Documentation: ${r.length} exported function(s) missing JSDoc: ${i}. Consider adding /** JSDoc */ comments for better IDE support.`,c.length>200&&(s==="py"?c=`Documentation: ${r.length} public function(s) missing docstrings. Add """docstrings""" for better documentation.`:c=`Documentation: ${r.length} exported function(s) missing JSDoc. Add /** JSDoc */ for better IDE support.`),u("docstring-enforcer",`DOCSTRING_WARN: ${r.length} functions missing docs in ${e}`),P(t)?k(`[Quality Gate] ${c}`):y(c)}return u("docstring-enforcer",`DOCSTRING_OK: All public functions documented in ${e}`),a()}import{basename as ys}from"node:path";var ks=[{name:"Potential hardcoded secret detected",pattern:/(api[_-]?key|password|secret|token)\s*[=:]\s*['"][^'"]+['"]/i,severity:"high"},{name:"Potential SQL injection vulnerability",pattern:{test:t=>t.includes("execute")&&/execute\s*\(\s*['"]/.test(t)&&t.includes("+")||/f['"]/.test(t)&&t.includes("SELECT")&&t.includes("{")},severity:"high"},{name:"Dangerous eval/exec usage detected",pattern:/eval\s*\(|exec\s*\(/,severity:"high"},{name:"Subprocess with shell=True detected",pattern:/subprocess\.(run|call|Popen).*shell\s*=\s*True/,severity:"medium"},{name:"Potential XSS vulnerability (innerHTML)",pattern:/\.innerHTML\s*=|dangerouslySetInnerHTML/,severity:"medium"},{name:"Insecure random number generation",pattern:/Math\.random\(\).*(?:password|token|secret|key)/i,severity:"medium"},{name:"Potential command injection",pattern:/os\.system\s*\(|os\.popen\s*\(/,severity:"high"},{name:"Insecure HTTP (should use HTTPS)",pattern:/http:\/\/(?!localhost|127\.0\.0\.1)/,severity:"low"}];function Ss(t){let e=[];for(let{name:n,pattern:o}of ks)o.test(t)&&e.push(n);return e}function ut(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=O(t,v);if(o!==null)return o;if(!e)return a();let s=Ss(n);if(s.length>0){u("security-pattern-validator",`SECURITY_WARN: ${e} - ${s.join(", ")}`);let r=`Security warnings for ${ys(e)}: ${s.join(", ")}`;return p("warn",`Security issues in ${e}: ${s.join(", ")}`,t),y(r)}return u("security-pattern-validator",`SECURITY_OK: ${e}`),p("allow",`No security issues in ${e}`,t),a()}import{existsSync as Pt,readFileSync as Ke,statSync as xs,renameSync as bs,mkdirSync as _s}from"node:fs";import{join as Rs}from"node:path";var $s=102400,ze=50,Ot=10,Cs=6e4;function Es(){let t=C();return Rs(t,"context7-telemetry.log")}function ws(t){try{Pt(t)&&xs(t).size>$s&&bs(t,`${t}.old`)}catch{}}function Is(t){if(!Pt(t))return"";try{let n=Ke(t,"utf8").trim().split(`
`).filter(Boolean),o=n.length;if(o===0)return"";let s=new Set;for(let c of n){let l=c.match(/library=([^| ]+)/);l?.[1]&&l[1]!==""&&s.add(l[1])}let r=[];for(let c=n.length-1;c>=0&&r.length<3;c--){let l=n[c].match(/library=([^| ]+)/);l?.[1]&&!r.includes(l[1])&&r.push(l[1])}let i=r.length>0?r.join(", "):"none";return`Context7: ${o} queries, ${s.size} libraries. Recent: ${i}`}catch{return""}}function Hs(t){if(!Pt(t))return null;try{let n=Ke(t,"utf8").trim().split(`
`).filter(Boolean);if(n.length>=ze)return`Context7 session limit reached (${ze} queries). Rely on already-fetched documentation or use WebFetch for additional lookups.`;let s=Date.now(),r=0;for(let i=n.length-1;i>=0&&i>=n.length-Ot-1;i--){let c=n[i].match(/^(\d{4}-\d{2}-\d{2}T[\d:.]+Z?)/);if(c){let l=new Date(c[1]).getTime();if(s-l<Cs)r++;else break}}if(r>=Ot)return`Context7 rate limit: ${Ot} queries/minute exceeded. Wait a moment before querying again.`}catch{}return null}function qe(t){let e=t.tool_name||"";if(!e.startsWith("mcp__context7__"))return a();let n=t.tool_input.libraryId||"",o=t.tool_input.query||"",s=C();try{_s(s,{recursive:!0})}catch{}let r=Es();ws(r);let i=Hs(r);if(i)return p("deny",`Context7 rate limited: ${i}`,t),u("context7-tracker",`RATE LIMITED: ${i}`),h(i);let l=`${new Date().toISOString()} | tool=${e} | library=${n} | query_length=${o.length}
`;try{R(r,l)}catch{}let m=Is(r);if(p("allow",`Documentation lookup: ${n}`,t),u("context7-tracker",`Query: ${e} library=${n}`),m){let d=m.match(/(\d+) queries/);if((d?parseInt(d[1],10):0)>=3)return y(m)}return a()}var Ve=200,lt=1e3,pt=20,Ts=new Set(["person","project","technology","concept","tool","pattern","decision","preference","workflow","organization","service","library","framework","language","file","module","api","endpoint","database","config","environment","event"]);function As(t){for(let e of t){let n=String(e.name||"");if(n.length>Ve)return`Entity name too long: ${n.length} chars (max ${Ve}). Oversized names may indicate a poisoning attempt.`;let o=e.observations;if(Array.isArray(o)){if(o.length>pt)return`Too many observations for '${n.substring(0,50)}': ${o.length} (max ${pt}). Split into multiple entities.`;for(let s of o){let r=String(s);if(r.length>lt)return`Observation too long for '${n.substring(0,50)}': ${r.length} chars (max ${lt}). Summarize the observation.`}}}return null}function vs(t){let e=[];for(let n of t){let o=String(n.entityType||"").toLowerCase();o&&!Ts.has(o)&&e.push(o)}return e}function Os(t){for(let e of t){let n=e.contents;if(Array.isArray(n)){if(n.length>pt)return`Too many observations in batch: ${n.length} (max ${pt}).`;for(let o of n){let s=String(o);if(s.length>lt)return`Observation too long: ${s.length} chars (max ${lt}). Summarize the observation.`}}}return null}function Ze(t){let e=t.tool_name||"";if(!e.startsWith("mcp__memory__"))return a();switch(e){case"mcp__memory__delete_entities":{let n=t.tool_input.entityNames,o=Array.isArray(n)?n.length:0;if(o>5)return p("warn",`Bulk delete: ${o} entities`,t),u("memory-validator",`WARN: Bulk entity delete: ${o} entities`),k(`Deleting ${o} entities from knowledge graph`);break}case"mcp__memory__delete_relations":{let n=t.tool_input.relations,o=Array.isArray(n)?n.length:0;if(o>10)return p("warn",`Bulk relation delete: ${o} relations`,t),u("memory-validator",`WARN: Bulk relation delete: ${o} relations`),k(`Deleting ${o} relations from knowledge graph`);break}case"mcp__memory__create_entities":{let n=t.tool_input.entities;if(!Array.isArray(n))return p("allow","Creating entities (non-array input)",t),a();let o=n.length,s=n.filter(c=>!c.name||c.name===""||!c.entityType||c.entityType==="").length;if(s>0)return p("warn",`Invalid entities: ${s} missing name or entityType`,t),u("memory-validator",`WARN: ${s} entities missing required fields`),k(`${s} entities missing required fields (name, entityType)`);let r=As(n);if(r)return p("deny",`Oversized entity: ${r}`,t),u("memory-validator",`BLOCKED: ${r}`),h(r);let i=vs(n);i.length>0&&u("memory-validator",`WARN: Unknown entity types: ${i.join(", ")}`),p("allow",`Creating ${o} valid entities`,t);break}case"mcp__memory__create_relations":{let n=t.tool_input.relations;if(!Array.isArray(n))return p("allow","Creating relations (non-array input)",t),a();let o=n.length,s=n.filter(r=>!r.from||!r.to||!r.relationType).length;if(s>0)return p("warn",`Invalid relations: ${s} missing from/to/relationType`,t),u("memory-validator",`WARN: ${s} relations missing required fields`),k(`${s} relations missing required fields`);p("allow",`Creating ${o} valid relations`,t);break}case"mcp__memory__add_observations":{let n=t.tool_input.observations;if(Array.isArray(n)){let o=Os(n);if(o)return p("deny",`Oversized observation: ${o}`,t),u("memory-validator",`BLOCKED: ${o}`),h(o)}p("allow","Adding observations",t);break}default:p("allow",`Read operation: ${e}`,t);break}return a()}var Dt="notebooklm-advisor",Je={notebook_delete:"Irreversible: all notebook content will be permanently deleted",source_delete:"Irreversible: source content will be permanently lost",studio_delete:"Irreversible: generated artifact will be permanently lost",notebook_share_public:"This makes the notebook publicly accessible via link",notebook_share_invite:"This sends an email invitation to the collaborator"};function Xe(t){let e=t.tool_name||"";if(!e.startsWith("mcp__notebooklm-mcp__"))return a();let n=e.replace("mcp__notebooklm-mcp__","");if(Je[n])return u(Dt,`WARN: ${n}`),k(Je[n]);if(n==="source_add"){let o=t.tool_input?.text;if(typeof o=="string"&&o.length>5e4)return u(Dt,`WARN: source_add large text (${o.length} chars)`),k(`Source is large (${o.length} chars). Consider splitting into multiple sources for better retrieval.`)}return n==="note"&&t.tool_input?.action==="delete"?(u(Dt,"WARN: note delete (irreversible)"),k("Irreversible: note will be permanently deleted")):a()}import{existsSync as Ps}from"node:fs";import{extname as Ds}from"node:path";function Ns(){return new Date().toISOString().split("T")[0]}function Ls(t,e){let n=Ns();switch(t.toLowerCase()){case"py":return`# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`;case"js":case"ts":return`// Generated by OrchestKit Claude Plugin
// Created: ${n}

${e}`;case"sh":{if(e.startsWith("#!/")){let o=e.indexOf(`
`),s=e.slice(0,o),r=e.slice(o+1);return`${s}
# Generated by OrchestKit Claude Plugin
# Created: ${n}

${r}`}return`#!/bin/bash
# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`}case"sql":return`-- Generated by OrchestKit Claude Plugin
-- Created: ${n}

${e}`;case"html":case"xml":return`<!-- Generated by OrchestKit Claude Plugin - ${n} -->

${e}`;case"css":case"scss":case"sass":return`/* Generated by OrchestKit Claude Plugin - ${n} */

${e}`;case"yaml":case"yml":return`# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`;case"json":return e;default:return e}}function js(t,e){return _({file_path:t,content:e})}function mt(t){let e=t.tool_name||"",n=t.tool_input.file_path||"",o=t.tool_input.content||"";if(e!=="Write")return a();if(Ps(n))return a();let s=Ds(n).replace(".","");if(o.includes("OrchestKit"))return u("write-headers",`Skipping header for ${n} (already has OrchestKit marker)`),a();let r=Ls(s,o);return r!==o?(u("write-headers",`Added header to ${n}`),js(n,r)):a()}import{existsSync as Ms,mkdirSync as Fs}from"node:fs";import{join as Qe,dirname as Bs,basename as Ws}from"node:path";function Us(t){try{Ms(t)||Fs(t,{recursive:!0})}catch{}}function Ye(t,e){try{Us(Bs(t)),R(t,e)}catch{}}function tn(t){let e=t.tool_input.skill||"",n=t.tool_input.args||"",o=t.project_dir||g();if(!e)return a();u("skill-tracker",`Skill invocation: ${e}${n?` (args: ${n})`:""}`);let s=Qe(o,".claude","logs","skill-usage.log"),r=new Date().toISOString();Ye(s,`${r} | ${e} | ${n||"no args"}
`);let i=Qe(o,".claude","logs","skill-analytics.jsonl"),c=JSON.stringify({skill:e,args:n||"",timestamp:r,project:Ws(o),phase:"start"});return Ye(i,`${c}
`),u("skill-tracker",`Skill usage logged for ${e}`),a()}import{existsSync as ti,readFileSync as ei,statSync as ni}from"node:fs";var en={".ts":"typescript",".tsx":"typescript",".js":"typescript",".jsx":"typescript",".mjs":"typescript",".mts":"typescript",".py":"python",".go":"go",".rs":"rust",".sh":"shell",".bash":"shell",".md":"markdown"};function nn(t){return t in en}function Gs(t){let e=t.split(`
`),n=[],o=[],s=[],r=[],i=[];for(let c of e){let l=c.trim();if(/^import\s/.test(l)){n.push(l.replace(/;$/,""));continue}if(/^(?:export\s+)?(?:interface|type)\s+\w+/.test(l)){let m=l.match(/^(?:export\s+)?(?:interface|type)\s+(\w+[^{=]*)/);m&&r.push(m[0].replace(/\s*[{=]\s*$/,"").trim());continue}if(/^(?:export\s+)?(?:abstract\s+)?class\s+\w+/.test(l)){let m=l.match(/^(?:export\s+)?(?:abstract\s+)?class\s+\w+(?:\s+extends\s+\w+)?(?:\s+implements\s+[\w,\s]+)?/);m&&s.push(m[0].trim());continue}if(/^(?:export\s+)?(?:async\s+)?function\s+\w+/.test(l)){let m=l.match(/^(?:export\s+)?(?:async\s+)?function\s+\w+\([^)]*\)(?:\s*:\s*[^{]+)?/);m&&o.push(m[0].replace(/\s*\{?\s*$/,"").trim());continue}if(/^(?:export\s+)?const\s+\w+\s*=\s*(?:async\s+)?\(/.test(l)){let m=l.match(/^(?:export\s+)?const\s+(\w+)\s*=\s*(?:async\s+)?\([^)]*\)(?:\s*:\s*[^=]+)?(?:\s*=>)?/);m&&o.push(m[0].replace(/\s*=>\s*$/,"").trim());continue}/^export\s+(?:\{|default\s)/.test(l)&&i.push(l.replace(/;$/,""))}return{imports:n,functions:o,classes:s,types:r,exports:i,sections:[],variables:[]}}function zs(t){let e=t.split(`
`),n=[],o=[],s=[],r="";for(let i of e){let c=i.trim();if(/^(?:from\s|import\s)/.test(c)){n.push(c);continue}if(/^@\w+/.test(c)){r=c;continue}if(/^(?:async\s+)?def\s+\w+/.test(i)&&!i.startsWith(" ")&&!i.startsWith("	")){let l=i.match(/^(?:async\s+)?def\s+\w+\([^)]*\)(?:\s*->\s*[^:]+)?/);if(l){let m=r?`${r} ${l[0].trim()}`:l[0].trim();o.push(m)}r="";continue}if(/^class\s+\w+/.test(i)&&!i.startsWith(" ")&&!i.startsWith("	")){let l=i.match(/^class\s+\w+(?:\([^)]*\))?/);if(l){let m=l[0].trim();s.push(m)}r="";continue}if(/^\s+(?:async\s+)?def\s+\w+/.test(i)){let l=i.match(/^\s+(?:async\s+)?def\s+(\w+)/);l&&!l[1].startsWith("_")&&o.push(`  ${l[0].trim()}`),r="";continue}r=""}return{imports:n,functions:o,classes:s,types:[],exports:[],sections:[],variables:[]}}function Ks(t){let e=t.split(`
`),n=[],o=[],s=[],r=!1;for(let i of e){let c=i.trim();if(/^import\s*\(/.test(c)){r=!0;continue}if(r){c===")"?r=!1:c&&!c.startsWith("//")&&n.push(`import ${c}`);continue}if(/^import\s+"/.test(c)){n.push(c);continue}if(/^func\s/.test(c)){let l=c.match(/^func\s+(?:\([^)]+\)\s+)?\w+\([^)]*\)(?:\s*(?:\([^)]*\)|\*?\w+))?/);l&&o.push(l[0].trim());continue}if(/^type\s+\w+\s+(?:struct|interface)/.test(c)){let l=c.match(/^type\s+\w+\s+(?:struct|interface)/);l&&s.push(l[0].trim())}}return{imports:n,functions:o,classes:[],types:s,exports:[],sections:[],variables:[]}}function qs(t){let e=t.split(`
`),n=[],o=[],s=[];for(let r of e){let i=r.trim();if(/^use\s/.test(i)){n.push(i.replace(/;$/,""));continue}if(/^(?:pub\s+)?(?:async\s+)?fn\s+\w+/.test(i)){let c=i.match(/^(?:pub\s+)?(?:async\s+)?fn\s+\w+(?:<[^>]+>)?\([^)]*\)(?:\s*->\s*[^{]+)?/);c&&o.push(c[0].replace(/\s*\{?\s*$/,"").trim());continue}if(/^(?:pub\s+)?(?:struct|enum|trait|impl)\s+\w+/.test(i)){let c=i.match(/^(?:pub\s+)?(?:struct|enum|trait|impl)\s+\w+(?:<[^>]+>)?(?:\s+for\s+\w+(?:<[^>]+>)?)?/);c&&s.push(c[0].trim())}}return{imports:n,functions:o,classes:[],types:s,exports:[],sections:[],variables:[]}}function Vs(t){let e=t.split(`
`),n=[],o=[],s=new Set;for(let r of e){let i=r.trim();if(/^(?:function\s+)?(\w+)\s*\(\)\s*\{?/.test(i)){let c=i.match(/^(?:function\s+)?(\w+)\s*\(\)/);c&&c[1]!=="if"&&c[1]!=="while"&&c[1]!=="for"&&n.push(c[1]);continue}if(/^function\s+(\w+)\s*\{?/.test(i)){let c=i.match(/^function\s+(\w+)/);c&&n.push(c[1]);continue}if(/^[A-Z][A-Z0-9_]+=/.test(i)&&s.size<10){let c=i.match(/^([A-Z][A-Z0-9_]+)=/);c&&!s.has(c[1])&&(s.add(c[1]),o.push(c[1]))}}return{imports:[],functions:n,classes:[],types:[],exports:[],sections:[],variables:o}}function Zs(t){let e=t.split(`
`),n=[];for(let o of e){let s=o.match(/^(#{1,3})\s+(.+)/);s&&n.push(`${s[1]} ${s[2].trim()}`)}return{imports:[],functions:[],classes:[],types:[],exports:[],sections:n,variables:[]}}var Js={typescript:Gs,python:zs,go:Ks,rust:qs,shell:Vs,markdown:Zs},Xs=1400;function Qs(t){return{typescript:"TypeScript",python:"Python",go:"Go",rust:"Rust",shell:"Shell",markdown:"Markdown"}[t]}function T(t,e,n=""){if(e.length===0)return"";let o=`${t} (${e.length}):`,s=e.map(r=>`${n}  ${r}`).join(`
`);return`${o}
${s}`}function Ys(t,e){let n="";for(let o of t){if(n.length+o.length+1>e){n+=`
  ...truncated`;break}n+=(n?`
`:"")+o}return n}function on(t,e){let n=e.lastIndexOf(".");if(n===-1)return null;let o=e.slice(n).toLowerCase(),s=en[o];if(!s)return null;let r=Js[s],i=r(t);if(i.imports.length+i.functions.length+i.classes.length+i.types.length+i.exports.length+i.sections.length+i.variables.length===0)return null;let l=t.split(`
`).length,m=x(t),d=`[TLDR] ${e} (${l} lines, ~${m} tokens, ${Qs(s)})`,b=[];i.classes.length>0&&b.push(T("Classes",i.classes)),i.types.length>0&&b.push(T("Types",i.types)),i.functions.length>0&&b.push(T("Functions",i.functions)),i.exports.length>0&&b.push(T("Exports",i.exports)),i.imports.length>0&&b.push(T("Imports",i.imports)),i.sections.length>0&&b.push(T("Sections",i.sections)),i.variables.length>0&&b.push(T("Variables",i.variables));let St=Xs-d.length-2,bn=Ys(b,St);return`${d}

${bn}`}var ft="tldr-summary",oi=1e3,ri=2e3,si=2*1024*1024,rn=new Set;function sn(t){try{let e=t.tool_input||{},n=e.file_path;if(!n)return a();if(rn.has(n))return u(ft,`Skipping ${n}: already summarized this session`),a();if(e.offset!==void 0||e.limit!==void 0)return a();let o=n.lastIndexOf(".");if(o===-1)return a();let s=n.slice(o).toLowerCase();if(!nn(s))return a();if(!ti(n))return a();let r=ni(n);if(r.size>si)return u(ft,`Skipping ${n}: ${r.size} bytes > 2MB cap`),a();let i=ei(n,"utf8"),c=i.split(`
`).length,l=x(i);if(c<oi&&l<ri)return a();let m=on(i,n);return m?(rn.add(n),u(ft,`Injecting summary for ${n} (${c} lines, ~${l} tokens)`),f(m)):a()}catch(e){return u(ft,`Error: ${e instanceof Error?e.message:String(e)}`,"warn"),a()}}var dt=6,Nt=3;function gt(t){let e=t.tool_input||{},n=e.team_name;if(!n)return a();Xt(n)&&(Qt(n),u("team-size-gate",`Auto-cleaned stale team "${n}" before TeamCreate`));let o=e.model||"",s=e.description||"",r=Jt(),i=r.length;if(u("team-size-gate",`Team "${n}": ${i} members, spawning model="${o}"`),i>=dt)return u("team-size-gate",`BLOCKED: Team size limit (${i} >= ${dt})`),h(`Team Size Limit

Team "${n}" has ${i} members (max ${dt}).

Wait for existing teammates to complete before spawning more.

Attempted: ${s}`);if(o==="opus"){let c=r.filter(l=>l.agentType.toLowerCase().includes("opus")).length;if(c>=Nt)return u("team-size-gate",`BLOCKED: Opus limit (${c} >= ${Nt})`),h(`Opus Model Limit

Team "${n}" already has ${c} Opus members (max ${Nt}).

Use a lighter model (sonnet/haiku) or wait for Opus teammates to finish.

Attempted: ${s}`)}return u("team-size-gate",`Team spawn allowed: ${i+1}/${dt}`),a()}var A="pretool-bash-dispatcher",cn=800,ii=[{name:"error-pattern-warner",fn:Q},{name:"issue-docs-requirement",fn:et},{name:"multi-instance-quality-gate",fn:nt},{name:"gh-issue-creation-guide",fn:tt},{name:"affected-tests-finder",fn:Y}];function ht(t){let e;try{let n=X(t);n.hookSpecificOutput?.updatedInput&&(e=n.hookSpecificOutput.updatedInput)}catch(n){let o=n instanceof Error?n.message:String(n);u(A,`default-timeout-setter failed: ${o}`,"warn")}try{let n=st(t);if(!n.continue)return n;let o=S(n);if(o)return an(t,e,o)}catch(n){let o=n instanceof Error?n.message:String(n);u(A,`agent-browser-safety failed: ${o}`,"warn")}return an(t,e,null)}function an(t,e,n){let o=[],s=0;if(n){let r=x(n);o.push(n),s+=r}for(let r of ii)try{let i=r.fn(t),c=S(i);if(!c)continue;let l=x(c);if(s+l>cn){u(A,`Budget limit: skipping ${r.name} (${l}t would exceed ${cn}t cap)`);continue}o.push(c),s+=l,u(A,`${r.name}: +${l}t (total: ${s}t)`)}catch(i){let c=i instanceof Error?i.message:String(i);u(A,`${r.name} failed: ${c}`,"warn")}if(e&&o.length>0){let r=o.join(`

---

`);return u(A,`Consolidated ${o.length} hooks into ${s}t + input mod`),{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:e,additionalContext:r}}}if(e)return _(e);if(o.length>0){let r=o.join(`

---

`);return u(A,`Consolidated ${o.length} hooks into ${s}t`),f(r)}return a()}var L="pretool-write-edit-dispatcher",un=800,ci=[{name:"architecture-change-detector",fn:at}];function yt(t){try{let e=ut(t);if(!e.continue)return e;let n=S(e);if(n)return ln(t,n)}catch(e){let n=e instanceof Error?e.message:String(e);u(L,`security-pattern-validator failed: ${n}`,"warn")}return ln(t,null)}function ln(t,e){let n=[],o=0;if(e){let r=x(e);n.push(e),o+=r}for(let r of ci)try{let i=r.fn(t),c=S(i);if(!c)continue;let l=x(c);if(o+l>un){u(L,`Budget limit: skipping ${r.name} (${l}t would exceed ${un}t cap)`);continue}n.push(c),o+=l,u(L,`${r.name}: +${l}t (total: ${o}t)`)}catch(i){let c=i instanceof Error?i.message:String(i);u(L,`${r.name} failed: ${c}`,"warn")}if(n.length===0)return a();let s=n.join(`

---

`);return u(L,`Consolidated ${n.length} hooks into ${o}t`),f(s)}function pn(t){let e=t.tool_name,n=process.env.CLAUDE_AGENT_ID||"unknown";return["Write","Edit","MultiEdit","NotebookEdit"].includes(e)?h(`BLOCKED: Agent '${n}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`):a()}var ai=[{test:t=>/DROP\s+TABLE/i.test(t),source:"DROP TABLE"},{test:t=>/DROP\s+DATABASE/i.test(t),source:"DROP DATABASE"},{test:t=>/TRUNCATE/i.test(t),source:"TRUNCATE"},{test:t=>/DELETE\s+FROM/i.test(t)&&/WHERE\s+1/i.test(t),source:"DELETE FROM...WHERE 1"},{test:t=>/DELETE\s+FROM/i.test(t)&&!/WHERE/i.test(t),source:"DELETE FROM (no WHERE)"},{test:t=>t.includes("--force"),source:"--force"},{test:t=>/alembic\s+downgrade/i.test(t),source:"alembic downgrade"}];function mn(t){if(t.tool_name!=="Bash")return a();let n=t.tool_input.command||"",o=n?V(n):"";for(let s of ai)if(s.test(o))return h(`BLOCKED: Potentially destructive database command detected. Pattern: '${s.source}'. Please confirm this operation is intentional before proceeding.`);return a()}import{mkdirSync as ui}from"node:fs";function fn(t){let e=process.env.CLAUDE_AGENT_ID||"unknown",n=t.tool_name,o=t.session_id||D(),s=t.project_dir||g(),r=`${s}/.claude/logs/security-audit.log`;if(n!=="Bash")return a();let i=t.tool_input.command||"",c=new Date().toISOString();if(i)try{ui(`${s}/.claude/logs`,{recursive:!0}),R(r,`[${c}] [${o}] [${e}] CMD: ${i}
`)}catch{}return a()}var li=[{test:t=>N(t,"force","push"),source:"force push"},{test:t=>N(t,"push","--force"),source:"push --force"},{test:t=>t.includes("--force-with-lease"),source:"--force-with-lease"},{test:t=>t.toLowerCase().includes("workflow_dispatch"),source:"workflow_dispatch"},{test:t=>N(t,"delete","workflow"),source:"delete workflow"},{test:t=>/gh\s+secret\s+delete/i.test(t),source:"gh secret delete"},{test:t=>/gh\s+variable\s+delete/i.test(t),source:"gh variable delete"},{test:t=>N(t,"rm","-rf",".github"),source:"rm -rf .github"}];function dn(t){let e=t.tool_input.command||"",n=e?V(e):"";for(let o of li)if(o.test(n))return h(`BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${o.source}'. This requires explicit user approval.`);return/deploy|release|publish/i.test(n)?y("CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place."):a()}var pi=[{test:t=>/\bprod\b/i.test(t),source:"prod"},{test:t=>/production/i.test(t),source:"production"},{test:t=>t.includes("--env")&&/prod/i.test(t),source:"--env.*prod"},{test:t=>t.includes("ENV=prod"),source:"ENV=prod"},{test:t=>t.includes("ENVIRONMENT=prod"),source:"ENVIRONMENT=prod"},{test:t=>t.toLowerCase().includes("deploy")&&t.toLowerCase().includes("main"),source:"deploy.*main"},{test:t=>t.toLowerCase().includes("deploy")&&t.toLowerCase().includes("master"),source:"deploy.*master"}];function gn(t){let e=t.tool_input.command||"";for(let n of pi)if(n.test(e))return h(`BLOCKED: Production deployment detected. Pattern: '${n.source}'. Production deployments require explicit user approval and should go through proper release processes.`);return/rollback|revert|downgrade/i.test(e)?y("Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed."):/terraform|kubectl|helm/i.test(e)||e.toLowerCase().includes("docker")&&e.toLowerCase().includes("push")?y("Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment."):a()}var j="pretool-task-dispatcher",hn=800,mi=[{name:"block-writes",fn:pn,canBlock:!0},{name:"migration-safety-check",fn:mn,canBlock:!0},{name:"ci-safety-check",fn:dn,canBlock:!0},{name:"deployment-safety-check",fn:gn,canBlock:!0},{name:"security-command-audit",fn,canBlock:!1}];function kt(t){let e=[],n=0;for(let s of mi)try{let r=s.fn(t);if(!r.continue)return u(j,`${s.name} blocked operation`),r;let i=S(r);if(!i)continue;let c=x(i);if(n+c>hn){u(j,`Budget limit: skipping ${s.name} (${c}t would exceed ${hn}t cap)`);continue}e.push(i),n+=c,u(j,`${s.name}: +${c}t (total: ${n}t)`)}catch(r){let i=r instanceof Error?r.message:String(r);u(j,`${s.name} failed: ${i}`,"warn")}if(e.length===0)return a();let o=e.join(`

---

`);return u(j,`Consolidated ${e.length} hooks into ${n}t`),f(o)}var w="sync-bash-dispatcher",fi=[{name:"dangerous-command-blocker",fn:Z},{name:"compound-command-validator",fn:J},{name:"unified-advisory-dispatcher",fn:ht}];function di(t,e){let n=t.length>0?t.join(`

---

`):null;return e&&n?(u(w,`Merged ${t.length} context(s) + updatedInput`),{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:e,additionalContext:n}}):e?(u(w,"updatedInput only \u2014 no context"),_(e)):n?(u(w,`Merged ${t.length} context(s)`),{continue:!0,suppressOutput:!0,hookSpecificOutput:{additionalContext:n,hookEventName:"PreToolUse"}}):(u(w,"All hooks silent"),a())}function yn(t){let e=[],n;for(let o of fi)try{let s=o.fn(t);if(!s.continue)return u(w,`${o.name} blocked \u2014 short-circuiting`),s;s.hookSpecificOutput?.updatedInput&&(n=s.hookSpecificOutput.updatedInput,u(w,`${o.name}: updatedInput collected`));let r=S(s);r&&(e.push(r),u(w,`${o.name}: additionalContext collected`))}catch(s){let r=s instanceof Error?s.message:String(s);u(w,`${o.name} failed: ${r}`,"warn")}return di(e,n)}var I="sync-write-edit-dispatcher",gi=[{name:"content-secret-scanner",fn:it},{name:"file-guard",fn:ct},{name:"write-headers",fn:mt},{name:"unified-quality-dispatcher",fn:yt}];function hi(t,e){let n=t.length>0?t.join(`

---

`):null;return e&&n?(u(I,`Merged ${t.length} context(s) + updatedInput`),{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:e,additionalContext:n}}):e?(u(I,"updatedInput only \u2014 no context"),_(e)):n?(u(I,`Merged ${t.length} context(s)`),{continue:!0,suppressOutput:!0,hookSpecificOutput:{additionalContext:n,hookEventName:"PreToolUse"}}):(u(I,"All hooks silent"),a())}function kn(t){let e=[],n;for(let o of gi)try{let s=o.fn(t);if(!s.continue)return u(I,`${o.name} blocked \u2014 short-circuiting`),s;s.hookSpecificOutput?.updatedInput&&(n=s.hookSpecificOutput.updatedInput,u(I,`${o.name}: updatedInput collected`));let r=S(s);r&&(e.push(r),u(I,`${o.name}: additionalContext collected`))}catch(s){let r=s instanceof Error?s.message:String(s);u(I,`${o.name} failed: ${r}`,"warn")}return hi(e,n)}var M="sync-task-dispatcher",yi=[{name:"unified-agent-safety-dispatcher",fn:kt},{name:"team-size-gate",fn:gt}];function Sn(t){let e=[];for(let o of yi)try{let s=o.fn(t);if(!s.continue)return u(M,`${o.name} blocked \u2014 short-circuiting`),s;let r=S(s);r&&(e.push(r),u(M,`${o.name}: additionalContext collected`))}catch(s){let r=s instanceof Error?s.message:String(s);u(M,`${o.name} failed: ${r}`,"warn")}if(e.length===0)return u(M,"All hooks silent"),a();let n=e.join(`

---

`);return u(M,`Merged ${e.length} context(s)`),{continue:!0,suppressOutput:!0,hookSpecificOutput:{additionalContext:n,hookEventName:"PreToolUse"}}}var xn={"pretool/bash/dangerous-command-blocker":Z,"pretool/bash/git-validator":ae,"pretool/bash/compound-command-validator":J,"pretool/bash/default-timeout-setter":X,"pretool/bash/error-pattern-warner":Q,"pretool/bash/conflict-predictor":fe,"pretool/bash/affected-tests-finder":Y,"pretool/bash/ci-simulation":de,"pretool/bash/pre-commit-simulation":ge,"pretool/bash/pr-merge-gate":he,"pretool/bash/changelog-generator":ye,"pretool/bash/version-sync":be,"pretool/bash/license-compliance":_e,"pretool/bash/gh-issue-creation-guide":tt,"pretool/bash/issue-docs-requirement":et,"pretool/bash/multi-instance-quality-gate":nt,"pretool/bash/agent-browser-safety":st,"pretool/bash/commit-atomicity-checker":Ne,"pretool/bash/issue-reference-checker":Le,"pretool/write-edit/content-secret-scanner":it,"pretool/write-edit/file-guard":ct,"pretool/Write/architecture-change-detector":at,"pretool/Write/code-quality-gate":Ue,"pretool/Write/docstring-enforcer":Ge,"pretool/Write/security-pattern-validator":ut,"pretool/mcp/context7-tracker":qe,"pretool/mcp/memory-validator":Ze,"pretool/mcp/notebooklm-advisor":Xe,"pretool/input-mod/write-headers":mt,"pretool/skill/skill-tracker":tn,"pretool/read/tldr-summary":sn,"pretool/task/team-size-gate":gt,"pretool/bash/unified-advisory-dispatcher":ht,"pretool/write-edit/unified-quality-dispatcher":yt,"pretool/task/unified-agent-safety-dispatcher":kt,"pretool/bash/sync-bash-dispatcher":yn,"pretool/write-edit/sync-write-edit-dispatcher":kn,"pretool/task/sync-task-dispatcher":Sn};function gp(t){return xn[t]}function hp(){return Object.keys(xn)}export{Vt as analyzeStagedChanges,gc as createGuard,tc as escapeRegex,x as estimateTokenCount,S as extractContext,co as extractIssueNumber,Ut as fnv1aHash,U as getCachedBranch,so as getCurrentBranch,cc as getDefaultBranch,Ui as getEnvFile,Qi as getField,io as getGitStatus,gp as getHook,C as getLogDir,to as getLogLevel,Yn as getPluginRoot,g as getProjectDir,rc as getRepoRoot,D as getSessionId,ao as getStagedFiles,xc as guardBash,v as guardCodeFiles,Et as guardFileExtension,_c as guardGitCommand,Rc as guardMultiInstance,bc as guardNontrivialBash,Yt as guardPathPattern,hc as guardPythonFiles,q as guardSkipInternal,kc as guardTestFiles,te as guardTool,yc as guardTypescriptFiles,Sc as guardWriteEdit,ic as hasUncommittedChanges,xn as hooks,Si as isBashInput,P as isDontAskMode,bi as isEditInput,sc as isGitRepo,Ct as isProtectedBranch,_i as isReadInput,xi as isWriteInput,Yi as lineContainsAll,N as lineContainsAllCI,hp as listHooks,u as logHook,p as logPermissionFeedback,$t as normalizeCommand,Gi as normalizeLineEndings,f as outputAllowWithContext,Ki as outputBlock,h as outputDeny,Vi as outputError,no as outputPromptContext,Zi as outputPromptContextBudgeted,zi as outputSilentAllow,a as outputSilentSuccess,zt as outputStderrWarning,k as outputWarning,y as outputWithContext,qi as outputWithNotification,_ as outputWithUpdatedInput,Xi as readHookInput,O as runGuards,eo as shouldLog,Zt as validateBranchName,Ji as writeRulesFile};
//# sourceMappingURL=pretool.mjs.map
