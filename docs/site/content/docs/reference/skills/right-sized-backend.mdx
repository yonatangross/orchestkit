---
title: "Right Sized Backend"
description: "Context-aware backend architecture sizing. Prevents over-engineering for interviews and MVPs, ensures proper structure for enterprise. Use when starting a new project, evaluating architecture decisions, or reviewing project structure."
---

<span className="badge badge-blue">Command</span> <span className="badge badge-orange">high</span>

**Primary Agent:** [backend-system-architect](/docs/reference/agents/backend-system-architect)


# Right-Sized Backend Architecture

Stop defaulting to enterprise patterns for interview take-homes. Stop using flat files for production SaaS. This skill provides context-aware architecture recommendations calibrated to project scope.

## The Problem

AI coding assistants and developers share the same failure mode: applying the architecture they know best regardless of context. A senior engineer's muscle memory says "clean architecture, repository pattern, domain events" -- but that is the wrong answer for a 4-hour take-home. Conversely, a startup founder's "just ship it" instinct produces unmaintainable code when the product finds traction.

## Architecture Sizing Matrix

| Signal | Flat/Simple | Layered | Clean/Hexagonal |
|--------|-------------|---------|-----------------|
| **Timeline** | Hours to days | Weeks to months | Months to years |
| **Team size** | 1 developer | 2-5 developers | 5+ developers |
| **Expected lifespan** | Disposable / demo | 1-3 years | 3+ years |
| **Domain complexity** | CRUD, single entity | 3-10 entities, some rules | Complex invariants, multiple bounded contexts |
| **Compliance** | None | Basic (HTTPS, hashing) | SOC2, HIPAA, PCI |
| **Users** | &lt; 100 | 100 - 10,000 | 10,000+ |
| **LOC estimate** | 200-800 | 1,000-10,000 | 10,000+ |

## Decision Flowchart

```
Is this a take-home or hackathon?
  YES --> Flat architecture. Single file or 3-5 files. Done.
  NO  -->

Is this a prototype or MVP with < 3 months runway?
  YES --> Simple layered. Routes + services + models. No abstractions.
  NO  -->

Do you have > 5 engineers or complex domain rules?
  YES --> Clean architecture with ports/adapters.
  NO  --> Layered architecture. Add abstractions only when pain appears.
```

## Scenario Guides

Each scenario has a detailed reference file with file trees, code examples, LOC estimates, and explicit over-engineering traps.

| Scenario | Reference | Right-Sized LOC | Over-Engineered LOC |
|----------|-----------|-----------------|---------------------|
| Interview take-home | [interview-takehome.md](references/interview-takehome.md) | 300-600 | 2,000-4,000 |
| Startup MVP / SaaS | [startup-mvp.md](references/startup-mvp.md) | 2,000-5,000 | 15,000-30,000 |
| Enterprise migration | [enterprise.md](references/enterprise.md) | Varies | N/A (complexity is justified) |
| Open source CLI tool | [oss-cli-plugin.md](references/oss-cli-plugin.md) | 500-2,000 | 5,000-10,000 |

## Quick Reference: What to Use When

### ORM Approach

| Context | Recommendation | Anti-Pattern |
|---------|---------------|--------------|
| Interview | Raw SQL or simple ORM (SQLModel, Prisma) | Repository + Unit of Work + generic base |
| MVP | Simple ORM with models in same file as routes | Abstract repository protocol + factory |
| Production | ORM with repository pattern per aggregate | Every table gets its own repository class |
| Enterprise | Full repository + Unit of Work | Over-abstracting simple lookups |

### Authentication

| Context | Recommendation | Anti-Pattern |
|---------|---------------|--------------|
| Interview | Session cookies or hardcoded API key | Full OAuth2 + PKCE + refresh token rotation |
| MVP | Supabase Auth / Clerk / Auth0 | Rolling your own JWT + refresh + revocation |
| Production | JWT (15min access + 7d refresh) or managed auth | No refresh tokens, storing JWT in localStorage |
| Enterprise | OAuth2.1 + PKCE + SSO + MFA | Skipping SSO requirement |

### Error Handling

| Context | Recommendation | Anti-Pattern |
|---------|---------------|--------------|
| Interview | try/except with clear HTTP status codes | RFC 9457 Problem Details + error registry |
| MVP | FastAPI default validation + custom HTTPException | Custom exception hierarchy with 10+ classes |
| Production | Domain exceptions + RFC 9457 in API layer | Bare `except Exception: pass` |
| Enterprise | RFC 9457 + error codes + error catalog | No error correlation or request IDs |

### Testing

| Context | Recommendation | Anti-Pattern |
|---------|---------------|--------------|
| Interview | 3-5 smoke tests proving it works | 80% coverage with mocks for everything |
| MVP | Happy path integration tests + critical edge cases | Unit tests for every function including getters |
| Production | Integration + unit for business logic + E2E for flows | Testing framework code or third-party libraries |
| Enterprise | Full pyramid + contract tests + chaos testing | Skipping integration tests for unit test count |

## Context-Aware Enforcement

The `backend-architecture-enforcer` skill enforces clean architecture by default. To make it context-aware, the enforcer should check project signals before applying rules.

### Detection Signals

```python
# Pseudo-logic for context detection
def detect_project_tier(project_root: str) -> str:
    signals = {
        "has_dockerfile": exists("Dockerfile"),
        "has_ci": exists(".github/workflows") or exists(".gitlab-ci.yml"),
        "has_k8s": exists("k8s/") or exists("helm/"),
        "has_terraform": exists("terraform/") or exists("infra/"),
        "file_count": count_python_files(),
        "has_tests_dir": exists("tests/"),
        "has_alembic": exists("alembic/") or exists("migrations/"),
        "readme_mentions_takehome": grep("take-home|interview|assessment", "README.md"),
        "has_monorepo": exists("packages/") or exists("services/"),
    }

    if signals["readme_mentions_takehome"] or signals["file_count"] < 10:
        return "interview"
    elif not signals["has_ci"] and signals["file_count"] < 50:
        return "mvp"
    elif signals["has_k8s"] or signals["has_terraform"] or signals["has_monorepo"]:
        return "enterprise"
    else:
        return "production"
```

### Tier-Based Rule Adjustment

| Rule | Interview | MVP | Production | Enterprise |
|------|-----------|-----|------------|------------|
| Layer separation | OFF | WARN | BLOCK | BLOCK |
| File naming conventions | OFF | WARN | BLOCK | BLOCK |
| Repository pattern required | OFF | OFF | WARN | BLOCK |
| Domain exceptions required | OFF | OFF | BLOCK | BLOCK |
| Dependency injection | OFF | WARN | BLOCK | BLOCK |
| OpenAPI documentation | OFF | OFF | WARN | BLOCK |
| Rate limiting | OFF | WARN | BLOCK | BLOCK |

## The Over-Engineering Tax

Every abstraction has a cost. The table below estimates the LOC overhead of common patterns when applied unnecessarily.

| Pattern | LOC Overhead | Justified When | Tax When Applied To Interview |
|---------|-------------|----------------|-------------------------------|
| Repository pattern | +150-300 per entity | 3+ consumers of same data | +300 LOC for 1 consumer |
| Domain exceptions hierarchy | +50-100 | Services consumed by multiple transports | +100 LOC for 1 API |
| Generic base repository | +100-200 | 5+ repositories with shared queries | +200 LOC for 2 tables |
| Unit of Work | +150-250 | Cross-aggregate transactions | +250 LOC for single-table CRUD |
| Event sourcing | +500-2000 | Audit trail mandated, temporal queries | +2000 LOC for a blog |
| CQRS | +300-800 | Read/write models diverge significantly | +800 LOC for matching models |
| API versioning | +100-200 per version | Public API with external consumers | +200 LOC for internal API |
| RFC 9457 errors | +150-300 | Public API or multi-team | +300 LOC for demo |

## Anti-Patterns by Context

### Interview Anti-Patterns
- Writing more infrastructure code than business logic
- Adding Docker Compose with Redis, Postgres, and message queue
- Implementing full CI/CD pipeline
- Creating abstract base classes for 2 concrete implementations
- Spending 2 hours on auth for a 4-hour assignment

### MVP Anti-Patterns
- Microservices for a product with 0 users
- Event sourcing because "we might need it"
- Building auth from scratch instead of using Supabase/Clerk
- Over-indexing on "scalability" before product-market fit
- Kubernetes for a single container application

### Enterprise Anti-Patterns
- Using a flat file structure for 50+ services
- Shared database between microservices
- No API versioning for public-facing APIs
- Skipping contract tests between services
- "We'll add observability later"

## Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Default recommendation | Layered (not clean) | 80% of projects need layered, not hexagonal |
| Interview threshold | &lt; 10 files | Take-homes should demonstrate thinking, not scaffolding |
| MVP auth | Managed (Supabase/Clerk) | Auth is a solved problem; build your differentiator |
| When to add repository | 3+ query consumers | Below this, direct ORM access is simpler and clearer |
| When to add CQRS | Read/write models differ by 50%+ | Otherwise the indirection adds no value |

## Related Skills

- `backend-architecture-enforcer` - Layer separation enforcement (production/enterprise tier)
- `clean-architecture` - Hexagonal architecture and DDD (enterprise tier)
- `api-design-framework` - API design patterns (production+ tier)
- `project-structure-enforcer` - Folder structure (all tiers, with adjusted rules)
- `architecture-decision-record` - Document why you chose this architecture

## Capability Details

### architecture-sizing
**Keywords:** right size, over-engineering, architecture decision, project size, how much structure
**Solves:**
- What architecture should I use for this project?
- Am I over-engineering this?
- Is this take-home too complex?

### interview-architecture
**Keywords:** interview, take-home, coding challenge, assessment, demo
**Solves:**
- How should I structure a take-home project?
- What patterns are appropriate for an interview?
- How to impress without over-engineering

### mvp-architecture
**Keywords:** mvp, startup, prototype, saas, serverless, supabase, firebase
**Solves:**
- What architecture for an MVP?
- Should I use microservices for my startup?
- Serverless vs monolith for MVP

### enterprise-architecture
**Keywords:** enterprise, migration, microservices, governance, hexagonal
**Solves:**
- When is hexagonal architecture justified?
- Enterprise migration patterns
- Governance for large teams

### context-aware-enforcement
**Keywords:** context-aware, adaptive, tier, enforcement, rules
**Solves:**
- How to make architecture enforcement context-aware
- Adjust rules for project size
- Detect project tier automatically
