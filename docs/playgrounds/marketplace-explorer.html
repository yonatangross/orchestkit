<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OrchestKit Marketplace Explorer</title>
<link rel="stylesheet" href="nav.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Sora:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js" integrity="sha384-NNQgBjjuhtXzPmmy4gurS5X7P4uTt1DThyevz4Ua0IVK5+kazYQI1W27JHjbbxQz" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js" integrity="sha384-vdScihEZCfbPnBQf+lc7LgXUdJVYyhC3yWHUW5C5P5GpHRqVnaM6HJELJxT6IqwM" crossorigin="anonymous"></script>
<style>
  :root {
    --bg: #0d1117;
    --surface: #161b22;
    --surface2: #1c2128;
    --border: #30363d;
    --text: #e6edf3;
    --text-muted: #8b949e;
    --accent: #8b5cf6;
    --accent2: #22c55e;
    --accent3: #06b6d4;
    --accent4: #f59e0b;
    --accent5: #f97316;
    --accent6: #ec4899;
    --accent7: #ef4444;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Sora', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Noise texture overlay */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.03;
    pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    z-index: 1000;
  }

  /* Staggered card animations */
  @keyframes cardReveal {
    from { opacity: 0; transform: translateY(30px) scale(0.96); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }
  @keyframes heroGlow {
    0%, 100% { box-shadow: 0 0 60px rgba(139, 92, 246, 0.15), 0 0 100px rgba(6, 182, 212, 0.1); }
    50% { box-shadow: 0 0 80px rgba(139, 92, 246, 0.25), 0 0 120px rgba(6, 182, 212, 0.15); }
  }
  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
  }
  @keyframes pulseRing {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(1.5); opacity: 0; }
  }

  /* Header */
  .header {
    background: linear-gradient(180deg, rgba(26, 16, 64, 0.8) 0%, rgba(13, 17, 23, 0.95) 100%);
    border-bottom: 1px solid var(--border);
    padding: 32px 40px;
    position: sticky;
    top: 48px;
    z-index: 100;
    backdrop-filter: blur(12px);
  }
  .header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 10%;
    right: 10%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.5), rgba(6, 182, 212, 0.5), transparent);
  }
  .header-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  .logo {
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .logo-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--accent), var(--accent3));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 800;
    color: white;
    font-family: 'JetBrains Mono', monospace;
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
    position: relative;
  }
  .logo-icon::before {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: 14px;
    background: linear-gradient(135deg, var(--accent), var(--accent3));
    z-index: -1;
    opacity: 0.4;
    filter: blur(8px);
  }
  .logo h1 {
    font-size: 26px;
    font-weight: 800;
    letter-spacing: -0.5px;
    background: linear-gradient(135deg, #fff 0%, #c4b5fd 50%, #67e8f9 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .logo .version {
    font-size: 11px;
    color: var(--accent3);
    background: rgba(6, 182, 212, 0.1);
    border: 1px solid rgba(6, 182, 212, 0.3);
    padding: 3px 10px;
    border-radius: 20px;
    margin-left: 10px;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
  }

  /* Stats bar */
  .stats-bar {
    display: flex;
    gap: 32px;
    flex-wrap: wrap;
  }
  .stat {
    display: flex;
    align-items: baseline;
    gap: 8px;
    position: relative;
  }
  .stat::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, currentColor, transparent);
    opacity: 0.2;
    border-radius: 1px;
  }
  .stat-value {
    font-size: 32px;
    font-weight: 800;
    font-variant-numeric: tabular-nums;
    letter-spacing: -1px;
  }
  .stat-label {
    font-size: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
  }

  /* Search + Filters */
  .controls {
    padding: 18px 40px;
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    align-items: center;
    border-bottom: 1px solid var(--border);
    background: rgba(22, 27, 34, 0.8);
    backdrop-filter: blur(8px);
  }
  .search-box {
    flex: 1;
    min-width: 280px;
    position: relative;
  }
  .search-box input {
    width: 100%;
    padding: 12px 16px 12px 44px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-size: 14px;
    font-family: 'Sora', sans-serif;
    outline: none;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .search-box input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
  }
  .search-box::before {
    content: '';
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%238b949e'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E") center/contain no-repeat;
    opacity: 0.6;
  }
  #categoryFilters {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .filter-btn {
    padding: 9px 18px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 20px;
    color: var(--text-muted);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    white-space: nowrap;
  }
  .filter-btn:hover {
    border-color: var(--accent);
    color: var(--text);
    background: rgba(139, 92, 246, 0.08);
  }
  .filter-btn.active {
    background: linear-gradient(135deg, var(--accent), #7c3aed);
    border-color: transparent;
    color: white;
    box-shadow: 0 2px 12px rgba(139, 92, 246, 0.3);
  }
  .view-toggle {
    display: flex;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    padding: 3px;
    gap: 2px;
  }
  .view-btn {
    padding: 8px 16px;
    background: none;
    border: none;
    border-radius: 7px;
    color: var(--text-muted);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  .view-btn.active {
    background: linear-gradient(135deg, var(--accent), #7c3aed);
    color: white;
    box-shadow: 0 2px 8px rgba(139, 92, 246, 0.25);
  }
  .view-btn:hover:not(.active) {
    color: var(--text);
    background: rgba(139, 92, 246, 0.1);
  }

  /* Main content */
  .main { padding: 32px 40px; }

  /* GRID VIEW - Editorial Magazine Layout */
  .grid-view {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 20px;
  }

  /* Hero card for main plugin */
  .plugin-card.hero-card {
    grid-column: span 12;
    background: linear-gradient(135deg, rgba(26, 16, 64, 0.6) 0%, rgba(13, 17, 23, 0.95) 50%, rgba(10, 22, 40, 0.8) 100%);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 20px;
    padding: 36px 40px;
    position: relative;
    overflow: hidden;
    animation: heroGlow 4s ease-in-out infinite;
  }
  .plugin-card.hero-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent), var(--accent3), transparent);
  }
  .plugin-card.hero-card::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 60%;
    height: 200%;
    background: radial-gradient(ellipse, rgba(139, 92, 246, 0.08) 0%, transparent 70%);
    pointer-events: none;
  }
  .plugin-card.hero-card .card-name {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: -0.5px;
  }
  .plugin-card.hero-card .card-desc {
    font-size: 15px;
    max-width: 600px;
    -webkit-line-clamp: 3;
  }
  .plugin-card.hero-card .card-metrics {
    gap: 28px;
  }
  .plugin-card.hero-card .card-metric {
    font-size: 15px;
  }
  .plugin-card.hero-card .card-metric .count {
    font-size: 22px;
  }
  .hero-badge {
    position: absolute;
    top: 20px;
    right: 24px;
    background: linear-gradient(135deg, var(--accent), var(--accent3));
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 6px 14px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 1px;
    animation: float 3s ease-in-out infinite;
  }

  /* Standard plugin cards */
  .plugin-card {
    grid-column: span 6;
    background: linear-gradient(180deg, rgba(22, 27, 34, 0.9) 0%, rgba(22, 27, 34, 0.7) 100%);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    cursor: pointer;
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    animation: cardReveal 0.5s cubic-bezier(0.4, 0, 0.2, 1) backwards;
    transform-style: preserve-3d;
    perspective: 1000px;
  }
  .plugin-card:nth-child(2) { animation-delay: 0.1s; }
  .plugin-card:nth-child(3) { animation-delay: 0.15s; }
  .plugin-card:nth-child(4) { animation-delay: 0.2s; }
  .plugin-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .plugin-card:hover::before { opacity: 1; }
  .plugin-card:hover {
    border-color: rgba(139, 92, 246, 0.5);
    transform: translateY(-6px) rotateX(2deg);
    box-shadow:
      0 20px 40px rgba(0, 0, 0, 0.3),
      0 0 40px rgba(139, 92, 246, 0.1),
      inset 0 1px 0 rgba(255,255,255,0.05);
  }
  .plugin-card.expanded {
    grid-column: 1 / -1;
    transform: none;
  }
  .plugin-card.expanded:hover {
    transform: none;
  }

  /* Card accent line */
  .card-accent-line {
    position: absolute;
    bottom: 0;
    left: 24px;
    right: 24px;
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent3));
    border-radius: 2px;
    transform: scaleX(0);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .plugin-card:hover .card-accent-line { transform: scaleX(1); }

  .card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 14px;
  }
  .card-name {
    font-size: 18px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
    letter-spacing: -0.3px;
  }
  .card-category {
    font-size: 10px;
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    backdrop-filter: blur(4px);
  }
  .card-desc {
    font-size: 13px;
    color: var(--text-muted);
    line-height: 1.6;
    margin-bottom: 18px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .card-metrics {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  .card-metric {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
  }
  .card-metric .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    position: relative;
  }
  .card-metric .dot::after {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: 50%;
    background: inherit;
    opacity: 0.3;
    filter: blur(3px);
  }
  .card-metric .count {
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    font-family: 'JetBrains Mono', monospace;
  }
  .card-metric .label {
    color: var(--text-muted);
    font-size: 12px;
  }

  /* Responsive: smaller screens show 1 card per row */
  @media (max-width: 900px) {
    .plugin-card { grid-column: span 12; }
    .plugin-card.hero-card { padding: 24px; }
  }

  /* Card expanded content */
  .card-details {
    display: none;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }
  .plugin-card.expanded .card-details { display: block; }
  .plugin-card.expanded .card-desc {
    -webkit-line-clamp: unset;
    overflow: visible;
  }
  .detail-section {
    margin-bottom: 14px;
  }
  .detail-section h4 {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    margin-bottom: 8px;
  }
  .tag-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }
  .tag {
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 6px;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'SF Mono', 'Fira Code', monospace;
    transition: all 0.15s;
    cursor: default;
  }
  .tag:hover {
    border-color: var(--accent);
    background: rgba(139, 92, 246, 0.1);
  }
  .tag.agent-tag {
    border-color: rgba(34, 197, 94, 0.3);
    background: rgba(34, 197, 94, 0.08);
  }
  .tag.agent-tag:hover {
    border-color: var(--accent2);
    background: rgba(34, 197, 94, 0.15);
  }
  .tag.command-tag {
    border-color: rgba(6, 182, 212, 0.3);
    background: rgba(6, 182, 212, 0.08);
  }

  /* AGENTS VIEW */
  .agents-view { display: none; }
  .agents-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 16px;
  }
  .agent-card {
    background: linear-gradient(180deg, rgba(22, 27, 34, 0.9) 0%, rgba(22, 27, 34, 0.7) 100%);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 20px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  .agent-card::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(180deg, var(--accent2), #10b981);
    transform: scaleY(0);
    transition: transform 0.3s;
  }
  .agent-card:hover::before { transform: scaleY(1); }
  .agent-card:hover {
    border-color: rgba(34, 197, 94, 0.4);
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2), 0 0 20px rgba(34, 197, 94, 0.1);
  }
  .agent-name {
    font-size: 16px;
    font-weight: 700;
    color: var(--accent2);
    margin-bottom: 6px;
    font-family: 'SF Mono', 'Fira Code', monospace;
  }
  .agent-desc {
    font-size: 12px;
    color: var(--text-muted);
    line-height: 1.5;
    margin-bottom: 10px;
  }
  .agent-plugins {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }
  .agent-plugin-tag {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    background: rgba(139, 92, 246, 0.15);
    color: var(--accent);
    font-family: 'SF Mono', 'Fira Code', monospace;
  }

  /* Category colors */
  .cat-development { background: rgba(139, 92, 246, 0.15); color: var(--accent); border: 1px solid rgba(139, 92, 246, 0.3); }
  .cat-ai { background: rgba(6, 182, 212, 0.15); color: var(--accent3); border: 1px solid rgba(6, 182, 212, 0.3); }
  .cat-backend { background: rgba(245, 158, 11, 0.15); color: var(--accent4); border: 1px solid rgba(245, 158, 11, 0.3); }
  .cat-frontend { background: rgba(236, 72, 153, 0.15); color: var(--accent6); border: 1px solid rgba(236, 72, 153, 0.3); }
  .cat-testing { background: rgba(34, 197, 94, 0.15); color: var(--accent2); border: 1px solid rgba(34, 197, 94, 0.3); }
  .cat-security { background: rgba(239, 68, 68, 0.15); color: var(--accent7); border: 1px solid rgba(239, 68, 68, 0.3); }
  .cat-devops { background: rgba(249, 115, 22, 0.15); color: var(--accent5); border: 1px solid rgba(249, 115, 22, 0.3); }
  .cat-product { background: rgba(168, 85, 247, 0.15); color: #a855f7; border: 1px solid rgba(168, 85, 247, 0.3); }
  .cat-accessibility { background: rgba(20, 184, 166, 0.15); color: #14b8a6; border: 1px solid rgba(20, 184, 166, 0.3); }
  .cat-data { background: rgba(99, 102, 241, 0.15); color: #6366f1; border: 1px solid rgba(99, 102, 241, 0.3); }

  /* Tooltip */
  .tooltip {
    position: fixed;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    font-size: 13px;
    max-width: 300px;
    pointer-events: none;
    z-index: 1000;
    display: none;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  }
  .tooltip-name {
    font-weight: 700;
    margin-bottom: 4px;
  }
  .tooltip-desc {
    color: var(--text-muted);
    font-size: 12px;
    line-height: 1.4;
  }

  /* ‚ïê‚ïê‚ïê INLINE DETAIL EXPANSION - Enhanced ‚ïê‚ïê‚ïê */
  .tag-detail {
    display: none;
    margin-top: 14px;
    padding: 18px;
    background: linear-gradient(135deg, rgba(13, 17, 23, 0.95), rgba(22, 27, 34, 0.9));
    border: 1px solid rgba(48, 54, 61, 0.6);
    border-radius: 12px;
    animation: detailSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    backdrop-filter: blur(8px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.03);
  }
  .tag-detail::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.4), transparent);
  }
  .tag-detail::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 3px;
    height: 100%;
    background: linear-gradient(180deg, var(--accent), var(--accent3));
    border-radius: 3px 0 0 3px;
  }
  .tag-detail.visible { display: block; }
  @keyframes detailSlideIn {
    from { opacity: 0; transform: translateY(-12px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }
  .tag-detail-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 14px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(48, 54, 61, 0.4);
  }
  .tag-detail-title {
    font-size: 15px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .tag-detail-type {
    font-size: 9px;
    padding: 4px 10px;
    border-radius: 4px;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 0.8px;
    border: 1px solid transparent;
  }
  .tag-detail-type.skill {
    background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(6, 182, 212, 0.05));
    color: #22d3ee;
    border-color: rgba(6, 182, 212, 0.3);
    text-shadow: 0 0 10px rgba(6, 182, 212, 0.4);
  }
  .tag-detail-type.agent {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05));
    color: #4ade80;
    border-color: rgba(34, 197, 94, 0.3);
    text-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
  }
  .tag-detail-type.command {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(139, 92, 246, 0.05));
    color: #c4b5fd;
    border-color: rgba(139, 92, 246, 0.3);
    text-shadow: 0 0 10px rgba(139, 92, 246, 0.4);
  }
  .tag-detail-close {
    width: 24px;
    height: 24px;
    border-radius: 6px;
    border: 1px solid rgba(48, 54, 61, 0.6);
    background: rgba(239, 68, 68, 0.05);
    color: #9ca3af;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    flex-shrink: 0;
  }
  .tag-detail-close:hover {
    border-color: rgba(239, 68, 68, 0.5);
    background: rgba(239, 68, 68, 0.15);
    color: #f87171;
    transform: rotate(90deg);
  }
  .tag-detail-desc {
    font-size: 13px;
    color: #9ca3af;
    line-height: 1.6;
    margin-bottom: 10px;
  }
  .tag-detail-row {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    margin-bottom: 6px;
    font-size: 11px;
  }
  .tag-detail-label {
    color: var(--text-muted);
    min-width: 60px;
    flex-shrink: 0;
  }
  .tag-detail-value {
    color: var(--text);
    font-family: 'SF Mono', 'Fira Code', monospace;
  }
  .tag-detail-plugins {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }
  .tag-detail-plugin {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.2);
    color: var(--accent);
    font-family: 'SF Mono', 'Fira Code', monospace;
  }
  .tag-detail-doc-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 10px;
    padding: 6px 12px;
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 6px;
    color: var(--accent);
    font-size: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
  }
  .tag-detail-doc-link:hover {
    background: rgba(139, 92, 246, 0.2);
    border-color: var(--accent);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SKILL DETAIL VIEW - "Neon Terminal" Aesthetic
     Sophisticated dark theme with glowing accents & micro-interactions
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  /* Keyframe Animations */
  @keyframes skillPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  @keyframes skillSlideIn {
    from { opacity: 0; transform: translateX(-8px); }
    to { opacity: 1; transform: translateX(0); }
  }
  @keyframes skillGlow {
    0%, 100% { box-shadow: 0 0 4px currentColor; }
    50% { box-shadow: 0 0 12px currentColor, 0 0 20px currentColor; }
  }
  @keyframes skillExpand {
    from { opacity: 0; max-height: 0; }
    to { opacity: 1; max-height: 500px; }
  }
  @keyframes tagFloat {
    from { opacity: 0; transform: translateY(6px) scale(0.9); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }
  @keyframes borderGlow {
    0%, 100% { border-color: rgba(139, 92, 246, 0.3); }
    50% { border-color: rgba(139, 92, 246, 0.6); }
  }

  /* Header Row */
  .skill-header-row {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  /* Version Badge - Holographic style */
  .skill-version-badge {
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 4px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.15));
    color: #818cf8;
    font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', monospace;
    border: 1px solid rgba(99, 102, 241, 0.3);
    text-shadow: 0 0 8px rgba(99, 102, 241, 0.5);
    letter-spacing: 0.5px;
    transition: all 0.2s ease;
  }
  .skill-version-badge:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.25));
    box-shadow: 0 0 12px rgba(99, 102, 241, 0.3);
  }

  /* Invocable Badge - Glowing neon */
  .skill-invocable-badge {
    font-size: 9px;
    padding: 3px 10px;
    border-radius: 20px;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(16, 185, 129, 0.1));
    color: #4ade80;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 1px;
    border: 1px solid rgba(34, 197, 94, 0.4);
    text-shadow: 0 0 10px rgba(34, 197, 94, 0.6);
    animation: skillPulse 2s ease-in-out infinite;
    position: relative;
  }
  .skill-invocable-badge::before {
    content: '';
    position: absolute;
    inset: -1px;
    border-radius: inherit;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), transparent);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .skill-invocable-badge:hover::before {
    opacity: 1;
  }

  /* Tag Chips Container */
  .skill-tag-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid rgba(139, 92, 246, 0.1);
  }

  /* Individual Tag Chip - Glassmorphism */
  .skill-tag-chip {
    font-size: 10px;
    padding: 4px 10px;
    border-radius: 6px;
    background: rgba(139, 92, 246, 0.08);
    border: 1px solid rgba(139, 92, 246, 0.2);
    color: #c4b5fd;
    font-family: 'JetBrains Mono', 'SF Mono', monospace;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: default;
    animation: tagFloat 0.3s ease-out backwards;
    position: relative;
    overflow: hidden;
  }
  .skill-tag-chip:nth-child(1) { animation-delay: 0.05s; }
  .skill-tag-chip:nth-child(2) { animation-delay: 0.1s; }
  .skill-tag-chip:nth-child(3) { animation-delay: 0.15s; }
  .skill-tag-chip:nth-child(4) { animation-delay: 0.2s; }
  .skill-tag-chip:nth-child(5) { animation-delay: 0.25s; }
  .skill-tag-chip:nth-child(6) { animation-delay: 0.3s; }
  .skill-tag-chip::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.5s;
  }
  .skill-tag-chip:hover {
    background: rgba(139, 92, 246, 0.2);
    border-color: rgba(139, 92, 246, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
  }
  .skill-tag-chip:hover::before {
    left: 100%;
  }

  /* ‚ïê‚ïê‚ïê FOLDER STRUCTURE TREE ‚ïê‚ïê‚ïê */
  .skill-structure-tree {
    margin-top: 16px;
    padding: 14px;
    background: linear-gradient(180deg, rgba(22, 27, 34, 0.8), rgba(13, 17, 23, 0.9));
    border-radius: 10px;
    font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', monospace;
    font-size: 12px;
    border: 1px solid rgba(48, 54, 61, 0.6);
    position: relative;
    overflow: hidden;
  }
  .skill-structure-tree::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.5), transparent);
  }

  .skill-structure-header {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: #6b7280;
    margin-bottom: 12px;
    font-family: system-ui, -apple-system, sans-serif;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .skill-structure-header::before {
    content: '>';
    color: var(--accent);
    animation: skillPulse 1s infinite;
  }

  /* Folder Row */
  .skill-folder {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    margin: 2px 0;
    color: var(--text);
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    background: transparent;
  }
  .skill-folder:hover {
    background: rgba(139, 92, 246, 0.08);
    padding-left: 14px;
  }
  .skill-folder:active {
    transform: scale(0.98);
  }

  /* Folder Icon - Animated */
  .skill-folder-icon {
    font-size: 14px;
    transition: transform 0.2s ease;
    filter: drop-shadow(0 0 4px rgba(245, 158, 11, 0.4));
  }
  .skill-folder:hover .skill-folder-icon {
    transform: scale(1.1);
    filter: drop-shadow(0 0 8px rgba(245, 158, 11, 0.6));
  }
  .skill-folder.open .skill-folder-icon {
    transform: rotate(-10deg);
  }

  /* Folder Name */
  .skill-folder-name {
    font-weight: 600;
    color: #e6edf3;
    transition: color 0.2s;
  }
  .skill-folder:hover .skill-folder-name {
    color: var(--accent);
  }

  /* Folder Count Badge */
  .skill-folder-count {
    font-size: 10px;
    color: #6b7280;
    background: rgba(107, 114, 128, 0.15);
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: auto;
    transition: all 0.2s;
  }
  .skill-folder:hover .skill-folder-count {
    background: rgba(139, 92, 246, 0.2);
    color: #c4b5fd;
  }

  /* Chevron Indicator */
  .skill-folder-chevron {
    font-size: 10px;
    color: #6b7280;
    transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    margin-left: 4px;
  }
  .skill-folder.open .skill-folder-chevron {
    transform: rotate(90deg);
    color: var(--accent);
  }

  /* Files Container - Animated Expand */
  .skill-files {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin-left: 24px;
    position: relative;
  }
  .skill-files::before {
    content: '';
    position: absolute;
    left: 6px;
    top: 0;
    bottom: 0;
    width: 1px;
    background: linear-gradient(180deg, rgba(139, 92, 246, 0.4), transparent);
  }
  .skill-files-inner {
    overflow: hidden;
  }
  .skill-files.expanded {
    grid-template-rows: 1fr;
  }

  /* Individual File */
  .skill-file {
    color: #9ca3af;
    padding: 6px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    transition: all 0.15s ease;
    border-radius: 4px;
    margin: 1px 0;
    animation: skillSlideIn 0.2s ease-out backwards;
  }
  .skill-file:nth-child(1) { animation-delay: 0.05s; }
  .skill-file:nth-child(2) { animation-delay: 0.1s; }
  .skill-file:nth-child(3) { animation-delay: 0.15s; }
  .skill-file:nth-child(4) { animation-delay: 0.2s; }
  .skill-file:hover {
    background: rgba(6, 182, 212, 0.08);
    color: #e6edf3;
    padding-left: 16px;
  }

  /* File Icon */
  .skill-file-icon {
    font-size: 11px;
    opacity: 0.7;
    transition: all 0.15s;
  }
  .skill-file:hover .skill-file-icon {
    opacity: 1;
    filter: drop-shadow(0 0 4px rgba(6, 182, 212, 0.5));
  }

  /* ‚ïê‚ïê‚ïê RELATED AGENTS SECTION ‚ïê‚ïê‚ïê */
  .skill-related-section {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid rgba(48, 54, 61, 0.5);
    position: relative;
  }
  .skill-related-section::before {
    content: '';
    position: absolute;
    top: -1px;
    left: 20%;
    right: 20%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.4), transparent);
  }

  .skill-related-label {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: #6b7280;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .skill-related-label::before {
    content: '';
    width: 6px;
    height: 6px;
    background: var(--accent2);
    border-radius: 50%;
    animation: skillPulse 1.5s infinite;
    box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
  }

  .skill-related-items {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  /* Agent Item - Pill with glow effect */
  .skill-related-item {
    font-size: 10px;
    padding: 5px 12px;
    border-radius: 20px;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.08), rgba(16, 185, 129, 0.05));
    border: 1px solid rgba(34, 197, 94, 0.25);
    color: #86efac;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    font-family: 'JetBrains Mono', 'SF Mono', monospace;
    position: relative;
    overflow: hidden;
  }
  .skill-related-item::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 0%, rgba(34, 197, 94, 0.2), transparent 70%);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .skill-related-item:hover {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(16, 185, 129, 0.15));
    border-color: rgba(34, 197, 94, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(34, 197, 94, 0.2), 0 0 20px rgba(34, 197, 94, 0.1);
    color: #4ade80;
  }
  .skill-related-item:hover::before {
    opacity: 1;
  }
  .skill-related-item:active {
    transform: translateY(0) scale(0.98);
  }

  /* GitHub Link - Enhanced */
  .tag-detail-doc-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-top: 14px;
    padding: 8px 16px;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(99, 102, 241, 0.05));
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 8px;
    color: #c4b5fd;
    font-size: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  .tag-detail-doc-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.15), transparent);
    transition: left 0.5s;
  }
  .tag-detail-doc-link:hover {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(99, 102, 241, 0.15));
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.25);
    color: #e6edf3;
  }
  .tag-detail-doc-link:hover::before {
    left: 100%;
  }

  .skill-empty-structure {
    color: #6b7280;
    font-style: italic;
    font-size: 11px;
    padding: 8px;
    text-align: center;
  }

  /* ‚ïê‚ïê‚ïê SKILL CATEGORY GROUPING ‚ïê‚ïê‚ïê */
  .skills-grouped-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .skill-category-group {
    background: linear-gradient(135deg, rgba(22, 27, 34, 0.6), rgba(13, 17, 23, 0.4));
    border: 1px solid rgba(48, 54, 61, 0.5);
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.2s ease;
  }
  .skill-category-group.collapsed .skill-category-tags {
    display: none;
  }
  .skill-category-group.collapsed .skill-category-detail {
    display: none !important;
  }
  .skill-category-group.initially-hidden {
    display: none;
  }
  .skill-category-group.initially-hidden.collapsed {
    display: none;
  }
  .skill-category-group:hover {
    border-color: rgba(139, 92, 246, 0.3);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  }
  .skill-category-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    background: rgba(22, 27, 34, 0.8);
    border-left: 3px solid var(--accent);
    cursor: pointer;
    transition: all 0.15s ease;
  }
  .skill-category-header:hover {
    background: rgba(30, 35, 44, 0.9);
  }
  .skill-category-group:not(.collapsed) .skill-category-header {
    border-bottom: 1px solid rgba(48, 54, 61, 0.4);
  }
  .skill-category-icon {
    font-size: 14px;
    line-height: 1;
  }
  .skill-category-name {
    font-size: 12px;
    font-weight: 700;
    color: #e6edf3;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .skill-category-count {
    font-size: 10px;
    color: #9ca3af;
    background: rgba(107, 114, 128, 0.2);
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: auto;
    font-family: 'JetBrains Mono', 'SF Mono', monospace;
  }
  .skill-category-chevron {
    font-size: 10px;
    color: #6b7280;
    transition: transform 0.2s ease;
    margin-left: 6px;
  }
  .skill-category-group:not(.collapsed) .skill-category-chevron {
    transform: rotate(90deg);
    color: var(--accent);
  }
  .skill-category-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 12px 14px;
    animation: skillSlideIn 0.2s ease-out;
  }
  .skill-category-tags .tag {
    font-size: 11px;
    padding: 4px 10px;
    background: rgba(22, 27, 34, 0.6);
    transition: all 0.15s ease;
  }
  .skill-category-tags .tag:hover {
    background: rgba(139, 92, 246, 0.15);
    transform: translateY(-1px);
  }
  .skill-category-detail {
    margin: 0 14px 14px 14px;
    border-radius: 8px;
  }
  .skill-category-detail.visible {
    margin-top: 8px;
  }

  /* Show All Categories Button */
  .show-all-categories {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 20px;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(99, 102, 241, 0.05));
    border: 1px dashed rgba(139, 92, 246, 0.3);
    border-radius: 10px;
    color: #c4b5fd;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-top: 4px;
  }
  .show-all-categories:hover {
    background: rgba(139, 92, 246, 0.15);
    border-color: var(--accent);
    color: #e6edf3;
  }
  .show-all-categories.expanded {
    background: rgba(107, 114, 128, 0.1);
    border-color: rgba(107, 114, 128, 0.3);
    color: #9ca3af;
  }

  /* Install Quick Action */
  .card-quick-actions {
    display: flex;
    gap: 8px;
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid rgba(48, 54, 61, 0.4);
  }
  .quick-action-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid transparent;
  }
  .quick-action-btn.primary {
    background: linear-gradient(135deg, var(--accent), #7c3aed);
    color: white;
    box-shadow: 0 2px 12px rgba(139, 92, 246, 0.3);
  }
  .quick-action-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
  }
  .quick-action-btn.secondary {
    background: rgba(48, 54, 61, 0.5);
    border-color: var(--border);
    color: var(--text-muted);
  }
  .quick-action-btn.secondary:hover {
    background: rgba(48, 54, 61, 0.8);
    color: var(--text);
    border-color: rgba(139, 92, 246, 0.3);
  }
  .quick-action-btn.copied {
    background: linear-gradient(135deg, var(--accent2), #16a34a) !important;
  }

  /* Breadcrumb in detail panel */
  .detail-breadcrumb {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 10px;
    color: #6b7280;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(48, 54, 61, 0.3);
  }
  .detail-breadcrumb span {
    color: #9ca3af;
  }
  .detail-breadcrumb .sep {
    color: #4b5563;
  }
  .detail-breadcrumb .current {
    color: var(--accent);
    font-weight: 600;
  }

  /* Empty state */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 40px;
    text-align: center;
    grid-column: 1 / -1;
  }
  .empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
  }
  .empty-state-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 8px;
  }
  .empty-state-desc {
    font-size: 14px;
    color: var(--text-muted);
    max-width: 400px;
    line-height: 1.6;
  }
  .empty-state-action {
    margin-top: 20px;
    padding: 10px 20px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .empty-state-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
  }

  /* Search result count */
  .search-result-count {
    font-size: 12px;
    color: var(--text-muted);
    padding: 6px 12px;
    background: rgba(139, 92, 246, 0.1);
    border-radius: 20px;
    white-space: nowrap;
  }
  .search-result-count strong {
    color: var(--accent);
  }

  /* ‚ïê‚ïê‚ïê SKILL CONTENT / README SECTION ‚ïê‚ïê‚ïê */
  .skill-content-section {
    margin-top: 16px;
    padding: 16px;
    background: linear-gradient(180deg, rgba(13, 17, 23, 0.95), rgba(22, 27, 34, 0.9));
    border-radius: 10px;
    border: 1px solid rgba(48, 54, 61, 0.6);
    max-height: 400px;
    overflow-y: auto;
    position: relative;
  }
  .skill-content-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(6, 182, 212, 0.4), transparent);
  }
  .skill-content-header {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: #6b7280;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .skill-content-header::before {
    content: 'üìñ';
    font-size: 12px;
  }
  .skill-content-body {
    font-size: 13px;
    line-height: 1.7;
    color: #d1d5db;
  }
  .skill-content-body h1, .skill-content-body h2, .skill-content-body h3 {
    color: #e6edf3;
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: 700;
    border-bottom: 1px solid rgba(48, 54, 61, 0.5);
    padding-bottom: 6px;
  }
  .skill-content-body h1 { font-size: 18px; color: var(--accent3); }
  .skill-content-body h2 { font-size: 15px; color: #a78bfa; }
  .skill-content-body h3 { font-size: 13px; color: #9ca3af; border-bottom: none; }
  .skill-content-body h1:first-child { margin-top: 0; }
  .skill-content-body p { margin-bottom: 12px; }
  .skill-content-body code {
    background: rgba(99, 102, 241, 0.15);
    color: #c4b5fd;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
  }
  .skill-content-body pre {
    background: rgba(13, 17, 23, 0.9);
    border: 1px solid rgba(48, 54, 61, 0.6);
    border-radius: 8px;
    padding: 12px 14px;
    overflow-x: auto;
    margin: 12px 0;
  }
  .skill-content-body pre code {
    background: none;
    padding: 0;
    font-size: 11px;
    line-height: 1.5;
    color: #9ca3af;
  }
  .skill-content-body ul, .skill-content-body ol {
    margin: 10px 0;
    padding-left: 24px;
  }
  .skill-content-body li {
    margin-bottom: 6px;
  }
  .skill-content-body table {
    width: 100%;
    border-collapse: collapse;
    margin: 12px 0;
    font-size: 12px;
  }
  .skill-content-body th, .skill-content-body td {
    border: 1px solid rgba(48, 54, 61, 0.5);
    padding: 8px 10px;
    text-align: left;
  }
  .skill-content-body th {
    background: rgba(99, 102, 241, 0.1);
    color: #c4b5fd;
    font-weight: 600;
  }
  .skill-content-body blockquote {
    border-left: 3px solid var(--accent);
    padding-left: 14px;
    margin: 12px 0;
    color: #9ca3af;
    font-style: italic;
  }
  .skill-content-body a {
    color: var(--accent3);
    text-decoration: none;
  }
  .skill-content-body a:hover {
    text-decoration: underline;
  }
  .skill-content-truncated {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px dashed rgba(48, 54, 61, 0.5);
    font-size: 11px;
    color: #6b7280;
    text-align: center;
  }

  /* Prompt output */
  .prompt-section {
    margin-top: 24px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px 20px;
  }
  .prompt-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .prompt-header h3 {
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
  }
  .copy-btn {
    padding: 6px 14px;
    background: var(--accent);
    border: none;
    border-radius: 6px;
    color: white;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .copy-btn:hover { filter: brightness(1.15); }
  .copy-btn.copied {
    background: var(--accent2);
  }
  .prompt-output {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 13px;
    line-height: 1.6;
    color: var(--text);
    white-space: pre-wrap;
    word-break: break-word;
  }

  @media (max-width: 768px) {
    .header, .controls, .main { padding-left: 16px; padding-right: 16px; }
    .stats-bar { gap: 16px; }
    .stat-value { font-size: 22px; }
    .grid-view { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<nav class="ork-breadcrumbs" id="breadcrumbs" aria-label="Breadcrumb"></nav>

<div class="header">
  <div class="header-top">
    <div class="logo">
      <div class="logo-icon">ork</div>
      <h1>OrchestKit Marketplace<span class="version">v6.0.0</span></h1>
    </div>
  </div>
  <div class="stats-bar" id="statsBar"></div>
</div>

<div class="controls">
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search plugins, skills, agents...">
  </div>
  <div id="categoryFilters"></div>
  <div class="view-toggle">
    <button class="view-btn active" data-view="grid">Plugins</button>
    <button class="view-btn" data-view="agents">Agents</button>
  </div>
</div>

<div class="main">
  <div class="grid-view" id="gridView"></div>
  <div class="agents-view" id="agentsView">
    <div class="agents-grid" id="agentsGrid"></div>
  </div>
  <div class="prompt-section">
    <div class="prompt-header">
      <h3>Install Command</h3>
      <button class="copy-btn" id="copyBtn" onclick="copyPrompt()">Copy</button>
    </div>
    <div class="prompt-output" id="promptOutput"></div>
  </div>
</div>

<div class="tooltip" id="tooltip">
  <div class="tooltip-name" id="tooltipName"></div>
  <div class="tooltip-desc" id="tooltipDesc"></div>
</div>

<script src="data.js"></script>
<script src="nav.js"></script>
<script>
// Compatibility shim: map shared data to local variable names
var PLUGINS = ORCHESTKIT_DATA.plugins.map(function(p) {
  return { name: p.name, desc: p.description, category: p.category, version: p.version,
    skills: p.skills, agents: p.agents, hooks: p.hooks, commands: p.commands,
    skillCount: p.skillCount, commandCount: p.commandCount };
});
var AGENTS = ORCHESTKIT_DATA.agents.map(function(a) {
  return { name: a.name, desc: a.description, plugins: a.plugins };
});
var CAT_COLORS = {};
Object.keys(ORCHESTKIT_DATA.categories).forEach(function(k) {
  CAT_COLORS[k] = { bg: ORCHESTKIT_DATA.categories[k].color, label: ORCHESTKIT_DATA.categories[k].label };
});

// Initialize from URL parameters
var urlParams = window.orkUrl ? window.orkUrl.getParams() : {};

// State
var state = {
  search: urlParams.search || '',
  category: urlParams.category || 'all',
  view: urlParams.view || 'grid',
  expandedCard: null,
  selectedPlugins: new Set(),
};

// Sync state to URL
function syncToUrl() {
  if (!window.orkUrl) return;
  var params = {};
  if (state.search) params.search = state.search;
  if (state.category !== 'all') params.category = state.category;
  if (state.view !== 'grid') params.view = state.view;
  window.orkUrl.setParams(params);
}

// Update breadcrumbs
function updateBreadcrumbs() {
  if (!window.orkBreadcrumbs) return;
  window.orkBreadcrumbs.render('breadcrumbs', 'marketplace-explorer.html', null);
}

// Computed
function getFilteredPlugins() {
  return PLUGINS.filter(function(p) {
    if (state.category !== 'all' && p.category !== state.category) return false;
    if (state.search) {
      var q = state.search.toLowerCase();
      return p.name.toLowerCase().indexOf(q) !== -1 ||
             p.desc.toLowerCase().indexOf(q) !== -1 ||
             p.skills.some(function(s) { return s.toLowerCase().indexOf(q) !== -1; }) ||
             p.agents.some(function(a) { return a.toLowerCase().indexOf(q) !== -1; });
    }
    return true;
  });
}

function getTotals() {
  // Use pre-calculated totals from data.js (avoids double-counting shared components)
  return ORCHESTKIT_DATA.totals;
}

// Render stats
function renderStats() {
  var t = getTotals();
  document.getElementById('statsBar').innerHTML =
    '<div class="stat"><span class="stat-value" style="color:var(--accent)">' + t.plugins + '</span><span class="stat-label">Plugins</span></div>' +
    '<div class="stat"><span class="stat-value" style="color:var(--accent3)">' + t.skills + '</span><span class="stat-label">Skills</span></div>' +
    '<div class="stat"><span class="stat-value" style="color:var(--accent2)">' + t.agents + '</span><span class="stat-label">Agents</span></div>' +
    '<div class="stat"><span class="stat-value" style="color:var(--accent4)">' + t.hooks + '</span><span class="stat-label">Hooks</span></div>' +
    '<div class="stat"><span class="stat-value" style="color:var(--accent5)">' + t.commands + '</span><span class="stat-label">Commands</span></div>';
}

// Render filters
function renderFilters() {
  var catMap = {};
  PLUGINS.forEach(function(p) { catMap[p.category] = true; });
  var cats = Object.keys(catMap);
  var el = document.getElementById('categoryFilters');

  // Search result count - only show when searching
  var filteredCount = getFilteredPlugins().length;
  var resultCountHtml = '';
  if (state.search) {
    resultCountHtml = '<span class="search-result-count"><strong>' + filteredCount + '</strong> ' + (filteredCount === 1 ? 'result' : 'results') + '</span>';
  }

  // Only show category filters if there's more than one category
  // (With only 2 plugins both in "development", filter buttons are redundant)
  var categoryFiltersHtml = '';
  if (cats.length > 1) {
    categoryFiltersHtml = '<button class="filter-btn ' + (state.category === 'all' ? 'active' : '') + '" onclick="setCategory(\'all\')">All</button>' +
      cats.map(function(c) {
        var catInfo = CAT_COLORS[c];
        var label = catInfo ? catInfo.label : c;
        return '<button class="filter-btn ' + (state.category === c ? 'active' : '') + '" onclick="setCategory(\'' + c + '\')">' + label + '</button>';
      }).join('');
  }

  el.innerHTML = resultCountHtml + categoryFiltersHtml;
}

// Render legend
function renderLegend() {
  var el = document.getElementById('legend');
  var keys = Object.keys(CAT_COLORS);
  el.innerHTML = keys.map(function(k) {
    var v = CAT_COLORS[k];
    return '<div class="legend-item"><div class="legend-dot" style="background:' + v.bg + '"></div>' + v.label + '</div>';
  }).join('');
}

// Grid view - uses skillsDetailed for full skill list
function renderGrid() {
  var plugins = getFilteredPlugins();
  var el = document.getElementById('gridView');

  // Empty state
  if (plugins.length === 0) {
    el.innerHTML = '<div class="empty-state">' +
      '<div class="empty-state-icon">üîç</div>' +
      '<div class="empty-state-title">No plugins found</div>' +
      '<div class="empty-state-desc">' +
        (state.search ? 'No plugins match "' + state.search + '"' : 'No plugins in this category') +
        '. Try adjusting your search or filters.' +
      '</div>' +
      '<button class="empty-state-action" onclick="clearFilters()">Clear Filters</button>' +
    '</div>';
    return;
  }

  el.innerHTML = plugins.map(function(p) {
    var catColor = CAT_COLORS[p.category] || { bg: '#666', label: p.category };
    var expanded = state.expandedCard === p.name;
    var skillCount = p.skillCount || p.skills.length;
    var cmdCount = p.commandCount || p.commands.length;
    var hooksHtml = p.hooks ? '<div class="card-metric"><div class="dot" style="background:var(--accent4)"></div><span class="count">' + p.hooks + '</span><span class="label">hooks</span></div>' : '';
    var cmdsHtml = cmdCount ? '<div class="card-metric"><div class="dot" style="background:var(--accent5)"></div><span class="count">' + cmdCount + '</span><span class="label">cmds</span></div>' : '';

    // Get all skills for this plugin from skillsDetailed
    var allSkills = [];
    if (ORCHESTKIT_DATA.skillsDetailed) {
      var pluginName = p.name;
      Object.keys(ORCHESTKIT_DATA.skillsDetailed).forEach(function(skillName) {
        var skill = ORCHESTKIT_DATA.skillsDetailed[skillName];
        if (skill.plugins && skill.plugins.indexOf(pluginName) !== -1) {
          allSkills.push(skillName);
        }
      });
      allSkills.sort();
    } else {
      allSkills = p.skills;
    }

    // Build grouped skills section - with progressive disclosure
    var skillsSection = '';
    if (allSkills.length) {
      var grouped = groupSkillsByCategory(allSkills);
      var totalCategories = grouped.order.length;
      var VISIBLE_CATEGORIES = 5;
      var skillGroupsHtml = grouped.order.map(function(cat, idx) {
        var catSkills = grouped.groups[cat];
        var meta = grouped.meta[cat] || { icon: 'üì¶', color: '#6b7280' };
        var catLabel = meta.label || (cat.charAt(0).toUpperCase() + cat.slice(1));
        var isCollapsed = idx >= VISIBLE_CATEGORIES ? ' collapsed initially-hidden' : '';
        return '<div class="skill-category-group' + isCollapsed + '" data-category="' + cat + '" data-index="' + idx + '">' +
          '<div class="skill-category-header" style="border-left-color:' + meta.color + '" onclick="event.stopPropagation();toggleCategory(this.parentElement)">' +
            '<span class="skill-category-icon">' + meta.icon + '</span>' +
            '<span class="skill-category-name">' + catLabel + '</span>' +
            '<span class="skill-category-count">' + catSkills.length + '</span>' +
            '<span class="skill-category-chevron">‚ñ∂</span>' +
          '</div>' +
          '<div class="skill-category-tags">' +
            catSkills.map(function(s) {
              return '<span class="tag" onclick="event.stopPropagation();showDetail(\'skill\',\'' + s + '\',this,\'' + catLabel + '\')" style="cursor:pointer;border-color:' + meta.color + '40;">' + s + '</span>';
            }).join('') +
          '</div>' +
          '<div class="tag-detail skill-category-detail"></div>' +
        '</div>';
      }).join('');
      var showAllBtn = totalCategories > VISIBLE_CATEGORIES ?
        '<div class="show-all-categories" onclick="event.stopPropagation();toggleAllCategories(this)">' +
          '<span class="show-all-text">Show ' + (totalCategories - VISIBLE_CATEGORIES) + ' more categories</span>' +
          '<span class="show-all-chevron">‚ñº</span>' +
        '</div>' : '';
      skillsSection = '<div class="detail-section"><h4>Skills (' + allSkills.length + ')</h4><div class="skills-grouped-container" data-plugin="' + p.name + '">' + skillGroupsHtml + showAllBtn + '</div></div>';
    }
    var agentsSection = p.agents.length ? '<div class="detail-section"><h4>Agents (' + p.agents.length + ')</h4><div class="tag-list">' + p.agents.map(function(a) { return '<span class="tag agent-tag" onclick="event.stopPropagation();showDetail(\'agent\',\'' + a + '\',this)" style="cursor:pointer">' + a + '</span>'; }).join('') + '</div><div class="tag-detail" id="detail-agent-' + p.name + '"></div></div>' : '';
    var commandsSection = p.commands.length ? '<div class="detail-section"><h4>Commands (' + cmdCount + ')</h4><div class="tag-list">' + p.commands.map(function(c) { return '<span class="tag command-tag" onclick="event.stopPropagation();showDetail(\'command\',\'' + c + '\',this)" style="cursor:pointer">/ork:' + c + '</span>'; }).join('') + '</div><div class="tag-detail" id="detail-command-' + p.name + '"></div></div>' : '';

    // Hero card for main 'ork' plugin
    var isHero = p.name === 'ork';
    var heroClass = isHero ? ' hero-card' : '';
    var heroBadge = isHero ? '<span class="hero-badge">Complete Toolkit</span>' : '';

    // Quick action buttons
    var quickActions = '<div class="card-quick-actions">' +
      '<button class="quick-action-btn primary" onclick="event.stopPropagation();copyInstall(\'' + p.name + '\',this)">üìã Copy Install</button>' +
      '<a class="quick-action-btn secondary" href="https://github.com/yonatangross/orchestkit/tree/main/plugins/' + p.name + '" target="_blank" rel="noopener" onclick="event.stopPropagation()">View Source ‚Üí</a>' +
    '</div>';

    return '<div class="plugin-card' + heroClass + (expanded ? ' expanded' : '') + '" onclick="toggleCard(\'' + p.name + '\')">' +
        heroBadge +
        '<div class="card-header">' +
          '<div class="card-name">' + p.name + '</div>' +
          '<span class="card-category cat-' + p.category + '">' + catColor.label + '</span>' +
        '</div>' +
        '<div class="card-desc">' + p.desc + '</div>' +
        '<div class="card-metrics">' +
          '<div class="card-metric"><div class="dot" style="background:var(--accent3)"></div><span class="count">' + skillCount + '</span><span class="label">skills</span></div>' +
          '<div class="card-metric"><div class="dot" style="background:var(--accent2)"></div><span class="count">' + p.agents.length + '</span><span class="label">agents</span></div>' +
          hooksHtml + cmdsHtml +
        '</div>' +
        quickActions +
        '<div class="card-accent-line"></div>' +
        '<div class="card-details">' +
          skillsSection + agentsSection + commandsSection +
        '</div>' +
      '</div>';
  }).join('');
}

// Treemap view
function renderTreemap() {
  var plugins = getFilteredPlugins();
  var container = document.getElementById('treemapContainer');
  var W = container.clientWidth;
  var H = container.clientHeight;
  if (!W || !H) return;

  // Sort by total component count
  var sorted = plugins.slice().map(function(p) {
    var skillCount = p.skillCount || p.skills.length;
    return {
      name: p.name, desc: p.desc, category: p.category, version: p.version,
      skills: p.skills, agents: p.agents, hooks: p.hooks, commands: p.commands,
      skillCount: skillCount,
      total: skillCount + p.agents.length + (p.hooks ? 10 : 0)
    };
  }).sort(function(a, b) { return b.total - a.total; });

  var totalArea = sorted.reduce(function(s, p) { return s + p.total; }, 0);

  // Simple squarified treemap
  var cells = [];
  var x = 0, y = 0, w = W, h = H;
  var remaining = sorted.slice();

  function layoutRow(row, rowTotal, isVertical, rx, ry, rw, rh) {
    var offset = 0;
    var dimMain = isVertical ? rh : rw;
    var dimCross = isVertical ? rw : rh;
    var crossSize = (rowTotal / totalArea) * (isVertical ? W : H);

    row.forEach(function(item) {
      var frac = item.total / rowTotal;
      var mainSize = frac * dimMain;
      cells.push({
        x: isVertical ? rx : rx + offset,
        y: isVertical ? ry + offset : ry,
        w: isVertical ? crossSize : mainSize,
        h: isVertical ? mainSize : crossSize,
        plugin: item,
      });
      offset += mainSize;
    });

    return crossSize;
  }

  // Simple strip layout
  var cx = 0, cy = 0, cw = W, ch = H;
  var isVertical = cw >= ch;

  while (remaining.length > 0) {
    var row = [remaining.shift()];
    var rowTotal = row[0].total;

    while (remaining.length > 0) {
      var candidate = remaining[0];
      var newTotal = rowTotal + candidate.total;
      // Check aspect ratio improvement
      var dimMain = isVertical ? ch : cw;
      var dimCross = isVertical ? cw : ch;
      var crossCurrent = (rowTotal / totalArea) * (isVertical ? W : H);
      var crossNew = (newTotal / totalArea) * (isVertical ? W : H);

      var worstCurrent = Math.max.apply(null, row.map(function(r) {
        var mainSize = (r.total / rowTotal) * dimMain;
        return Math.max(mainSize / crossCurrent, crossCurrent / mainSize);
      }));
      var rowWithCandidate = row.concat([candidate]);
      var worstNew = Math.max.apply(null, rowWithCandidate.map(function(r) {
        var mainSize = (r.total / newTotal) * dimMain;
        return Math.max(mainSize / crossNew, crossNew / mainSize);
      }));

      if (worstNew <= worstCurrent) {
        row.push(remaining.shift());
        rowTotal = newTotal;
      } else break;
    }

    var crossSize = layoutRow(row, rowTotal, isVertical, cx, cy, cw, ch);
    if (isVertical) { cx += crossSize; cw -= crossSize; }
    else { cy += crossSize; ch -= crossSize; }
    isVertical = cw >= ch;
  }

  container.innerHTML = cells.map(function(c) {
    var cat = CAT_COLORS[c.plugin.category] || { bg: '#666' };
    var showLabel = c.w > 60 && c.h > 40;
    var showCount = c.w > 40 && c.h > 30;
    var countHtml = showCount ? '<span class="cell-count">' + (c.plugin.skillCount + c.plugin.agents.length) + '</span>' : '';
    var labelHtml = showLabel ? '<span class="cell-name">' + c.plugin.name.replace('ork-', '') + '</span>' : '';
    return '<div class="treemap-cell" style="left:' + c.x + 'px;top:' + c.y + 'px;width:' + c.w + 'px;height:' + c.h + 'px;background:' + cat.bg + '88;"' +
      ' onmouseenter="showTooltip(event,\'' + c.plugin.name + '\',\'' + c.plugin.skillCount + ' skills, ' + c.plugin.agents.length + ' agents\')"' +
      ' onmouseleave="hideTooltip()"' +
      ' onclick="setSearch(\'' + c.plugin.name + '\');setView(\'grid\')">' +
      countHtml + labelHtml +
    '</div>';
  }).join('');
}

// Agents view
function renderAgents() {
  var q = state.search.toLowerCase();
  var filtered = AGENTS.filter(function(a) {
    if (state.category !== 'all') {
      return a.plugins.some(function(p) {
        var plugin = PLUGINS.filter(function(pl) { return pl.name === p; })[0];
        return plugin && plugin.category === state.category;
      });
    }
    if (q) {
      return a.name.indexOf(q) !== -1 || a.desc.toLowerCase().indexOf(q) !== -1 || a.plugins.some(function(p) { return p.indexOf(q) !== -1; });
    }
    return true;
  });

  document.getElementById('agentsGrid').innerHTML = filtered.map(function(a) {
    var pluginTags = a.plugins.map(function(p) { return '<span class="agent-plugin-tag">' + p + '</span>'; }).join('');
    return '<div class="agent-card">' +
      '<div class="agent-name">' + a.name + '</div>' +
      '<div class="agent-desc">' + a.desc + '</div>' +
      '<div class="agent-plugins">' + pluginTags + '</div>' +
    '</div>';
  }).join('');
}

// Graph view - force-directed
function renderGraph() {
  var canvas = document.getElementById('graphCanvas');
  var ctx = canvas.getContext('2d');
  var rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width * 2;
  canvas.height = rect.height * 2;
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
  ctx.scale(2, 2);

  var W = rect.width;
  var H = rect.height;
  var centerX = W / 2;
  var centerY = H / 2;

  // Build nodes
  var nodes = [];
  var edges = [];

  // Plugin nodes
  var filteredPlugins = getFilteredPlugins();
  filteredPlugins.forEach(function(p, i) {
    var angle = (i / filteredPlugins.length) * Math.PI * 2 - Math.PI / 2;
    var radius = Math.min(W, H) * 0.35;
    var catInfo = CAT_COLORS[p.category];
    nodes.push({
      id: p.name,
      type: 'plugin',
      x: centerX + Math.cos(angle) * radius,
      y: centerY + Math.sin(angle) * radius,
      vx: 0, vy: 0,
      size: 6 + Math.sqrt(p.skills.length + p.agents.length) * 2.5,
      color: catInfo ? catInfo.bg : '#666',
      label: p.name.replace('ork-', ''),
      data: p,
    });
  });

  // Shared agent edges
  var agentPluginMap = {};
  filteredPlugins.forEach(function(p) {
    p.agents.forEach(function(a) {
      if (!agentPluginMap[a]) agentPluginMap[a] = [];
      agentPluginMap[a].push(p.name);
    });
  });

  var agentKeys = Object.keys(agentPluginMap);
  agentKeys.forEach(function(agent) {
    var pluginNames = agentPluginMap[agent];
    if (pluginNames.length > 1) {
      for (var i = 0; i < pluginNames.length; i++) {
        for (var j = i + 1; j < pluginNames.length; j++) {
          edges.push({ from: pluginNames[i], to: pluginNames[j], agent: agent });
        }
      }
    }
  });

  // Simple force simulation
  function simulate() {
    for (var iter = 0; iter < 100; iter++) {
      // Repulsion
      for (var i = 0; i < nodes.length; i++) {
        for (var j = i + 1; j < nodes.length; j++) {
          var dx = nodes[j].x - nodes[i].x;
          var dy = nodes[j].y - nodes[i].y;
          var dist = Math.max(Math.sqrt(dx * dx + dy * dy), 1);
          var force = 2000 / (dist * dist);
          var fx = (dx / dist) * force;
          var fy = (dy / dist) * force;
          nodes[i].vx -= fx;
          nodes[i].vy -= fy;
          nodes[j].vx += fx;
          nodes[j].vy += fy;
        }
      }

      // Attraction (edges)
      edges.forEach(function(e) {
        var a = nodes.filter(function(n) { return n.id === e.from; })[0];
        var b = nodes.filter(function(n) { return n.id === e.to; })[0];
        if (!a || !b) return;
        var dx = b.x - a.x;
        var dy = b.y - a.y;
        var dist = Math.sqrt(dx * dx + dy * dy);
        var force = (dist - 120) * 0.01;
        var fx = (dx / dist) * force;
        var fy = (dy / dist) * force;
        a.vx += fx;
        a.vy += fy;
        b.vx -= fx;
        b.vy -= fy;
      });

      // Center gravity
      nodes.forEach(function(n) {
        n.vx += (centerX - n.x) * 0.003;
        n.vy += (centerY - n.y) * 0.003;
        n.x += n.vx * 0.3;
        n.y += n.vy * 0.3;
        n.vx *= 0.8;
        n.vy *= 0.8;
        // Bounds
        n.x = Math.max(50, Math.min(W - 50, n.x));
        n.y = Math.max(50, Math.min(H - 50, n.y));
      });
    }
  }

  simulate();

  // Draw
  ctx.clearRect(0, 0, W, H);

  // Edges
  edges.forEach(function(e) {
    var a = nodes.filter(function(n) { return n.id === e.from; })[0];
    var b = nodes.filter(function(n) { return n.id === e.to; })[0];
    if (!a || !b) return;
    ctx.beginPath();
    ctx.moveTo(a.x, a.y);
    ctx.lineTo(b.x, b.y);
    ctx.strokeStyle = 'rgba(139, 92, 246, 0.25)';
    ctx.lineWidth = 1.5;
    ctx.stroke();
    // Agent label on edge
    var mx = (a.x + b.x) / 2;
    var my = (a.y + b.y) / 2;
    ctx.fillStyle = 'rgba(34, 197, 94, 0.6)';
    ctx.font = '9px system-ui';
    ctx.textAlign = 'center';
    ctx.fillText(e.agent, mx, my - 4);
  });

  // Nodes
  nodes.forEach(function(n) {
    // Glow
    var gradient = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.size * 2);
    gradient.addColorStop(0, n.color + '40');
    gradient.addColorStop(1, 'transparent');
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(n.x, n.y, n.size * 2, 0, Math.PI * 2);
    ctx.fill();

    // Circle
    ctx.beginPath();
    ctx.arc(n.x, n.y, n.size, 0, Math.PI * 2);
    ctx.fillStyle = n.color;
    ctx.fill();
    ctx.strokeStyle = n.color + '80';
    ctx.lineWidth = 2;
    ctx.stroke();

    // Label
    ctx.fillStyle = '#e6edf3';
    ctx.font = 'bold 11px system-ui';
    ctx.textAlign = 'center';
    ctx.fillText(n.label, n.x, n.y + n.size + 14);

    // Count
    ctx.fillStyle = 'white';
    ctx.font = 'bold 9px system-ui';
    ctx.fillText(n.data.skills.length, n.x, n.y + 3);
  });
}

// Tooltip
function showTooltip(e, name, desc) {
  var tt = document.getElementById('tooltip');
  document.getElementById('tooltipName').textContent = name;
  document.getElementById('tooltipDesc').textContent = desc;
  tt.style.display = 'block';
  tt.style.left = (e.clientX + 12) + 'px';
  tt.style.top = (e.clientY + 12) + 'px';
}
function hideTooltip() {
  document.getElementById('tooltip').style.display = 'none';
}

// Inline detail expansion for skills/agents/commands
var currentDetailEl = null;

function showDetail(type, name, clickedTag, categoryLabel) {
  // Find the detail container - for skills, find within the same category group
  var parent = clickedTag.parentElement;
  var detailEl = null;
  var pluginName = '';

  // For skills, look for the detail in the same category group
  if (type === 'skill') {
    while (parent && !parent.classList.contains('skill-category-group')) {
      parent = parent.parentElement;
    }
    if (parent) {
      detailEl = parent.querySelector('.tag-detail');
      // Get plugin name from container
      var container = parent.closest('.skills-grouped-container');
      if (container) {
        pluginName = container.dataset.plugin || '';
      }
    }
  }

  // For agents/commands, traverse up to detail-section
  if (!detailEl) {
    parent = clickedTag.parentElement;
    while (parent && !parent.classList.contains('detail-section')) {
      parent = parent.parentElement;
    }
    if (parent) {
      detailEl = parent.querySelector('.tag-detail');
    }
  }

  if (!detailEl) return;

  // If clicking same item, toggle off
  if (currentDetailEl === detailEl && detailEl.classList.contains('visible') && detailEl.dataset.currentItem === name) {
    detailEl.classList.remove('visible');
    currentDetailEl = null;
    return;
  }

  // Close any other open detail
  if (currentDetailEl && currentDetailEl !== detailEl) {
    currentDetailEl.classList.remove('visible');
  }

  // Track which item is shown
  detailEl.dataset.currentItem = name;

  var content = '';
  var docUrl = '';

  if (type === 'skill' || type === 'command') {
    // Use skillsDetailed data if available
    var skillData = ORCHESTKIT_DATA.skillsDetailed ? ORCHESTKIT_DATA.skillsDetailed[name] : null;
    docUrl = 'https://github.com/yonatangross/orchestkit/blob/main/src/skills/' + name + '/SKILL.md';

    if (skillData) {
      // Build enhanced skill detail view
      var isCommand = type === 'command';
      var typeLabel = isCommand ? 'Command' : 'Skill';
      var typeClass = isCommand ? 'command' : 'skill';
      var displayName = isCommand ? '/ork:' + name : name;

      // Breadcrumb navigation
      var breadcrumbHtml = '';
      if (pluginName || categoryLabel) {
        breadcrumbHtml = '<div class="detail-breadcrumb">' +
          (pluginName ? '<span>' + pluginName + '</span><span class="sep">‚Ä∫</span>' : '') +
          (categoryLabel ? '<span>' + categoryLabel + '</span><span class="sep">‚Ä∫</span>' : '') +
          '<span class="current">' + name + '</span>' +
        '</div>';
      }

      // Header with badges
      var headerHtml = '<div class="tag-detail-header">' +
        '<div class="tag-detail-title">' +
          '<span class="tag-detail-type ' + typeClass + '">' + typeLabel + '</span>' +
          '<span class="skill-header-row">' +
            '<span>' + displayName + '</span>' +
            '<span class="skill-version-badge">v' + skillData.version + '</span>' +
            (skillData.userInvocable ? '<span class="skill-invocable-badge">Invocable</span>' : '') +
          '</span>' +
        '</div>' +
        '<button class="tag-detail-close" onclick="event.stopPropagation();closeDetail()">&times;</button>' +
      '</div>';
      headerHtml = breadcrumbHtml + headerHtml;

      // Description
      var descHtml = '<div class="tag-detail-desc">' + skillData.description + '</div>';

      // Tags as chips
      var tagsHtml = '';
      if (skillData.tags && skillData.tags.length > 0) {
        tagsHtml = '<div class="skill-tag-chips">' +
          skillData.tags.map(function(t) {
            return '<span class="skill-tag-chip">' + t + '</span>';
          }).join('') +
        '</div>';
      }

      // Plugins row
      var pluginsHtml = '';
      if (skillData.plugins && skillData.plugins.length > 0) {
        pluginsHtml = '<div class="tag-detail-row"><span class="tag-detail-label">Plugins:</span><div class="tag-detail-plugins">' +
          skillData.plugins.map(function(p) { return '<span class="tag-detail-plugin">' + p + '</span>'; }).join('') +
        '</div></div>';
      }

      // Usage row
      var usageHtml = '<div class="tag-detail-row"><span class="tag-detail-label">Usage:</span><span class="tag-detail-value">' +
        (skillData.userInvocable ? '/ork:' + name : 'Auto-injected when relevant') +
      '</span></div>';

      // Folder structure tree - Enhanced with animations
      var structureHtml = '';
      var structure = skillData.structure;
      if (structure && Object.keys(structure).length > 0) {
        var folderHtml = Object.keys(structure).map(function(folder) {
          var files = structure[folder];
          var folderId = 'folder-' + name + '-' + folder;
          return '<div class="skill-folder" id="toggle-' + folderId + '" onclick="event.stopPropagation();toggleSkillFolder(\'' + folderId + '\')">' +
            '<span class="skill-folder-chevron">&#9654;</span>' +
            '<span class="skill-folder-icon">&#128193;</span>' +
            '<span class="skill-folder-name">' + folder + '/</span>' +
            '<span class="skill-folder-count">' + files.length + ' files</span>' +
          '</div>' +
          '<div class="skill-files" id="' + folderId + '">' +
            '<div class="skill-files-inner">' +
              files.map(function(f) {
                var ext = f.split('.').pop();
                var icon = ext === 'md' ? '&#128221;' : ext === 'sh' ? '&#9889;' : ext === 'ts' ? '&#128296;' : '&#128196;';
                return '<div class="skill-file"><span class="skill-file-icon">' + icon + '</span>' + f + '</div>';
              }).join('') +
            '</div>' +
          '</div>';
        }).join('');

        structureHtml = '<div class="skill-structure-tree">' +
          '<div class="skill-structure-header">Folder Structure</div>' +
          folderHtml +
        '</div>';
      }

      // Related agents
      var relatedHtml = '';
      if (skillData.relatedAgents && skillData.relatedAgents.length > 0) {
        relatedHtml = '<div class="skill-related-section">' +
          '<div class="skill-related-label">Related Agents</div>' +
          '<div class="skill-related-items">' +
            skillData.relatedAgents.map(function(a) {
              return '<span class="skill-related-item" onclick="event.stopPropagation();searchAndShowAgent(\'' + a + '\')">' + a + '</span>';
            }).join('') +
          '</div>' +
        '</div>';
      }

      // Markdown content section
      var contentHtml = '';
      if (skillData.content && skillData.content.trim()) {
        var renderedMarkdown = '';
        try {
          var parsedContent = typeof marked !== 'undefined' ? marked.parse(skillData.content) : skillData.content.replace(/\n/g, '<br>');
          renderedMarkdown = typeof DOMPurify !== 'undefined' ? DOMPurify.sanitize(parsedContent) : parsedContent;
        } catch (e) {
          renderedMarkdown = skillData.content.replace(/\n/g, '<br>');
        }
        contentHtml = '<div class="skill-content-section">' +
          '<div class="skill-content-header">Documentation</div>' +
          '<div class="skill-content-body">' + renderedMarkdown + '</div>' +
          (skillData.contentTruncated ? '<div class="skill-content-truncated">Content truncated. View full documentation on GitHub.</div>' : '') +
        '</div>';
      }

      // Doc link
      var docLinkHtml = '<a class="tag-detail-doc-link" href="' + docUrl + '" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">View on GitHub &rarr;</a>';

      content = headerHtml + descHtml + tagsHtml + pluginsHtml + usageHtml + contentHtml + structureHtml + relatedHtml + docLinkHtml;

    } else {
      // Fallback if no detailed data
      var containingPlugins = PLUGINS.filter(function(p) {
        return p.skills.indexOf(name) !== -1 || p.commands.indexOf(name) !== -1;
      }).map(function(p) { return p.name; });

      content = '<div class="tag-detail-header">' +
        '<div class="tag-detail-title"><span class="tag-detail-type ' + (type === 'command' ? 'command' : 'skill') + '">' + (type === 'command' ? 'Command' : 'Skill') + '</span>' + (type === 'command' ? '/ork:' : '') + name + '</div>' +
        '<button class="tag-detail-close" onclick="event.stopPropagation();closeDetail()">&times;</button>' +
      '</div>' +
      '<div class="tag-detail-desc">Patterns and guidance for ' + name.replace(/-/g, ' ') + '.</div>' +
      '<div class="tag-detail-row"><span class="tag-detail-label">Plugins:</span><div class="tag-detail-plugins">' +
        containingPlugins.map(function(p) { return '<span class="tag-detail-plugin">' + p + '</span>'; }).join('') +
      '</div></div>' +
      '<a class="tag-detail-doc-link" href="' + docUrl + '" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">View Documentation &rarr;</a>';
    }

  } else if (type === 'agent') {
    var agentData = ORCHESTKIT_DATA.agents.filter(function(a) { return a.name === name; })[0];
    var desc = agentData ? agentData.description : 'Specialized agent for ' + name.replace(/-/g, ' ') + ' tasks.';
    var plugins = agentData ? agentData.plugins : [];
    var model = agentData ? agentData.model : 'inherit';
    var category = agentData ? agentData.category : 'development';
    docUrl = 'https://github.com/yonatangross/orchestkit/blob/main/src/agents/' + name + '.md';

    // Find skills that reference this agent
    var agentSkills = [];
    if (ORCHESTKIT_DATA.skillsDetailed) {
      Object.keys(ORCHESTKIT_DATA.skillsDetailed).forEach(function(skillName) {
        var skill = ORCHESTKIT_DATA.skillsDetailed[skillName];
        if (skill.relatedAgents && skill.relatedAgents.indexOf(name) !== -1) {
          agentSkills.push(skillName);
        }
      });
    }

    // Category color mapping
    var catColors = {
      development: '#8b5cf6', ai: '#06b6d4', backend: '#f59e0b', frontend: '#ec4899',
      testing: '#22c55e', security: '#ef4444', devops: '#f97316', product: '#a855f7',
      data: '#6366f1', research: '#14b8a6'
    };
    var catColor = catColors[category] || '#8b5cf6';

    // Build enhanced agent detail view
    var headerHtml = '<div class="tag-detail-header">' +
      '<div class="tag-detail-title">' +
        '<span class="tag-detail-type agent">Agent</span>' +
        '<span class="skill-header-row">' +
          '<span>' + name + '</span>' +
          '<span class="skill-version-badge" style="background:linear-gradient(135deg, rgba(' + hexToRgb(catColor) + ', 0.2), rgba(' + hexToRgb(catColor) + ', 0.1)); color:' + catColor + '; border-color:' + catColor + '40;">' + category + '</span>' +
          (model !== 'inherit' ? '<span class="skill-invocable-badge" style="background:linear-gradient(135deg, rgba(249, 115, 22, 0.15), rgba(249, 115, 22, 0.1)); color:#fb923c; border-color:rgba(249, 115, 22, 0.4);">' + model.toUpperCase() + '</span>' : '') +
        '</span>' +
      '</div>' +
      '<button class="tag-detail-close" onclick="event.stopPropagation();closeDetail()">&times;</button>' +
    '</div>';

    var descHtml = '<div class="tag-detail-desc">' + desc + '</div>';

    var pluginsHtml = plugins.length ? '<div class="tag-detail-row"><span class="tag-detail-label">Plugins:</span><div class="tag-detail-plugins">' +
      plugins.map(function(p) { return '<span class="tag-detail-plugin">' + p + '</span>'; }).join('') +
    '</div></div>' : '';

    var invokeHtml = '<div class="tag-detail-row"><span class="tag-detail-label">Invoke:</span><span class="tag-detail-value" style="font-family: JetBrains Mono, SF Mono, monospace;">Task(subagent_type="' + name + '")</span></div>';

    // Related skills section
    var skillsHtml = '';
    if (agentSkills.length > 0) {
      skillsHtml = '<div class="skill-related-section" style="border-color:rgba(6, 182, 212, 0.3);">' +
        '<div class="skill-related-label" style="color:#9ca3af;"><span style="width:6px;height:6px;background:#06b6d4;border-radius:50%;box-shadow:0 0 8px rgba(6, 182, 212, 0.5);"></span> Uses Skills (' + agentSkills.length + ')</div>' +
        '<div class="skill-related-items">' +
          agentSkills.slice(0, 12).map(function(s) {
            return '<span class="skill-related-item" style="background:linear-gradient(135deg, rgba(6, 182, 212, 0.08), rgba(6, 182, 212, 0.05)); border-color:rgba(6, 182, 212, 0.25); color:#67e8f9;" onclick="event.stopPropagation();">' + s + '</span>';
          }).join('') +
          (agentSkills.length > 12 ? '<span class="skill-related-item" style="background:rgba(107, 114, 128, 0.1); border-color:rgba(107, 114, 128, 0.3); color:#9ca3af;">+' + (agentSkills.length - 12) + ' more</span>' : '') +
        '</div>' +
      '</div>';
    }

    var docLinkHtml = '<a class="tag-detail-doc-link" href="' + docUrl + '" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">View on GitHub &rarr;</a>';

    content = headerHtml + descHtml + pluginsHtml + invokeHtml + skillsHtml + docLinkHtml;
  }

  detailEl.innerHTML = content;
  detailEl.classList.add('visible');
  currentDetailEl = detailEl;
}

// Helper: Convert hex color to RGB values
function hexToRgb(hex) {
  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? parseInt(result[1], 16) + ', ' + parseInt(result[2], 16) + ', ' + parseInt(result[3], 16) : '139, 92, 246';
}

// Group skills by primary tag/category
function groupSkillsByCategory(skills) {
  var groups = {};

  // Categories based on actual tags found in skills (in priority order)
  var categoryList = [
    { key: 'testing', icon: 'üß™', color: '#22c55e', label: 'Testing',
      keywords: ['testing', 'test-', 'e2e', 'unit-test', 'integration-test', 'playwright', 'jest', 'vitest', 'coverage', 'property-based', 'golden-dataset', 'fixture', 'mock'] },
    { key: 'video', icon: 'üé¨', color: '#ec4899', label: 'Video & Media',
      keywords: ['video', 'remotion', 'manim', 'narration', 'audio', 'music', 'thumbnail', 'storyboard', 'heygen', 'elevenlabs', 'ffmpeg', 'demo', 'marketing'] },
    { key: 'ai-ml', icon: 'ü§ñ', color: '#8b5cf6', label: 'AI & LLM',
      keywords: ['llm', 'langgraph', 'langchain', 'rag', 'retrieval', 'embedding', 'ai', 'agents', 'multi-agent', 'langfuse', 'evaluation', 'prompt', 'fine-tuning', 'multimodal', 'semantic-search'] },
    { key: 'python', icon: 'üêç', color: '#3776ab', label: 'Python',
      keywords: ['python', 'fastapi', 'celery', 'arq', 'asyncio', 'pydantic', 'async'] },
    { key: 'security', icon: 'üîí', color: '#ef4444', label: 'Security',
      keywords: ['security', 'auth', 'owasp', 'vulnerability', 'defense', 'secrets', 'scanning', 'blocking'] },
    { key: 'performance', icon: '‚ö°', color: '#f59e0b', label: 'Performance',
      keywords: ['performance', 'optimization', 'caching', 'profiling', 'lazy'] },
    { key: 'api', icon: 'üîå', color: '#f59e0b', label: 'API & Backend',
      keywords: ['api', 'rest', 'graphql', 'grpc', 'streaming', 'versioning', 'rate-limit', 'validation', 'real-time', 'sse', 'websocket'] },
    { key: 'database', icon: 'üóÑÔ∏è', color: '#6366f1', label: 'Database',
      keywords: ['database', 'sql', 'postgres', 'redis', 'mongo', 'schema', 'migration', 'cqrs', 'event-sourcing'] },
    { key: 'architecture', icon: 'üèóÔ∏è', color: '#14b8a6', label: 'Architecture',
      keywords: ['architecture', 'patterns', 'microservices', 'domain-driven', 'clean', 'hexagonal', 'solid', 'monorepo', 'design'] },
    { key: 'react', icon: '‚öõÔ∏è', color: '#61dafb', label: 'React & Frontend',
      keywords: ['react', 'zustand', 'tanstack', 'recharts', 'animation', 'ui', 'ux', 'responsive', 'tailwind', 'zod'] },
    { key: 'accessibility', icon: '‚ôø', color: '#14b8a6', label: 'Accessibility',
      keywords: ['accessibility', 'a11y', 'wcag', 'aria', 'keyboard', 'focus'] },
    { key: 'devops', icon: 'üöÄ', color: '#f97316', label: 'DevOps & CI/CD',
      keywords: ['devops', 'ci', 'cd', 'pipeline', 'docker', 'kubernetes', 'deploy', 'infrastructure', 'monitoring', 'observability', 'prometheus', 'tracing'] },
    { key: 'git', icon: 'üìù', color: '#f05032', label: 'Git & GitHub',
      keywords: ['git', 'github', 'commit', 'branch', 'pr', 'merge', 'rebase', 'worktree', 'release'] },
    { key: 'product', icon: 'üìã', color: '#a855f7', label: 'Product & Research',
      keywords: ['product', 'requirement', 'user-story', 'okr', 'kpi', 'prioritization', 'persona', 'journey', 'research', 'market', 'competitive', 'business'] },
    { key: 'memory', icon: 'üíæ', color: '#6366f1', label: 'Memory & Context',
      keywords: ['memory', 'context', 'knowledge', 'graph', 'session'] },
    { key: 'browser', icon: 'üåê', color: '#4285f4', label: 'Browser & Web',
      keywords: ['browser', 'scraping', 'headless', 'web-research', 'fetch'] },
    { key: 'quality', icon: '‚úÖ', color: '#22c55e', label: 'Quality & Review',
      keywords: ['quality', 'code-review', 'review', 'assessment', 'evaluation'] },
    { key: 'workflow', icon: 'üîÑ', color: '#06b6d4', label: 'Orchestration',
      keywords: ['orchestration', 'workflow', 'automation', 'tools', 'implementation', 'feature', 'configuration', 'setup', 'wizard'] },
    { key: 'docs', icon: 'üìö', color: '#06b6d4', label: 'Documentation',
      keywords: ['documentation', 'readme', 'adr', 'changelog', 'visualization', 'metadata', 'parser', 'analyzer'] }
  ];

  // Build category metadata lookup
  var categoryMeta = { 'other': { order: 99, icon: 'üì¶', color: '#6b7280', label: 'Other' } };
  categoryList.forEach(function(cat, idx) {
    categoryMeta[cat.key] = { order: idx + 1, icon: cat.icon, color: cat.color, label: cat.label };
  });

  skills.forEach(function(skillName) {
    var skill = ORCHESTKIT_DATA.skillsDetailed ? ORCHESTKIT_DATA.skillsDetailed[skillName] : null;
    var category = 'other';
    var skillLower = skillName.toLowerCase();

    // Combine skill name and tags for matching (not description - too noisy)
    var searchText = ' ' + skillLower + ' ';
    if (skill && skill.tags) {
      searchText += skill.tags.join(' ').toLowerCase() + ' ';
    }

    // Find first matching category (categories are in priority order)
    for (var c = 0; c < categoryList.length; c++) {
      var cat = categoryList[c];
      var keywords = cat.keywords;
      for (var k = 0; k < keywords.length; k++) {
        if (searchText.indexOf(keywords[k]) !== -1) {
          category = cat.key;
          break;
        }
      }
      if (category !== 'other') break;
    }

    if (!groups[category]) {
      groups[category] = [];
    }
    groups[category].push(skillName);
  });

  // Sort groups by priority
  var sortedCategories = Object.keys(groups).sort(function(a, b) {
    var orderA = categoryMeta[a] ? categoryMeta[a].order : 99;
    var orderB = categoryMeta[b] ? categoryMeta[b].order : 99;
    return orderA - orderB;
  });

  return { groups: groups, order: sortedCategories, meta: categoryMeta };
}

// Toggle skill folder expansion with animation
function toggleSkillFolder(folderId) {
  var el = document.getElementById(folderId);
  var toggle = document.getElementById('toggle-' + folderId);
  if (el) {
    el.classList.toggle('expanded');
    if (toggle) {
      toggle.classList.toggle('open');
    }
  }
}

// Toggle individual skill category collapse
function toggleCategory(groupEl) {
  groupEl.classList.toggle('collapsed');
}

// Toggle all hidden categories (show more/less)
function toggleAllCategories(btn) {
  var container = btn.parentElement;
  var hiddenGroups = container.querySelectorAll('.skill-category-group.initially-hidden');
  var isExpanded = btn.classList.contains('expanded');

  hiddenGroups.forEach(function(group) {
    if (isExpanded) {
      group.classList.add('collapsed');
      group.style.display = 'none';
    } else {
      group.style.display = 'block';
      group.classList.remove('collapsed');
    }
  });

  btn.classList.toggle('expanded');
  var textEl = btn.querySelector('.show-all-text');
  var chevronEl = btn.querySelector('.show-all-chevron');
  if (isExpanded) {
    textEl.textContent = 'Show ' + hiddenGroups.length + ' more categories';
    chevronEl.textContent = '‚ñº';
  } else {
    textEl.textContent = 'Show less';
    chevronEl.textContent = '‚ñ≤';
  }
}

// Copy install command for a plugin
function copyInstall(pluginName, btn) {
  var cmd = 'claude plugin install ' + pluginName;
  navigator.clipboard.writeText(cmd).then(function() {
    var originalHtml = btn.innerHTML;
    btn.innerHTML = '‚úì Copied!';
    btn.classList.add('copied');
    setTimeout(function() {
      btn.innerHTML = originalHtml;
      btn.classList.remove('copied');
    }, 1500);
  }).catch(function(err) {
    console.error('Failed to copy:', err);
  });
}

// Search for and show agent details (called from related agents)
function searchAndShowAgent(agentName) {
  setSearch(agentName);
  setView('agents');
}

function closeDetail() {
  if (currentDetailEl) {
    currentDetailEl.classList.remove('visible');
    currentDetailEl = null;
  }
}

// Close detail on Escape
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeDetail();
});

// Prompt output
function updatePrompt() {
  var el = document.getElementById('promptOutput');
  if (state.category !== 'all') {
    var plugins = PLUGINS.filter(function(p) { return p.category === state.category; });
    var names = plugins.map(function(p) { return p.name; });
    var catInfo = CAT_COLORS[state.category];
    var catLabel = catInfo ? catInfo.label : state.category;
    el.textContent = '# Install ' + catLabel + ' plugins:\n' + names.map(function(n) { return 'claude plugin install ' + n; }).join('\n');
  } else if (state.search) {
    var filtered = getFilteredPlugins();
    if (filtered.length === 1) {
      var p = filtered[0];
      var skillCount = p.skillCount || p.skills.length;
      el.textContent = 'claude plugin install ' + p.name + '\n\n# ' + p.name + ' includes:\n# ' + skillCount + ' skills, ' + p.agents.length + ' agents, ' + p.hooks + ' hooks';
    } else {
      el.textContent = '# ' + filtered.length + ' plugins match "' + state.search + '":\n' + filtered.map(function(p) { var sc = p.skillCount || p.skills.length; return 'claude plugin install ' + p.name + '  # ' + sc + ' skills, ' + p.agents.length + ' agents'; }).join('\n');
    }
  } else {
    var otherPlugins = PLUGINS.filter(function(p) { return p.name !== 'ork'; });
    el.textContent = '# Install the complete OrchestKit toolkit:\nclaude plugin install ork\n\n# Or install domain-specific plugins:\n' + otherPlugins.map(function(p) { var sc = p.skillCount || p.skills.length; return '# claude plugin install ' + p.name + '  (' + sc + ' skills, ' + p.agents.length + ' agents)'; }).join('\n');
  }
}

function copyPrompt() {
  var text = document.getElementById('promptOutput').textContent;
  navigator.clipboard.writeText(text).then(function() {
    var btn = document.getElementById('copyBtn');
    btn.textContent = 'Copied!';
    btn.classList.add('copied');
    setTimeout(function() {
      btn.textContent = 'Copy';
      btn.classList.remove('copied');
    }, 1500);
  }).catch(function(err) {
    console.error('Failed to copy:', err);
  });
}

// Actions
function setCategory(cat) {
  state.category = cat;
  renderAll();
  syncToUrl();
}
function setSearch(q) {
  state.search = q;
  document.getElementById('searchInput').value = q;
  renderAll();
  syncToUrl();
}
function clearFilters() {
  state.search = '';
  state.category = 'all';
  document.getElementById('searchInput').value = '';
  renderAll();
  syncToUrl();
}
function setView(v) {
  state.view = v;
  document.querySelectorAll('.view-btn').forEach(function(b) { b.classList.toggle('active', b.dataset.view === v); });
  document.getElementById('gridView').style.display = v === 'grid' ? 'grid' : 'none';
  document.getElementById('agentsView').style.display = v === 'agents' ? 'block' : 'none';
  if (v === 'agents') renderAgents();
  syncToUrl();
}
function toggleCard(name) {
  state.expandedCard = state.expandedCard === name ? null : name;
  renderGrid();
}

function renderAll() {
  renderStats();
  renderFilters();
  renderGrid();
  updatePrompt();
  if (state.view === 'agents') renderAgents();
}

// Events
document.getElementById('searchInput').addEventListener('input', function(e) {
  state.search = e.target.value;
  renderAll();
  syncToUrl();
});
var viewBtns = document.querySelectorAll('.view-btn');
for (var i = 0; i < viewBtns.length; i++) {
  (function(b) {
    b.addEventListener('click', function() { setView(b.dataset.view); });
  })(viewBtns[i]);
}
window.addEventListener('resize', function() {
  if (state.view === 'treemap') renderTreemap();
  if (state.view === 'graph') renderGraph();
});

// Init
if (state.search) {
  document.getElementById('searchInput').value = state.search;
}
updateBreadcrumbs();
renderAll();
setView(state.view);
</script>
</body>
</html>
