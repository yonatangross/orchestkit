# Release Please - Automated Versioning and Changelog
#
# This workflow automates:
# - Version bumps based on conventional commits
# - CHANGELOG.md generation
# - GitHub Release creation
#
# How it works:
# 1. On every push to main, release-please analyzes commits
# 2. It creates/updates a "Release PR" with version bump and changelog
# 3. When you merge the Release PR, it creates a GitHub Release + tag
#
# Configuration lives in:
# - .release-please-config.json (changelog sections, extra-files)
# - .release-please-manifest.json (current version)
# - version.txt (simple release type source of truth)
#
# Conventional Commits -> Version Bumps:
# - fix: -> patch (6.0.23 -> 6.0.24)
# - feat: -> minor (6.0.23 -> 6.1.0)
# - feat!: or BREAKING CHANGE -> major (6.0.23 -> 7.0.0)
#
# Reference: https://github.com/googleapis/release-please

name: Release

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  release-please:
    permissions:
      contents: write
      pull-requests: write
    runs-on: ubuntu-latest
    outputs:
      release_created: ${{ steps.release.outputs.release_created }}
      tag_name: ${{ steps.release.outputs.tag_name }}
      version: ${{ steps.release.outputs.version }}
    steps:
      - id: release
        uses: googleapis/release-please-action@16a9c90856f42705d54a6fda1823352bdc62cf38  # v4
        with:
          config-file: .release-please-config.json
          manifest-file: .release-please-manifest.json
          token: ${{ secrets.RELEASE_PLEASE_TOKEN }}

  # NOTE: Version sync to manifests, pyproject.toml, and CLAUDE.md is handled
  # by release-please extra-files in .release-please-config.json.
  # The previous post-release job was removed because it failed on protected
  # branches (GH006: cannot push directly to main).
