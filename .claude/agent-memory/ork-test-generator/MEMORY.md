# Test Generator Agent Memory

## OrchestKit Test Architecture
- Test runner: `tests/run-all-tests.sh` runs all suites sequentially
- TypeScript hooks tested via vitest in `src/hooks/`
- Shell-based tests in `tests/` organized by category: unit, security, integration, e2e, etc.
- CI uses `scripts/ci/run-tests.sh <dir>` for category-based test discovery

## Known Test Issues (2026-02-07)
- `tests/skills/structure/test-skill-md.sh:511` — `EXPECTED_INTERNAL` count drifts when skills added/removed. Currently 175 (HeyGen removed). Check this whenever skills change.
- `plugins/.composite-agent-index.md` — Must be generated by build. If missing, 37 tests fail (all agents missing from index).
- `tests/unit/test-hooks-unit.sh` — All 6 hook unit tests SKIP because they can't find compiled bundles. Tests look for hooks in wrong location.
- `session-env-setup.test.ts:289` — Pre-existing: asserts `agent_type === 'env-agent'` but gets empty string.
- `memory-writer.test.ts` — Pre-existing: fails on Windows due to path separators.
- Local vitest skip: `@rollup/rollup-darwin-x64` missing → fix with `cd src/hooks && rm -rf node_modules && npm i`

## CI Workflow Patterns
- Pinned workflows: ci.yml, build.yml, plugin-validation.yml, release-please.yml, release-video.yml, mem0-visualization.yml, version-check.yml, reusable-test-runner.yml
- Unpinned workflows (need fixing): eval-index-effectiveness.yml, ci-report.yml — use `@v4`/`@v7` tags instead of SHA pins
- Composite action: `.github/actions/setup/action.yml` handles cross-platform deps + node setup + plugin build
- Artifact sharing: build step uploads `plugins/`, downstream jobs download via `actions/download-artifact`

## Count Drift Pattern
- Correct counts (as of 2026-02-07): 199 skills total (24 commands + 175 internal), 36 agents, 119 hooks
- Files to update when counts change: `test-skill-md.sh` EXPECTED_INTERNAL, `validate-counts.sh` (auto from filesystem), plugin.json description
