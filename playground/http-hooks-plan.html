<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OrchestKit HTTP Hooks — #856 Design Plan</title>
<style>
:root {
  --bg: #0d1117; --surface: #161b22; --surface2: #21262d; --border: #30363d;
  --text: #e6edf3; --text-dim: #8b949e; --text-muted: #484f58;
  --accent: #58a6ff; --green: #3fb950; --red: #f85149; --yellow: #d29922;
  --orange: #d18616; --purple: #bc8cff; --pink: #f778ba; --cyan: #39d2c0;
  --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --mono: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: var(--font); background: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; }

/* Header */
.header { padding: 20px 32px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 16px; }
.header h1 { font-size: 20px; font-weight: 600; }
.header h1 span { color: var(--accent); }
.header .badge { background: var(--surface2); border: 1px solid var(--border); padding: 2px 10px; border-radius: 12px; font-size: 12px; color: var(--text-dim); }
.header .issue { color: var(--green); font-size: 13px; font-family: var(--mono); }

/* Tabs */
.tabs { display: flex; border-bottom: 1px solid var(--border); padding: 0 32px; overflow-x: auto; }
.tab { padding: 12px 20px; cursor: pointer; font-size: 13px; color: var(--text-dim); border-bottom: 2px solid transparent; white-space: nowrap; transition: all 0.2s; user-select: none; }
.tab:hover { color: var(--text); background: var(--surface); }
.tab.active { color: var(--text); border-bottom-color: var(--accent); }

/* Content */
.content { padding: 32px; max-width: 1400px; margin: 0 auto; min-height: calc(100vh - 120px); }
.panel { display: none; animation: fadeIn 0.3s ease; }
.panel.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

/* Architecture Diagram */
.arch-container { display: flex; flex-direction: column; gap: 24px; }
.arch-toggle { display: flex; gap: 8px; margin-bottom: 8px; }
.arch-toggle button { padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-dim); cursor: pointer; font-size: 13px; transition: all 0.2s; }
.arch-toggle button.active { background: var(--accent); color: #fff; border-color: var(--accent); }
.diagram { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 32px; font-family: var(--mono); font-size: 13px; line-height: 1.5; white-space: pre; overflow-x: auto; position: relative; min-height: 480px; }

/* Pulse animation for data flow */
@keyframes pulse { 0%,100% { opacity: 0.3; } 50% { opacity: 1; } }
.flow-dot { display: inline-block; animation: pulse 1.5s ease-in-out infinite; }
.flow-dot.d1 { animation-delay: 0s; }
.flow-dot.d2 { animation-delay: 0.3s; }
.flow-dot.d3 { animation-delay: 0.6s; }

/* Tier Cards */
.tiers { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 20px; margin-top: 16px; }
.tier-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 24px; transition: all 0.3s; }
.tier-card:hover { border-color: var(--accent); transform: translateY(-2px); }
.tier-card.t1 { border-top: 3px solid var(--text-dim); }
.tier-card.t2 { border-top: 3px solid var(--accent); }
.tier-card.t3 { border-top: 3px solid var(--purple); }
.tier-num { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 4px; }
.tier-card.t1 .tier-num { color: var(--text-dim); }
.tier-card.t2 .tier-num { color: var(--accent); }
.tier-card.t3 .tier-num { color: var(--purple); }
.tier-card h3 { font-size: 18px; margin-bottom: 8px; }
.tier-card p { color: var(--text-dim); font-size: 13px; margin-bottom: 16px; }
.tier-card .env { background: var(--bg); border-radius: 6px; padding: 10px 14px; font-family: var(--mono); font-size: 12px; color: var(--green); margin: 8px 0; overflow-x: auto; }
.tier-features { list-style: none; }
.tier-features li { padding: 6px 0; font-size: 13px; color: var(--text-dim); display: flex; align-items: center; gap: 8px; }
.tier-features li::before { content: ''; width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
.tier-card.t1 .tier-features li::before { background: var(--text-muted); }
.tier-card.t2 .tier-features li::before { background: var(--accent); }
.tier-card.t3 .tier-features li::before { background: var(--purple); }
.check { color: var(--green); } .cross { color: var(--text-muted); }

/* Comparison Table */
.comp-table { width: 100%; border-collapse: collapse; margin-top: 24px; font-size: 13px; }
.comp-table th { text-align: left; padding: 10px 16px; border-bottom: 2px solid var(--border); color: var(--text-dim); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
.comp-table td { padding: 10px 16px; border-bottom: 1px solid var(--border); }
.comp-table tr:hover td { background: var(--surface); }

/* Hook Map */
.filter-bar { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
.filter-btn { padding: 6px 14px; border-radius: 20px; border: 1px solid var(--border); background: var(--surface); color: var(--text-dim); cursor: pointer; font-size: 12px; transition: all 0.2s; }
.filter-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }
.filter-btn.f-security.active { background: var(--red); border-color: var(--red); }
.filter-btn.f-observability.active { background: var(--green); border-color: var(--green); }
.filter-btn.f-advisory.active { background: var(--yellow); border-color: var(--yellow); }
.filter-btn.f-dispatcher.active { background: var(--orange); border-color: var(--orange); }

.hook-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.hook-table th { text-align: left; padding: 8px 12px; border-bottom: 2px solid var(--border); color: var(--text-dim); font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; position: sticky; top: 0; background: var(--bg); z-index: 1; }
.hook-table td { padding: 8px 12px; border-bottom: 1px solid var(--border); font-family: var(--mono); font-size: 12px; }
.hook-table tr { transition: all 0.2s; }
.hook-table tr:hover td { background: var(--surface); }
.hook-table .event { color: var(--text-dim); font-family: var(--font); }
.badge-sm { padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 600; font-family: var(--font); }
.badge-command { background: rgba(248,81,73,0.15); color: var(--red); }
.badge-http { background: rgba(63,185,80,0.15); color: var(--green); }
.badge-maybe { background: rgba(210,153,34,0.15); color: var(--yellow); }
.badge-risk-none { background: rgba(63,185,80,0.1); color: var(--green); }
.badge-risk-low { background: rgba(210,153,34,0.1); color: var(--yellow); }
.badge-risk-med { background: rgba(248,81,73,0.1); color: var(--red); }
.hook-count { display: flex; gap: 16px; margin-bottom: 16px; }
.hook-count .hc { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px 20px; text-align: center; }
.hook-count .hc .num { font-size: 28px; font-weight: 700; }
.hook-count .hc .lbl { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }

/* Data Flow */
.flow-cards { display: grid; grid-template-columns: 1fr; gap: 20px; }
.flow-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
.flow-card-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
.flow-card-header h4 { font-size: 14px; display: flex; align-items: center; gap: 10px; }
.flow-card-header .arrow { transition: transform 0.3s; color: var(--text-dim); }
.flow-card-header.open .arrow { transform: rotate(90deg); }
.flow-card-body { padding: 0; max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.3s ease; }
.flow-card-body.open { padding: 20px; max-height: 800px; }
.flow-direction { display: grid; grid-template-columns: 1fr auto 1fr; gap: 12px; align-items: start; }
.flow-direction .arrow-col { color: var(--accent); font-size: 20px; padding-top: 20px; }
.json-block { background: var(--bg); border-radius: 8px; padding: 14px; font-family: var(--mono); font-size: 12px; line-height: 1.7; overflow-x: auto; }
.json-block .key { color: var(--accent); }
.json-block .str { color: var(--green); }
.json-block .num { color: var(--orange); }
.json-block .comment { color: var(--text-muted); font-style: italic; }
.json-label { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-family: var(--font); }

/* Timeline */
.timeline { position: relative; padding-left: 40px; margin-top: 16px; }
.timeline::before { content: ''; position: absolute; left: 15px; top: 0; bottom: 0; width: 2px; background: var(--border); }
.tl-item { position: relative; margin-bottom: 32px; }
.tl-dot { position: absolute; left: -33px; top: 4px; width: 12px; height: 12px; border-radius: 50%; border: 2px solid var(--border); background: var(--bg); }
.tl-item.done .tl-dot { background: var(--green); border-color: var(--green); }
.tl-item.current .tl-dot { background: var(--accent); border-color: var(--accent); box-shadow: 0 0 8px var(--accent); }
.tl-item.future .tl-dot { background: var(--surface2); border-color: var(--text-muted); }
.tl-phase { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; }
.tl-title { font-size: 16px; font-weight: 600; margin: 4px 0; }
.tl-desc { color: var(--text-dim); font-size: 13px; }
.tl-files { margin-top: 8px; }
.tl-file { font-family: var(--mono); font-size: 12px; color: var(--accent); padding: 2px 0; }
.tl-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-top: 6px; font-weight: 600; }
.tl-tag.ork { background: rgba(188,140,255,0.15); color: var(--purple); }
.tl-tag.hq { background: rgba(57,210,192,0.15); color: var(--cyan); }
.tl-tag.docs { background: rgba(88,166,255,0.15); color: var(--accent); }
.tl-scope { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px; }

/* Config Diff */
.diff-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px; }
.diff-panel { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
.diff-header { padding: 10px 16px; border-bottom: 1px solid var(--border); font-size: 12px; font-weight: 600; }
.diff-header.before { color: var(--red); }
.diff-header.after { color: var(--green); }
.diff-body { padding: 16px; font-family: var(--mono); font-size: 12px; line-height: 1.8; white-space: pre; overflow-x: auto; }
.diff-body .removed { background: rgba(248,81,73,0.1); color: var(--red); display: block; margin: 0 -16px; padding: 0 16px; }
.diff-body .added { background: rgba(63,185,80,0.1); color: var(--green); display: block; margin: 0 -16px; padding: 0 16px; }
.diff-body .dim { color: var(--text-muted); }

.env-table { width: 100%; border-collapse: collapse; margin-top: 16px; font-size: 13px; }
.env-table th { text-align: left; padding: 8px 12px; border-bottom: 2px solid var(--border); color: var(--text-dim); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
.env-table td { padding: 8px 12px; border-bottom: 1px solid var(--border); }
.env-table td:first-child { font-family: var(--mono); color: var(--green); font-size: 12px; }

/* Section headings */
.section-title { font-size: 22px; font-weight: 700; margin-bottom: 8px; }
.section-sub { color: var(--text-dim); font-size: 14px; margin-bottom: 24px; }

/* Stats row */
.stats-row { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
.stat { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 16px 24px; min-width: 120px; }
.stat .val { font-size: 32px; font-weight: 700; }
.stat .lbl { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-top: 2px; }
.stat.s-cmd .val { color: var(--red); }
.stat.s-http .val { color: var(--green); }
.stat.s-maybe .val { color: var(--yellow); }
.stat.s-total .val { color: var(--accent); }

/* Prompt output area */
.prompt-area { margin-top: 32px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
.prompt-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border); }
.prompt-header span { font-size: 12px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
.copy-btn { padding: 6px 14px; border-radius: 6px; border: 1px solid var(--border); background: var(--surface2); color: var(--text); cursor: pointer; font-size: 12px; transition: all 0.2s; }
.copy-btn:hover { background: var(--accent); border-color: var(--accent); color: #fff; }
.prompt-body { padding: 16px; font-size: 13px; line-height: 1.7; color: var(--text-dim); min-height: 80px; }

@media (max-width: 768px) {
  .content { padding: 16px; }
  .diff-container { grid-template-columns: 1fr; }
  .flow-direction { grid-template-columns: 1fr; }
  .flow-direction .arrow-col { transform: rotate(90deg); text-align: center; padding: 0; }
}
</style>
</head>
<body>

<div class="header">
  <h1><span>OrchestKit</span> HTTP Hooks</h1>
  <span class="badge">v7.0.0</span>
  <span class="badge">CC 2.1.63+</span>
  <span class="issue">#856</span>
</div>

<div class="tabs" id="tabs">
  <div class="tab active" data-tab="arch">Architecture</div>
  <div class="tab" data-tab="tiers">User Tiers</div>
  <div class="tab" data-tab="hooks">Hook Map</div>
  <div class="tab" data-tab="data">Data Flow</div>
  <div class="tab" data-tab="phases">Phases</div>
  <div class="tab" data-tab="config">Configuration</div>
</div>

<!-- ====== TAB 1: Architecture ====== -->
<div class="content">
<div class="panel active" id="panel-arch">
  <div class="section-title">System Architecture</div>
  <div class="section-sub">How HTTP hooks bridge OrchestKit with your observability stack</div>
  <div class="arch-toggle">
    <button class="active" onclick="setArch('yonatan')">Yonatan's Setup (Full HQ)</button>
    <button onclick="setArch('community')">Community Setup (Generic)</button>
    <button onclick="setArch('default')">Default (No Config)</button>
  </div>
  <div class="diagram" id="arch-diagram"></div>

  <div style="margin-top:24px; display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px;">
    <div class="stat"><div class="val" style="color:var(--red)">32</div><div class="lbl">Stay command</div></div>
    <div class="stat"><div class="val" style="color:var(--green)">17</div><div class="lbl">HTTP candidates</div></div>
    <div class="stat"><div class="val" style="color:var(--yellow)">5</div><div class="lbl">Maybe later</div></div>
  </div>
</div>

<!-- ====== TAB 2: User Tiers ====== -->
<div class="panel" id="panel-tiers">
  <div class="section-title">User Tiers</div>
  <div class="section-sub">HTTP hooks are opt-in. Zero change for users who don't configure them.</div>

  <div class="tiers">
    <div class="tier-card t1">
      <div class="tier-num">Tier 1 — Default</div>
      <h3>Local Only</h3>
      <p>No configuration needed. All hooks stay <code>type: "command"</code>. Data writes to local JSONL files. 100% backward compatible.</p>
      <div class="env" style="color:var(--text-muted)"># No env vars needed</div>
      <ul class="tier-features">
        <li><span class="check">&#10003;</span> All 54 hooks work as-is</li>
        <li><span class="check">&#10003;</span> Local analytics in ~/.claude/analytics/</li>
        <li><span class="check">&#10003;</span> /ork:analytics reads local data</li>
        <li><span class="cross">&#10007;</span> No dashboards</li>
        <li><span class="cross">&#10007;</span> No cross-project search</li>
        <li><span class="cross">&#10007;</span> No Langfuse traces</li>
      </ul>
    </div>

    <div class="tier-card t2">
      <div class="tier-num">Tier 2 — Direct to Service</div>
      <h3>Bring Your Own Endpoint</h3>
      <p>Set env vars. OrchestKit adds <code>type: "http"</code> hooks alongside existing command hooks. POST directly to Langfuse, Datadog, or your own API.</p>
      <div class="env">export ORCHESTKIT_HOOK_URL=https://your-server.com/hooks
export ORCHESTKIT_HOOK_TOKEN=sk-your-token</div>
      <ul class="tier-features">
        <li><span class="check">&#10003;</span> Everything in Tier 1</li>
        <li><span class="check">&#10003;</span> HTTP hooks fire alongside command hooks</li>
        <li><span class="check">&#10003;</span> Direct Langfuse/Datadog/custom integration</li>
        <li><span class="check">&#10003;</span> Session traces in your dashboard</li>
        <li><span class="cross">&#10007;</span> No pgvector RAG (needs backend)</li>
        <li><span class="cross">&#10007;</span> No cross-project MCP read-back</li>
      </ul>
    </div>

    <div class="tier-card t3">
      <div class="tier-num">Tier 3 — Full HQ Stack</div>
      <h3>Closed Loop with MCP</h3>
      <p>HTTP hooks POST to yonatan-hq (or your own FastAPI). Backend processes into Langfuse + pgvector + Prometheus. hq-knowledge MCP reads it back. Full circle.</p>
      <div class="env">export ORCHESTKIT_HOOK_URL=http://localhost:8000/api/v1/cc-hooks
export ORCHESTKIT_HOOK_TOKEN=your-hq-token</div>
      <ul class="tier-features">
        <li><span class="check">&#10003;</span> Everything in Tier 1 + 2</li>
        <li><span class="check">&#10003;</span> Langfuse traces with cost attribution</li>
        <li><span class="check">&#10003;</span> Patterns stored in pgvector</li>
        <li><span class="check">&#10003;</span> Prometheus metrics + Grafana dashboards</li>
        <li><span class="check">&#10003;</span> hq-knowledge MCP reads back insights</li>
        <li><span class="check">&#10003;</span> Celery async processing for heavy ops</li>
      </ul>
    </div>
  </div>

  <table class="comp-table" style="margin-top:32px">
    <thead>
      <tr><th>Feature</th><th>Tier 1 (Default)</th><th>Tier 2 (Direct)</th><th>Tier 3 (Full HQ)</th></tr>
    </thead>
    <tbody>
      <tr><td>Setup effort</td><td>None</td><td>2 env vars</td><td>Running backend + env vars</td></tr>
      <tr><td>Session metrics</td><td>Local JSONL</td><td><span class="check">&#10003;</span> Remote dashboard</td><td><span class="check">&#10003;</span> Langfuse + Prometheus</td></tr>
      <tr><td>Learned patterns</td><td>Local JSON files</td><td><span class="check">&#10003;</span> Remote storage</td><td><span class="check">&#10003;</span> pgvector + MCP search</td></tr>
      <tr><td>Cross-project queries</td><td><span class="cross">&#10007;</span></td><td>Depends on backend</td><td><span class="check">&#10003;</span> hq-knowledge MCP</td></tr>
      <tr><td>Cost attribution</td><td><span class="cross">&#10007;</span></td><td><span class="check">&#10003;</span> If Langfuse</td><td><span class="check">&#10003;</span> Full breakdown</td></tr>
      <tr><td>Infrastructure needed</td><td>None</td><td>Any HTTP endpoint</td><td>FastAPI + Postgres + Redis</td></tr>
      <tr><td>Data leaves machine?</td><td>Never</td><td>Yes (user's endpoint)</td><td>Yes (user's localhost)</td></tr>
      <tr><td>Privacy</td><td>100% local</td><td>User controls endpoint</td><td>User controls everything</td></tr>
    </tbody>
  </table>
</div>

<!-- ====== TAB 3: Hook Map ====== -->
<div class="panel" id="panel-hooks">
  <div class="section-title">Hook Migration Map</div>
  <div class="section-sub">All 54 hooks classified by migration target</div>

  <div class="stats-row">
    <div class="stat s-cmd"><div class="val" id="cnt-cmd">32</div><div class="lbl">Stays Command</div></div>
    <div class="stat s-http"><div class="val" id="cnt-http">17</div><div class="lbl">HTTP Candidate</div></div>
    <div class="stat s-maybe"><div class="val" id="cnt-maybe">5</div><div class="lbl">Maybe Later</div></div>
    <div class="stat s-total"><div class="val">54</div><div class="lbl">Total Hooks</div></div>
  </div>

  <div class="filter-bar" id="hook-filters">
    <button class="filter-btn active" data-filter="all">All (54)</button>
    <button class="filter-btn f-security" data-filter="security">Security (14)</button>
    <button class="filter-btn f-dispatcher" data-filter="dispatcher">Dispatchers (8)</button>
    <button class="filter-btn f-observability" data-filter="observability">Observability (17)</button>
    <button class="filter-btn f-advisory" data-filter="advisory">Advisory (10)</button>
    <button class="filter-btn" data-filter="maybe" style="border-color:var(--yellow)">Maybe (5)</button>
  </div>

  <div style="max-height:500px; overflow-y:auto; border:1px solid var(--border); border-radius:8px;">
  <table class="hook-table" id="hook-table">
    <thead><tr><th>Hook Name</th><th>Event</th><th>Category</th><th>Migration</th><th>Risk</th></tr></thead>
    <tbody></tbody>
  </table>
  </div>
</div>

<!-- ====== TAB 4: Data Flow ====== -->
<div class="panel" id="panel-data">
  <div class="section-title">Data Flow Detail</div>
  <div class="section-sub">What gets POSTed and what comes back for each migrated hook</div>

  <div class="flow-cards" id="flow-cards"></div>
</div>

<!-- ====== TAB 5: Phases ====== -->
<div class="panel" id="panel-phases">
  <div class="section-title">Implementation Phases</div>
  <div class="section-sub">6-phase rollout plan for HTTP hooks integration</div>

  <div class="timeline" id="timeline"></div>
</div>

<!-- ====== TAB 6: Configuration ====== -->
<div class="panel" id="panel-config">
  <div class="section-title">Configuration Changes</div>
  <div class="section-sub">hooks.json diffs and environment setup</div>

  <h3 style="margin-bottom:12px; font-size:15px;">Environment Variables</h3>
  <table class="env-table">
    <thead><tr><th>Variable</th><th>Required</th><th>Description</th><th>Example</th></tr></thead>
    <tbody>
      <tr><td>ORCHESTKIT_HOOK_URL</td><td>Tier 2+</td><td>Base URL for HTTP hook endpoint</td><td style="font-family:var(--mono);font-size:12px;color:var(--text-dim)">http://localhost:8000/api/v1/cc-hooks</td></tr>
      <tr><td>ORCHESTKIT_HOOK_TOKEN</td><td>Tier 2+</td><td>Bearer token for authentication</td><td style="font-family:var(--mono);font-size:12px;color:var(--text-dim)">sk-hq-abc123...</td></tr>
      <tr><td>ORCHESTKIT_HOOK_MODE</td><td>No</td><td>Override: "http", "command", or "dual" (default: "dual")</td><td style="font-family:var(--mono);font-size:12px;color:var(--text-dim)">dual</td></tr>
    </tbody>
  </table>

  <h3 style="margin:32px 0 12px; font-size:15px;">hooks.json Diff — worktree-lifecycle-logger</h3>
  <div class="diff-container" id="diff-worktree"></div>

  <h3 style="margin:32px 0 12px; font-size:15px;">hooks.json Diff — session-metrics-summary</h3>
  <div class="diff-container" id="diff-metrics"></div>

  <h3 style="margin:32px 0 12px; font-size:15px;">hooks.json Diff — pattern-sync-push</h3>
  <div class="diff-container" id="diff-patterns"></div>
</div>

<!-- Prompt Output -->
<div class="prompt-area">
  <div class="prompt-header">
    <span>Implementation Prompt</span>
    <button class="copy-btn" onclick="copyPrompt()">Copy</button>
  </div>
  <div class="prompt-body" id="prompt-output"></div>
</div>

</div><!-- /content -->

<script>
// ── Tab switching ──
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('panel-' + tab.dataset.tab).classList.add('active');
    updatePrompt();
  });
});

// ── State ──
const state = { archMode: 'yonatan', hookFilter: 'all', activeTab: 'arch' };

// ── Architecture Diagrams ──
const diagrams = {
yonatan: `<span style="color:var(--accent)">  Claude Code</span>  (any project: orchestkit, yonatan-hq, portfolio...)
       │
       ▼
  ┌─────────────────────────────────────────────────────┐
  │  <span style="color:var(--text)">OrchestKit Hooks (54)</span>                               │
  │                                                     │
  │  <span style="color:var(--red)">Security (14)</span> ─── type: "command" ── local Node.js  │
  │  <span style="color:var(--orange)">Dispatchers (8)</span> ── type: "command" ── local Node.js │
  │                                                     │
  │  <span style="color:var(--green)">Observability (17)</span> ── type: "http" ─────────────┐   │
  │  <span style="color:var(--yellow)">Advisory (10)</span> ──────── type: "http" ──────────┐ │   │
  └────────────────────────────────────────────── │─│ ──┘
                                                  │ │
              <span class="flow-dot d1" style="color:var(--green)">●</span> <span class="flow-dot d2" style="color:var(--green)">●</span> <span class="flow-dot d3" style="color:var(--green)">●</span>  POST JSON + Bearer token  │ │
                                                  │ │
  ┌───────────────────────────────────────────────┘─┘───┐
  │  <span style="color:var(--cyan)">yonatan-hq API</span>  (FastAPI, localhost:8000)            │
  │                                                     │
  │  POST /api/v1/cc-hooks/session-end                  │
  │  POST /api/v1/cc-hooks/pattern-sync                 │
  │  POST /api/v1/cc-hooks/skill-event                  │
  │  POST /api/v1/cc-hooks/worktree-event               │
  │       │          │           │          │           │
  │       ▼          ▼           ▼          ▼           │
  │  ┌─────────┐ ┌────────┐ ┌──────────┐ ┌──────────┐ │
  │  │<span style="color:var(--pink)">Langfuse </span>│ │<span style="color:var(--purple)">pgvector</span>│ │<span style="color:var(--orange)">Prometheus</span>│ │<span style="color:var(--cyan)">Celery   </span>│ │
  │  │ traces  │ │ RAG    │ │ metrics  │ │ async    │ │
  │  └─────────┘ └───┬────┘ └──────────┘ └──────────┘ │
  └──────────────────│──────────────────────────────────┘
                     │
          <span class="flow-dot d1" style="color:var(--purple)">●</span> <span class="flow-dot d2" style="color:var(--purple)">●</span> <span class="flow-dot d3" style="color:var(--purple)">●</span>  MCP read-back (already works!)
                     │
  ┌──────────────────┘──────────────────────────────────┐
  │  <span style="color:var(--purple)">hq-knowledge MCP</span>  (configured in ~/.claude/settings)  │
  │                                                     │
  │  knowledge_search("patterns learned last week")     │
  │  ask_hq_search("how did I solve the auth bug?")     │
  │  knowledge_browse(type="conversation_extract")      │
  │                                                     │
  │  <span style="color:var(--green)">CLOSED LOOP</span>: hooks write → pgvector → MCP reads back │
  └─────────────────────────────────────────────────────┘`,

community: `<span style="color:var(--accent)">  Claude Code</span>  (your project)
       │
       ▼
  ┌─────────────────────────────────────────────────────┐
  │  <span style="color:var(--text)">OrchestKit Hooks (54)</span>                               │
  │                                                     │
  │  <span style="color:var(--red)">Security (14)</span> ─── type: "command" ── local Node.js  │
  │  <span style="color:var(--orange)">Dispatchers (8)</span> ── type: "command" ── local Node.js │
  │                                                     │
  │  <span style="color:var(--green)">Observability (17)</span> ── type: "http" ─────────────┐   │
  │  <span style="color:var(--yellow)">Advisory (10)</span> ──────── type: "http" ──────────┐ │   │
  └────────────────────────────────────────────── │─│ ──┘
                                                  │ │
              <span class="flow-dot d1" style="color:var(--green)">●</span> <span class="flow-dot d2" style="color:var(--green)">●</span> <span class="flow-dot d3" style="color:var(--green)">●</span>  POST JSON + Bearer token  │ │
                                                  │ │
       ┌──────────────────────────────────────────┘─┘──┐
       │  <span style="color:var(--accent)">Your Endpoint</span>  (pick any)                       │
       │                                               │
       │  Option A:  <span style="color:var(--pink)">Langfuse API</span> (direct)               │
       │  ┌─────────────────────────────────────────┐  │
       │  │ ORCHESTKIT_HOOK_URL=https://cloud.       │  │
       │  │   langfuse.com/api/public                │  │
       │  │ Session traces, cost, generations        │  │
       │  └─────────────────────────────────────────┘  │
       │                                               │
       │  Option B:  <span style="color:var(--cyan)">Custom FastAPI / Express / CF Worker</span>  │
       │  ┌─────────────────────────────────────────┐  │
       │  │ ORCHESTKIT_HOOK_URL=https://my-api.com/  │  │
       │  │ Your logic, your database, your rules    │  │
       │  └─────────────────────────────────────────┘  │
       │                                               │
       │  Option C:  <span style="color:var(--orange)">Datadog / Grafana Cloud / Axiom</span>     │
       │  ┌─────────────────────────────────────────┐  │
       │  │ ORCHESTKIT_HOOK_URL=https://http-intake   │  │
       │  │   .logs.datadoghq.com/api/v2/logs        │  │
       │  │ Structured logs, APM, dashboards          │  │
       │  └─────────────────────────────────────────┘  │
       └───────────────────────────────────────────────┘`,

default: `<span style="color:var(--accent)">  Claude Code</span>  (your project)
       │
       ▼
  ┌─────────────────────────────────────────────────────┐
  │  <span style="color:var(--text)">OrchestKit Hooks (54)</span>                               │
  │                                                     │
  │  <span style="color:var(--text-dim)">ALL hooks</span> ──── type: "command" ── local Node.js     │
  │                                                     │
  │  <span style="color:var(--text-muted)">No ORCHESTKIT_HOOK_URL set = no HTTP hooks fire</span>     │
  │  <span style="color:var(--text-muted)">Everything works exactly as before v7.0.0</span>           │
  │                                                     │
  └───────────────────────────┬─────────────────────────┘
                              │
                              ▼
  ┌─────────────────────────────────────────────────────┐
  │  <span style="color:var(--text-dim)">~/.claude/analytics/</span>                                │
  │                                                     │
  │  session-summary.jsonl      (session end data)      │
  │  skill-usage.jsonl          (skill invocations)     │
  │  agent-usage.jsonl          (agent spawns)          │
  │  hook-timing.jsonl          (hook performance)      │
  │  team-activity.jsonl        (team coordination)     │
  │                                                     │
  │  <span style="color:var(--text-muted)">Queryable via /ork:analytics — but local only.</span>      │
  │  <span style="color:var(--text-muted)">No dashboards, no cross-project, no Langfuse.</span>      │
  │  <span style="color:var(--green)">100% private. Zero network. Works offline.</span>           │
  └─────────────────────────────────────────────────────┘`
};

function setArch(mode) {
  state.archMode = mode;
  document.querySelectorAll('.arch-toggle button').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('arch-diagram').innerHTML = diagrams[mode];
  updatePrompt();
}
document.getElementById('arch-diagram').innerHTML = diagrams.yonatan;

// ── Hook Data ──
const hooks = [
  // Security — stays command
  {name:'dangerous-command-blocker',event:'PreToolUse',cat:'security',target:'command',risk:'none'},
  {name:'compound-command-validator',event:'PreToolUse',cat:'security',target:'command',risk:'none'},
  {name:'content-secret-scanner',event:'PreToolUse',cat:'security',target:'command',risk:'none'},
  {name:'file-guard',event:'PreToolUse',cat:'security',target:'command',risk:'none'},
  {name:'commit-atomicity-checker',event:'PreToolUse',cat:'security',target:'command',risk:'none'},
  {name:'issue-reference-checker',event:'PreToolUse',cat:'security',target:'command',risk:'none'},
  {name:'prefill-guard',event:'SessionStart',cat:'security',target:'command',risk:'none'},
  {name:'analytics-consent-check',event:'SessionStart',cat:'security',target:'command',risk:'none'},
  {name:'stop-uncommitted-check',event:'Stop',cat:'security',target:'command',risk:'none'},
  {name:'permission-auditor',event:'PermissionRequest',cat:'security',target:'command',risk:'none'},
  {name:'subagent-resource-guard',event:'SubagentStart',cat:'security',target:'command',risk:'none'},
  {name:'subagent-quality-gate',event:'SubagentStop',cat:'security',target:'command',risk:'none'},
  {name:'pre-compact-saver',event:'PreCompact',cat:'security',target:'command',risk:'none'},
  {name:'queue-recovery',event:'SessionStart',cat:'security',target:'command',risk:'none'},

  // Dispatchers — stays command (complex internal routing)
  {name:'unified-advisory-dispatcher (bash)',event:'PreToolUse',cat:'dispatcher',target:'command',risk:'none'},
  {name:'unified-quality-dispatcher (write)',event:'PreToolUse',cat:'dispatcher',target:'command',risk:'none'},
  {name:'unified-dispatcher (lifecycle)',event:'SessionStart',cat:'dispatcher',target:'command',risk:'none'},
  {name:'unified-dispatcher (stop)',event:'Stop',cat:'dispatcher',target:'command',risk:'none'},
  {name:'unified-dispatcher (posttool)',event:'PostToolUse',cat:'dispatcher',target:'command',risk:'none'},
  {name:'unified-dispatcher (prompt)',event:'UserPromptSubmit',cat:'dispatcher',target:'command',risk:'none'},
  {name:'teammate-idle-dispatcher',event:'TeammateIdle',cat:'dispatcher',target:'command',risk:'none'},
  {name:'task-completed-dispatcher',event:'TaskCompleted',cat:'dispatcher',target:'command',risk:'none'},

  // Observability — HTTP candidates
  {name:'session-metrics-summary',event:'SessionEnd',cat:'observability',target:'http',risk:'none'},
  {name:'session-cleanup',event:'SessionEnd',cat:'observability',target:'http',risk:'low'},
  {name:'pattern-sync-push',event:'SessionEnd',cat:'observability',target:'http',risk:'low'},
  {name:'pattern-sync-pull',event:'SessionStart',cat:'observability',target:'http',risk:'low'},
  {name:'skill-tracker',event:'PreToolUse',cat:'observability',target:'http',risk:'none'},
  {name:'context7-tracker',event:'PreToolUse',cat:'observability',target:'http',risk:'none'},
  {name:'session-metrics (posttool)',event:'PostToolUse',cat:'observability',target:'http',risk:'none'},
  {name:'agent-usage-tracker',event:'SubagentStart',cat:'observability',target:'http',risk:'none'},
  {name:'agent-stop-tracker',event:'SubagentStop',cat:'observability',target:'http',risk:'none'},
  {name:'team-activity-logger',event:'TeammateIdle',cat:'observability',target:'http',risk:'none'},
  {name:'task-completion-logger',event:'TaskCompleted',cat:'observability',target:'http',risk:'none'},
  {name:'hook-timing-collector',event:'PostToolUse',cat:'observability',target:'http',risk:'none'},
  {name:'notification-logger',event:'Notification',cat:'observability',target:'http',risk:'none'},
  {name:'intent-capture',event:'UserPromptSubmit',cat:'observability',target:'http',risk:'none'},
  {name:'config-change-tracker',event:'ConfigChange',cat:'observability',target:'http',risk:'none'},
  {name:'setup-telemetry',event:'Setup',cat:'observability',target:'http',risk:'none'},
  {name:'error-pattern-collector',event:'PostToolUseFailure',cat:'observability',target:'http',risk:'low'},

  // Advisory — HTTP candidates
  {name:'worktree-lifecycle-logger',event:'WorktreeCreate',cat:'advisory',target:'http',risk:'none'},
  {name:'worktree-lifecycle-logger',event:'WorktreeRemove',cat:'advisory',target:'http',risk:'none'},
  {name:'session-context-loader',event:'SessionStart',cat:'advisory',target:'http',risk:'low'},
  {name:'pr-status-enricher',event:'SessionStart',cat:'advisory',target:'http',risk:'low'},
  {name:'mcp-health-check',event:'SessionStart',cat:'advisory',target:'http',risk:'none'},
  {name:'write-headers',event:'PreToolUse',cat:'advisory',target:'http',risk:'low'},
  {name:'profile-injector',event:'UserPromptSubmit',cat:'advisory',target:'http',risk:'low'},
  {name:'memory-context-loader',event:'UserPromptSubmit',cat:'advisory',target:'http',risk:'low'},
  {name:'capture-user-intent',event:'UserPromptSubmit',cat:'advisory',target:'http',risk:'none'},
  {name:'learning-pattern-extractor',event:'Stop',cat:'advisory',target:'http',risk:'low'},

  // Maybe later
  {name:'run-hook-silent (background)',event:'UserPromptSubmit',cat:'maybe',target:'maybe',risk:'med'},
  {name:'prompt-compression',event:'PreCompact',cat:'maybe',target:'maybe',risk:'med'},
  {name:'auto-commit-reminder',event:'Stop',cat:'maybe',target:'maybe',risk:'low'},
  {name:'branch-context-injector',event:'SessionStart',cat:'maybe',target:'maybe',risk:'med'},
  {name:'stale-branch-detector',event:'SessionStart',cat:'maybe',target:'maybe',risk:'low'},
];

function renderHookTable() {
  const tbody = document.querySelector('#hook-table tbody');
  const filter = state.hookFilter;
  const filtered = filter === 'all' ? hooks : hooks.filter(h => h.cat === filter);
  tbody.innerHTML = filtered.map(h => {
    const targetBadge = h.target === 'command' ? '<span class="badge-sm badge-command">stays command</span>' :
                        h.target === 'http' ? '<span class="badge-sm badge-http">HTTP candidate</span>' :
                        '<span class="badge-sm badge-maybe">maybe later</span>';
    const riskBadge = h.risk === 'none' ? '<span class="badge-sm badge-risk-none">none</span>' :
                      h.risk === 'low' ? '<span class="badge-sm badge-risk-low">low</span>' :
                      '<span class="badge-sm badge-risk-med">medium</span>';
    return `<tr><td>${h.name}</td><td class="event">${h.event}</td><td>${h.cat}</td><td>${targetBadge}</td><td>${riskBadge}</td></tr>`;
  }).join('');
}

document.getElementById('hook-filters').addEventListener('click', e => {
  if (!e.target.classList.contains('filter-btn')) return;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  e.target.classList.add('active');
  state.hookFilter = e.target.dataset.filter;
  renderHookTable();
});
renderHookTable();

// ── Data Flow Cards ──
const flows = [
  {
    name: 'session-metrics-summary', event: 'SessionEnd', desc: 'Session statistics and tool usage breakdown',
    request: {
      session_id: '"abc-123"', hook_event: '"SessionEnd"',
      tool_counts: '{ "Bash": 42, "Read": 31, "Edit": 18 }',
      error_count: '2', duration_ms: '384000',
      top_tools: '["Bash", "Read", "Edit"]',
      agent_spawns: '3', team_name: '"brainstorm-auth"'
    },
    response: { _comment: '// fire-and-forget, empty OK' },
    dest: 'Langfuse span + Prometheus counter'
  },
  {
    name: 'pattern-sync-push', event: 'SessionEnd', desc: 'Learned patterns from this session, ingested into pgvector for cross-project search',
    request: {
      session_id: '"abc-123"', hook_event: '"SessionEnd"',
      project_hash: '"a3f5b8e9c2d1"',
      patterns: '[\n    { "text": "Use MSW for API mocking, not jest.mock(fetch)",\n      "source": "code-review", "confidence": 0.9 },\n    { "text": "Always run npm test before commit",\n      "source": "pre-push-failure", "confidence": 0.8 }\n  ]',
      timestamp: '"2026-02-28T06:15:00Z"'
    },
    response: { ingested: '2', knowledge_ids: '["uuid-1", "uuid-2"]' },
    dest: 'knowledge_ingest(content_type="conversation_extract") -> pgvector'
  },
  {
    name: 'skill-tracker', event: 'PreToolUse(Skill)', desc: 'Skill invocation tracking for usage analytics',
    request: {
      session_id: '"abc-123"', hook_event: '"PreToolUse"',
      skill_name: '"ork:brainstorming"',
      project_hash: '"a3f5b8e9c2d1"',
      timestamp: '"2026-02-28T06:10:00Z"'
    },
    response: { _comment: '// fire-and-forget' },
    dest: 'Langfuse generation event + skill_usage metric'
  },
  {
    name: 'worktree-lifecycle-logger', event: 'WorktreeCreate', desc: 'Worktree creation/removal events with context injection',
    request: {
      session_id: '"abc-123"', hook_event: '"WorktreeCreate"',
      worktree_path: '"/repo/.claude/worktrees/feat-auth"',
      timestamp: '"2026-02-28T06:12:00Z"'
    },
    response: {
      additionalContext: '"[WorktreeCreate] Isolated worktree created at /repo/.claude/worktrees/feat-auth. Changes here do not affect the main working tree."'
    },
    dest: 'Context injection + event log'
  }
];

function renderFlowCards() {
  const container = document.getElementById('flow-cards');
  container.innerHTML = flows.map((f, i) => {
    const reqJson = Object.entries(f.request).map(([k,v]) => `  <span class="key">"${k}"</span>: <span class="${v.startsWith('"') ? 'str' : v.startsWith('[') || v.startsWith('{') ? 'str' : v.startsWith('//') ? 'comment' : 'num'}">${v}</span>`).join(',\n');
    const resJson = Object.entries(f.response).map(([k,v]) => {
      if (k === '_comment') return `  <span class="comment">${v}</span>`;
      return `  <span class="key">"${k}"</span>: <span class="${v.startsWith('"') || v.startsWith('[') ? 'str' : 'num'}">${v}</span>`;
    }).join(',\n');
    return `
    <div class="flow-card">
      <div class="flow-card-header" onclick="toggleFlow(${i})">
        <h4><span class="badge-sm badge-http">HTTP</span> ${f.name} <span style="color:var(--text-dim);font-size:12px;font-weight:400">${f.event}</span></h4>
        <span class="arrow">&#9654;</span>
      </div>
      <div class="flow-card-body" id="flow-body-${i}">
        <div style="color:var(--text-dim);font-size:12px;margin-bottom:16px">${f.desc}</div>
        <div style="color:var(--text-dim);font-size:11px;margin-bottom:4px">Destination: <span style="color:var(--cyan)">${f.dest}</span></div>
        <div class="flow-direction">
          <div>
            <div class="json-label">Request (POST body)</div>
            <div class="json-block">{\n${reqJson}\n}</div>
          </div>
          <div class="arrow-col">&#10132;</div>
          <div>
            <div class="json-label">Response (200 OK)</div>
            <div class="json-block">{\n${resJson}\n}</div>
          </div>
        </div>
      </div>
    </div>`;
  }).join('');
}
function toggleFlow(i) {
  const body = document.getElementById('flow-body-' + i);
  const header = body.previousElementSibling;
  body.classList.toggle('open');
  header.classList.toggle('open');
}
renderFlowCards();

// ── Timeline ──
const phases = [
  { phase: 'Phase 1', title: 'HTTP hook schema + validation', status: 'current',
    desc: 'Add type:"http" support to hooks.json schema validation. Update test-manifests to accept HTTP hooks. No behavioral change yet.',
    files: ['src/hooks/src/lib/schema.ts', 'tests/manifests/test-hooks-schema.sh'],
    tags: [{t:'ork',l:'OrchestKit'}] },
  { phase: 'Phase 2', title: 'Adapter layer — env var routing', status: 'future',
    desc: 'Build routing logic: if ORCHESTKIT_HOOK_URL is set, add HTTP hooks alongside command hooks. "Dual mode" — both fire, HTTP is fire-and-forget. If URL not set, HTTP hooks are silently skipped.',
    files: ['src/hooks/src/lib/http-adapter.ts', 'src/hooks/hooks.json'],
    tags: [{t:'ork',l:'OrchestKit'}] },
  { phase: 'Phase 3', title: 'Migrate 3 hooks', status: 'future',
    desc: 'Add type:"http" entries for worktree-lifecycle-logger, session-metrics-summary, and pattern-sync-push. Command versions stay — dual write.',
    files: ['src/hooks/hooks.json (3 new entries)'],
    tags: [{t:'ork',l:'OrchestKit'}] },
  { phase: 'Phase 4', title: 'yonatan-hq cc_hooks router', status: 'future',
    desc: 'New FastAPI router in yonatan-hq that receives hook POSTs. Routes to Langfuse trace creation, pgvector knowledge_ingest, and Prometheus metrics. Celery tasks for heavy processing.',
    files: ['apps/api/app/routes/cc_hooks.py', 'apps/api/app/services/cc_hooks_service.py'],
    tags: [{t:'hq',l:'yonatan-hq'}] },
  { phase: 'Phase 5', title: 'Community docs — direct-to-Langfuse', status: 'future',
    desc: 'Document how Tier 2 users can POST directly to Langfuse Cloud API, Datadog, or any HTTP endpoint. Update ork:configure and ork:setup skills.',
    files: ['src/skills/configure/references/http-hooks.md', 'src/skills/setup/SKILL.md'],
    tags: [{t:'docs',l:'Documentation'}] },
  { phase: 'Phase 6', title: 'Migrate remaining observability hooks', status: 'future',
    desc: 'Extend HTTP support to all 17 observability hooks and 10 advisory hooks. Full coverage for Tier 2+ users.',
    files: ['src/hooks/hooks.json (24 more entries)'],
    tags: [{t:'ork',l:'OrchestKit'}] },
];

document.getElementById('timeline').innerHTML = phases.map(p => `
  <div class="tl-item ${p.status}">
    <div class="tl-dot"></div>
    <div class="tl-phase">${p.phase}</div>
    <div class="tl-title">${p.title}</div>
    <div class="tl-desc">${p.desc}</div>
    <div class="tl-files">${p.files.map(f => `<div class="tl-file">${f}</div>`).join('')}</div>
    <div class="tl-scope">${p.tags.map(t => `<span class="tl-tag ${t.t}">${t.l}</span>`).join('')}</div>
  </div>
`).join('');

// ── Config Diffs ──
function renderDiff(containerId, before, after) {
  document.getElementById(containerId).innerHTML = `
    <div class="diff-panel"><div class="diff-header before">Before (command only)</div><div class="diff-body">${before}</div></div>
    <div class="diff-panel"><div class="diff-header after">After (command + http)</div><div class="diff-body">${after}</div></div>`;
}

renderDiff('diff-worktree',
`<span class="dim">"WorktreeCreate": [</span>
<span class="dim">  {</span>
<span class="dim">    "hooks": [</span>
      {
        "type": "command",
        "command": "node \${CLAUDE_PLUGIN_ROOT}
          /hooks/bin/run-hook.mjs
          worktree/worktree-lifecycle-logger",
        "timeout": 10000
      }
<span class="dim">    ]</span>
<span class="dim">  }</span>
<span class="dim">]</span>`,
`<span class="dim">"WorktreeCreate": [</span>
<span class="dim">  {</span>
<span class="dim">    "hooks": [</span>
      {
        "type": "command",
        "command": "node \${CLAUDE_PLUGIN_ROOT}
          /hooks/bin/run-hook.mjs
          worktree/worktree-lifecycle-logger",
        "timeout": 10000
      }<span class="added">,
      {
        "type": "http",
        "url": "\${ORCHESTKIT_HOOK_URL}/worktree",
        "timeout": 5000,
        "headers": {
          "Authorization": "Bearer $ORCHESTKIT_HOOK_TOKEN"
        },
        "allowedEnvVars": [
          "ORCHESTKIT_HOOK_TOKEN",
          "ORCHESTKIT_HOOK_URL"
        ]
      }</span>
<span class="dim">    ]</span>
<span class="dim">  }</span>
<span class="dim">]</span>`);

renderDiff('diff-metrics',
`<span class="dim">"SessionEnd": [</span>
<span class="dim">  {</span>
<span class="dim">    "hooks": [</span>
      {
        "type": "command",
        "command": "node \${CLAUDE_PLUGIN_ROOT}
          /hooks/bin/run-hook.mjs
          lifecycle/session-metrics-summary",
        "timeout": 15000,
        "run_on_fail": true
      }<span class="dim">,</span>
      <span class="dim">// ... other SessionEnd hooks</span>
<span class="dim">    ]</span>
<span class="dim">  }</span>
<span class="dim">]</span>`,
`<span class="dim">"SessionEnd": [</span>
<span class="dim">  {</span>
<span class="dim">    "hooks": [</span>
      {
        "type": "command",
        "command": "node \${CLAUDE_PLUGIN_ROOT}
          /hooks/bin/run-hook.mjs
          lifecycle/session-metrics-summary",
        "timeout": 15000,
        "run_on_fail": true
      }<span class="added">,
      {
        "type": "http",
        "url": "\${ORCHESTKIT_HOOK_URL}/session-end",
        "timeout": 5000,
        "run_on_fail": true,
        "headers": {
          "Authorization": "Bearer $ORCHESTKIT_HOOK_TOKEN"
        },
        "allowedEnvVars": [
          "ORCHESTKIT_HOOK_TOKEN",
          "ORCHESTKIT_HOOK_URL"
        ]
      }</span><span class="dim">,</span>
      <span class="dim">// ... other SessionEnd hooks</span>
<span class="dim">    ]</span>
<span class="dim">  }</span>
<span class="dim">]</span>`);

renderDiff('diff-patterns',
`<span class="dim">"SessionEnd": [</span>
<span class="dim">  {</span>
<span class="dim">    "hooks": [</span>
      <span class="dim">// ... other hooks</span>
      {
        "type": "command",
        "command": "node \${CLAUDE_PLUGIN_ROOT}
          /hooks/bin/run-hook.mjs
          lifecycle/pattern-sync-push",
        "timeout": 30000
      }
<span class="dim">    ]</span>
<span class="dim">  }</span>
<span class="dim">]</span>`,
`<span class="dim">"SessionEnd": [</span>
<span class="dim">  {</span>
<span class="dim">    "hooks": [</span>
      <span class="dim">// ... other hooks</span>
      {
        "type": "command",
        "command": "node \${CLAUDE_PLUGIN_ROOT}
          /hooks/bin/run-hook.mjs
          lifecycle/pattern-sync-push",
        "timeout": 30000
      }<span class="added">,
      {
        "type": "http",
        "url": "\${ORCHESTKIT_HOOK_URL}/pattern-sync",
        "timeout": 10000,
        "headers": {
          "Authorization": "Bearer $ORCHESTKIT_HOOK_TOKEN"
        },
        "allowedEnvVars": [
          "ORCHESTKIT_HOOK_TOKEN",
          "ORCHESTKIT_HOOK_URL"
        ]
      }</span>
<span class="dim">    ]</span>
<span class="dim">  }</span>
<span class="dim">]</span>`);

// ── Prompt Output ──
function updatePrompt() {
  const activeTab = document.querySelector('.tab.active').dataset.tab;
  let prompt = '';

  if (activeTab === 'arch') {
    prompt = `Implement OrchestKit HTTP hooks (issue #856) for CC 2.1.63+.\n\nArchitecture: Dual-mode hooks — security hooks (14) stay type:"command" for blocking capability. Observability hooks (17) and advisory hooks (10) get additional type:"http" entries that POST JSON to ORCHESTKIT_HOOK_URL.\n\nKey design: If ORCHESTKIT_HOOK_URL env var is not set, HTTP hooks are silently skipped. Zero change for default users. HTTP hooks fire alongside command hooks (dual write), not instead of them.\n\nThree user tiers: Tier 1 (default, local JSONL), Tier 2 (direct-to-service via env vars), Tier 3 (full HQ stack with pgvector + Langfuse + MCP read-back).`;
  } else if (activeTab === 'tiers') {
    prompt = `Design the HTTP hooks adapter layer for OrchestKit v7.0.0.\n\nRequirements:\n- Tier 1 (default): No env vars set = all hooks stay type:"command", local JSONL. Zero breaking change.\n- Tier 2 (direct): ORCHESTKIT_HOOK_URL + ORCHESTKIT_HOOK_TOKEN = HTTP hooks fire alongside command hooks. User POSTs to Langfuse, Datadog, or custom endpoint.\n- Tier 3 (full HQ): Same env vars pointing to yonatan-hq FastAPI. Backend routes to Langfuse + pgvector (hq-knowledge) + Prometheus. Closed loop via hq-knowledge MCP.\n\nPrivacy: All data stays anonymized (hashed project IDs). User controls opt-in. Data never leaves machine without explicit ORCHESTKIT_HOOK_URL configuration.`;
  } else if (activeTab === 'hooks') {
    const httpCount = hooks.filter(h => h.target === 'http').length;
    const cmdCount = hooks.filter(h => h.target === 'command').length;
    prompt = `Migrate ${httpCount} of 54 OrchestKit hooks to support HTTP mode.\n\nStays command (${cmdCount}): All security hooks (dangerous-command-blocker, content-secret-scanner, file-guard, etc.) and dispatcher hooks — these MUST block synchronously.\n\nHTTP candidates (${httpCount}): Observability hooks (session-metrics, pattern-sync, skill-tracker, agent-usage, etc.) and advisory hooks (worktree-lifecycle, pr-status-enricher, mcp-health-check, etc.) — these are fire-and-forget or return advisory context.`;
  } else if (activeTab === 'data') {
    prompt = `Implement the HTTP hook payload format for OrchestKit.\n\nAll hooks POST to: \${ORCHESTKIT_HOOK_URL}/<hook-route>\nAuth: Bearer \${ORCHESTKIT_HOOK_TOKEN}\nContent-Type: application/json\n\nPayloads include: session_id, hook_event, project_hash (anonymized), timestamp, plus event-specific data (tool_counts, patterns, skill_name, worktree_path).\n\nResponses: Most are fire-and-forget (empty {} OK). Advisory hooks can return { additionalContext: "..." } for context injection. pattern-sync can return { ingested: N, knowledge_ids: [...] }.`;
  } else if (activeTab === 'phases') {
    prompt = `Execute the 6-phase HTTP hooks rollout for OrchestKit #856.\n\nPhase 1: Schema validation (accept type:"http" in hooks.json)\nPhase 2: Adapter layer (env var routing, dual-mode)\nPhase 3: Migrate 3 hooks (worktree-lifecycle, session-metrics, pattern-sync)\nPhase 4: yonatan-hq cc_hooks router (FastAPI → Langfuse + pgvector + Prometheus)\nPhase 5: Community docs (direct-to-Langfuse setup guide)\nPhase 6: Migrate remaining 24 observability/advisory hooks`;
  } else {
    prompt = `Configure HTTP hooks in OrchestKit v7.0.0.\n\nEnvironment variables:\n- ORCHESTKIT_HOOK_URL: Base URL for HTTP hook endpoint (required for Tier 2+)\n- ORCHESTKIT_HOOK_TOKEN: Bearer token for authentication (required for Tier 2+)\n- ORCHESTKIT_HOOK_MODE: "http" | "command" | "dual" (default: "dual")\n\nhooks.json changes: Each migrated hook gets a new type:"http" entry ALONGSIDE the existing type:"command" entry. Both fire in dual mode. HTTP entry uses \${ORCHESTKIT_HOOK_URL}/<route> with allowedEnvVars for token interpolation.`;
  }

  document.getElementById('prompt-output').textContent = prompt;
}
updatePrompt();

function copyPrompt() {
  const text = document.getElementById('prompt-output').textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.querySelector('.copy-btn');
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = 'Copy', 1500);
  });
}
</script>
</body>
</html>
