{
  "skill": "python-backend",
  "version": "2.0.0",
  "testCases": [
    {
      "id": "asyncio-taskgroup",
      "rule": "asyncio-taskgroup",
      "query": "Run multiple HTTP requests concurrently with error handling",
      "expectedBehavior": [
        "Uses asyncio.TaskGroup for structured concurrency",
        "Wraps in asyncio.timeout for deadline",
        "Handles ExceptionGroup with except*"
      ]
    },
    {
      "id": "asyncio-structured",
      "rule": "asyncio-structured",
      "query": "Implement a rate-limited async HTTP client",
      "expectedBehavior": [
        "Uses asyncio.Semaphore for concurrency limiting",
        "Combines with TaskGroup for batch processing",
        "Uses asyncio.to_thread for sync bridges"
      ]
    },
    {
      "id": "asyncio-cancellation",
      "rule": "asyncio-cancellation",
      "query": "Handle task cancellation with proper cleanup",
      "expectedBehavior": [
        "Re-raises CancelledError after cleanup",
        "Uses try/finally for resource release",
        "Never swallows CancelledError"
      ]
    },
    {
      "id": "fastapi-dependencies",
      "rule": "fastapi-dependencies",
      "query": "Create FastAPI dependency injection for services",
      "expectedBehavior": [
        "Uses Depends() for database sessions",
        "Creates class-based service dependencies",
        "Implements authentication dependency chain"
      ]
    },
    {
      "id": "fastapi-middleware",
      "rule": "fastapi-middleware",
      "query": "Add request ID and timing middleware to FastAPI",
      "expectedBehavior": [
        "Creates RequestIDMiddleware with header propagation",
        "Adds TimingMiddleware with X-Response-Time",
        "Orders middleware correctly: CORS -> RequestID -> Timing -> Logging"
      ]
    },
    {
      "id": "fastapi-background",
      "rule": "fastapi-background",
      "query": "Configure FastAPI lifespan with health checks",
      "expectedBehavior": [
        "Uses asynccontextmanager for lifespan",
        "Initializes DB engine and Redis in startup",
        "Implements health check endpoint verifying all dependencies"
      ]
    },
    {
      "id": "sqlalchemy-sessions",
      "rule": "sqlalchemy-sessions",
      "query": "Set up async SQLAlchemy sessions with FastAPI",
      "expectedBehavior": [
        "Creates engine with pool_pre_ping=True",
        "Uses async_sessionmaker with expire_on_commit=False",
        "Implements get_db dependency with commit/rollback"
      ]
    },
    {
      "id": "sqlalchemy-relationships",
      "rule": "sqlalchemy-relationships",
      "query": "Define SQLAlchemy models with eager loading",
      "expectedBehavior": [
        "Uses Mapped type annotations",
        "Sets lazy='raise' on relationships",
        "Uses selectinload for eager loading"
      ]
    },
    {
      "id": "sqlalchemy-migrations",
      "rule": "sqlalchemy-migrations",
      "query": "Implement bulk operations and repository pattern",
      "expectedBehavior": [
        "Creates generic AsyncRepository with CRUD",
        "Chunks bulk inserts for memory management",
        "Uses flush() for ID generation without commit"
      ]
    },
    {
      "id": "pooling-database",
      "rule": "pooling-database",
      "query": "Configure database connection pooling for production",
      "expectedBehavior": [
        "Sets pool_size, max_overflow, pool_pre_ping",
        "Configures pool_recycle and pool_timeout",
        "Uses pool sizing formula"
      ]
    },
    {
      "id": "pooling-http",
      "rule": "pooling-http",
      "query": "Set up aiohttp session with connection limits",
      "expectedBehavior": [
        "Configures TCPConnector with limit and limit_per_host",
        "Sets proper timeouts (total, connect, sock_read)",
        "Creates session at startup, closes at shutdown"
      ]
    },
    {
      "id": "pooling-tuning",
      "rule": "pooling-tuning",
      "query": "Diagnose and fix connection pool exhaustion",
      "expectedBehavior": [
        "Adds connection checkout/checkin event listeners",
        "Implements retry logic for stale connections",
        "Uses Prometheus metrics for pool monitoring"
      ]
    }
  ]
}
