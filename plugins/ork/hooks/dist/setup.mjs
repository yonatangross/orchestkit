// OrchestKit Hooks - setup bundle
// Generated: 2026-02-06T16:44:55.592Z

function Pn(t){return typeof t.command=="string"}function Nn(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function Mn(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function An(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as ut,existsSync as pt,statSync as ie,renameSync as se,mkdirSync as ce,readSync as ae}from"node:fs";import{execSync as ue}from"node:child_process";import nt from"node:os";import P from"node:path";function N(){return process.env.HOME||process.env.USERPROFILE||nt.homedir()}function ot(){return nt.tmpdir()}function V(){return process.env.CLAUDE_PROJECT_DIR||"."}function rt(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function it(){return process.env.CLAUDE_PLUGIN_ROOT?P.join(N(),".claude","logs","ork"):P.join(V(),".claude","logs")}var Un=P.join,Kn=P.sep;import{execSync as Kt}from"node:child_process";import{createHash as Wt}from"node:crypto";import{existsSync as st,readFileSync as Vt,writeFileSync as Jt,mkdirSync as Bt}from"node:fs";import{join as J,basename as qt}from"node:path";var zt=20,Gt=15,Yt=/[^a-z0-9-]/g;function Xt(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=qt(e);return ct(n,zt)}function Zt(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=Kt("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=ct(n||"detached",Gt);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function Qt(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function te(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function ee(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return Wt("sha256").update(t).digest("hex").slice(0,4)}function ct(t,e){return t.toLowerCase().replace(Yt,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function ne(t,e){let n=Xt(t),o=Zt(t),i=Qt(e),s=te(e),c=ee();return`${n}-${o}-${i}-${s}-${c}`}function oe(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=J(e,".instance","session-id.json");if(st(n))try{let o=JSON.parse(Vt(n,"utf8"));if(o.session_id&&o.created_at){let i=Date.now()-new Date(o.created_at).getTime(),s=1440*60*1e3;if(i<s)return o.session_id}}catch{}}function re(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=J(n,".instance"),i=J(o,"session-id.json");try{st(o)||Bt(o,{recursive:!0}),Jt(i,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function at(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=oe(t);if(e)return e;let n=ne(t);return re(n,t),n}function lt(){return it()}function h(){return V()}function S(){return rt()}function mt(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${S()}/.claude/.instance_env`}function x(){return at()}function Qn(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=ue("git branch --show-current",{cwd:t||h(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function pe(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function to(t){return t.replace(/\r\n/g,`
`)}function le(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(pe())}function m(){return{continue:!0,suppressOutput:!0}}function eo(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function no(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function k(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function me(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function oo(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function ro(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function io(t){return{continue:!0,systemMessage:t}}function so(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function co(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function ao(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var de=200*1024,fe=100*1024;function dt(t,e){if(pt(t))try{if(ie(t).size>e){let o=`${t}.old.${Date.now()}`;se(t,o)}}catch{}}function ft(t){pt(t)||ce(t,{recursive:!0})}function r(t,e,n="debug"){if(!le(n))return;let o=lt(),i=`${o}/hooks.log`;try{ft(o),dt(i,de);let s=new Date().toISOString().replace("T"," ").slice(0,19);ut(i,`[${s}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function uo(t,e,n){let o=lt(),i=`${o}/permission-feedback.log`;try{ft(o),dt(i,fe);let s=new Date().toISOString(),c=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=n?.session_id||x();ut(i,`${s} | ${t} | ${e} | tool=${c} | session=${a}
`)}catch{}}function ge(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function po(t,e,n,o,i){let s=ge(t);return o&&o.isOverBudget(n)?(r(e,`Budget exhausted for ${n}, suppressing ${s}t`),m()):(i&&i.trackTokenUsage(e,n,s),me(t))}function lo(){try{let t=[],n=Buffer.allocUnsafe(256),o,i=0;for(;;)try{if(o=ae(i,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let s=Buffer.concat(t).toString("utf8").trim();return s?JSON.parse(s):{tool_name:"",session_id:x(),tool_input:{}}}catch{return{tool_name:"",session_id:x(),tool_input:{}}}}function mo(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let i of n){if(o==null)return;o=o[i]}return o}function fo(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function go(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{existsSync as D,readFileSync as q,writeFileSync as he,mkdirSync as ke}from"node:fs";var ye=[{package:"lodash",pattern:"<4.17.21",severity:"high",cve:"CVE-2021-23337",description:"Prototype pollution"},{package:"minimist",pattern:"<1.2.6",severity:"critical",cve:"CVE-2021-44906",description:"Prototype pollution"},{package:"node-fetch",pattern:"<2.6.7",severity:"high",cve:"CVE-2022-0235",description:"Information exposure"},{package:"axios",pattern:"<0.21.2",severity:"high",cve:"CVE-2021-3749",description:"ReDoS vulnerability"},{package:"jsonwebtoken",pattern:"<9.0.0",severity:"critical",cve:"CVE-2022-23529",description:"Insecure token verification"},{package:"express",pattern:"<4.17.3",severity:"medium",cve:"CVE-2022-24999",description:"Open redirect"},{package:"tar",pattern:"<6.1.11",severity:"critical",cve:"CVE-2021-37701",description:"Arbitrary file overwrite"},{package:"path-parse",pattern:"<1.0.7",severity:"medium",cve:"CVE-2021-23343",description:"ReDoS vulnerability"},{package:"django",pattern:"<3.2.14",severity:"high",cve:"CVE-2022-34265",description:"SQL injection"},{package:"flask",pattern:"<2.0.2",severity:"medium",cve:"CVE-2021-28091",description:"Path traversal"},{package:"requests",pattern:"<2.28.0",severity:"medium",cve:"CVE-2023-32681",description:"Information disclosure"},{package:"urllib3",pattern:"<1.26.5",severity:"high",cve:"CVE-2021-33503",description:"ReDoS vulnerability"},{package:"pillow",pattern:"<9.0.0",severity:"high",cve:"CVE-2022-22817",description:"Buffer overflow"},{package:"pyyaml",pattern:"<5.4",severity:"critical",cve:"CVE-2020-14343",description:"Arbitrary code execution"},{package:"jinja2",pattern:"<3.0.3",severity:"medium",cve:"CVE-2020-28493",description:"XSS vulnerability"},{package:"sqlalchemy",pattern:"<1.4.46",severity:"medium",cve:"CVE-2023-30533",description:"SQL injection"}],Se=24;function ve(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function $e(t,e){let n=t.split(".").map(i=>parseInt(i,10)||0),o=e.split(".").map(i=>parseInt(i,10)||0);for(let i=0;i<Math.max(n.length,o.length);i++){let s=n[i]||0,c=o[i]||0;if(s<c)return!0;if(s>c)return!1}return!1}function _e(t,e){let n=e.charAt(0),o=e.substring(1);return n==="<"?$e(t,o):n==="="?t===o:!1}function be(t){return t.replace(/^[^~>=<]/,"").replace(/,.*$/,"").trim()}function gt(t,e){let n=be(e),o=t.toLowerCase();for(let i of ye)if(o===i.package&&_e(n,i.pattern))return i;return null}function Ce(t){if(!D(t))return null;try{let e=JSON.parse(q(t,"utf-8"));if((Date.now()-e.timestamp)/(1e3*60*60)<Se)return e.warnings}catch{}return null}function B(t,e){try{ke(t.replace(/\/[^/]+$/,""),{recursive:!0});let n={warnings:e,timestamp:Date.now()};he(t,JSON.stringify(n,null,2))}catch{}}function Ee(t){let e=0,n=0,o="";if(!D(t))return{criticalCount:e,highCount:n,warnings:o};try{let i=JSON.parse(q(t,"utf-8")),s={...i.dependencies,...i.devDependencies};for(let[c,a]of Object.entries(s)){let u=gt(c,a);u&&(u.severity==="critical"&&e++,u.severity==="high"&&n++,o+=`
- ${c}@${a}: ${u.description} (${u.cve}, ${u.severity}) - upgrade to ${u.pattern}`)}}catch{}return{criticalCount:e,highCount:n,warnings:o}}function De(t){let e=0,n=0,o="";if(!D(t))return{criticalCount:e,highCount:n,warnings:o};try{let s=q(t,"utf-8").split(`
`);for(let c of s){let a=c.trim();if(!a||a.startsWith("#"))continue;let u=a.match(/^([a-zA-Z0-9_-]+)(?:==|>=|~=|!=|<|>)\s*([0-9.]+)/);if(!u)continue;let[,p,d]=u,l=gt(p,d);l&&(l.severity==="critical"&&e++,l.severity==="high"&&n++,o+=`
- ${p}==${d}: ${l.description} (${l.cve}, ${l.severity}) - upgrade to ${l.pattern}`)}}catch{}return{criticalCount:e,highCount:n,warnings:o}}function ht(t){if(ve())return r("dependency-version-check","Skipping dependency check (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),m();r("dependency-version-check","Starting dependency version check");let e=t.project_dir||h(),n=`${e}/.claude/feedback/dependency-check-cache.json`,o=D(`${e}/package.json`),i=D(`${e}/requirements.txt`),s=D(`${e}/pyproject.toml`),c=D(`${e}/go.mod`);if(!o&&!i&&!s&&!c)return r("dependency-version-check","No package files found, skipping check"),B(n,"none"),m();let a=Ce(n);if(a!==null)return r("dependency-version-check","Using cached dependency warnings"),a!=="none"?k(`DEPENDENCY SECURITY CHECK (cached): ${a}`):m();let u=0,p=0,d="";if(o){let l=Ee(`${e}/package.json`);u+=l.criticalCount,p+=l.highCount,l.warnings&&(d+=`

Node.js (package.json):${l.warnings}`)}if(i){let l=De(`${e}/requirements.txt`);u+=l.criticalCount,p+=l.highCount,l.warnings&&(d+=`

Python (requirements.txt):${l.warnings}`)}if(d){let l=`Found ${u} critical and ${p} high severity vulnerabilities`,f=`DEPENDENCY SECURITY CHECK: ${l}${d}

Run 'npm audit' or 'pip-audit' for full details.`;if(B(n,f),r("dependency-version-check",l),u>0||p>0)return k(f)}else B(n,"none"),r("dependency-version-check","No known vulnerabilities found");return m()}import{writeFileSync as Ie,mkdirSync as Re}from"node:fs";function Oe(){return!!process.env.MEM0_API_KEY}function we(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function kt(t){if(we())return r("mem0-webhook-setup","Skipping mem0 webhook setup (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),m();if(r("mem0-webhook-setup","Mem0 webhook setup starting"),!Oe())return r("mem0-webhook-setup","Mem0 not available, skipping webhook setup"),m();let e=t.project_dir||h(),n=`${e}/.claude/mem0-webhooks.json`,o="orchestkit-auto-sync",i=["memory.created","memory.updated","memory.deleted"],s=process.env.MEM0_WEBHOOK_URL||"https://example.com/webhook/mem0";r("mem0-webhook-setup","Checking for existing webhooks"),process.env.MEM0_WEBHOOK_URL||r("mem0-webhook-setup","Webhook URL not configured (set MEM0_WEBHOOK_URL), skipping creation");try{Re(`${e}/.claude`,{recursive:!0}),Ie(n,JSON.stringify({webhook_name:o,events:i,url:s},null,2)),r("mem0-webhook-setup","Webhook config saved")}catch(c){r("mem0-webhook-setup",`Failed to save webhook config: ${c}`)}return r("mem0-webhook-setup","Webhook setup complete"),m()}import{existsSync as He,readFileSync as xe,writeFileSync as Te,mkdirSync as St,appendFileSync as Pe}from"node:fs";function yt(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function Ne(){return process.env.CLAUDE_MULTI_INSTANCE==="1"}function Me(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function Ae(t){let e=`${t}/.claude/context/session/state.json`;if(!He(e))return"General development";try{return JSON.parse(xe(e,"utf-8")).current_task?.description||"General development"}catch{return"General development"}}function Fe(){return process.env.CLAUDE_SUBAGENT_ROLE||"main"}function je(){let t=x(),e=new Date().toISOString().replace(/[-:T.Z]/g,"").slice(0,14),n=Math.random().toString(36).substring(2,8);return`${t.slice(0,8)}-${e}-${n}`}function Le(t,e){let n=mt();try{St(`${t}/.claude`,{recursive:!0}),Pe(n,`CLAUDE_INSTANCE_ID=${e}
`),r("coordination-init",`Saved instance ID: ${e}`)}catch(o){r("coordination-init",`Failed to save instance ID: ${o}`)}}function Ue(t,e,n,o){let i=`${t}/.claude/coordination/heartbeats`;try{St(i,{recursive:!0});let s={instance_id:e,task:n,role:o,status:"active",started_at:new Date().toISOString(),last_heartbeat:new Date().toISOString()};Te(`${i}/${e}.json`,JSON.stringify(s,null,2)),r("coordination-init",`Initialized heartbeat for ${e}`)}catch(s){r("coordination-init",`Failed to initialize heartbeat: ${s}`)}}function vt(t){if(yt())return r("coordination-init","Agent Teams active, yielding to CC native registration"),m();if(!Ne())return r("coordination-init","Multi-instance not enabled, skipping"),m();if(Me())return r("coordination-init","Skipping coordination init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),m();r("coordination-init","Starting coordination initialization");let e=t.project_dir||h(),n=Ae(e),o=Fe(),i=je();return process.env.CLAUDE_INSTANCE_ID=i,Le(e,i),Ue(e,i,n,o),r("coordination-init",`Coordination initialized: ${i}`),m()}var M=[{name:"dependency-version-check",fn:ht},{name:"mem0-webhook-setup",fn:kt},{name:"coordination-init",fn:vt}];async function $t(t){r("setup-dispatcher",`Running ${M.length} Setup hooks in parallel`);let e=await Promise.allSettled(M.map(async o=>{try{let i=o.fn(t);return i instanceof Promise&&await i,{hook:o.name,status:"success"}}catch(i){let s=i instanceof Error?i.message:String(i);return r("setup-dispatcher",`${o.name} failed: ${s}`),{hook:o.name,status:"error",message:s}}})),n=[];for(let o of e)o.status==="rejected"?n.push("unknown"):o.value.status==="error"&&n.push(o.value.hook);return n.length>0?r("setup-dispatcher",`${n.length}/${M.length} hooks failed: ${n.join(", ")}`):r("setup-dispatcher",`All ${M.length} Setup hooks completed successfully`),m()}import{existsSync as _t,mkdirSync as Ke,writeFileSync as bt,readdirSync as G,chmodSync as We}from"node:fs";import{execSync as b}from"node:child_process";var z="4.25.0";function Ve(){r("first-run-setup","Phase 1: Detecting environment");let t={os:process.platform};try{let n=b("python3 --version",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}).match(/(\d+\.\d+)/);n&&(t.python=n[1],r("first-run-setup",`Python: ${n[1]}`))}catch{}try{let n=b("node --version",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}).match(/(\d+\.\d+)/);n&&(t.nodejs=n[1],r("first-run-setup",`Node.js: ${n[1]}`))}catch{}try{b("which git",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}),t.git=!0,r("first-run-setup","Git: available")}catch{}try{b("which docker",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}),t.docker=!0,r("first-run-setup","Docker: available")}catch{}try{b("which sqlite3",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}),t.sqlite3=!0,r("first-run-setup","SQLite3: available (multi-instance coordination enabled)")}catch{}return t}function Je(){r("first-run-setup","Phase 2: Validating dependencies");let t=[],e=[];try{b("which jq",{encoding:"utf8",stdio:["pipe","pipe","pipe"]})}catch{t.push("jq (required for JSON processing)")}try{b("which sqlite3",{encoding:"utf8",stdio:["pipe","pipe","pipe"]})}catch{e.push("sqlite3 not found - multi-instance coordination disabled")}try{b('python3 -c "import anthropic"',{encoding:"utf8",stdio:["pipe","pipe","pipe"]}),r("first-run-setup","Anthropic SDK: available (Memory Fabric Agent enabled)")}catch{e.push("anthropic SDK not found - Memory Fabric Agent will use fallback mode"),e.push("  Install with: pip install 'orchestkit[memory]'")}if(t.length>0){r("first-run-setup","ERROR: Missing required dependencies:");for(let n of t)r("first-run-setup",`  - ${n}`)}for(let n of e)r("first-run-setup",`WARN: ${n}`);return{valid:t.length===0,missing:t,warnings:e}}function Be(t){let e={complete:{preset:"complete",description:"Full AI-assisted development toolkit",features:{skills:!0,agents:!0,hooks:!0,mcp:!0,coordination:!0,statusline:!0},hook_groups:{safety:!0,quality:!0,productivity:!0,observability:!0}},standard:{preset:"standard",description:"Skills and hooks without agent orchestration",features:{skills:!0,agents:!1,hooks:!0,mcp:!0,coordination:!0,statusline:!0},hook_groups:{safety:!0,quality:!0,productivity:!0,observability:!0}},lite:{preset:"lite",description:"Essential skills for constrained environments",features:{skills:!0,agents:!1,hooks:!0,mcp:!1,coordination:!1,statusline:!1},hook_groups:{safety:!0,quality:!0,productivity:!1,observability:!1}},"hooks-only":{preset:"hooks-only",description:"Safety hooks only for pure automation",features:{skills:!1,agents:!1,hooks:!0,mcp:!1,coordination:!1,statusline:!1},hook_groups:{safety:!0,quality:!1,productivity:!1,observability:!1}}};return e[t]||e.complete}function qe(t,e,n){r("first-run-setup",`Phase 4: Applying configuration (preset: ${t})`);let o=Be(t),i=[`${n}/.claude/defaults`,`${n}/.claude/context/session`,`${n}/.claude/context/knowledge`,`${n}/.claude/logs`];for(let c of i)try{Ke(c,{recursive:!0})}catch{}let s=`${n}/.claude/defaults/config.json`;_t(s)||(bt(s,JSON.stringify(o,null,2)),r("first-run-setup",`Created config file: ${s}`));try{let c=`${n}/hooks`;if(_t(c)){let a=u=>{try{let p=G(u,{withFileTypes:!0});for(let d of p){let l=`${u}/${d.name}`;if(d.isDirectory())a(l);else if(d.name.endsWith(".sh"))try{We(l,493)}catch{}}}catch{}};a(c),r("first-run-setup","Made hooks executable")}}catch{}return o}function ze(t,e,n){r("first-run-setup","Phase 5: Creating marker file");let o=new Date().toISOString(),i=0,s=0,c=0;try{let p=(d,l)=>{let f=0,g=$=>{try{let _=G($,{withFileTypes:!0});for(let y of _){let H=`${$}/${y.name}`;y.isDirectory()?g(H):l.test(y.name)&&f++}}catch{}};return g(d),f};i=p(`${n}/hooks`,/\.sh$/),s=p(`${n}/skills`,/SKILL\.md$/),c=p(`${n}/agents`,/\.md$/)}catch{}let a={version:z,setup_date:o,preset:t,components:{hooks:{count:i,valid:!0},skills:{count:s,valid:!0},agents:{count:c,valid:!0}},last_health_check:o,last_maintenance:o,environment:e,user_preferences:{onboarding_completed:!0,mcp_configured:!1,statusline_configured:!1}},u=`${n}/.setup-complete`;bt(u,JSON.stringify(a,null,2)),r("first-run-setup",`Marker file created: ${u}`)}function Ct(t){let e=S(),n=process.argv.includes("--silent")?"silent":"interactive";r("first-run-setup",`First-run setup starting (mode: ${n})`);let o=Ve(),{valid:i,missing:s}=Je();if(!i){r("first-run-setup","ERROR: Dependency validation failed");let l=`OrchestKit setup failed: Missing required dependencies. Install ${s.join(", ")}.`;return k(l)}let c="complete";n==="interactive"?r("first-run-setup","Interactive mode - using complete preset (wizard via Claude conversation)"):r("first-run-setup","Silent mode - using complete preset"),qe(c,o,e),ze(c,o,e);let a=0,u=0,p=0;try{let l=(f,g)=>{let $=0,_=y=>{try{let H=G(y,{withFileTypes:!0});for(let W of H){let Ut=`${y}/${W.name}`;W.isDirectory()?_(Ut):g.test(W.name)&&$++}}catch{}};return _(f),$};a=l(`${e}/hooks`,/\.sh$/),u=l(`${e}/skills`,/SKILL\.md$/),p=l(`${e}/agents`,/\.md$/)}catch{}r("first-run-setup",`Setup complete: ${u} skills, ${p} agents, ${a} hooks`);let d=n==="interactive"?`OrchestKit v${z} setup complete! Loaded ${u} skills, ${p} agents, and ${a} hooks. Use /ork:configure to customize settings.`:`OrchestKit v${z} initialized (silent mode).`;return k(d)}import{existsSync as Ge,mkdirSync as Ye,writeFileSync as Xe}from"node:fs";import{execSync as Ze}from"node:child_process";function Qe(){return!!process.env.MEM0_API_KEY}function Et(t){if(r("mem0-analytics","Mem0 analytics dashboard starting"),!Qe())return r("mem0-analytics","Mem0 not available, skipping analytics dashboard"),m();let e=t.project_dir||h(),n=S(),o=`${e}/.claude/logs/mem0-analytics.jsonl`,i=`${e}/.claude/logs/mem0-dashboard.json`,s=`${n}/skills/mem0-memory/scripts/memory-summary.py`,c="{}";if(Ge(s))try{c=Ze(`python3 "${s}"`,{encoding:"utf8",timeout:3e4,stdio:["pipe","pipe","pipe"]})}catch{r("mem0-analytics","Failed to run summary script")}else return r("mem0-analytics","Summary script not found, skipping dashboard"),m();let a;try{a=JSON.parse(c)}catch{a={}}let p={timestamp:new Date().toISOString(),summary:a,trends:{memory_growth:"tracked",search_frequency:"tracked",graph_utilization:"tracked"}};try{Ye(`${e}/.claude/logs`,{recursive:!0}),Xe(i,JSON.stringify(p,null,2)),r("mem0-analytics","Mem0 analytics dashboard generated")}catch(d){r("mem0-analytics",`Failed to save dashboard: ${d}`)}return m()}import{mkdirSync as tn,writeFileSync as en}from"node:fs";function nn(){return!!process.env.MEM0_API_KEY}function Dt(t){if(r("mem0-backup","Mem0 backup setup starting"),!nn())return r("mem0-backup","Mem0 not available, skipping backup setup"),m();let e=t.project_dir||h(),n=`${e}/.claude/mem0-backup-config.json`,o=process.env.MEM0_BACKUP_SCHEDULE||"weekly",i=parseInt(process.env.MEM0_BACKUP_RETENTION||"30",10);try{tn(`${e}/.claude`,{recursive:!0});let s={schedule:o,retention_days:i,enabled:!0,max_backups:parseInt(process.env.MEM0_MAX_BACKUPS||"5",10),rotation_strategy:"count",backup_naming:"timestamp"};en(n,JSON.stringify(s,null,2)),r("mem0-backup",`Mem0 backup configured: schedule=${o}, retention=${i} days`)}catch(s){r("mem0-backup",`Failed to create backup config: ${s}`)}return m()}import{existsSync as It,mkdirSync as on,appendFileSync as O}from"node:fs";import{execSync as Rt}from"node:child_process";function rn(){return!!process.env.MEM0_API_KEY}function sn(t){let e=new Date;return e.setDate(e.getDate()-t),e.toISOString().split("T")[0]}function Ot(t){if(r("mem0-cleanup","Mem0 cleanup starting"),!rn())return r("mem0-cleanup","Mem0 not available, skipping cleanup"),m();let e=t.project_dir||h(),o=`${S()}/skills/mem0-memory/scripts`,i=`${o}/batch/batch-delete.py`,s=`${o}/crud/get-memories.py`;if(!It(i))return r("mem0-cleanup",`Batch delete script not found at ${i}, skipping cleanup`),m();if(!It(s))return r("mem0-cleanup",`Get memories script not found at ${s}, skipping cleanup`),m();let c=parseInt(process.env.MEM0_CLEANUP_AGE_DAYS||"90",10),a=sn(c),u=`${e}/.claude/logs/mem0-cleanup.log`;try{on(`${e}/.claude/logs`,{recursive:!0})}catch{}r("mem0-cleanup",`Querying memories older than ${a} (${c} days)`);let p=new Date().toISOString();try{O(u,`[${p}] Cleanup started - threshold: ${a}
`)}catch{}let d;try{let g=Rt(`python3 "${s}"`,{encoding:"utf8",timeout:6e4,stdio:["pipe","pipe","pipe"]});d=JSON.parse(g)}catch{r("mem0-cleanup","Failed to get memories");try{O(u,`[${p}] Failed to get memories
`)}catch{}return m()}let f=(d.memories||[]).filter(g=>{let _=(g.created_at?.split("T")[0]||"")<a,y=g.metadata?.protected===!0;return _&&!y}).map(g=>g.id).slice(0,100);if(f.length===0){r("mem0-cleanup",`No stale memories found older than ${a}`);try{O(u,`[${p}] No stale memories found
`)}catch{}return m()}r("mem0-cleanup",`Found ${f.length} stale memories to delete`);try{O(u,`[${p}] Found ${f.length} stale memories
`)}catch{}try{let g=JSON.stringify(f);Rt(`python3 "${i}" --memory-ids '${g}'`,{encoding:"utf8",timeout:12e4,stdio:["pipe","pipe","pipe"]}),r("mem0-cleanup",`Successfully deleted ${f.length} stale memories`);try{O(u,`[${p}] Deleted ${f.length} memories successfully
`)}catch{}}catch(g){r("mem0-cleanup",`Batch delete failed: ${g}`);try{O(u,`[${p}] Delete failed: ${g}
`)}catch{}}return r("mem0-cleanup",`Mem0 cleanup complete (age threshold: ${c} days)`),m()}import{existsSync as Y,readdirSync as wt}from"node:fs";var cn=["pnpm-workspace.yaml","lerna.json","nx.json","turbo.json","rush.json"];function an(t){let e=0;try{let n=wt(t,{withFileTypes:!0});for(let o of n){if(!o.isDirectory()||o.name.startsWith(".")||o.name==="node_modules")continue;let i=`${t}/${o.name}`;Y(`${i}/package.json`)&&e++;try{let s=wt(i,{withFileTypes:!0});for(let c of s)!c.isDirectory()||c.name.startsWith(".")||c.name==="node_modules"||Y(`${i}/${c.name}/package.json`)&&e++}catch{}}}catch{}return e}function Ht(t){if(r("monorepo-detector","Checking for monorepo structure"),process.env.CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD==="1")return r("monorepo-detector","CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD already set, skipping"),m();let e=t.project_dir||h(),n=[];for(let c of cn)Y(`${e}/${c}`)&&n.push(c);let o=an(e);if(!(n.length>0||o>=3))return r("monorepo-detector","No monorepo detected"),m();let s=n.length>0?`Detected: ${n.join(", ")}`:`Found ${o} nested packages`;return r("monorepo-detector",`Monorepo detected: ${s}`),k(`**Monorepo Detected** (${s})

CC 2.1.20 supports multi-directory context with \`--add-dir\`. Each service can have its own CLAUDE.md for targeted instructions.

Set \`CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD=1\` to auto-load CLAUDE.md from added directories.`)}import{existsSync as C,readFileSync as Z,readdirSync as un,writeFileSync as pn}from"node:fs";import{spawn as X}from"node:child_process";var T="4.25.0";function xt(t,e){if(!C(t))return null;try{let n=JSON.parse(Z(t,"utf-8")),o=e.split("."),i=n;for(let s of o){if(i==null)return null;i=i[s]}return i}catch{return null}}function ln(t){let e=0,n=`${t}/.claude/defaults/config.json`;if(C(n))try{JSON.parse(Z(n,"utf-8"))}catch{r("setup-check","WARN: config.json is invalid JSON"),e++}let o=0;if(C(`${t}/hooks`))try{let c=(a,u=0)=>{if(u>3)return 0;let p=0;try{let d=un(a,{withFileTypes:!0});for(let l of d.slice(0,100)){let f=`${a}/${l.name}`;l.isDirectory()&&!l.name.startsWith(".")?p+=c(f,u+1):l.name.endsWith(".sh")&&p++}}catch{}return p};o=c(`${t}/hooks`)}catch{}o<10&&r("setup-check",`WARN: Only ${o} hooks found (expected 50+)`);let i=`${t}/.setup-complete`,s=xt(i,"version");return s&&s!==T?(r("setup-check",`INFO: Version mismatch - marker: ${s}, current: ${T}`),2):e}function mn(t){let e=xt(t,"last_maintenance");if(!e)return!0;try{let n=new Date(e).getTime();return(Date.now()-n)/(1e3*60*60)>=24}catch{return!0}}function dn(t,e,n){if(C(t))try{let o=JSON.parse(Z(t,"utf-8"));o[e]=n,pn(t,JSON.stringify(o,null,2))}catch{}}function Tt(t){if(process.env.ORCHESTKIT_SKIP_SETUP==="1"||process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1")return m();let e=S(),n=`${e}/.setup-complete`,o=`${e}/hooks/setup`;r("setup-check",`Setup check starting (v${T})`);let i=process.argv;if(i.includes("--init")||i.includes("init"))return r("setup-check","Explicit --init: Running full setup"),{continue:!0,systemMessage:"Running first-run setup..."};if(i.includes("--init-only")||i.includes("init-only"))return r("setup-check","CI/CD mode (--init-only): Running silent setup"),{continue:!0,systemMessage:"Running silent setup..."};if(i.includes("--maintenance")||i.includes("maintenance"))return r("setup-check","Explicit --maintenance: Running maintenance tasks"),{continue:!0,systemMessage:"Running maintenance tasks..."};if(!C(n))return r("setup-check","No marker file found - first run detected"),(t.hook_event||process.env.HOOK_EVENT)==="Setup"?{continue:!0,systemMessage:"First run detected. Running setup..."}:k("OrchestKit setup not complete. Run 'claude --init' to configure the plugin.");switch(r("setup-check","Marker file exists - running quick validation"),ln(e)){case 0:if(mn(n)){r("setup-check","Maintenance due - queueing background tasks");let u=`${o}/setup-maintenance.sh`;C(u)&&X(u,["--background"],{detached:!0,stdio:"ignore"}).unref()}return r("setup-check","Setup check passed (fast path)"),m();case 1:r("setup-check","Validation failed - triggering self-healing repair");let c=`${o}/setup-repair.sh`;return C(c)&&X(c,[],{detached:!0,stdio:"ignore"}).unref(),k("OrchestKit setup validation failed. Repair running in background.");case 2:r("setup-check","Version mismatch - running migration");let a=`${o}/setup-maintenance.sh`;return C(a)&&X(a,["--migrate"],{detached:!0,stdio:"ignore"}).unref(),dn(n,"version",T),k(`OrchestKit upgraded to v${T}.`);default:return m()}}import{existsSync as E,mkdirSync as fn,readFileSync as Q,writeFileSync as gn,renameSync as Pt,readdirSync as w,unlinkSync as F,statSync as I,chmodSync as hn}from"node:fs";import{execSync as j}from"node:child_process";var A="4.25.0",v=[];function Nt(t,e){if(!E(t))return null;try{return JSON.parse(Q(t,"utf-8"))[e.replace(/^\./,"")]}catch{return null}}function tt(t,e,n){if(E(t))try{let o=JSON.parse(Q(t,"utf-8"));o[e.replace(/^\./,"")]=n,gn(t,JSON.stringify(o,null,2))}catch{}}function kn(t){if(!t)return 999;try{let e=new Date(t).getTime();return(Date.now()-e)/(1e3*60*60)}catch{return 999}}function yn(t){r("setup-maintenance","Task: Log rotation");let e=[`${t}/.claude/logs`,`${N()}/.claude/logs/ork`],n=0;for(let o of e)if(E(o))try{let i=w(o);for(let c of i){if(!c.endsWith(".log"))continue;let a=`${o}/${c}`;try{if(I(a).size>204800){let p=`${a}.old.${Date.now()}`;Pt(a,p),n++;try{j(`gzip "${p}"`,{stdio:["pipe","pipe","pipe"]})}catch{}}}catch{}}let s=i.filter(c=>c.includes(".log.old.")).sort().reverse();for(let c of s.slice(5))try{F(`${o}/${c}`)}catch{}}catch{}n>0&&v.push(`Rotated ${n} log files`)}function Sn(t){r("setup-maintenance","Task: Stale lock cleanup");let e=`${t}/.claude/coordination/.claude.db`,n=0;if(E(e))try{j(`sqlite3 "${e}" "DELETE FROM file_locks WHERE datetime(acquired_at) < datetime('now', '-24 hours');"`,{timeout:5e3,stdio:["pipe","pipe","pipe"]});let o=j(`sqlite3 "${e}" "SELECT COUNT(*) FROM file_locks;"`,{encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();r("setup-maintenance",`Coordination locks remaining: ${o}`),n=1}catch{}try{let o=(i,s=0)=>{if(!(s>3))try{let c=w(i,{withFileTypes:!0});for(let a of c){let u=`${i}/${a.name}`;if(a.isDirectory()&&!a.name.startsWith("."))o(u,s+1);else if(a.name.endsWith(".lock"))try{let p=I(u);(Date.now()-p.mtimeMs)/(1e3*60*60)>24&&(F(u),n++)}catch{}}}catch{}};o(t)}catch{}n>0&&v.push("Cleaned stale locks")}function vn(t){r("setup-maintenance","Task: Session cleanup");let e=`${t}/.claude/context/sessions`,n=`${t}/.claude/context/archive`;if(!E(e))return;let o=0;try{fn(n,{recursive:!0});let s=w(e,{withFileTypes:!0});for(let c of s){if(!c.isDirectory())continue;let a=`${e}/${c.name}`;try{let u=I(a);(Date.now()-u.mtimeMs)/(1e3*60*60*24)>7&&(Pt(a,`${n}/${c.name}`),o++)}catch{}}}catch{}let i=ot();try{let s=w(i);for(let c of s){if(!c.startsWith("claude-session-"))continue;let a=`${i}/${c}`;try{let u=I(a);(Date.now()-u.mtimeMs)/(1e3*60*60*24)>7&&u.isDirectory()&&j(`rm -rf "${a}"`,{stdio:["pipe","pipe","pipe"]})}catch{}}}catch{}o>0&&v.push(`Archived ${o} old sessions`)}function $n(t){r("setup-maintenance","Task: Memory Fabric cleanup");let e=0,n=`${t}/.claude/logs`;if(E(n))try{let i=w(n);for(let s of i){if(!s.startsWith(".mem0-pending-sync-"))continue;let c=`${n}/${s}`;try{let a=I(c);(Date.now()-a.mtimeMs)/(1e3*60*60*24)>7&&(F(c),e++)}catch{}}}catch{}let o=`${N()}/.claude/.mem0-pending-sync.json`;if(E(o))try{let i=I(o);(Date.now()-i.mtimeMs)/(1e3*60*60)>24&&(F(o),e++)}catch{}e>0&&v.push(`Cleaned ${e} Memory Fabric files`)}function _n(t,e){r("setup-maintenance","Task: Full health validation");let n=0,o=0,i=(c,a=0)=>{if(!(a>4))try{let u=w(c,{withFileTypes:!0});for(let p of u){let d=`${c}/${p.name}`;if(p.isDirectory()&&!p.name.startsWith("."))i(d,a+1);else if(p.name.endsWith(".sh"))try{I(d).mode&73||(hn(d,493),o++)}catch{}}}catch{}};i(`${t}/hooks`),o>0&&(r("setup-maintenance",`WARN: ${o} hooks were not executable`),n++);let s=`${t}/.claude/defaults/config.json`;if(E(s))try{JSON.parse(Q(s,"utf-8"))}catch{r("setup-maintenance","WARN: config.json is invalid"),n++}tt(e,"last_health_check",new Date().toISOString()),n===0?v.push("Health validation passed"):v.push(`Health validation found ${n} issues (auto-fixed)`)}function bn(t){r("setup-maintenance","Task: Version migration");let e=Nt(t,"version");!e||e===A||(r("setup-maintenance",`Migrating from ${e} to ${A}`),tt(t,"version",A),v.push(`Migrated from ${e} to ${A}`))}function Mt(t){let e=S(),n=t.project_dir||h(),o=`${e}/.setup-complete`,i=process.argv,s="auto";i.includes("--force")?s="force":i.includes("--migrate")?s="migrate":i.includes("--background")&&(s="background"),r("setup-maintenance",`Maintenance starting (mode: ${s})`);let c=new Date().toISOString(),a=Nt(o,"last_maintenance"),u=kn(a),p=!1,d=!1;switch(s){case"force":p=!0,d=!0;break;case"migrate":bn(o);break;case"background":case"auto":u>=24&&(p=!0),u>=168&&(d=!0);break}if(p&&(r("setup-maintenance","Running daily maintenance tasks"),yn(e),Sn(e),vn(e),$n(n)),d&&(r("setup-maintenance","Running weekly maintenance tasks"),_n(e,o)),tt(o,"last_maintenance",c),v.length>0){r("setup-maintenance",`Maintenance complete: ${v.length} tasks`);let l=`Completed: ${v.join(", ")}`;return s==="background"?m():k(`Maintenance: ${l}`)}return r("setup-maintenance","No maintenance tasks needed"),m()}import{existsSync as et,mkdirSync as At,readFileSync as Cn,writeFileSync as Ft,renameSync as En,readdirSync as U,statSync as Dn,chmodSync as In}from"node:fs";var Rn="4.25.0",R=[],L=[],K=!1;function On(t){let e=`${t}/.claude/defaults/config.json`,n=`${t}/.claude/defaults`;try{At(n,{recursive:!0})}catch{}if(et(e))try{JSON.parse(Cn(e,"utf-8"));return}catch{let i=`${e}.corrupt.${Date.now()}`;try{En(e,i),r("setup-repair",`Backed up corrupt config to ${i}`),K=!0}catch{}}Ft(e,JSON.stringify({preset:"complete",description:"Full AI-assisted development toolkit (restored by repair)",features:{skills:!0,agents:!0,hooks:!0,mcp:!0,coordination:!0,statusline:!0},hook_groups:{safety:!0,quality:!0,productivity:!0,observability:!0}},null,2)),R.push("config.json restored"),r("setup-repair","Restored default config.json")}function wn(t){let e=0,n=(o,i=0)=>{if(!(i>5))try{let s=U(o,{withFileTypes:!0});for(let c of s){let a=`${o}/${c.name}`;if(c.isDirectory()&&!c.name.startsWith("."))n(a,i+1);else if(c.name.endsWith(".sh"))try{Dn(a).mode&73||(In(a,493),e++)}catch{}}}catch{}};n(`${t}/hooks`),e>0&&(R.push(`${e} hook permissions fixed`),r("setup-repair",`Fixed permissions on ${e} hooks`))}function Hn(t){let e=0,n=[`${t}/.claude/defaults`,`${t}/.claude/context/session`,`${t}/.claude/context/knowledge`,`${t}/.claude/logs`,`${t}/.claude/coordination`];for(let o of n)if(!et(o))try{At(o,{recursive:!0}),e++}catch{}e>0&&(R.push(`${e} directories created`),r("setup-repair",`Created ${e} missing directories`))}function xn(t){let e=new Date().toISOString(),n=0,o=0,i=0,s=(u,p,d=5)=>{let l=0,f=(g,$)=>{if(!($>d))try{let _=U(g,{withFileTypes:!0});for(let y of _){let H=`${g}/${y.name}`;y.isDirectory()&&!y.name.startsWith(".")?f(H,$+1):p.test(y.name)&&l++}}catch{}};return f(u,0),l};try{n=s(`${t}/hooks`,/\.sh$/),o=s(`${t}/skills`,/SKILL\.md$/),i=s(`${t}/agents`,/\.md$/)}catch{}let c={version:Rn,setup_date:e,preset:"complete",repaired_at:e,components:{hooks:{count:n,valid:!0},skills:{count:o,valid:!0},agents:{count:i,valid:!0}},last_health_check:e,last_maintenance:e,environment:{os:process.platform},user_preferences:{onboarding_completed:!0,mcp_configured:!1,statusline_configured:!1}},a=`${t}/.setup-complete`;Ft(a,JSON.stringify(c,null,2)),R.push("marker file regenerated"),r("setup-repair","Regenerated marker file")}function Tn(t){let e=0,n=0;try{n=(s=>{let c=0,a=(u,p)=>{if(!(p>4))try{let d=U(u,{withFileTypes:!0});for(let l of d){let f=`${u}/${l.name}`;l.isDirectory()&&!l.name.startsWith(".")?a(f,p+1):l.name.endsWith(".sh")&&c++}}catch{}};return a(s,0),c})(`${t}/hooks`)}catch{}n<20&&(r("setup-repair",`CRITICAL: Only ${n} hooks found (expected 50+)`),e++);let o=0;try{o=(s=>{let c=0,a=(u,p)=>{if(!(p>2))try{let d=U(u,{withFileTypes:!0});for(let l of d){let f=`${u}/${l.name}`;l.isDirectory()&&!l.name.startsWith(".")?a(f,p+1):l.name==="SKILL.md"&&c++}}catch{}};return a(s,0),c})(`${t}/skills`)}catch{}return o<50&&(r("setup-repair",`CRITICAL: Only ${o} skills found (expected 100+)`),e++),et(`${t}/hooks/_lib/common.sh`)||(r("setup-repair","CRITICAL: hooks/_lib/common.sh missing"),e++),e>=2?(L.push("Multiple critical components missing - reinstall recommended"),K=!0,!1):!0}function jt(t){let e=S();r("setup-repair","Setup repair starting"),Hn(e),On(e),wn(e),Tn(e)||r("setup-repair","WARN: Critical components missing, repair incomplete"),xn(e);let n="";return R.length>0&&(n=`Repairs: ${R.join(", ")}`),L.length>0&&(n=`${n?n+". ":""}Issues: ${L.join(", ")}`,K=!0),r("setup-repair",`Repair complete: ${R.length} repairs made, ${L.length} issues`),K&&n?k(`OrchestKit auto-repair: ${n}`):m()}var Lt={"setup/unified-dispatcher":$t,"setup/first-run-setup":Ct,"setup/mem0-analytics-dashboard":Et,"setup/mem0-backup-setup":Dt,"setup/mem0-cleanup":Ot,"setup/monorepo-detector":Ht,"setup/setup-check":Tt,"setup/setup-maintenance":Mt,"setup/setup-repair":jt};function Er(t){return Lt[t]}function Dr(){return Object.keys(Lt)}export{go as escapeRegex,ge as estimateTokenCount,Qn as getCachedBranch,mt as getEnvFile,mo as getField,Er as getHook,lt as getLogDir,pe as getLogLevel,S as getPluginRoot,h as getProjectDir,x as getSessionId,Lt as hooks,Pn as isBashInput,Mn as isEditInput,An as isReadInput,Nn as isWriteInput,Dr as listHooks,r as logHook,uo as logPermissionFeedback,fo as normalizeCommand,to as normalizeLineEndings,ro as outputAllowWithContext,no as outputBlock,co as outputDeny,io as outputError,me as outputPromptContext,po as outputPromptContextBudgeted,eo as outputSilentAllow,m as outputSilentSuccess,so as outputWarning,k as outputWithContext,oo as outputWithNotification,ao as outputWithUpdatedInput,lo as readHookInput,le as shouldLog};
//# sourceMappingURL=setup.mjs.map
