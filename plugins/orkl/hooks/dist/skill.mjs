// OrchestKit Hooks - skill bundle
// Generated: 2026-02-20T12:28:57.094Z

function Ks(s){return typeof s.command=="string"}function Js(s){return typeof s.file_path=="string"&&typeof s.content=="string"}function Ys(s){return typeof s.file_path=="string"&&typeof s.old_string=="string"&&typeof s.new_string=="string"}function Xs(s){return typeof s.file_path=="string"&&s.content===void 0}import{existsSync as rt,statSync as le,renameSync as fe,mkdirSync as de,readSync as ge}from"node:fs";import{appendFileSync as Bt,mkdirSync as Gt}from"node:fs";import{dirname as Wt}from"node:path";var N=[],B=!1,Q=!1;function _(s,e){N.push({filePath:s,content:e}),zt()}function G(){if(B||N.length===0)return;B=!0;let s=new Map;for(let e of N){let t=s.get(e.filePath);t?t.push(e.content):s.set(e.filePath,[e.content])}for(let[e,t]of s)try{Gt(Wt(e),{recursive:!0}),Bt(e,t.join(""))}catch{}N.length=0,B=!1}function zt(){Q||(Q=!0,process.on("exit",G),process.on("SIGTERM",()=>{G(),process.exit(0)}),process.on("SIGINT",()=>{G(),process.exit(0)}))}import{execSync as me}from"node:child_process";import Vt from"node:os";import L from"node:path";function Zt(){return process.env.HOME||process.env.USERPROFILE||Vt.homedir()}function W(){return process.env.CLAUDE_PROJECT_DIR||"."}function tt(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function et(){return process.env.CLAUDE_PLUGIN_ROOT?L.join(Zt(),".claude","logs","ork"):L.join(W(),".claude","logs")}var rn=L.join,cn=L.sep;import{execSync as qt}from"node:child_process";import{createHash as Kt}from"node:crypto";import{existsSync as st,readFileSync as Jt,writeFileSync as Yt,mkdirSync as Xt}from"node:fs";import{join as z,basename as Qt}from"node:path";var te=20,ee=15,se=/[^a-z0-9-]/g;function ne(s){let e=s||process.env.CLAUDE_PROJECT_DIR||process.cwd(),t=Qt(e);return nt(t,te)}function oe(s){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=s||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let t=qt("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),n=nt(t||"detached",ee);return process.env.ORCHESTKIT_SESSION_BRANCH=n,n}catch{return"nobranch"}}function re(s){let e=s||new Date,t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}${n}`}function ie(s){let e=s||new Date,t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}${n}`}function ce(){let s=`${process.pid}-${Date.now()}-${Math.random()}`;return Kt("sha256").update(s).digest("hex").slice(0,4)}function nt(s,e){return s.toLowerCase().replace(se,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function ae(s,e){let t=ne(s),n=oe(s),o=re(e),r=ie(e),i=ce();return`${t}-${n}-${o}-${r}-${i}`}function ue(s){let e=s||process.env.CLAUDE_PROJECT_DIR||process.cwd(),t=z(e,".instance","session-id.json");if(st(t))try{let n=JSON.parse(Jt(t,"utf8"));if(n.session_id&&n.created_at){let o=Date.now()-new Date(n.created_at).getTime(),r=1440*60*1e3;if(o<r)return n.session_id}}catch{}}function pe(s,e){let t=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=z(t,".instance"),o=z(n,"session-id.json");try{st(n)||Xt(n,{recursive:!0}),Yt(o,JSON.stringify({session_id:s,created_at:new Date().toISOString()},null,2))}catch{}}function ot(s){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=ue(s);if(e)return e;let t=ae(s);return pe(t,s),t}function x(){return et()}function m(){return W()}function Z(){return tt()}function _n(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${Z()}/.claude/.instance_env`}function V(){return ot()}function vn(s){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=me("git branch --show-current",{cwd:s||m(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function he(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function xn(s){return s.replace(/\r\n/g,`
`)}function ye(s){let e=["debug","info","warn","error"];return e.indexOf(s)>=e.indexOf(he())}function u(){return{continue:!0,suppressOutput:!0}}function Sn(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function h(s){return{continue:!1,stopReason:s,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:s}}}function k(s){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:s}}}function ke(s){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:s}}}function bn(s,e){let t={continue:!0,suppressOutput:!0};return s&&(t.systemMessage=s),e&&(t.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),t}function Rn(s,e){let t={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:s,permissionDecision:"allow"}};return e?t.systemMessage=e:t.suppressOutput=!0,t}function $n(s){return{continue:!0,systemMessage:s}}function En(s){return{continue:!0,systemMessage:`\u26A0 ${s}`}}function wn(s){process.stderr.write(`\u26A0 ${s}
`),process.exit(2)}function Tn(s){return{continue:!1,stopReason:s,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:s}}}function In(s){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:s}}}var _e=200*1024,ve=100*1024;function it(s,e){if(rt(s))try{if(le(s).size>e){let n=`${s}.old.${Date.now()}`;fe(s,n)}}catch{}}function ct(s){rt(s)||de(s,{recursive:!0})}function y(s,e,t="debug"){if(!ye(t))return;let n=x(),o=`${n}/hooks.log`;try{ct(n),it(o,_e);let r=new Date().toISOString().replace("T"," ").slice(0,19);_(o,`[${r}] [${t.toUpperCase()}] [${s}] ${e}
`)}catch{}}function Cn(s,e,t){let n=x(),o=`${n}/permission-feedback.log`;try{ct(n),it(o,ve);let r=new Date().toISOString(),i=t?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=t?.session_id||V();_(o,`${r} | ${s} | ${e} | tool=${i} | session=${a}
`)}catch{}}function xe(s){if(!s)return 0;let n=(s.match(/[{};()=><]/g)||[]).length/s.length>.03?2.8:3.5;return Math.ceil(s.length/n)}function An(s,e,t,n,o){let r=xe(s);return n?.isOverBudget(t)?(y(e,`Budget exhausted for ${t}, suppressing ${r}t`),u()):(o&&o.trackTokenUsage(e,t,r),ke(s))}function Dn(){try{let s=[],t=Buffer.allocUnsafe(256),n,o=0;for(;;)try{if(n=ge(o,t,0,256,null),n===0)break;s.push(Buffer.from(t.subarray(0,n)))}catch{break}let r=Buffer.concat(s).toString("utf8").trim();return r?JSON.parse(r):{tool_name:"",session_id:V(),tool_input:{}}}catch{return{tool_name:"",session_id:V(),tool_input:{}}}}function Hn(s,e){let t=e.replace(/^\./,"").split("."),n=s;for(let o of t){if(n==null)return;n=n[o]}return n}function w(s,...e){return s.split(`
`).some(t=>e.every(n=>t.includes(n)))}function at(s,...e){return s.split(`
`).some(t=>{let n=t.toLowerCase();return e.every(o=>n.includes(o.toLowerCase()))})}function Pn(s){return s.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function On(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as $}from"node:child_process";function A(s){let e=s||m();try{return $("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function Se(s){let e=s||A();return["dev","main","master"].includes(e)}function R(s){let e=s||m();try{return $("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function Fn(s){let e=s||m();try{return $("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function be(s){let e=s||m();try{return $("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function ut(s){return be(s).length>0}function pt(s){let e=s||m();try{return $("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return $("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function Re(s){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let t of e){let n=s.match(t);if(n)return parseInt(n[1],10)}return null}function $e(s){let e=s||m();try{let t=$("git diff --cached --name-only",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim();return t?t.split(`
`).filter(n=>n.trim()):[]}catch{return[]}}function Mn(s){let e=$e(s),t=new Set,n=new Set,o=!1,r=!1,i=!1,a=!1;for(let p of e){let c=p.split("/");c.length>1&&(t.add(c[0]),c.length>2&&t.add(`${c[0]}/${c[1]}`));let d=p.split(".").pop()||"";n.add(d),/\.(test|spec)\.\w+$/.test(p)||/^tests?\//.test(p)||/__tests__\//.test(p)?o=!0:/\.(md|mdx|txt|rst)$/.test(p)||/^docs?\//.test(p)||p==="README.md"?i=!0:/\.(json|ya?ml|toml|ini|cfg|env)$/.test(p)||/config/i.test(p)||p==="package.json"||p==="tsconfig.json"?r=!0:a=!0}return{files:e,directories:t,extensions:n,hasTests:o,hasConfig:r,hasDocs:i,hasSource:a}}function Un(s){if(Se(s))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(n=>s.startsWith(n))?s.startsWith("issue/")&&!Re(s)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}function lt(s,...e){let t=s.tool_input.file_path;if(!t)return u();let n=t.split(".").pop()?.toLowerCase()||"";return e.map(r=>r.toLowerCase().replace(/^\./,"")).includes(n)?null:u()}function T(s){return lt(s,"py","ts","tsx","js","jsx","go","rs","java")}function F(s){return lt(s,"py")}import{basename as Ee,dirname as we}from"node:path";function ft(s){let e=F(s);if(e)return e;let t=s.tool_input.file_path;if(!t)return u();if(!t.includes("/app/")&&!t.includes("/backend/"))return u();let n=Ee(t),o=we(t),r=[];if(n==="__init__.py")return u();if(o.endsWith("/routers")||o.includes("/routers/")){let i=/^(router_|routes_|api_).*\.py$/,a=/^(deps|dependencies|utils|helpers|base)\.py$/;!i.test(n)&&!a.test(n)&&(r.push("ROUTER NAMING: Files in routers/ must be prefixed"),r.push(`  Got: ${n}`),r.push("  Expected: router_*.py, routes_*.py, api_*.py, deps.py"))}if(o.endsWith("/services")||o.includes("/services/")){let i=/_service\.py$/,a=/^(base|utils|helpers|abstract)\.py$/;!i.test(n)&&!a.test(n)&&(r.push("SERVICE NAMING: Files in services/ must end with _service.py"),r.push(`  Got: ${n}`),r.push("  Expected: *_service.py, base.py, utils.py"))}if(o.endsWith("/repositories")||o.includes("/repositories/")){let i=/_(repository|repo)\.py$/,a=/^(base|abstract|utils)\.py$/;!i.test(n)&&!a.test(n)&&(r.push("REPOSITORY NAMING: Files in repositories/ must end with _repository.py"),r.push(`  Got: ${n}`),r.push("  Expected: *_repository.py, *_repo.py, base.py"))}if(o.endsWith("/schemas")||o.includes("/schemas/")){let i=/_(schema|dto|request|response)\.py$/,a=/^(base|common|shared|utils)\.py$/;!i.test(n)&&!a.test(n)&&(r.push("SCHEMA NAMING: Files in schemas/ must use proper suffix"),r.push(`  Got: ${n}`),r.push("  Expected: *_schema.py, *_dto.py, *_request.py, *_response.py"))}if(o.endsWith("/models")||o.includes("/models/")){let i=/_(model|entity|orm)\.py$/,a=/^(base|abstract|mixins)\.py$/;!i.test(n)&&!a.test(n)&&(r.push("MODEL NAMING: Files in models/ must use proper suffix"),r.push(`  Got: ${n}`),r.push("  Expected: *_model.py, *_entity.py, *_orm.py, base.py"))}if(/^[A-Z][a-zA-Z]+\.py$/.test(n)&&(r.push("NAMING: Python files should use snake_case, not PascalCase"),r.push(`  Got: ${n}`)),r.length>0){let i=`Backend naming violation in ${n}: ${r[0]}`;return y("backend-file-naming",`BLOCKED: ${i}`),h(i)}return u()}import{execSync as Te}from"node:child_process";import{readFileSync as Ie,existsSync as Ce}from"node:fs";import{join as Ae}from"node:path";var De=100,q=10240,dt=["decided","chose","selected","will use","implemented","architecture:","pattern:","approach:","recommendation:","best practice:","conclusion:"],He=["database-engineer","backend-system-architect","frontend-ui-developer","security-auditor","test-generator","workflow-architect","llm-integrator","data-pipeline-engineer","metrics-architect","ux-researcher","ci-cd-engineer","infrastructure-architect","accessibility-specialist"],Pe=["postgresql","postgres","pgvector","redis","mongodb","sqlite","fastapi","django","flask","express","nextjs","react","vue","angular","typescript","python","jwt","oauth","passkeys","langchain","langgraph","langfuse","docker","kubernetes","terraform","aws","gcp","pytest","jest","vitest","playwright","msw"],Oe=["cursor-pagination","repository-pattern","service-layer","clean-architecture","dependency-injection","event-sourcing","cqrs","saga-pattern","circuit-breaker","rate-limiting","optimistic-locking","caching","cache-aside","rag","semantic-search"],je=[["cursor-pagination",/cursor[- ]?(based)?[- ]?pagination/i],["jwt-validation",/jwt|json web token/i],["dependency-injection",/dependency injection|di pattern|ioc/i],["rate-limiting",/rate[- ]?limit|throttl/i],["circuit-breaker",/circuit[- ]?breaker|resilience/i],["event-sourcing",/event[- ]?sourc/i],["cqrs",{test:s=>/cqrs/i.test(s)||at(s,"command","query","separation")}],["idempotency",/idempoten/i]],Ne=["critical","security","breaking","migration","architecture","production"],Le=["refactor","optimize","improve","update","enhance","fix"],I=null;function Fe(){if(process.env.CLAUDE_CODE_VERSION)return process.env.CLAUDE_CODE_VERSION;try{let e=Te("claude --version 2>/dev/null",{encoding:"utf-8",timeout:2e3}).match(/(\d+\.\d+\.\d+)/);if(e)return e[1]}catch{}return"2.1.16"}function Me(){if(I)return I;try{let s=Z(),e=Ae(s,".claude-plugin","plugin.json");if(Ce(e))return I=JSON.parse(Ie(e,"utf-8")).version||"unknown",I}catch{}return I="unknown",I}function gt(s){let e=s.toLowerCase();return{agents:[...new Set(He.filter(t=>e.includes(t)))],technologies:[...new Set(Pe.filter(t=>e.includes(t)))],patterns:[...new Set(Oe.filter(t=>e.includes(t)))]}}function Ue(s){let e=s.toLowerCase();return/recommend|suggests|advises/.test(e)?"RECOMMENDS":/chose|selected|decided/.test(e)?"CHOSEN_FOR":/replace|instead of/.test(e)?"REPLACES":/conflict|incompatible/.test(e)?"CONFLICTS_WITH":"RELATES_TO"}var Be=[/\bbecause\s+([^.,!?\n]+)/gi,/\bsince\s+([^.,!?\n]+)/gi,/\bdue to\s+([^.,!?\n]+)/gi,/\bto avoid\s+([^.,!?\n]+)/gi,/\bso that\s+([^.,!?\n]+)/gi,/\bin order to\s+([^.,!?\n]+)/gi,/\bas it\s+([^.,!?\n]+)/gi,/\bfor\s+(better|improved|faster|simpler|easier)\s+([^.,!?\n]+)/gi],Ge=[/\bover\s+([^.,!?\n]+)/gi,/\binstead of\s+([^.,!?\n]+)/gi,/\brather than\s+([^.,!?\n]+)/gi,/\bnot\s+([^.,!?\n]+)/gi,/\bversus\s+([^.,!?\n]+)/gi,/\bvs\.?\s+([^.,!?\n]+)/gi],We=[/\b(must|need to|required|constraint|requirement)\s+([^.,!?\n]+)/gi,/\b(have to|has to|should)\s+([^.,!?\n]+)/gi,/\b(mandatory|essential)\s+([^.,!?\n]+)/gi],ze=[/\b(tradeoff|trade-off|downside|drawback)\s*:?\s+([^.,!?\n]+)/gi,/\bbut\s+([^.,!?\n]+)/gi,/\bhowever\s+([^.,!?\n]+)/gi,/\balthough\s+([^.,!?\n]+)/gi,/\b(cost|limitation)\s+is\s+([^.,!?\n]+)/gi];function Ve(s){let e=s.toLowerCase();return dt.some(t=>e.includes(t))}function Ze(s){let e=[];for(let t of dt){let n=new RegExp(`[^\\n]*${t}[^\\n]*`,"gi"),o=s.match(n);if(o)for(let r of o.slice(0,3)){let i=r.trim().slice(0,300);i.length>30&&e.push(i)}}return[...new Set(e)].slice(0,5)}function qe(s){for(let e of Be){let t=s.match(e);if(t)return t[1]?.trim().slice(0,200)}}function Ke(s){let e=[];for(let t of Ge){let n=s.matchAll(t);for(let o of n){let r=o[1]?.trim();r&&r.length>2&&r.length<100&&e.push(r)}}return[...new Set(e)].slice(0,3)}function Je(s){let e=[];for(let t of We){let n=s.matchAll(t);for(let o of n){let r=o[2]?.trim()||o[1]?.trim();r&&r.length>3&&r.length<150&&e.push(r)}}return[...new Set(e)].slice(0,3)}function Ye(s){let e=[];for(let t of ze){let n=s.matchAll(t);for(let o of n){let r=o[2]?.trim()||o[1]?.trim();r&&r.length>3&&r.length<150&&e.push(r)}}return[...new Set(e)].slice(0,3)}function Xe(s){let e=[/\b(?:chose|decided on|selected|using|will use|going with)\s+([^.,!?\n]+)/i,/\b(?:the decision is|decision:)\s+([^.,!?\n]+)/i,/\brecommend(?:ation)?:?\s+([^.,!?\n]+)/i];for(let t of e){let n=s.match(t);if(n)return n[1].trim().slice(0,100)}return s.slice(0,100).trim()}function Qe(s){let e=.5;return s.rationale&&(e+=.2),s.alternatives&&s.alternatives.length>0&&(e+=.1),s.constraints&&s.constraints.length>0&&(e+=.05),s.tradeoffs&&s.tradeoffs.length>0&&(e+=.05),s.entities.length>=1&&(e+=.05),s.entities.length>=2&&(e+=.05),s.importance==="high"&&(e+=.1),Math.min(.99,e)}function ts(s){let e=Ze(s),t=[];for(let n of e){let o=gt(n),r=[...o.agents,...o.technologies,...o.patterns],i={what:Xe(n),text:n,rationale:qe(n),alternatives:Ke(n),constraints:Je(n),tradeoffs:Ye(n),entities:r,confidence:0,category:mt(n),importance:es(n)};i.confidence=Qe(i),t.push(i)}return t}function mt(s){let e=s.slice(0,q).toLowerCase();return/pagination|cursor|offset/.test(e)?"pagination":/security|vulnerability|owasp/.test(e)?"security":/database|sql|postgres|schema/.test(e)?"database":/api|endpoint|rest|graphql/.test(e)?"api":/auth|login|jwt|oauth/.test(e)?"authentication":/test|pytest|jest|vitest/.test(e)?"testing":/deploy|ci|cd|docker|kubernetes/.test(e)?"deployment":/monitoring|logging|tracing|metrics/.test(e)?"observability":/react|frontend|ui|tailwind/.test(e)?"frontend":/llm|rag|embedding|langchain/.test(e)?"ai-ml":/architecture|design|pattern/.test(e)?"architecture":"decision"}function es(s){let e=s.toLowerCase();return Ne.some(t=>e.includes(t))?"high":Le.some(t=>e.includes(t))?"medium":"low"}function ss(s){for(let[e,t]of je)if(t.test(s))return e;return null}function ht(s){let e=s.skill_name||s.tool_input?.skill||"",t=s.tool_result,n=typeof t=="string"?t:t?.content||s.output||"";if(!n||n.length<De)return u();let o=n.length>q?n.slice(0,q):n;if(!Ve(o))return u();let r=ts(o),i=gt(o),a=i.agents.length+i.technologies.length+i.patterns.length;if(r.length===0&&a===0)return u();let p=[],c=r[0],d=c?.category||mt(n.slice(0,200));if(r.length>0){let l=c?.importance||"low",f=ss(c?.text||""),g=Fe(),O=Me(),b={category:d,source:"orchestkit-plugin",skill:e||"unknown",cc_version:g,plugin_version:O,importance:l,timestamp:new Date().toISOString(),confidence:c?.confidence||.5};f&&(b.best_practice=f),c?.rationale&&(b.rationale=c.rationale),c?.alternatives?.length&&(b.alternatives=c.alternatives),c?.constraints?.length&&(b.constraints=c.constraints),c?.tradeoffs?.length&&(b.tradeoffs=c.tradeoffs);let v=`[Decisions] Found ${r.length} decision(s) (category: ${d}, importance: ${l})`;if(c&&(v+=`

Primary Decision: "${c.what.slice(0,100)}"`,c.rationale&&(v+=`
Rationale: "${c.rationale.slice(0,150)}"`),c.alternatives?.length&&(v+=`
Alternatives considered: ${c.alternatives.join(", ")}`),c.constraints?.length&&(v+=`
Constraints: ${c.constraints.join("; ")}`),c.tradeoffs?.length&&(v+=`
Tradeoffs: ${c.tradeoffs.join("; ")}`),v+=`
Confidence: ${(c.confidence*100).toFixed(0)}%`),v+=`

To persist to knowledge graph:
mcp__memory__create_entities with entities: [{"name": "${d}-decision", "entityType": "Decision", "observations": ["<decision>"]}]`,p.push(v),c?.alternatives?.length){let j=c.alternatives.map(Ut=>({from:c.what,to:Ut,relationType:"CHOSE_OVER"}));p.push(`[Relations] Create CHOSE_OVER relations:
mcp__memory__create_relations with:
relations: ${JSON.stringify(j)}`)}}if(a>0){let l=Ue(n),f=[...i.agents.map(g=>({name:g,entityType:"Agent",observations:[`Agent: ${g}`]})),...i.technologies.map(g=>({name:g,entityType:"Technology",observations:[`Tech: ${g}`]})),...i.patterns.map(g=>({name:g,entityType:"Pattern",observations:[`Pattern: ${g}`]}))];p.push(`[Entities] Found ${a} entities for graph memory:
- Agents: ${i.agents.length}
- Technologies: ${i.technologies.length}
- Patterns: ${i.patterns.length}

mcp__memory__create_entities with:
entities: ${JSON.stringify(f.slice(0,5))}

Relation type: ${l}`)}return{continue:!0,systemMessage:p.join(`

`)}}import{basename as ns}from"node:path";function yt(s){let e=F(s);if(e)return e;let t=s.tool_input.file_path,n=s.tool_input.content||s.tool_result||"";if(!t||!n)return u();let o=[];if(t.includes("/routers/")&&(/db\.(add|delete|commit|flush|rollback|refresh|execute|scalar)/.test(n)&&o.push("DATABASE: Direct database operations not allowed in routers"),/^from sqlalchemy import/m.test(n)&&o.push("IMPORT: SQLAlchemy imports not allowed in routers")),t.includes("/services/")&&(/HTTPException\s*\(/.test(n)&&o.push("HTTP: HTTPException not allowed in services - use domain exceptions"),n.includes("from fastapi import")&&(/\bRequest\b/.test(n)||/\bResponse\b/.test(n))&&o.push("HTTP: Request/Response types not allowed in services")),t.includes("/repositories/")&&(/HTTPException/.test(n)&&o.push("HTTP: HTTPException not allowed in repositories"),(w(n,"from","services","import")||w(n,"from","routers","import"))&&o.push("IMPORT: Repositories cannot import from services or routers")),o.length>0){let i=`Layer violation in ${ns(t)||t}: ${o[0]}`;return y("backend-layer-validator",`BLOCKED: ${i}`),h(i)}return u()}import{existsSync as M,mkdirSync as os}from"node:fs";import{execSync as rs}from"node:child_process";function kt(s){let e=m(),t=x(),n=`${t}/coverage-check.log`,o=parseInt(process.env.COVERAGE_THRESHOLD||"80",10);try{os(t,{recursive:!0})}catch{}let r=[],i=new Date().toISOString().replace("T"," ").slice(0,19);r.push(`[${i}] Coverage Check`);let a=`${e}/.coverage`,p=`${e}/coverage.xml`;if(M(a)||M(p))try{let l=rs("coverage report --fail-under=0",{cwd:e,encoding:"utf8",timeout:3e4,stdio:["pipe","pipe","pipe"]}).split(`
`).find(f=>f.includes("TOTAL"));if(l){let f=l.match(/(\d+)%/);if(f){let g=parseInt(f[1],10);r.push(`Python coverage: ${g}%`),g<o?r.push(`WARNING: Coverage ${g}% is below threshold ${o}%`):r.push("Coverage meets threshold")}}}catch{}let c=`${e}/coverage`;if(M(c)){let d=`${c}/coverage-summary.json`;M(d)&&(r.push(""),r.push("JavaScript/TypeScript coverage report found"),r.push("Check coverage/lcov-report/index.html for details"))}try{_(n,`${r.join(`
`)}
`)}catch{}return u()}import{existsSync as is,readFileSync as cs}from"node:fs";var as=["coverage/coverage-summary.json","coverage/coverage-final.json",".vitest/coverage/coverage-summary.json","coverage.json",".coverage.json","htmlcov/status.json"];function us(s,e){try{let t=JSON.parse(e);return s.includes("coverage-summary.json")?t?.total?.lines?.pct??t?.total?.statements?.pct??null:s.includes("coverage.json")?t?.totals?.percent_covered??null:t?.total?.pct!==void 0?t.total.pct:null}catch{return null}}function _t(s){let e=m(),t=parseInt(process.env.COVERAGE_THRESHOLD||"80",10),n="",o="";for(let a of as){let p=`${e}/${a}`;if(is(p)){n=p;try{o=cs(p,"utf8")}catch{continue}break}}if(!n||!o)return u();let r=us(n,o);if(r===null)return u();if(Math.floor(r)<t){let a=`BLOCKED: Coverage ${r}% is below threshold ${t}%

Coverage report: ${n}

Actions required:
  1. Identify uncovered code paths
  2. Add tests for critical business logic
  3. Re-run tests with coverage:

     TypeScript: npm test -- --coverage
     Python:     pytest --cov=app --cov-report=term-missing

  4. Ensure coverage >= ${t}% before proceeding

Tip: Focus on testing:
  - Business logic (services, utils)
  - Edge cases and error handling
  - Critical user flows`;return h(a)}return u()}import{existsSync as D,readFileSync as ps}from"node:fs";import{basename as U,dirname as C}from"node:path";function ls(s){return/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(s)||s.endsWith(".py")&&(s.split("/").pop()||"").startsWith("test_")||/_test\.py$/.test(s)}function fs(s){if(/\.(ts|tsx|js|jsx)$/.test(s)){let e=s.replace(/\.[^.]+$/,""),t=s.split(".").pop()||"ts",n=[`${e}.test.${t}`,`${e}.spec.${t}`,`${e}.test.ts`,`${e}.test.tsx`];for(let p of n)if(D(p))return p;let o=C(s),i=U(s).replace(/\.[^.]+$/,""),a=[`${o}/__tests__/${i}.test.${t}`,`${o}/__tests__/${i}.spec.${t}`];for(let p of a)if(D(p))return p}else if(s.endsWith(".py")){let e=C(s),n=`test_${U(s)}`;if(D(`${e}/${n}`))return`${e}/${n}`;let o=C(e);if(D(`${o}/tests/${n}`))return`${o}/tests/${n}`;if(D(`${e}/tests/${n}`))return`${e}/tests/${n}`}return null}function ds(s,e){let t=[];if(/\.(ts|tsx|js|jsx)$/.test(e)){let n=s.match(/export (function|class|const|async function)\s+([A-Za-z_][A-Za-z0-9_]*)/g);if(n)for(let o of n){let r=o.split(/\s+/).pop();r&&t.push(r)}}else if(e.endsWith(".py")){let n=s.split(`
`);for(let o of n){let r=o.match(/^(def|class)\s+([A-Za-z][A-Za-z0-9_]*)/);r?.[2]&&t.push(r[2])}}return[...new Set(t)]}function vt(s){let e=s.tool_input?.file_path||"",t=s.tool_input?.content||s.tool_result||"";if(!e||!t)return u();if(ls(e))return u();if(!/\.(ts|tsx|js|jsx|py)$/.test(e))return u();let n=[],o=[],r=fs(e),i=ds(t,e);if(i.length>0)if(r)try{let a=ps(r,"utf8"),p=[];for(let c of i)new RegExp(`\\b${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`).test(a)||p.push(c);if(p.length>0){o.push("TEST COVERAGE: New units without tests"),o.push(`  Implementation: ${e}`),o.push(`  Test file: ${r}`),o.push(""),o.push(`  Untested units (${p.length}/${i.length}):`);for(let c of p.slice(0,5))o.push(`    - ${c}`);o.push(""),o.push("  Add tests before committing")}}catch{}else{if(n.push("TEST COVERAGE: No test file found for implementation"),n.push(`  Implementation: ${e}`),n.push("  Expected test file:"),/\.(ts|tsx|js|jsx)$/.test(e)){let a=e.replace(/\.[^.]+$/,""),p=e.split(".").pop()||"ts",c=C(e),d=U(e);n.push(`    - ${a}.test.${p}`),n.push(`    - ${c}/__tests__/${d}`)}else if(e.endsWith(".py")){let a=U(e),p=C(e);n.push(`    - ${p}/test_${a}`),n.push(`    - ${C(p)}/tests/test_${a}`)}n.push(""),n.push(`  Found ${i.length} testable units:`);for(let a of i.slice(0,5))n.push(`    - ${a}`)}if(n.length>0)return h(`Missing test coverage for new code: ${n[0]}`);if(o.length>0){let a=o.join(`
`);return k(`Test coverage warnings detected:

${a}`)}return u()}import{basename as gs}from"node:path";function xt(s){let e=s.tool_input?.file_path||"",t=s.tool_input?.content||s.tool_result||"";if(!e||!t)return u();if(!(e.includes("/routers/")&&e.endsWith(".py")))return u();let n=gs(e);if(/^(deps|dependencies|__init__)\.py$/.test(n))return u();let o=[],r=t.split(`
`).find(c=>/Service\s*\(\s*\)/.test(c)&&/=\s*[A-Z]/.test(c));if(r){let c=r.match(/([A-Z]\w*Service)\s*\(\s*\)/);o.push("INSTANTIATION: Direct service instantiation not allowed"),o.push(`  Found: ${c?.[1]||"Service"}()`),o.push("  "),o.push("  Use dependency injection:"),o.push("    service: MyService = Depends(get_my_service)")}let i=t.split(`
`).find(c=>/(?:Repository|Repo)\s*\(\s*\)/.test(c)&&/=\s*[A-Z]/.test(c));if(i){let c=i.match(/([A-Z]\w*(?:Repository|Repo))\s*\(\s*\)/);o.push("INSTANTIATION: Direct repository instantiation not allowed"),o.push(`  Found: ${c?.[1]||"Repository"}()`),o.push("  "),o.push("  Use dependency injection:"),o.push("    repo: MyRepository = Depends(get_my_repository)")}if(t.split(`
`).some(c=>/^[a-z_]+\s*=\s*[A-Z]/.test(c)&&/(?:Service|Repository|Repo)\s*\(/.test(c))&&(o.push("GLOBAL: Global service/repository instance not allowed"),o.push("  "),o.push("  Global instances cause:"),o.push("    - Shared state between requests"),o.push("    - Difficult testing"),o.push("    - Connection pool issues"),o.push("  "),o.push("  Use Depends() for request-scoped instances")),t.split(`
`).some(c=>/:\s*(?:Async)?Session/.test(c)&&c.includes(")"))&&(t.split(`
`).some(d=>/:\s*(?:Async)?Session\s*=\s*Depends/.test(d))||(o.push("DI: Database session must use Depends()"),o.push("  "),o.push("  BAD:  async def get_users(db: AsyncSession):"),o.push("  GOOD: async def get_users(db: AsyncSession = Depends(get_db)):"))),/@router\.(get|post|put|patch|delete)/.test(t)&&t.split(`
`).some(d=>/:\s*[A-Z]/.test(d)&&/(?:Service|Repository|Repo)\s*[),]/.test(d))&&(t.split(`
`).some(l=>/(?:Service|Repository|Repo)\s*=\s*Depends/.test(l))||(o.push("DI: Service/Repository parameters must use Depends()"),o.push("  "),o.push("  BAD:  async def create_user(user_service: UserService):"),o.push("  GOOD: async def create_user(user_service: UserService = Depends(get_user_service)):"))),/async def/.test(t)){/db\.query\(/.test(t)&&(t.split(`
`).some(l=>l.includes("db.query(")&&l.includes("await"))||(o.push("ASYNC: Sync database call in async function"),o.push("  Found: db.query() (sync pattern)"),o.push("  "),o.push("  Use async SQLAlchemy 2.0 patterns:"),o.push("    result = await db.execute(select(User))"),o.push("    users = result.scalars().all()")));let c=/db\.(add|delete|commit|flush|rollback|refresh)\(/;if(c.test(t)&&/AsyncSession/.test(t)){let d=t.split(`
`);for(let l of d)if(c.test(l)&&!l.includes("await")){o.push("ASYNC: Missing await for async database operation"),o.push("  "),o.push("  With AsyncSession, use await:"),o.push("    await db.commit()"),o.push("    await db.refresh(user)");break}}}if(o.length>0){y("di-pattern-enforcer",`BLOCKED: DI violation in ${e}`);let c=`Dependency injection violation in ${e}. See stderr for details.`;return k(c)}return u()}import{readFileSync as ms,readdirSync as hs}from"node:fs";function ys(s,e){let t=[];if(/\.(ts|tsx|js|jsx)$/.test(e)){let n=s.match(/(function|class|const|export function|export class)\s+[A-Za-z_][A-Za-z0-9_]*/g);n&&t.push(...n)}else if(e.endsWith(".py")){let n=s.split(`
`);for(let o of n){let r=o.match(/^(def|class)\s+[A-Za-z_][A-Za-z0-9_]*/);r&&t.push(r[0])}}return[...new Set(t)]}function ks(s,e){let t=[],n=["node_modules",".venv","venv","__pycache__","dist","build",".next",".git"];function o(r){try{let i=hs(r,{withFileTypes:!0});for(let a of i){let p=`${r}/${a.name}`;a.isDirectory()?n.includes(a.name)||o(p):a.isFile()&&e.test(a.name)&&t.push(p)}}catch{}}return o(s),t}function _s(s){let e=[],t=s.split(`
`),n="",o=0,r=0;for(let i=0;i<t.length;i++){let a=t[i].trim();a&&a===n?(o++,o>=3&&e.push(`Line ${r}: ${n.substring(0,50)}`)):(n=a,o=1,r=i+1)}return e}function vs(s,e){let t=[],n=[];if(/\.(ts|tsx|js|jsx)$/.test(e)){s.includes("new Date")&&s.includes("toLocaleDateString")&&(t.push("UTILITY: Direct date formatting detected"),t.push("  Use centralized date utilities: import { formatDate } from '@/lib/dates'"));let o=(s.match(/fetch\s*\(\s*['"]/g)||[]).length;o>2&&(n.push(`UTILITY: Multiple fetch calls detected (${o})`),n.push("  Consider using centralized API client or custom hook"));let r=s.split(`
`).filter(i=>i.includes(".test(")&&/^\s*if\s*\(/.test(i)).length;r>3&&(n.push(`UTILITY: Multiple inline validations detected (${r})`),n.push("  Use Zod schemas: const schema = z.object({...})"))}if(e.endsWith(".py")){let o=(s.match(/json\.loads/g)||[]).length;o>3&&(n.push(`UTILITY: Multiple json.loads detected (${o})`),n.push("  Consider centralized JSON handling with error recovery"));let r=(s.match(/os\.getenv|os\.environ/g)||[]).length;r>5&&(n.push(`UTILITY: Multiple environment variable accesses (${r})`),n.push("  Use Settings/Config class with Pydantic validation"))}return{errors:t,warnings:n}}function St(s){let e=s.tool_input?.file_path||"",t=s.tool_input?.content||s.tool_result||"";if(!e||!t)return u();if(!/\.(ts|tsx|js|jsx|py)$/.test(e))return u();let n=[],o=[],r=ys(t,e);if(r.length>0){let p=R()||m(),c=ks(p,/\.(ts|tsx|js|jsx|py)$/);for(let d of r){let l=d.split(/\s+/).pop()||"";if(l){for(let f of c)if(f!==e)try{let g=ms(f,"utf8");if(new RegExp(`\\b${l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`).test(g)&&g.includes(d)){let b=f.replace(`${p}/`,"");o.push(`DUPLICATE: '${l}' already exists in:`),o.push(`  - ${b}`),o.push("  Consider:"),o.push("    1. Reusing existing implementation"),o.push("    2. Extracting to shared utility"),o.push("    3. Using different name if intentionally different");break}}catch{}}}}let i=_s(t);if(i.length>0){o.push("COPY-PASTE: Repeated code blocks detected:");for(let p of i.slice(0,5))o.push(`  ${p}`);o.push("  Refactor repeated logic into functions")}let a=vs(t,e);if(n.push(...a.errors),o.push(...a.warnings),n.length>0){let p=`Duplicate code violation in ${e}. See stderr for details.`;return k(p)}if(o.length>0){let p=`Potential code duplication detected in ${e}. Review warnings on stderr.`;return k(p)}return u()}import{existsSync as K,readFileSync as bt,readdirSync as xs}from"node:fs";function Rt(s){let e=m(),t=[];t.push("::group::LLM Evaluation Summary");let n=`${e}/eval_results.json`;if(K(n)){t.push("Evaluation results found:");try{let i=bt(n,"utf8"),a=JSON.parse(i);if(typeof a=="object"&&a!==null){for(let[p,c]of Object.entries(a))if(typeof c=="number"){let d=Number.isInteger(c)?c.toString():c.toFixed(2);t.push(`  ${p}: ${d}`)}}}catch{try{let a=bt(n,"utf8").split(`
`).slice(0,20);t.push(...a)}catch{t.push("  (Unable to read file)")}}}let o=`${e}/.deepeval`;if(K(o)){t.push(""),t.push("DeepEval results directory found");try{let i=xs(o).slice(0,5);for(let a of i)t.push(`  ${a}`)}catch{}}let r=`${e}/ragas_results.json`;K(r)&&(t.push(""),t.push("RAGAS evaluation results found")),t.push(""),t.push("Evaluation complete - review metrics above"),t.push("::endgroup::");for(let i of t)process.stderr.write(`${i}
`);return u()}import{existsSync as E,mkdirSync as Ss,readdirSync as bs}from"node:fs";function $t(s){let e=x(),t=m(),n=`${e}/evidence-collector.log`;try{Ss(e,{recursive:!0})}catch{}let o=new Date().toISOString().replace("T"," ").slice(0,19),r=[];r.push(`[${o}] Evidence Collection`),r.push("Recent command results:");let i=process.env.CC_LAST_EXIT_CODE;i&&r.push(`  Last exit code: ${i}`),(E(`${t}/pytest.xml`)||E(`${t}/junit.xml`))&&r.push("  Test results: Found (XML format)");let a=`${t}/test-results`;if(E(a)){r.push("  Test results directory: Found");try{let p=bs(a).slice(0,5);for(let c of p)r.push(`    ${c}`)}catch{}}(E(`${t}/.coverage`)||E(`${t}/coverage`))&&r.push("  Coverage data: Found"),(E(`${t}/lint-results.json`)||E(`${t}/eslint-report.json`))&&r.push("  Lint results: Found"),r.push("Evidence verification complete.");try{_(n,`${r.join(`
`)}
`)}catch{}return u()}import{basename as Rs}from"node:path";function $s(s){return s.includes("/shared/")?"shared":s.includes("/lib/")?"lib":s.includes("/utils/")?"utils":s.includes("/components/")&&!s.includes("/features/")?"components":s.includes("/hooks/")&&!s.includes("/features/")?"hooks":s.includes("/features/")?"features":s.includes("/app/")||s.includes("/pages/")?"app":s.includes("/repositories/")?"repositories":s.includes("/services/")&&s.endsWith(".py")?"services":s.includes("/routers/")?"routers":null}function Et(s){let e=T(s);if(e)return e;let t=s.tool_input.file_path||"",n=s.tool_input.content||s.tool_result||"";if(!t||!n)return u();let o=$s(t);if(!o)return u();let r=[];if(/\.(ts|tsx|js|jsx)$/.test(t))switch(o){case"shared":case"lib":case"utils":/from ['"](@\/|\.\.\/)*(features|app)\//.test(n)&&r.push(`${o}/ cannot import from features/ or app/`);break;case"components":case"hooks":/from ['"](@\/|\.\.\/)*(features|app)\//.test(n)&&r.push(`${o}/ cannot import from features/ or app/`);break;case"features":/from ['"](@\/|\.\.\/)*app\//.test(n)&&r.push("features/ cannot import from app/");break}if(t.endsWith(".py"))switch(o){case"repositories":/from (app\.)?(services|routers)/.test(n)&&r.push("repositories/ cannot import from services/ or routers/");break;case"services":/from (app\.)?routers\.[a-z]/.test(n)&&(/from (app\.)?routers\.(deps|dependencies)/.test(n)||r.push("services/ cannot import from routers/"));break}if(r.length>0){let a=`Import direction violation in ${Rs(t)||t}: ${r[0]}`;return y("import-direction-enforcer",`BLOCKED: ${a}`),h(a)}return u()}import{existsSync as Es,readFileSync as ws}from"node:fs";import{execSync as H}from"node:child_process";function Ts(){try{return H("git worktree list --porcelain",{encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(e=>e.startsWith("worktree ")).map(e=>e.replace("worktree ",""))}catch{return[]}}function Is(s){try{return H("git rev-parse --abbrev-ref HEAD",{cwd:s,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function Cs(s,e){try{let t=H(`git status --short "${e}"`,{cwd:s,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]});return/^.M|^M.|^A/.test(t)}catch{return!1}}function As(s,e){try{let t=parseInt(H(`git rev-list --count ${s}..${e}`,{encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim(),10),n=parseInt(H(`git rev-list --count ${e}..${s}`,{encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim(),10);return{ahead:t||0,behind:n||0}}catch{return{ahead:0,behind:0}}}function wt(s){let e=s.tool_input.file_path||"",t=s.tool_input.content||s.tool_result||"";if(!e||!t)return u();let n=Ts();if(n.length===0)return u();let o=[],r=[],i=R()||m(),a=i,p=e.replace(`${i}/`,"").replace(i,"");for(let l of n){if(l===a)continue;let f=`${l}/${p}`;if(!Es(f))continue;let g=Is(l);if(Cs(l,p)){r.push({worktree:l,branch:g,status:"modified"});try{let O=ws(f,"utf8"),b=t.split(`
`),v=O.split(`
`),j=Math.abs(b.length-v.length);j>10&&(o.push(`OVERLAP: Significant changes in both branches (~${j} lines)`),o.push(`  Branch: ${g}`),o.push("  High risk of merge conflict"))}catch{}}}let c=A(),d=pt();if(c!==d){let{ahead:l,behind:f}=As(d,c);f>10&&(o.push(`DIVERGENCE: Current branch is ${f} commits behind ${d}`),o.push("  Consider rebasing before continuing development"),o.push("  This reduces merge conflict risk"))}if(r.length>0){o.unshift("MERGE CONFLICT RISK: Concurrent modifications detected"),o.unshift(""),o.unshift(`File: ${e}`);for(let l of r)o.push(`  Branch: ${l.branch}`),o.push(`  Status: ${l.status}`),o.push(`  Path: ${l.worktree}`);o.push(""),o.push("Recommendations:"),o.push("  1. Coordinate changes with other instances"),o.push("  2. Consider splitting work to avoid overlapping files"),o.push("  3. Communicate before merging")}if(o.length>0){let l=`Potential merge conflicts detected in ${e}. Review warnings on stderr.`;return process.stderr.write(`${o.join(`
`)}
`),k(l)}return u()}import{existsSync as J,readFileSync as Ds}from"node:fs";import{execSync as Hs}from"node:child_process";function S(s,e){try{return Hs(s,{cwd:e||m(),encoding:"utf8",timeout:3e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function Tt(s){let e=s.tool_input?.command||"";if(!/\b(gh\s+pr\s+merge|git\s+merge|git\s+rebase)\b/i.test(e))return u();let t=s.tool_input.target_branch||"main",n=A();if(n===t)return process.stderr.write(`Already on target branch ${t}
`),u();process.stderr.write(`Checking merge readiness: ${n} -> ${t}

`);let o=R()||m(),r=[],i=[],a=[];if(process.stderr.write(`1. Checking for uncommitted changes...
`),ut()){let f=S("git status --short");r.push("Uncommitted changes detected:"),r.push(f.split(`
`).slice(0,10).join(`
`))}else a.push("No uncommitted changes");process.stderr.write(`2. Checking branch divergence...
`),S(`git fetch origin ${t}`);let p=parseInt(S(`git rev-list --count origin/${t}..${n}`)||"0",10),c=parseInt(S(`git rev-list --count ${n}..origin/${t}`)||"0",10);if(process.stderr.write(`   Ahead: ${p} commits, Behind: ${c} commits
`),c>20?(r.push(`Branch is significantly behind ${t} (${c} commits)`),r.push(`Rebase or merge ${t} before proceeding`)):c>5?(i.push(`Branch is behind ${t} by ${c} commits`),i.push("Consider rebasing for easier merge")):a.push(`Branch is up to date (behind by ${c})`),process.stderr.write(`3. Checking for merge conflicts...
`),S(`git merge --no-commit --no-ff origin/${t}`).includes("CONFLICT")){let f=S("git diff --name-only --diff-filter=U");r.push(`Merge conflicts detected with ${t}:`);for(let g of f.split(`
`).slice(0,10))g&&r.push(`  - ${g}`);r.push("Resolve conflicts before merging"),S("git merge --abort")}else a.push("No merge conflicts detected"),S("git merge --abort");process.stderr.write(`4. Running quality gates on changed files...
`);let l=S(`git merge-base ${n} origin/${t}`);if(l){let g=S(`git diff --name-only ${l} ${n}`).split(`
`).filter(Boolean).length;process.stderr.write(`   Checking ${g} changed files...
`),a.push("Quality gates check performed")}else i.push("Cannot determine merge base - skipping file checks");if(process.stderr.write(`5. Checking test suite...
`),J(`${o}/package.json`)&&Ds(`${o}/package.json`,"utf8").includes('"test":')&&a.push("Frontend test script found"),(J(`${o}/pytest.ini`)||J(`${o}/pyproject.toml`))&&a.push("Backend test configuration found"),process.stderr.write(`
`),process.stderr.write(`${"=".repeat(60)}
`),process.stderr.write(`
MERGE READINESS REPORT

`),process.stderr.write(`Branch: ${n} -> ${t}

`),a.length>0){process.stderr.write(`PASSED CHECKS:
`);for(let f of a)process.stderr.write(`   ${f}
`);process.stderr.write(`
`)}if(i.length>0){process.stderr.write(`WARNINGS:
`);for(let f of i)process.stderr.write(`   ${f}
`);process.stderr.write(`
`)}if(r.length>0){process.stderr.write(`BLOCKERS:
`);for(let f of r)process.stderr.write(`   ${f}
`);return process.stderr.write(`
MERGE NOT READY - Fix blockers before merging
`),{continue:!1,stopReason:"Merge not ready - blockers detected"}}return i.length>0?(process.stderr.write(`MERGE READY WITH WARNINGS
`),process.stderr.write(`Review warnings before proceeding with merge
`)):(process.stderr.write(`MERGE READY - All checks passed!
`),process.stderr.write(`You can safely merge this branch
`)),u()}import{existsSync as Ps,readFileSync as Os}from"node:fs";import{execSync as js}from"node:child_process";import{basename as Ns}from"node:path";function It(s){let e=s.tool_input?.file_path||process.env.CC_TOOL_FILE_PATH||"";if(!e)return u();if(!e.includes("alembic/versions")||!e.endsWith(".py"))return u();if(!Ps(e))return u();process.stderr.write(`::group::Migration Validation: ${Ns(e)}
`);let t=[],n;try{n=Os(e,"utf8")}catch{return t.push("Cannot read migration file"),k(`Migration validation failed for ${e}`)}n.includes("def upgrade")||t.push("Missing upgrade() function in migration"),n.includes("def downgrade")||t.push("Missing downgrade() function in migration"),/^revision = /m.test(n)||t.push("Missing revision ID in migration");try{js(`python3 -m py_compile "${e}"`,{encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]})}catch{t.push("Python syntax error in migration")}if(t.length>0){process.stderr.write(`::error::Migration validation failed
`);for(let r of t)process.stderr.write(`  - ${r}
`);process.stderr.write(`::endgroup::
`),y("migration-validator",`BLOCKED: ${t[0]}`);let o=`Migration validation failed for ${e}. See stderr for details.`;return k(o)}return process.stderr.write(`Migration file is valid
`),process.stderr.write(`::endgroup::
`),u()}import{existsSync as Ls}from"node:fs";function Ct(s){let e=s.tool_input.file_path||"",t=s.tool_input.content||s.tool_result||"";if(!e||!t)return u();let o=`${R()||m()}/.claude/context/knowledge/patterns/established.json`;if(!Ls(o))return u();let r=[],i=[];if(e.endsWith(".py")&&(e.includes("/backend/")||e.includes("/api/"))&&(e.includes("/routers/")&&w(t,"from","repositories","import")&&(r.push("PATTERN: Router imports repository directly"),r.push("  Established pattern: routers -> services -> repositories"),r.push("  Import from services/ layer instead")),e.includes("/services/")&&w(t,"from","routers","import")&&(r.push("PATTERN: Service imports router (circular dependency)"),r.push("  Established pattern: Services are independent of HTTP layer")),/from sqlalchemy import/.test(t)&&(/from sqlalchemy\.ext\.asyncio import/.test(t)||/Session|sessionmaker/.test(t)&&(r.push("PATTERN: Using sync SQLAlchemy instead of async"),r.push("  Established pattern: All DB operations use async/await"),r.push("  Import: from sqlalchemy.ext.asyncio import AsyncSession"))),t.includes("from pydantic import")&&t.includes("BaseModel")&&(/@validator\(/.test(t)&&(r.push("PATTERN: Using Pydantic v1 @validator decorator"),r.push("  Established pattern: Pydantic v2 with @field_validator"),r.push("  Update: @field_validator('field_name', mode='after')")),/@root_validator/.test(t)&&(r.push("PATTERN: Using Pydantic v1 @root_validator decorator"),r.push("  Established pattern: Pydantic v2 with @model_validator"),r.push("  Update: @model_validator(mode='after')")))),/\.(ts|tsx|js|jsx)$/.test(e)&&(e.includes("/frontend/")||e.includes("/src/"))&&(/React\.FC</.test(t)&&(r.push("PATTERN: Using React.FC instead of explicit Props type"),r.push("  Established pattern: function Component(props: Props): React.ReactNode"),r.push("  Remove React.FC, use explicit function declaration")),/fetch\(|axios\./.test(t)&&(/from ['"]zod['"]/.test(t)||(r.push("PATTERN: API call without Zod validation"),r.push("  Established pattern: All API responses validated with Zod"),r.push("  Import: import { z } from 'zod'"))),/<form/.test(t)&&(/useFormStatus|useActionState|useOptimistic/.test(t)||(i.push("PATTERN: Form without React 19 form hooks"),i.push("  Established pattern: Use useFormStatus for pending state"),i.push("  Consider: useOptimistic for optimistic updates"))),(t.includes("new Date")&&t.includes("toLocaleDateString")||t.includes("toLocaleString"))&&(r.push("PATTERN: Direct date formatting instead of centralized utility"),r.push("  Established pattern: Use @/lib/dates helpers"),r.push("  Import: import { formatDate, formatDateShort } from '@/lib/dates'"))),(/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(e)||e.endsWith(".py")&&e.split("/").pop()?.startsWith("test_"))&&(/\/\/ Arrange|\/\/ Act|\/\/ Assert|# Arrange|# Act|# Assert/i.test(t)||(i.push("PATTERN: AAA pattern comments missing"),i.push("  Established pattern: Structure tests with Arrange-Act-Assert"),i.push("  Add comments for clarity in complex tests")),/\.(ts|tsx|js|jsx)$/.test(e)&&(t.includes("jest.mock")&&t.includes("fetch")||t.includes("global.fetch"))&&(r.push("PATTERN: Using jest.mock for fetch instead of MSW"),r.push("  Established pattern: Use MSW for API mocking"),r.push("  Import: import { http, HttpResponse } from 'msw'")),e.endsWith(".py")&&t.includes("class Test")&&t.includes("setUp")&&(r.push("PATTERN: Using unittest setUp instead of pytest fixtures"),r.push("  Established pattern: Use pytest fixtures"),r.push("  Convert: @pytest.fixture\\ndef setup_data():"))),(e.includes("/llm/")||e.includes("/ai/")||e.includes("/agent/"))&&((t.includes("prompt")&&t.includes("{")&&t.includes("id")&&t.includes("}")||t.includes('f"')&&t.includes(".id}")&&t.includes('"'))&&(r.push("PATTERN: Database IDs in LLM prompts"),r.push("  Established pattern: IDs flow around LLM, not through it"),r.push("  Pass IDs via metadata, join results after LLM processing")),t.includes("await")&&(t.includes("openai")||t.includes("anthropic")||t.includes("llm"))&&(/asyncio\.timeout|asyncio\.wait_for|Promise\.race/.test(t)||(r.push("PATTERN: LLM call without timeout protection"),r.push("  Established pattern: Wrap all LLM calls with timeout"),r.push("  Python: async with asyncio.timeout(30):"),r.push("  TypeScript: await Promise.race([call, timeout])")))),r.length>0)return h(`Pattern consistency violations detected in ${e}`);if(i.length>0){process.stderr.write(`WARNING: Pattern consistency issues detected
`),process.stderr.write(`File: ${e}

`);for(let a of i)process.stderr.write(`  ${a}
`)}return u()}var Fs=[/sk-[a-zA-Z0-9]{20,}/,/ghp_[a-zA-Z0-9]{36}/,/AKIA[A-Z0-9]{16}/,/xox[baprs]-[a-zA-Z0-9-]+/,/tvly-[a-zA-Z0-9-]{10,}/,/m0-[a-zA-Z0-9]{10,}/],Ms=[/password\s*[:=]\s*['"][^'"]+['"]/i,/secret\s*[:=]\s*['"][^'"]+['"]/i];function At(s){let e=s.tool_result||s.output||"";if(!e)return u();for(let t of Fs)if(t.test(e)){process.stderr.write(`::warning::Potential API key detected in output - verify redaction
`);break}for(let t of Ms)if(t.test(e)){process.stderr.write(`::warning::Potential hardcoded credential in output
`);break}return u()}import{mkdirSync as Us}from"node:fs";function Dt(s){let e=x(),t=`${e}/review-summary.log`;try{Us(e,{recursive:!0})}catch{}let o=`[${new Date().toISOString().replace("T"," ").slice(0,19)}] Code Review Summary
Review checklist:
  [ ] All blocking issues addressed
  [ ] Non-blocking suggestions noted
  [ ] Tests pass
  [ ] No security concerns
  [ ] Documentation updated if needed

Conventional comment prefixes used:
  - blocking: Must fix before merge
  - suggestion: Consider this improvement
  - nitpick: Minor style issue
  - question: Needs clarification
  - praise: Good work!
`;try{_(t,`${o}
`)}catch{}return u()}import{mkdirSync as Bs}from"node:fs";function Ht(s){let e=x(),t=`${e}/security-summary.log`;try{Bs(e,{recursive:!0})}catch{}let o=`[${new Date().toISOString().replace("T"," ").slice(0,19)}] Security Scan Complete
Review findings for:
  - Critical/High vulnerabilities (fix immediately)
  - Dependency CVEs (update packages)
  - Hardcoded secrets (move to env vars)
  - OWASP Top 10 violations

Next steps:
  1. Triage findings by severity
  2. Create issues for critical/high
  3. Update dependencies with CVEs
`;try{_(t,`${o}
`)}catch{}return u()}import{basename as Gs,dirname as Ws}from"node:path";var Pt=4;function Ot(s){let e=T(s);if(e)return e;let t=s.tool_input.file_path||"";if(!t)return u();let n=t.replace(/\\/g,"/"),o=[],r=Gs(n);if(n.includes("/src/")||n.includes("/app/")){let i="";n.includes("/src/")?i=n.split("/src/")[1]||"":i=n.split("/app/")[1]||"";let a=i.split(/[/\\]/).filter(Boolean).length;a>Pt&&o.push(`NESTING: Max depth exceeded - ${a} levels (max: ${Pt})`)}if(/^index\.(ts|tsx|js)$/.test(r)&&!n.includes("/app/")&&!/\/(node_modules|dist|build)\//.test(n)&&o.push("BARREL: Barrel files (index.ts) are discouraged - import directly from source"),/\.(tsx|ts|jsx|js)$/.test(n)&&(/^[A-Z][a-zA-Z0-9]*\.(tsx|jsx)$/.test(r)&&(/(components\/|features\/|app\/|pages\/)/.test(n)||o.push("COMPONENT: React components must be in components/, features/, or app/")),/^use[A-Z][a-zA-Z0-9]*\.(ts|tsx)$/.test(r)&&(/(hooks\/|\/hooks\/)/.test(n)||o.push("HOOK: Custom hooks must be in hooks/ directory"))),n.endsWith(".py")){let i=Ws(n);/^(router_|routes_|api_).*\.py$/.test(r)&&!i.endsWith("/routers")&&!i.endsWith("routers")&&o.push("ROUTER: Router files must be in routers/ directory"),/_service\.py$/.test(r)&&!i.endsWith("/services")&&!i.endsWith("services")&&o.push("SERVICE: Service files must be in services/ directory"),/_(repository|repo)\.py$/.test(r)&&!i.endsWith("/repositories")&&!i.endsWith("repositories")&&o.push("REPOSITORY: Repository files must be in repositories/ directory")}if(o.length>0){let i=`Structure violation: ${o[0]}`;return y("structure-location-validator",`BLOCKED: ${i}`),h(i)}return u()}import{basename as zs}from"node:path";function Vs(s){return!!(/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(s)||/(^|\/)test_[^/]*\.py$/.test(s)||/_test\.py$/.test(s))}function jt(s){let e=T(s);if(e)return e;let t=s.tool_input.file_path||"";if(!t)return u();let n=zs(t),o=Vs(t);if(o&&!/(tests\/|__tests__\/|\/test\/|test\/)/.test(t)){let r=`Test file must be in tests/, __tests__/, or test/ directory: ${n}`;return y("test-location-validator",`BLOCKED: ${r}`),h(r)}if(!o&&/(tests\/|__tests__\/|\/test\/)/.test(t)){let i=[/^(conftest|fixtures|factories|mocks|__init__|setup|helpers|utils)\.py$/,/^(setup|helpers|utils|mocks|fixtures)\.(ts|js)$/].some(p=>p.test(n)),a=/\/(fixtures|mocks|factories|__mocks__)\//.test(t);if(!i&&!a){let p=`Source files cannot be in test directories: ${n}`;return y("test-location-validator",`BLOCKED: ${p}`),h(p)}}if(/\.(ts|tsx|js|jsx)$/.test(t)&&/(tests\/|__tests__)/.test(t)){if(/^(setup|jest|vitest|config|helpers|utils|mocks)\./.test(n))return u();if(!/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(n)){let r=`Test files must use .test.ts or .spec.ts suffix: ${n}`;return y("test-location-validator",`BLOCKED: ${r}`),h(r)}}if(t.endsWith(".py")&&/(tests\/|\/test\/)/.test(t)){if(/^(conftest|__init__|fixtures|factories|mocks|helpers)\.py$/.test(n))return u();if(!/^test_.*\.py$/.test(n)&&!/_test\.py$/.test(n)){let r=`Python test files must be named test_*.py or *_test.py: ${n}`;return y("test-location-validator",`BLOCKED: ${r}`),h(r)}}return u()}function Zs(s){return!!(/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(s)||/(^|\/)test_[^/]*\.py$/.test(s)||/_test\.py$/.test(s))}function Nt(s){let e=s.tool_input?.file_path||"",t=s.tool_input?.content||s.tool_result||"";if(!e||!t)return u();if(!Zs(e))return u();let n=[];if(/\.(ts|tsx|js|jsx)$/.test(e)){let o=t.match(/(test|it)\(['"][^'"]{1,10}['"]/g);o&&o.some(p=>/test[0-9]|works|^test$/i.test(p))&&(n.push("Test names too short or generic. Use descriptive names:"),n.push("  BAD:  test('test1'), test('works')"),n.push("  GOOD: test('should return user when ID exists')")),/^let [a-zA-Z_][a-zA-Z0-9_]* =/m.test(t)&&(/beforeEach\s*\(\s*(async\s*)?\(\s*\)\s*=>/.test(t)||(n.push("Shared mutable state detected without beforeEach reset:"),n.push("  Add beforeEach(() => { /* reset state */ }) to ensure test isolation")));let r=(t.match(/expect\(/g)||[]).length,i=(t.match(/(test|it)\s*\(/g)||[]).length||1,a=Math.floor(r/i);a>5&&(n.push(`High assertion count (avg ${a} per test):`),n.push("  Consider splitting into focused tests with 1-3 assertions each"),n.push("  Or add AAA comments (// Arrange, // Act, // Assert)")),/console\.(log|warn|error)\(/.test(t)&&(n.push("console.log found in test file:"),n.push("  Remove debugging statements before committing"),n.push("  Use proper assertions instead")),/(test|it|describe)\.only\(/.test(t)&&(n.push(".only() found - this skips other tests:"),n.push("  Remove .only() before committing")),/(test|it|describe)\.skip\(/.test(t)&&(/TODO|FIXME|temporarily/i.test(t)||t.split(`
`).some(c=>/skip/i.test(c)&&/because/i.test(c))||(n.push(".skip() found without explanation:"),n.push("  Add a comment explaining why the test is skipped"),n.push("  Example: test.skip('reason: waiting for API fix')")))}return e.endsWith(".py")&&(/def test[A-Z]/.test(t)&&(n.push("Test names must use snake_case, not camelCase:"),n.push("  BAD:  def testUserCreation()"),n.push("  GOOD: def test_user_creation()")),/def (setUp|tearDown|setUpClass|tearDownClass)\s*\(/.test(t)&&(n.push("Use pytest fixtures instead of unittest setUp/tearDown:"),n.push("  BAD:  def setUp(self): ..."),n.push("  GOOD: @pytest.fixture\\n        def setup_data(): ...")),t.split(`
`).some(o=>/^class Test\w*\s*[:(]/.test(o))&&(/^\s+[a-z_]+ = \[\]/m.test(t)||/^\s+[a-z_]+ = \{\}/m.test(t))&&(n.push("Class-level mutable defaults can cause test pollution:"),n.push("  BAD:  class TestUser:\\n            items = []"),n.push("  GOOD: Use @pytest.fixture to create fresh instances")),/^\s+print\(/m.test(t)&&(n.push("print() found in test file:"),n.push("  Remove debugging statements before committing"),n.push("  Use proper assertions or pytest's capfd fixture")),(/@pytest\.mark\.skip\s*$/.test(t)||/@pytest\.mark\.skip\(\s*\)/.test(t))&&(n.push("@pytest.mark.skip without reason:"),n.push("  Add reason: @pytest.mark.skip(reason='waiting for fix')")),/async def test_/.test(t)&&(/@pytest\.mark\.asyncio/.test(t)||(n.push("Async test found without @pytest.mark.asyncio:"),n.push("  Add: @pytest.mark.asyncio"),n.push("  Or set asyncio_mode = auto in pytest.ini")))),n.length>0?(y("test-pattern-validator",`BLOCKED: ${n[0]}`),h(`Test pattern violations detected in ${e}`)):u()}import{existsSync as Lt}from"node:fs";import{execSync as P}from"node:child_process";import{basename as Y,dirname as X}from"node:path";function qs(s){let e=s;for(;e&&e!=="/"&&e.length>0;){if(Lt(`${e}/package.json`))return e;let t=X(e);if(t===e)break;e=t}return null}function Ft(s){let e=s.tool_input?.file_path||process.env.CC_TOOL_FILE_PATH||"";if(!e)return u();let t=e.split("/").pop()||"";if(t.startsWith("test")&&t.endsWith(".py")||t.endsWith("_test.py")){process.stderr.write(`::group::Auto-running Python test: ${Y(e)}
`);let n=X(e);try{if(Lt(`${n}/pyproject.toml`))try{P("command -v poetry",{stdio:["pipe","pipe","pipe"]});let r=P(`poetry run pytest "${e}" -v --tb=short`,{cwd:n,encoding:"utf8",timeout:6e4,stdio:["pipe","pipe","pipe"]}).split(`
`).slice(-30);process.stderr.write(`${r.join(`
`)}
`)}catch{}try{P("command -v pytest",{stdio:["pipe","pipe","pipe"]});let r=P(`pytest "${e}" -v --tb=short`,{cwd:n,encoding:"utf8",timeout:6e4,stdio:["pipe","pipe","pipe"]}).split(`
`).slice(-30);process.stderr.write(`${r.join(`
`)}
`)}catch{process.stderr.write(`pytest not found - skipping auto-run
`)}}catch(o){o instanceof Error&&process.stderr.write(`Test execution error: ${o.message}
`)}process.stderr.write(`::endgroup::
`)}if(/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(e)){process.stderr.write(`::group::Auto-running TypeScript test: ${Y(e)}
`);let n=qs(X(e));if(n)try{let o=Y(e).replace(/\.[^.]+$/,"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=P(`npm test -- --testPathPattern="${o}"`,{cwd:n,encoding:"utf8",timeout:6e4,stdio:["pipe","pipe","pipe"]}).split(`
`).slice(-30);process.stderr.write(`${i.join(`
`)}
`)}catch(o){o instanceof Error&&process.stderr.write(`Test execution error: ${o.message}
`)}process.stderr.write(`::endgroup::
`)}return u()}var Mt={"skill/backend-file-naming":ft,"skill/decision-processor":ht,"skill/backend-layer-validator":yt,"skill/coverage-check":kt,"skill/coverage-threshold-gate":_t,"skill/cross-instance-test-validator":vt,"skill/di-pattern-enforcer":xt,"skill/duplicate-code-detector":St,"skill/eval-metrics-collector":Rt,"skill/evidence-collector":$t,"skill/import-direction-enforcer":Et,"skill/merge-conflict-predictor":wt,"skill/merge-readiness-checker":Tt,"skill/migration-validator":It,"skill/pattern-consistency-enforcer":Ct,"skill/redact-secrets":At,"skill/review-summary-generator":Dt,"skill/security-summary":Ht,"skill/structure-location-validator":Ot,"skill/test-location-validator":jt,"skill/test-pattern-validator":Nt,"skill/test-runner":Ft};function Jr(s){return Mt[s]}function Yr(){return Object.keys(Mt)}export{Mn as analyzeStagedChanges,On as escapeRegex,xe as estimateTokenCount,Re as extractIssueNumber,vn as getCachedBranch,A as getCurrentBranch,pt as getDefaultBranch,_n as getEnvFile,Hn as getField,be as getGitStatus,Jr as getHook,x as getLogDir,he as getLogLevel,Z as getPluginRoot,m as getProjectDir,R as getRepoRoot,V as getSessionId,$e as getStagedFiles,ut as hasUncommittedChanges,Mt as hooks,Ks as isBashInput,Ys as isEditInput,Fn as isGitRepo,Se as isProtectedBranch,Xs as isReadInput,Js as isWriteInput,w as lineContainsAll,at as lineContainsAllCI,Yr as listHooks,y as logHook,Cn as logPermissionFeedback,Pn as normalizeCommand,xn as normalizeLineEndings,Rn as outputAllowWithContext,h as outputBlock,Tn as outputDeny,$n as outputError,ke as outputPromptContext,An as outputPromptContextBudgeted,Sn as outputSilentAllow,u as outputSilentSuccess,wn as outputStderrWarning,En as outputWarning,k as outputWithContext,bn as outputWithNotification,In as outputWithUpdatedInput,Dn as readHookInput,ye as shouldLog,Un as validateBranchName};
//# sourceMappingURL=skill.mjs.map
