// OrchestKit Hooks - permission bundle
// Generated: 2026-02-13T15:38:12.683Z

var j=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Ht(t){return typeof t.command=="string"}function Tt(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function Pt(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function bt(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as v,existsSync as y,statSync as nt,renameSync as rt,mkdirSync as st,readSync as it}from"node:fs";import{execSync as ut}from"node:child_process";import U from"node:os";import g from"node:path";function N(){return process.env.HOME||process.env.USERPROFILE||U.homedir()}function f(){return process.env.CLAUDE_PROJECT_DIR||"."}function x(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function S(){return process.env.CLAUDE_PLUGIN_ROOT?g.join(N(),".claude","logs","ork"):g.join(f(),".claude","logs")}var Ct=g.join,At=g.sep;import{execSync as F}from"node:child_process";import{createHash as M}from"node:crypto";import{existsSync as R,readFileSync as B,writeFileSync as G,mkdirSync as W}from"node:fs";import{join as d,basename as z}from"node:path";var J=20,K=15,q=/[^a-z0-9-]/g;function X(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=z(e);return E(o,J)}function Z(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let o=F("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),n=E(o||"detached",K);return process.env.ORCHESTKIT_SESSION_BRANCH=n,n}catch{return"nobranch"}}function V(t){let e=t||new Date,o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${o}${n}`}function Y(t){let e=t||new Date,o=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${o}${n}`}function Q(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return M("sha256").update(t).digest("hex").slice(0,4)}function E(t,e){return t.toLowerCase().replace(q,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function tt(t,e){let o=X(t),n=Z(t),s=V(e),i=Y(e),p=Q();return`${o}-${n}-${s}-${i}-${p}`}function et(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=d(e,".instance","session-id.json");if(R(o))try{let n=JSON.parse(B(o,"utf8"));if(n.session_id&&n.created_at){let s=Date.now()-new Date(n.created_at).getTime(),i=1440*60*1e3;if(s<i)return n.session_id}}catch{}}function ot(t,e){let o=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=d(o,".instance"),s=d(n,"session-id.json");try{R(n)||W(n,{recursive:!0}),G(s,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function I(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=et(t);if(e)return e;let o=tt(t);return ot(o,t),o}function H(){return S()}function h(){return f()}function k(){return x()}function zt(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${k()}/.claude/.instance_env`}function m(){return I()}function Jt(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=ut("git branch --show-current",{cwd:t||h(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function at(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function Kt(t){return t.replace(/\r\n/g,`
`)}function ct(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(at())}function r(){return{continue:!0,suppressOutput:!0}}function a(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function qt(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function Xt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function pt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function Zt(t,e){let o={continue:!0,suppressOutput:!0};return t&&(o.systemMessage=t),e&&(o.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),o}function Vt(t,e){let o={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?o.systemMessage=e:o.suppressOutput=!0,o}function Yt(t){return{continue:!0,systemMessage:t}}function Qt(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function te(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function ee(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function oe(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var lt=200*1024,gt=100*1024;function T(t,e){if(y(t))try{if(nt(t).size>e){let n=`${t}.old.${Date.now()}`;rt(t,n)}}catch{}}function P(t){y(t)||st(t,{recursive:!0})}function u(t,e,o="debug"){if(!ct(o))return;let n=H(),s=`${n}/hooks.log`;try{P(n),T(s,lt);let i=new Date().toISOString().replace("T"," ").slice(0,19);v(s,`[${i}] [${o.toUpperCase()}] [${t}] ${e}
`)}catch{}}function c(t,e,o){let n=H(),s=`${n}/permission-feedback.log`;try{P(n),T(s,gt);let i=new Date().toISOString(),p=o?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",l=o?.session_id||m();v(s,`${i} | ${t} | ${e} | tool=${p} | session=${l}
`)}catch{}}function ft(t){if(!t)return 0;let n=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/n)}function ne(t,e,o,n,s){let i=ft(t);return n&&n.isOverBudget(o)?(u(e,`Budget exhausted for ${o}, suppressing ${i}t`),r()):(s&&s.trackTokenUsage(e,o,i),pt(t))}function re(){try{let t=[],o=Buffer.allocUnsafe(256),n,s=0;for(;;)try{if(n=it(s,o,0,256,null),n===0)break;t.push(Buffer.from(o.subarray(0,n)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:m(),tool_input:{}}}catch{return{tool_name:"",session_id:m(),tool_input:{}}}}function se(t,e){let o=e.replace(/^\./,"").split("."),n=t;for(let s of o){if(n==null)return;n=n[s]}return n}function ie(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function ue(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function ge(t){return e=>t(e)?null:r()}function _(t,...e){let o=t.tool_input.file_path;if(!o)return r();let n=o.split(".").pop()?.toLowerCase()||"";return e.map(i=>i.toLowerCase().replace(/^\./,"")).includes(n)?null:r()}function fe(t){return _(t,"py","ts","tsx","js","jsx","go","rs","java")}function de(t){return _(t,"py")}function me(t){return _(t,"ts","tsx","js","jsx")}function he(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(n=>n.test(e))?null:r():r()}function ke(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(n=>n.test(e))?r():null}function _e(t,...e){let o=t.tool_input.file_path;if(!o)return r();for(let n of e)if(typeof n=="string"){if(new RegExp(n.replace(/\*/g,".*").replace(/\?/g,".")).test(o))return null}else if(n.test(o))return null;return r()}function O(t,...e){let o=t.tool_name;return o?e.includes(o)?null:r():r()}function xe(t){return O(t,"Write","Edit")}function Se(t){return O(t,"Bash")}function Re(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(n=>n.test(e))?r():null}function Ee(t){return(t.tool_input.command||"").startsWith("git")?null:r()}function Ie(t){if(b())return r();let o=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:n}=j("node:fs");if(n(o))return null}catch{}return r()}function ve(t,...e){for(let o of e){let n=o(t);if(n!==null)return n}return null}function ye(t){return t.permissionMode==="dontAsk"}var dt=[/^git (status|log|diff|branch|show|fetch|pull)/,/^git checkout/,/^npm (list|ls|outdated|audit|run|test)/,/^pnpm (list|ls|outdated|audit|run|test)/,/^yarn (list|outdated|audit|run|test)/,/^poetry (show|run|env)/,/^docker (ps|images|logs|inspect)/,/^docker-compose (ps|logs)/,/^docker compose (ps|logs)/,/^ls(\s|$)/,/^pwd$/,/^echo\s/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^find\s/,/^which\s/,/^type\s/,/^env$/,/^printenv/,/^gh (issue|pr|repo|workflow) (list|view|status)/,/^gh milestone/,/^pytest/,/^poetry run pytest/,/^npm run (test|lint|typecheck|format)/,/^ruff (check|format)/,/^ty check/,/^mypy/];function D(t){let e=t.tool_input.command||"";u("auto-approve-safe-bash",`Evaluating bash command: ${e.slice(0,50)}...`);for(let o of dt)if(o.test(e))return u("auto-approve-safe-bash",`Auto-approved: matches safe pattern ${o}`),c("allow",`Matches safe pattern: ${o}`,t),a();return u("auto-approve-safe-bash","Command requires manual approval"),r()}import{resolve as mt,isAbsolute as w,relative as ht,normalize as C}from"node:path";var kt=["node_modules",".git","dist","build","__pycache__",".venv","venv"];function A(t){let e=t.tool_input.file_path||"",o=h();u("auto-approve-project-writes",`Evaluating write to: ${e}`),w(e)||(e=mt(o,e));let n=C(e),s=C(o),i=ht(s,n);if(!i.startsWith("..")&&!w(i)){for(let l of kt)if(e.includes(`/${l}/`))return u("auto-approve-project-writes",`Write to excluded directory: ${l}`),r();return u("auto-approve-project-writes","Auto-approved: within project directory"),c("allow",`In-project write: ${e}`,t),a()}return u("auto-approve-project-writes","Write outside project directory - manual approval required"),r()}import{existsSync as _t,readFileSync as xt}from"node:fs";import{join as St}from"node:path";var Rt=[/rm\s+-rf\s+[/~]/,/sudo\s/,/chmod\s+-R\s+777/,/>\s*\/dev\/sd/,/mkfs\./,/dd\s+if=/,/:.*\(\).*\{.*\|.*&.*\}/,/curl.*\|\s*sh/,/wget.*\|\s*sh/];function Et(t){return Rt.some(e=>e.test(t))}function It(){let t=k(),e=St(t,".claude","feedback","learned-patterns.json");try{if(_t(e))return JSON.parse(xt(e,"utf8")).autoApprovePatterns||[]}catch{}return[]}function vt(t){let e=It();for(let o of e)try{if(new RegExp(o).test(t))return!0}catch{}return!1}function L(t){let e=t.tool_name,o=t.tool_input.command||t.tool_input.file_path||"";if(u("learning-tracker",`Processing permission for tool: ${e}, command: ${o.slice(0,50)}...`),e==="Bash"&&o){if(Et(o))return u("learning-tracker","Command matches security blocklist, skipping"),r();if(vt(o))return u("learning-tracker","Command matches learned auto-approve pattern"),c("allow","Learned pattern match",t),a()}return r()}var $={"permission/auto-approve-safe-bash":D,"permission/auto-approve-project-writes":A,"permission/learning-tracker":L};function Ne(t){return $[t]}function Fe(){return Object.keys($)}export{ge as createGuard,ue as escapeRegex,ft as estimateTokenCount,Jt as getCachedBranch,zt as getEnvFile,se as getField,Ne as getHook,H as getLogDir,at as getLogLevel,k as getPluginRoot,h as getProjectDir,m as getSessionId,Se as guardBash,fe as guardCodeFiles,_ as guardFileExtension,Ee as guardGitCommand,Ie as guardMultiInstance,Re as guardNontrivialBash,_e as guardPathPattern,de as guardPythonFiles,ke as guardSkipInternal,he as guardTestFiles,O as guardTool,me as guardTypescriptFiles,xe as guardWriteEdit,$ as hooks,Ht as isBashInput,ye as isDontAskMode,Pt as isEditInput,bt as isReadInput,Tt as isWriteInput,Fe as listHooks,u as logHook,c as logPermissionFeedback,ie as normalizeCommand,Kt as normalizeLineEndings,Vt as outputAllowWithContext,qt as outputBlock,ee as outputDeny,Yt as outputError,pt as outputPromptContext,ne as outputPromptContextBudgeted,a as outputSilentAllow,r as outputSilentSuccess,te as outputStderrWarning,Qt as outputWarning,Xt as outputWithContext,Zt as outputWithNotification,oe as outputWithUpdatedInput,re as readHookInput,ve as runGuards,ct as shouldLog};
//# sourceMappingURL=permission.mjs.map
