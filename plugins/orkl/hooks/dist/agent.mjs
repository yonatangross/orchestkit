// OrchestKit Hooks - agent bundle
// Generated: 2026-02-19T08:29:54.388Z

var j=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Dt(t){return typeof t.command=="string"}function vt(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function Ot(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Ct(t){return typeof t.file_path=="string"&&t.content===void 0}import{existsSync as D,statSync as at,renameSync as pt,mkdirSync as lt,readSync as ft}from"node:fs";import{appendFileSync as M,mkdirSync as F}from"node:fs";import{dirname as B}from"node:path";var f=[],m=!1,E=!1;function a(t,e){f.push({filePath:t,content:e}),G()}function h(){if(m||f.length===0)return;m=!0;let t=new Map;for(let e of f){let n=t.get(e.filePath);n?n.push(e.content):t.set(e.filePath,[e.content])}for(let[e,n]of t)try{F(B(e),{recursive:!0}),M(e,n.join(""))}catch{}f.length=0,m=!1}function G(){E||(E=!0,process.on("exit",h),process.on("SIGTERM",()=>{h(),process.exit(0)}),process.on("SIGINT",()=>{h(),process.exit(0)}))}import{execSync as gt}from"node:child_process";import W from"node:os";import g from"node:path";function J(){return process.env.HOME||process.env.USERPROFILE||W.homedir()}function k(){return process.env.CLAUDE_PROJECT_DIR||"."}function R(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function y(){return process.env.CLAUDE_PLUGIN_ROOT?g.join(J(),".claude","logs","ork"):g.join(k(),".claude","logs")}var $t=g.join,Ut=g.sep;import{execSync as K}from"node:child_process";import{createHash as z}from"node:crypto";import{existsSync as I,readFileSync as V,writeFileSync as q,mkdirSync as X}from"node:fs";import{join as _,basename as Z}from"node:path";var Q=20,Y=15,tt=/[^a-z0-9-]/g;function et(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=Z(e);return T(n,Q)}function nt(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=K("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=T(n||"detached",Y);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function ot(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function rt(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function st(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return z("sha256").update(t).digest("hex").slice(0,4)}function T(t,e){return t.toLowerCase().replace(tt,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function it(t,e){let n=et(t),o=nt(t),s=ot(e),i=rt(e),c=st();return`${n}-${o}-${s}-${i}-${c}`}function ut(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=_(e,".instance","session-id.json");if(I(n))try{let o=JSON.parse(V(n,"utf8"));if(o.session_id&&o.created_at){let s=Date.now()-new Date(o.created_at).getTime(),i=1440*60*1e3;if(s<i)return o.session_id}}catch{}}function ct(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=_(n,".instance"),s=_(o,"session-id.json");try{I(o)||X(o,{recursive:!0}),q(s,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function H(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=ut(t);if(e)return e;let n=it(t);return ct(n,t),n}function v(){return y()}function x(){return k()}function dt(){return R()}function Xt(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${dt()}/.claude/.instance_env`}function p(){return H()}function Zt(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=gt("git branch --show-current",{cwd:t||x(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function mt(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function Qt(t){return t.replace(/\r\n/g,`
`)}function ht(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(mt())}function r(){return{continue:!0,suppressOutput:!0}}function Yt(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function te(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function l(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function kt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function ee(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function ne(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function oe(t){return{continue:!0,systemMessage:t}}function re(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function se(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function u(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function ie(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var _t=200*1024,xt=100*1024;function O(t,e){if(D(t))try{if(at(t).size>e){let o=`${t}.old.${Date.now()}`;pt(t,o)}}catch{}}function C(t){D(t)||lt(t,{recursive:!0})}function St(t,e,n="debug"){if(!ht(n))return;let o=v(),s=`${o}/hooks.log`;try{C(o),O(s,_t);let i=new Date().toISOString().replace("T"," ").slice(0,19);a(s,`[${i}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function ue(t,e,n){let o=v(),s=`${o}/permission-feedback.log`;try{C(o),O(s,xt);let i=new Date().toISOString(),c=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",d=n?.session_id||p();a(s,`${i} | ${t} | ${e} | tool=${c} | session=${d}
`)}catch{}}function Et(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function ce(t,e,n,o,s){let i=Et(t);return o&&o.isOverBudget(n)?(St(e,`Budget exhausted for ${n}, suppressing ${i}t`),r()):(s&&s.trackTokenUsage(e,n,i),kt(t))}function ae(){try{let t=[],n=Buffer.allocUnsafe(256),o,s=0;for(;;)try{if(o=ft(s,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:p(),tool_input:{}}}catch{return{tool_name:"",session_id:p(),tool_input:{}}}}function pe(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let s of n){if(o==null)return;o=o[s]}return o}function le(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function fe(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function ke(t){return e=>t(e)?null:r()}function S(t,...e){let n=t.tool_input.file_path;if(!n)return r();let o=n.split(".").pop()?.toLowerCase()||"";return e.map(i=>i.toLowerCase().replace(/^\./,"")).includes(o)?null:r()}function _e(t){return S(t,"py","ts","tsx","js","jsx","go","rs","java")}function xe(t){return S(t,"py")}function Se(t){return S(t,"ts","tsx","js","jsx")}function Ee(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(o=>o.test(e))?null:r():r()}function Re(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(o=>o.test(e))?r():null}function ye(t,...e){let n=t.tool_input.file_path;if(!n)return r();for(let o of e)if(typeof o=="string"){if(new RegExp(o.replace(/\*/g,".*").replace(/\?/g,".")).test(n))return null}else if(o.test(n))return null;return r()}function P(t,...e){let n=t.tool_name;return n?e.includes(n)?null:r():r()}function Ie(t){return P(t,"Write","Edit")}function Te(t){return P(t,"Bash")}function He(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(o=>o.test(e))?r():null}function De(t){return(t.tool_input.command||"").startsWith("git")?null:r()}function ve(t){if(b())return r();let n=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:o}=j("node:fs");if(o(n))return null}catch{}return r()}function Oe(t,...e){for(let n of e){let o=n(t);if(o!==null)return o}return null}function Ce(t){return t.permissionMode==="dontAsk"}function A(t){let e=t.tool_name,n=process.env.CLAUDE_AGENT_ID||"unknown";return["Write","Edit","MultiEdit","NotebookEdit"].includes(e)?u(`BLOCKED: Agent '${n}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`):r()}var Rt=[/force.*push/i,/push.*--force/i,/--force-with-lease/i,/workflow_dispatch/i,/delete.*workflow/i,/gh\s+secret\s+delete/i,/gh\s+variable\s+delete/i,/rm.*-rf.*\.github/i];function w(t){let e=t.tool_input.command||"";for(let n of Rt)if(n.test(e))return u(`BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${n.source}'. This requires explicit user approval.`);return/deploy|release|publish/i.test(e)?l("CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place."):r()}var yt=[/\bprod\b/i,/production/i,/--env.*prod/i,/ENV=prod/i,/ENVIRONMENT=prod/i,/deploy.*main/i,/deploy.*master/i];function N(t){let e=t.tool_input.command||"";for(let n of yt)if(n.test(e))return u(`BLOCKED: Production deployment detected. Pattern: '${n.source}'. Production deployments require explicit user approval and should go through proper release processes.`);return/rollback|revert|downgrade/i.test(e)?l("Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed."):/terraform|kubectl|helm|docker.*push/i.test(e)?l("Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment."):r()}var It=[/DROP\s+TABLE/i,/DROP\s+DATABASE/i,/TRUNCATE/i,/DELETE\s+FROM.*WHERE\s+1/i,/DELETE\s+FROM\s+[^W]*$/i,/--force/i,/alembic\s+downgrade/i];function L(t){if(t.tool_name!=="Bash")return r();let n=t.tool_input.command||"";for(let o of It)if(o.test(n))return u(`BLOCKED: Potentially destructive database command detected. Pattern: '${o.source}'. Please confirm this operation is intentional before proceeding.`);return r()}import{mkdirSync as Tt}from"node:fs";function $(t){let e=process.env.CLAUDE_AGENT_ID||"unknown",n=t.tool_name,o=t.session_id||p(),s=t.project_dir||x(),i=`${s}/.claude/logs/security-audit.log`;if(n!=="Bash")return r();let c=t.tool_input.command||"",d=new Date().toISOString();if(c)try{Tt(`${s}/.claude/logs`,{recursive:!0}),a(i,`[${d}] [${o}] [${e}] CMD: ${c}
`)}catch{}return r()}var U={"agent/block-writes":A,"agent/ci-safety-check":w,"agent/deployment-safety-check":N,"agent/migration-safety-check":L,"agent/security-command-audit":$};function qe(t){return U[t]}function Xe(){return Object.keys(U)}export{ke as createGuard,fe as escapeRegex,Et as estimateTokenCount,Zt as getCachedBranch,Xt as getEnvFile,pe as getField,qe as getHook,v as getLogDir,mt as getLogLevel,dt as getPluginRoot,x as getProjectDir,p as getSessionId,Te as guardBash,_e as guardCodeFiles,S as guardFileExtension,De as guardGitCommand,ve as guardMultiInstance,He as guardNontrivialBash,ye as guardPathPattern,xe as guardPythonFiles,Re as guardSkipInternal,Ee as guardTestFiles,P as guardTool,Se as guardTypescriptFiles,Ie as guardWriteEdit,U as hooks,Dt as isBashInput,Ce as isDontAskMode,Ot as isEditInput,Ct as isReadInput,vt as isWriteInput,Xe as listHooks,St as logHook,ue as logPermissionFeedback,le as normalizeCommand,Qt as normalizeLineEndings,ne as outputAllowWithContext,te as outputBlock,u as outputDeny,oe as outputError,kt as outputPromptContext,ce as outputPromptContextBudgeted,Yt as outputSilentAllow,r as outputSilentSuccess,se as outputStderrWarning,re as outputWarning,l as outputWithContext,ee as outputWithNotification,ie as outputWithUpdatedInput,ae as readHookInput,Oe as runGuards,ht as shouldLog};
//# sourceMappingURL=agent.mjs.map
