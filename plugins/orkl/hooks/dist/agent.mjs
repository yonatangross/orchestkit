// OrchestKit Hooks - agent bundle
// Generated: 2026-02-20T13:33:09.271Z

var G=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Pt(t){return typeof t.command=="string"}function At(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function wt(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Lt(t){return typeof t.file_path=="string"&&t.content===void 0}import{existsSync as v,statSync as dt,renameSync as gt,mkdirSync as mt,readSync as ht}from"node:fs";import{appendFileSync as W,mkdirSync as J}from"node:fs";import{dirname as K}from"node:path";var h=[],E=!1,T=!1;function l(t,e){h.push({filePath:t,content:e}),z()}function x(){if(E||h.length===0)return;E=!0;let t=new Map;for(let e of h){let o=t.get(e.filePath);o?o.push(e.content):t.set(e.filePath,[e.content])}for(let[e,o]of t)try{J(K(e),{recursive:!0}),W(e,o.join(""))}catch{}h.length=0,E=!1}function z(){T||(T=!0,process.on("exit",x),process.on("SIGTERM",()=>{x(),process.exit(0)}),process.on("SIGINT",()=>{x(),process.exit(0)}))}import{execSync as kt}from"node:child_process";import V from"node:os";import k from"node:path";function q(){return process.env.HOME||process.env.USERPROFILE||V.homedir()}function _(){return process.env.CLAUDE_PROJECT_DIR||"."}function H(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function D(){return process.env.CLAUDE_PLUGIN_ROOT?k.join(q(),".claude","logs","ork"):k.join(_(),".claude","logs")}var Bt=k.join,Gt=k.sep;import{execSync as X}from"node:child_process";import{createHash as Z}from"node:crypto";import{existsSync as C,readFileSync as Q,writeFileSync as Y,mkdirSync as tt}from"node:fs";import{join as S,basename as et}from"node:path";var ot=20,nt=15,rt=/[^a-z0-9-]/g;function st(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=et(e);return b(o,ot)}function it(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let o=X("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),n=b(o||"detached",nt);return process.env.ORCHESTKIT_SESSION_BRANCH=n,n}catch{return"nobranch"}}function ut(t){let e=t||new Date,o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${o}${n}`}function ct(t){let e=t||new Date,o=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${o}${n}`}function at(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return Z("sha256").update(t).digest("hex").slice(0,4)}function b(t,e){return t.toLowerCase().replace(rt,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function pt(t,e){let o=st(t),n=it(t),s=ut(e),i=ct(e),a=at();return`${o}-${n}-${s}-${i}-${a}`}function lt(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=S(e,".instance","session-id.json");if(C(o))try{let n=JSON.parse(Q(o,"utf8"));if(n.session_id&&n.created_at){let s=Date.now()-new Date(n.created_at).getTime(),i=1440*60*1e3;if(s<i)return n.session_id}}catch{}}function ft(t,e){let o=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=S(o,".instance"),s=S(n,"session-id.json");try{C(n)||tt(n,{recursive:!0}),Y(s,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function O(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=lt(t);if(e)return e;let o=pt(t);return ft(o,t),o}function P(){return D()}function R(){return _()}function Et(){return H()}function ee(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${Et()}/.claude/.instance_env`}function f(){return O()}function oe(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=kt("git branch --show-current",{cwd:t||R(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function xt(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function ne(t){return t.replace(/\r\n/g,`
`)}function _t(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(xt())}function r(){return{continue:!0,suppressOutput:!0}}function re(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function se(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function d(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function St(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function ie(t,e){let o={continue:!0,suppressOutput:!0};return t&&(o.systemMessage=t),e&&(o.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),o}function ue(t,e){let o={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?o.systemMessage=e:o.suppressOutput=!0,o}function ce(t){return{continue:!0,systemMessage:t}}function ae(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function pe(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function c(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function le(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var Rt=200*1024,yt=100*1024;function A(t,e){if(v(t))try{if(dt(t).size>e){let n=`${t}.old.${Date.now()}`;gt(t,n)}}catch{}}function w(t){v(t)||mt(t,{recursive:!0})}function It(t,e,o="debug"){if(!_t(o))return;let n=P(),s=`${n}/hooks.log`;try{w(n),A(s,Rt);let i=new Date().toISOString().replace("T"," ").slice(0,19);l(s,`[${i}] [${o.toUpperCase()}] [${t}] ${e}
`)}catch{}}function fe(t,e,o){let n=P(),s=`${n}/permission-feedback.log`;try{w(n),A(s,yt);let i=new Date().toISOString(),a=o?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",u=o?.session_id||f();l(s,`${i} | ${t} | ${e} | tool=${a} | session=${u}
`)}catch{}}function Tt(t){if(!t)return 0;let n=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/n)}function de(t,e,o,n,s){let i=Tt(t);return n?.isOverBudget(o)?(It(e,`Budget exhausted for ${o}, suppressing ${i}t`),r()):(s&&s.trackTokenUsage(e,o,i),St(t))}function ge(){try{let t=[],o=Buffer.allocUnsafe(256),n,s=0;for(;;)try{if(n=ht(s,o,0,256,null),n===0)break;t.push(Buffer.from(o.subarray(0,n)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:f(),tool_input:{}}}catch{return{tool_name:"",session_id:f(),tool_input:{}}}}function me(t,e){let o=e.replace(/^\./,"").split("."),n=t;for(let s of o){if(n==null)return;n=n[s]}return n}function he(t,...e){return t.split(`
`).some(o=>e.every(n=>o.includes(n)))}function g(t,...e){return t.split(`
`).some(o=>{let n=o.toLowerCase();return e.every(s=>n.includes(s.toLowerCase()))})}function ke(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function Ee(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function L(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function Ht(t,e){let o=t.split("*"),n=0;for(let s of o){if(s==="")continue;let i=s;if(i.indexOf("?")>=0){let u=!1;for(let m=n;m<=e.length-i.length;m++){let I=!0;for(let p=0;p<i.length;p++)if(i[p]!=="?"&&i[p]!==e[m+p]){I=!1;break}if(I){n=m+i.length,u=!0;break}}if(!u)return!1}else{let u=e.indexOf(i,n);if(u===-1)return!1;n=u+i.length}}return!0}function ye(t){return e=>t(e)?null:r()}function y(t,...e){let o=t.tool_input.file_path;if(!o)return r();let n=o.split(".").pop()?.toLowerCase()||"";return e.map(i=>i.toLowerCase().replace(/^\./,"")).includes(n)?null:r()}function Ie(t){return y(t,"py","ts","tsx","js","jsx","go","rs","java")}function Te(t){return y(t,"py")}function He(t){return y(t,"ts","tsx","js","jsx")}function De(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(n=>n.test(e))?null:r():r()}function Ce(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(n=>n.test(e))?r():null}function be(t,...e){let o=t.tool_input.file_path;if(!o)return r();for(let n of e)if(typeof n=="string"){if(Ht(n,o))return null}else if(n.test(o))return null;return r()}function N(t,...e){let o=t.tool_name;return o?e.includes(o)?null:r():r()}function Oe(t){return N(t,"Write","Edit")}function ve(t){return N(t,"Bash")}function Pe(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(n=>n.test(e))?r():null}function Ae(t){return(t.tool_input.command||"").startsWith("git")?null:r()}function we(t){if(L())return r();let o=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:n}=G("node:fs");if(n(o))return null}catch{}return r()}function Le(t,...e){for(let o of e){let n=o(t);if(n!==null)return n}return null}function Ne(t){return t.permissionMode==="dontAsk"}function U(t){let e=t.tool_name,o=process.env.CLAUDE_AGENT_ID||"unknown";return["Write","Edit","MultiEdit","NotebookEdit"].includes(e)?c(`BLOCKED: Agent '${o}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`):r()}var Dt=[{test:t=>g(t,"force","push"),source:"force push"},{test:t=>g(t,"push","--force"),source:"push --force"},{test:t=>t.includes("--force-with-lease"),source:"--force-with-lease"},{test:t=>t.toLowerCase().includes("workflow_dispatch"),source:"workflow_dispatch"},{test:t=>g(t,"delete","workflow"),source:"delete workflow"},{test:t=>/gh\s+secret\s+delete/i.test(t),source:"gh secret delete"},{test:t=>/gh\s+variable\s+delete/i.test(t),source:"gh variable delete"},{test:t=>g(t,"rm","-rf",".github"),source:"rm -rf .github"}];function $(t){let e=t.tool_input.command||"";for(let o of Dt)if(o.test(e))return c(`BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${o.source}'. This requires explicit user approval.`);return/deploy|release|publish/i.test(e)?d("CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place."):r()}var Ct=[{test:t=>/\bprod\b/i.test(t),source:"prod"},{test:t=>/production/i.test(t),source:"production"},{test:t=>t.includes("--env")&&/prod/i.test(t),source:"--env.*prod"},{test:t=>t.includes("ENV=prod"),source:"ENV=prod"},{test:t=>t.includes("ENVIRONMENT=prod"),source:"ENVIRONMENT=prod"},{test:t=>t.toLowerCase().includes("deploy")&&t.toLowerCase().includes("main"),source:"deploy.*main"},{test:t=>t.toLowerCase().includes("deploy")&&t.toLowerCase().includes("master"),source:"deploy.*master"}];function j(t){let e=t.tool_input.command||"";for(let o of Ct)if(o.test(e))return c(`BLOCKED: Production deployment detected. Pattern: '${o.source}'. Production deployments require explicit user approval and should go through proper release processes.`);return/rollback|revert|downgrade/i.test(e)?d("Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed."):/terraform|kubectl|helm/i.test(e)||e.toLowerCase().includes("docker")&&e.toLowerCase().includes("push")?d("Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment."):r()}var bt=[{test:t=>/DROP\s+TABLE/i.test(t),source:"DROP TABLE"},{test:t=>/DROP\s+DATABASE/i.test(t),source:"DROP DATABASE"},{test:t=>/TRUNCATE/i.test(t),source:"TRUNCATE"},{test:t=>/DELETE\s+FROM/i.test(t)&&/WHERE\s+1/i.test(t),source:"DELETE FROM...WHERE 1"},{test:t=>/DELETE\s+FROM/i.test(t)&&!/WHERE/i.test(t),source:"DELETE FROM (no WHERE)"},{test:t=>t.includes("--force"),source:"--force"},{test:t=>/alembic\s+downgrade/i.test(t),source:"alembic downgrade"}];function M(t){if(t.tool_name!=="Bash")return r();let o=t.tool_input.command||"";for(let n of bt)if(n.test(o))return c(`BLOCKED: Potentially destructive database command detected. Pattern: '${n.source}'. Please confirm this operation is intentional before proceeding.`);return r()}import{mkdirSync as Ot}from"node:fs";function F(t){let e=process.env.CLAUDE_AGENT_ID||"unknown",o=t.tool_name,n=t.session_id||f(),s=t.project_dir||R(),i=`${s}/.claude/logs/security-audit.log`;if(o!=="Bash")return r();let a=t.tool_input.command||"",u=new Date().toISOString();if(a)try{Ot(`${s}/.claude/logs`,{recursive:!0}),l(i,`[${u}] [${n}] [${e}] CMD: ${a}
`)}catch{}return r()}var B={"agent/block-writes":U,"agent/ci-safety-check":$,"agent/deployment-safety-check":j,"agent/migration-safety-check":M,"agent/security-command-audit":F};function eo(t){return B[t]}function oo(){return Object.keys(B)}export{ye as createGuard,Ee as escapeRegex,Tt as estimateTokenCount,oe as getCachedBranch,ee as getEnvFile,me as getField,eo as getHook,P as getLogDir,xt as getLogLevel,Et as getPluginRoot,R as getProjectDir,f as getSessionId,ve as guardBash,Ie as guardCodeFiles,y as guardFileExtension,Ae as guardGitCommand,we as guardMultiInstance,Pe as guardNontrivialBash,be as guardPathPattern,Te as guardPythonFiles,Ce as guardSkipInternal,De as guardTestFiles,N as guardTool,He as guardTypescriptFiles,Oe as guardWriteEdit,B as hooks,Pt as isBashInput,Ne as isDontAskMode,wt as isEditInput,Lt as isReadInput,At as isWriteInput,he as lineContainsAll,g as lineContainsAllCI,oo as listHooks,It as logHook,fe as logPermissionFeedback,ke as normalizeCommand,ne as normalizeLineEndings,ue as outputAllowWithContext,se as outputBlock,c as outputDeny,ce as outputError,St as outputPromptContext,de as outputPromptContextBudgeted,re as outputSilentAllow,r as outputSilentSuccess,pe as outputStderrWarning,ae as outputWarning,d as outputWithContext,ie as outputWithNotification,le as outputWithUpdatedInput,ge as readHookInput,Le as runGuards,_t as shouldLog};
//# sourceMappingURL=agent.mjs.map
