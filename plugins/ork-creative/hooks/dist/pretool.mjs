// OrchestKit Hooks - pretool bundle
// Generated: 2026-02-18T08:36:10.318Z

var qe=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function vs(t){return typeof t.command=="string"}function Ps(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function Ds(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function As(t){return typeof t.file_path=="string"&&t.content===void 0}import{existsSync as Ct,statSync as yn,renameSync as kn,mkdirSync as Sn,readSync as xn}from"node:fs";import{appendFileSync as Ke,mkdirSync as Ve}from"node:fs";import{dirname as Je}from"node:path";var O=[],st=!1,St=!1;function b(t,e){O.push({filePath:t,content:e}),Xe()}function it(){if(st||O.length===0)return;st=!0;let t=new Map;for(let e of O){let n=t.get(e.filePath);n?n.push(e.content):t.set(e.filePath,[e.content])}for(let[e,n]of t)try{Ve(Je(e),{recursive:!0}),Ke(e,n.join(""))}catch{}O.length=0,st=!1}function Xe(){St||(St=!0,process.on("exit",it),process.on("SIGTERM",()=>{it(),process.exit(0)}),process.on("SIGINT",()=>{it(),process.exit(0)}))}import{execSync as bn}from"node:child_process";import Qe from"node:os";import j from"node:path";function Ze(){return process.env.HOME||process.env.USERPROFILE||Qe.homedir()}function ct(){return process.env.CLAUDE_PROJECT_DIR||"."}function xt(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function bt(){return process.env.CLAUDE_PLUGIN_ROOT?j.join(Ze(),".claude","logs","ork"):j.join(ct(),".claude","logs")}var Bs=j.join,Ws=j.sep;import{execSync as Ye}from"node:child_process";import{createHash as tn}from"node:crypto";import{existsSync as Rt,readFileSync as en,writeFileSync as nn,mkdirSync as on}from"node:fs";import{join as at,basename as rn}from"node:path";var sn=20,cn=15,an=/[^a-z0-9-]/g;function un(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=rn(e);return _t(n,sn)}function ln(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=Ye("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=_t(n||"detached",cn);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function pn(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function mn(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function fn(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return tn("sha256").update(t).digest("hex").slice(0,4)}function _t(t,e){return t.toLowerCase().replace(an,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function dn(t,e){let n=un(t),o=ln(t),r=pn(e),s=mn(e),i=fn();return`${n}-${o}-${r}-${s}-${i}`}function gn(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=at(e,".instance","session-id.json");if(Rt(n))try{let o=JSON.parse(en(n,"utf8"));if(o.session_id&&o.created_at){let r=Date.now()-new Date(o.created_at).getTime(),s=1440*60*1e3;if(r<s)return o.session_id}}catch{}}function hn(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=at(n,".instance"),r=at(o,"session-id.json");try{Rt(o)||on(o,{recursive:!0}),nn(r,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function $t(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=gn(t);if(e)return e;let n=dn(t);return hn(n,t),n}function _(){return bt()}function d(){return ct()}function Rn(){return xt()}function ti(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${Rn()}/.claude/.instance_env`}function P(){return $t()}function L(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=bn("git branch --show-current",{cwd:t||d(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function _n(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function ei(t){return t.replace(/\r\n/g,`
`)}function $n(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(_n())}function a(){return{continue:!0,suppressOutput:!0}}function ni(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function oi(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function y(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function Cn(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function ri(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function m(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function si(t){return{continue:!0,systemMessage:t}}function S(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function ii(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function h(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function E(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var wn=200*1024,Hn=100*1024;function wt(t,e){if(Ct(t))try{if(yn(t).size>e){let o=`${t}.old.${Date.now()}`;kn(t,o)}}catch{}}function Ht(t){Ct(t)||Sn(t,{recursive:!0})}function l(t,e,n="debug"){if(!$n(n))return;let o=_(),r=`${o}/hooks.log`;try{Ht(o),wt(r,wn);let s=new Date().toISOString().replace("T"," ").slice(0,19);b(r,`[${s}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function p(t,e,n){let o=_(),r=`${o}/permission-feedback.log`;try{Ht(o),wt(r,Hn);let s=new Date().toISOString(),i=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",c=n?.session_id||P();b(r,`${s} | ${t} | ${e} | tool=${i} | session=${c}
`)}catch{}}function k(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function ci(t,e,n,o,r){let s=k(t);return o&&o.isOverBudget(n)?(l(e,`Budget exhausted for ${n}, suppressing ${s}t`),a()):(r&&r.trackTokenUsage(e,n,s),Cn(t))}function ai(){try{let t=[],n=Buffer.allocUnsafe(256),o,r=0;for(;;)try{if(o=xn(r,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let s=Buffer.concat(t).toString("utf8").trim();return s?JSON.parse(s):{tool_name:"",session_id:P(),tool_input:{}}}catch{return{tool_name:"",session_id:P(),tool_input:{}}}}function ui(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let r of n){if(o==null)return;o=o[r]}return o}function N(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function li(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as C}from"node:child_process";function En(t){let e=t||d();try{return C("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function ut(t){let e=t||En();return["dev","main","master"].includes(e)}function di(t){let e=t||d();try{return C("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function gi(t){let e=t||d();try{return C("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function In(t){let e=t||d();try{return C("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function hi(t){return In(t).length>0}function yi(t){let e=t||d();try{return C("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return C("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function Tn(t){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let n of e){let o=t.match(n);if(o)return parseInt(o[1],10)}return null}function vn(t){let e=t||d();try{let n=C("git diff --cached --name-only",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim();return n?n.split(`
`).filter(o=>o.trim()):[]}catch{return[]}}function Et(t){let e=vn(t),n=new Set,o=new Set,r=!1,s=!1,i=!1,c=!1;for(let u of e){let f=u.split("/");f.length>1&&(n.add(f[0]),f.length>2&&n.add(`${f[0]}/${f[1]}`));let g=u.split(".").pop()||"";o.add(g),/\.(test|spec)\.\w+$/.test(u)||/^tests?\//.test(u)||/__tests__\//.test(u)?r=!0:/\.(md|mdx|txt|rst)$/.test(u)||/^docs?\//.test(u)||u==="README.md"?i=!0:/\.(json|ya?ml|toml|ini|cfg|env)$/.test(u)||/config/i.test(u)||u==="package.json"||u==="tsconfig.json"?s=!0:c=!0}return{files:e,directories:n,extensions:o,hasTests:r,hasConfig:s,hasDocs:i,hasSource:c}}function It(t){if(ut(t))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(o=>t.startsWith(o))?t.startsWith("issue/")&&!Tn(t)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}import{existsSync as M,readFileSync as Pn,readdirSync as xi,statSync as Dn,rmSync as An}from"node:fs";import{join as F}from"node:path";function B(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function On(){return process.env.CLAUDE_CODE_TEAM_NAME||null}function Tt(){let t=On();if(!t)return[];let e=process.env.HOME||process.env.USERPROFILE||"";if(!e)return[];let n=F(e,".claude","teams",t,"config.json");if(!M(n))return[];try{let r=JSON.parse(Pn(n,"utf-8")).members;return Array.isArray(r)?r.map(s=>({name:s.name||"unknown",agentType:s.agentType||"unknown"})):[]}catch{return[]}}function vt(t,e=4){let n=process.env.HOME||process.env.USERPROFILE||"";if(!n)return!1;let o=F(n,".claude","teams",t);if(!M(o))return!1;let r=F(o,"config.json");if(!M(r))return!0;try{return Date.now()-Dn(o).mtimeMs>e*36e5}catch{return!0}}function Pt(t){let e=process.env.HOME||process.env.USERPROFILE||"";if(!e)return!1;let n=!0;for(let o of["teams","tasks"]){let r=F(e,".claude",o,t);if(M(r))try{An(r,{recursive:!0,force:!0})}catch{n=!1}}return n}function Ci(t){return e=>t(e)?null:a()}function lt(t,...e){let n=t.tool_input.file_path;if(!n)return a();let o=n.split(".").pop()?.toLowerCase()||"";return e.map(s=>s.toLowerCase().replace(/^\./,"")).includes(o)?null:a()}function I(t){return lt(t,"py","ts","tsx","js","jsx","go","rs","java")}function wi(t){return lt(t,"py")}function Hi(t){return lt(t,"ts","tsx","js","jsx")}function Ei(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(o=>o.test(e))?null:a():a()}function W(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(o=>o.test(e))?a():null}function Dt(t,...e){let n=t.tool_input.file_path;if(!n)return a();for(let o of e)if(typeof o=="string"){if(new RegExp(o.replace(/\*/g,".*").replace(/\?/g,".")).test(n))return null}else if(o.test(n))return null;return a()}function At(t,...e){let n=t.tool_name;return n?e.includes(n)?null:a():a()}function Ii(t){return At(t,"Write","Edit")}function Ti(t){return At(t,"Bash")}function vi(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(o=>o.test(e))?a():null}function Pi(t){return(t.tool_input.command||"").startsWith("git")?null:a()}function Di(t){if(B())return a();let n=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:o}=qe("node:fs");if(o(n))return null}catch{}return a()}function T(t,...e){for(let n of e){let o=n(t);if(o!==null)return o}return null}function v(t){return t.permissionMode==="dontAsk"}function jn(t){return t.replace(/\\x([0-9a-fA-F]{2})/g,(e,n)=>String.fromCharCode(parseInt(n,16)))}function Ln(t){return t.replace(/\\([0-7]{3})/g,(e,n)=>String.fromCharCode(parseInt(n,8)))}function Nn(t){return t.replace(/\\([^\s])/g,"$1")}function Mn(t){let e=t;return e=e.replace(/"([^"]*)"/g,"$1"),e=e.replace(/'([^']*)'/g,"$1"),e}function Fn(t){if(!t||!t.trim())return[];let e=t;return e=jn(e),e=Ln(e),e=Nn(e),e=Mn(e),e=e.replace(/\\\s*[\r\n]+/g," "),e.split(/\s*(?:&&|\|\||\||;|\n)\s*/).map(o=>o.replace(/\s+/g," ").trim()).filter(Boolean)}function Ot(t,e){let n=Fn(t);for(let o of n){let r=o.toLowerCase();for(let s of e)if(r.includes(s.toLowerCase()))return{matches:!0,matched:s,subCommand:o}}return{matches:!1}}var Bn=["rm -rf /","rm -rf ~","rm -fr /","rm -fr ~","mv /* /dev/null","> /dev/sda","mkfs.","dd if=/dev/zero of=/dev/","dd if=/dev/random of=/dev/","chmod -R 777 /",":(){:|:&};:","git reset --hard","git clean -fd","drop database","drop schema","truncate table"],Wn=/\|\s*(sh|bash|zsh|dash)\b/i,Gn=/git\s+push\s+.*(-f|--force)\b/i;function jt(t){let e=t.tool_input.command||"";if(!e)return a();let n=Ot(e,Bn);if(n.matches){let r=n.matched;return l("dangerous-command-blocker",`BLOCKED: Dangerous pattern: ${r}`),p("deny",`Dangerous pattern: ${r}`,t),h(`Command matches dangerous pattern: ${r}

This command could cause severe system damage and has been blocked.`)}let o=N(e).toLowerCase();if(o.includes(":(){:|:&};:")){let r="Fork bomb detected";return l("dangerous-command-blocker",`BLOCKED: ${r}`),p("deny",r,t),h(`Command matches dangerous pattern: :(){:|:&};:

This command could cause severe system damage and has been blocked.`)}if(Wn.test(o)){let r="Piping to shell interpreter detected";return l("dangerous-command-blocker",`BLOCKED: ${r}`),p("deny",r,t),h(`${r}

Piping untrusted content to a shell interpreter is dangerous and has been blocked.`)}if(Gn.test(o)){let r="Git force-push detected (rewrites remote history)";return l("dangerous-command-blocker",`BLOCKED: ${r}`),p("deny",r,t),h(`${r}

Force-pushing can destroy remote commit history and has been blocked.`)}return a()}var pt=["feat","fix","refactor","docs","test","chore","style","perf","ci","build"],Un=10;function Lt(t){let e=t.match(/-m\s+["']([^"']+)["']/);if(e)return e[1];let n=t.match(/-m\s+(\S+)/);return n?n[1]:null}function zn(t){let e=t.match(/checkout\s+-b\s+(\S+)/);if(e)return e[1];let n=t.match(/git\s+branch\s+(\S+)/);return n?n[1]:null}function qn(t,e){if(!ut(e))return null;if(/git\s+(commit|push)/.test(t)){let n=`BLOCKED: Cannot commit or push directly to '${e}' branch.

Required workflow:
1. git checkout -b issue/<number>-<description>
2. git commit -m "feat(#<number>): Description"
3. git push -u origin issue/<number>-<description>
4. gh pr create --base dev`;return p("deny",`Blocked on protected branch: ${e}`),h(n)}return y(`On protected branch '${e}'. Create feature branch for changes.`)}function Kn(t){if(!/git\s+(checkout\s+-b|branch\s+)/.test(t))return null;let e=zn(t);if(!e)return null;let n=It(e);if(n){let o=`Branch naming: ${n}

Recommended: issue/123-description, feature/xyz, fix/bug-name`;return p("allow",`Branch naming guidance: ${e}`),m(o)}return null}function Vn(t){if(!/^git\s+commit/.test(t))return null;if(/<<['"]?EOF/.test(t))return m(`Heredoc commit. Use: type(#issue): description
Types: ${pt.join(", ")}
End with: Co-Authored-By: Claude <noreply@anthropic.com>`);let e=Lt(t);if(!e)return m("Interactive commit. Use: type(#issue): description");let n=pt.join("|"),o=new RegExp(`^(${n})(\\(#?[0-9]+\\)|(\\([a-z-]+\\)))?: .+`),r=new RegExp(`^(${n}): .+`);if(o.test(e)||r.test(e)){let i=e.split(`
`)[0].length;return i>72?m(`Commit title is ${i} chars (max 72 recommended)`):null}let s=`INVALID COMMIT FORMAT: "${e}"

Required: type(#issue): description
Types: ${pt.join(", ")}
Example: feat(#123): Add user authentication`;return p("deny",`Invalid commit: ${e}`),h(s)}function Jn(t,e){if(!/^git\s+commit/.test(t))return null;let n=Et(e),o=[];if(n.files.length>Un&&o.push(`Large commit: ${n.files.length} staged files.`),[n.hasSource,n.hasDocs,n.hasConfig].filter(Boolean).length>1&&!n.hasTests){let u=[];n.hasSource&&u.push("source code"),n.hasDocs&&u.push("documentation"),n.hasConfig&&u.push("configuration"),o.push(`Mixed concerns: ${u.join(" + ")}. Consider separate commits for each.`)}let s=new Set(n.files.map(u=>u.split("/")[0]).filter(u=>u&&u!=="."));s.size>=4&&o.push(`Changes span ${s.size} top-level directories (${[...s].slice(0,5).join(", ")}). Verify all changes are related.`);let c=Lt(t);if(c){let u=c.match(/^(feat|fix|refactor|docs|test|chore|style|perf|ci|build)/)?.[1];u==="feat"&&n.hasConfig&&!n.hasSource&&o.push('Commit type is "feat" but only config files are staged. Use "chore" instead?'),u==="docs"&&n.hasSource&&o.push('Commit type is "docs" but source files are staged. Split docs from code changes.'),u==="test"&&n.hasSource&&!n.hasTests&&o.push('Commit type is "test" but no test files found in staged changes.')}if(o.length>0){let u=`Atomic commit check:
${o.map(f=>`- ${f}`).join(`
`)}

Tip: Use \`git add -p\` to stage changes interactively. See commit/rules/atomic-commit.md for guidelines.`;return m(u)}return null}function Nt(t){let e=t.tool_input.command||"";if(!e.startsWith("git"))return a();let n=L(t.project_dir);l("git-validator",`Validating: ${e.slice(0,50)}...`);let o=qn(e,n);if(o?.continue===!1)return o;let r=Vn(e);if(r?.continue===!1)return r;let s=Kn(e),i=Jn(e,t.project_dir),c=[];return o?.hookSpecificOutput?.additionalContext&&c.push(o.hookSpecificOutput.additionalContext),r?.hookSpecificOutput?.additionalContext&&c.push(r.hookSpecificOutput.additionalContext),s?.hookSpecificOutput?.additionalContext&&c.push(s.hookSpecificOutput.additionalContext),i?.hookSpecificOutput?.additionalContext&&c.push(i.hookSpecificOutput.additionalContext),c.length>0?y(c.join(`

`)):a()}var Xn=["rm -rf /","rm -rf ~","rm -fr /","rm -fr ~","mkfs","dd if=/dev","> /dev/sd","chmod -R 777 /"];function Qn(t){let e=t.trim();if(!e)return!0;for(let n of Xn)if(e.includes(n))return!1;return!0}function Zn(t){if(/curl.*\|.*(sh|bash)/.test(t)||/wget.*\|.*(sh|bash)/.test(t))return"pipe-to-shell execution (curl/wget piped to sh/bash)";if(!t.includes("&&")&&!t.includes("||")&&!t.includes("|")&&!t.includes(";"))return null;let e=t.split(/&&|\|\||[|;]/);for(let n of e)if(!Qn(n))return n.trim();return null}function Mt(t){let e=t.tool_input.command||"";if(!e)return a();let n=N(e),o=Zn(n);if(o){let r=`BLOCKED: Dangerous compound command detected.

Blocked segment: ${o}

The command contains a potentially destructive operation.

Please review and modify your command to remove the dangerous operation.`;return p("deny",`Dangerous compound command: ${o}`,t),l("compound-command-validator",`BLOCKED: ${o}`),h(r)}return p("allow","Compound command validated: safe",t),a()}var Ft=12e4;function G(t){let e=t.tool_input.command||"",n=t.tool_input.timeout,o=t.tool_input.description;if(typeof n=="number"&&n>0)return{continue:!0,suppressOutput:!0};let r={command:e,timeout:Ft};return o&&typeof o=="string"&&(r.description=o),l("default-timeout-setter",`Setting default timeout: ${Ft}ms`),E(r)}import{existsSync as Yn,readFileSync as to}from"node:fs";import{join as eo}from"node:path";function no(t){let e=eo(t,".claude","rules","error_rules.json");try{if(Yn(e))return JSON.parse(to(e,"utf8")).rules||[]}catch{}return[]}function oo(t,e){let n=new Set(t.toLowerCase().split(/\s+/)),o=new Set(e.toLowerCase().split(/\s+/)),r=0;for(let s of n)o.has(s)&&s.length>2&&r++;return r}function U(t){let e=d(),n=t.tool_input.command||"";if(!n)return a();let o=no(e);if(o.length===0)return a();let r=[];/psql.*-U\s+(postgres|orchestkit|root)/.test(n)&&o.filter(i=>i.tool==="Bash"&&i.signature?.includes("role")).length>0&&r.push("DB role error: use docker exec -it <container> psql -U orchestkit_user"),n.includes("mcp__postgres")&&o.filter(i=>i.tool?.includes("postgres-mcp")).length>0&&r.push("MCP postgres: verify connection to correct database");for(let s of o){if(!s.pattern||(s.occurrence_count||0)<5)continue;let i=s.sample_input?.command;i&&oo(n,i)>3&&(l("error-pattern-warner",`Pattern match: ${s.signature}`),s.suggested_fix?r.push(`${s.signature} (${s.occurrence_count}x): ${s.suggested_fix}`):r.push(`${s.signature} (${s.occurrence_count}x)`))}if(r.length>0){let s="Learned error patterns | "+r.join(" | ");return s.length>200&&(s=s.slice(0,197)+"..."),y(s)}return a()}import{execSync as Bt}from"node:child_process";function ro(t,e){try{let o=Bt(`git diff --name-only ${e}...HEAD 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim().split(`
`).filter(Boolean),r=[];for(let s of o.slice(0,20))try{Bt(`git log -1 --pretty=format:"%h" ${e} -- "${s}" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()&&r.push(s)}catch{}return r}catch{return[]}}function Wt(t){let e=t.tool_input.command||"",n=d();if(!/git\s+(merge|rebase|pull)/.test(e))return a();let o=null,r=e.match(/git\s+(merge|rebase)\s+(\S+)/);if(r&&(o=r[2]),e.includes("git pull")&&(o="origin/dev"),!o)return a();let s=ro(n,o);if(s.length>0){let i=`Potential conflicts detected: ${s.length} file(s)
Files: ${s.slice(0,5).join(", ")}${s.length>5?"...":""}

Consider:
1. Review changes in these files before merging
2. Run: git diff ${o}...HEAD -- <file>
3. Prepare conflict resolution strategy`;return p("allow",`Conflict prediction: ${s.length} files`,t),l("conflict-predictor",`Potential conflicts: ${s.join(", ")}`),m(i)}return p("allow","No conflicts predicted",t),a()}import{execSync as so}from"node:child_process";import{existsSync as io}from"node:fs";import{join as co,basename as ao,dirname as uo}from"node:path";function lo(t,e){let n=[],o=ao(e).replace(/\.(ts|tsx|js|jsx|py)$/,""),r=uo(e),s=[`${r}/${o}.test.ts`,`${r}/${o}.test.tsx`,`${r}/${o}.spec.ts`,`${r}/${o}.spec.tsx`,`${r}/__tests__/${o}.test.ts`,`${r}/__tests__/${o}.test.tsx`,`tests/${e.replace(/\.(ts|tsx|js|jsx)$/,".test.ts")}`,`test_${o}.py`,`tests/test_${o}.py`];for(let i of s){let c=co(t,i);io(c)&&n.push(i)}return n}function po(t){try{return so('git status --short 2>/dev/null || echo ""',{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(n=>n.trim()).map(n=>n.slice(3).trim()).filter(n=>/\.(ts|tsx|js|jsx|py)$/.test(n))}catch{return[]}}function z(t){let e=t.tool_input.command||"",n=d();if(!/git\s+push|npm\s+run\s+test|pytest/.test(e))return a();if(/npm\s+run\s+test|pytest/.test(e))return a();let o=po(n);if(o.length===0)return a();let r=[];for(let i of o.slice(0,10)){let c=lo(n,i);r.push(...c)}let s=[...new Set(r)];if(s.length>0){let i=`Related tests for changed files:
${s.slice(0,5).join(`
`)}${s.length>5?`
...`:""}

Consider running: npm run test -- ${s[0]}`;return p("allow",`Found ${s.length} related tests`,t),l("affected-tests-finder",`Tests: ${s.join(", ")}`),m(i)}return a()}import{existsSync as mt}from"node:fs";import{join as ft}from"node:path";function mo(t){let e=[];return mt(ft(t,"package.json"))&&(e.push("npm run lint"),e.push("npm run typecheck"),e.push("npm run test")),mt(ft(t,"pyproject.toml"))&&(e.push("ruff check ."),e.push("mypy ."),e.push("pytest")),mt(ft(t,"go.mod"))&&(e.push("go vet ./..."),e.push("go test ./...")),e}function Gt(t){let e=t.tool_input.command||"",n=d();if(!/git\s+push/.test(e))return a();let o=mo(n);if(o.length===0)return a();let r=`Pre-push CI simulation suggested:
${o.slice(0,3).join(`
`)}

Run these locally to catch issues before CI fails.
Or: git push --no-verify to skip (not recommended)`;return p("allow","CI simulation suggested",t),l("ci-simulation",`Suggested checks: ${o.join(", ")}`),m(r)}import{existsSync as dt}from"node:fs";import{join as gt}from"node:path";function fo(t){return dt(gt(t,".pre-commit-config.yaml"))||dt(gt(t,".pre-commit-config.yml"))}function go(t){return dt(gt(t,".husky"))}function Ut(t){let e=t.tool_input.command||"",n=d();if(!/git\s+commit/.test(e))return a();if(/--no-verify/.test(e)){let o=`WARNING: --no-verify will skip pre-commit hooks.
Consider removing it unless intentional.
Skipped checks may cause CI failures.`;return p("allow","Skip pre-commit detected",t),l("pre-commit-simulation","--no-verify used"),m(o)}if(fo(n)){let o=`Pre-commit hooks will run: .pre-commit-config.yaml
If hooks fail, fix issues and retry.
Run manually: pre-commit run --all-files`;return p("allow","pre-commit config found",t),m(o)}if(go(n)){let o=`Husky hooks will run: .husky/
If hooks fail, fix issues and retry.`;return p("allow","husky config found",t),m(o)}return a()}import{execSync as ho}from"node:child_process";function yo(t,e){try{let n=e?`${e}`:"",o=ho(`gh pr view ${n} --json number,state,mergeable,statusCheckRollup,reviewDecision 2>/dev/null`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]});return JSON.parse(o)}catch{return null}}function zt(t){let e=t.tool_input.command||"",n=d();if(!/gh\s+pr\s+merge/.test(e))return a();let o=e.match(/gh\s+pr\s+merge\s+(\d+)/),r=o?parseInt(o[1],10):void 0,s=yo(n,r);if(!s){let c=`Could not fetch PR status. Ensure:
1. gh CLI is installed and authenticated
2. You're in a git repository
3. PR exists and is accessible`;return p("allow","PR status unavailable",t),m(c)}let i=[];if(s.state!=="OPEN"&&i.push(`PR state: ${s.state} (expected OPEN)`),s.mergeable||i.push("PR has merge conflicts"),s.statusCheckRollup!=="SUCCESS"&&s.statusCheckRollup!=="PENDING"&&i.push(`Status checks: ${s.statusCheckRollup}`),s.reviewDecision==="CHANGES_REQUESTED"&&i.push("Changes requested by reviewer"),i.length>0){let c=`PR #${s.number} has issues:
${i.join(`
`)}

Resolve these before merging.`;return p("allow",`PR issues: ${i.join(", ")}`,t),l("pr-merge-gate",`PR #${s.number} has ${i.length} issues`),m(c)}return p("allow",`PR #${s.number} ready to merge`,t),a()}import{execSync as ko}from"node:child_process";function So(t,e){try{let n=e?`--since="${e}"`:"--max-count=20";return ko(`git log ${n} --pretty=format:"%s" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(Boolean)}catch{return[]}}function xo(t){let e={feat:[],fix:[],refactor:[],docs:[],test:[],chore:[],other:[]};for(let n of t){let o=n.match(/^(feat|fix|refactor|docs|test|chore|perf|ci|build)/);if(o){let r=o[1]==="perf"||o[1]==="ci"||o[1]==="build"?"chore":o[1];e[r].push(n)}else e.other.push(n)}return e}function qt(t){let e=t.tool_input.command||"",n=d();if(!/npm\s+version|poetry\s+version|changelog/.test(e))return a();let o=So(n);if(o.length===0)return a();let r=xo(o),s=[];if(r.feat.length>0&&s.push(`### Features
${r.feat.slice(0,5).map(c=>`- ${c}`).join(`
`)}`),r.fix.length>0&&s.push(`### Bug Fixes
${r.fix.slice(0,5).map(c=>`- ${c}`).join(`
`)}`),r.refactor.length>0||r.chore.length>0){let c=[...r.refactor,...r.chore];s.push(`### Maintenance
${c.slice(0,3).map(u=>`- ${u}`).join(`
`)}`)}if(s.length===0)return a();let i=`Suggested changelog entries:

${s.join(`

`)}

Update CHANGELOG.md before releasing.`;return p("allow","Changelog suggestions generated",t),l("changelog-generator",`Generated ${s.length} sections`),m(i)}import{existsSync as Kt,readFileSync as Vt}from"node:fs";import{join as Jt}from"node:path";function bo(t){let e=Jt(t,"package.json");try{if(Kt(e))return JSON.parse(Vt(e,"utf8")).version||null}catch{}return null}function Ro(t){let e=Jt(t,"pyproject.toml");try{if(Kt(e)){let o=Vt(e,"utf8").match(/version\s*=\s*["']([^"']+)["']/);return o?o[1]:null}}catch{}return null}function _o(t){let e=[],n=bo(t);n&&e.push({file:"package.json",version:n});let o=Ro(t);return o&&e.push({file:"pyproject.toml",version:o}),e}function Xt(t){let e=t.tool_input.command||"",n=d();if(!/npm\s+version|poetry\s+version/.test(e))return a();let o=_o(n);if(o.length<2)return a();let r=o.map(i=>i.version),s=[...new Set(r)];if(s.length>1){let i=`Version mismatch detected:
${o.map(c=>`${c.file}: ${c.version}`).join(`
`)}

Consider syncing versions across all files.`;return p("allow","Version mismatch detected",t),l("version-sync",`Versions: ${r.join(", ")}`),m(i)}return p("allow",`Versions in sync: ${s[0]}`,t),a()}import{existsSync as $o,readFileSync as Co}from"node:fs";import{join as wo}from"node:path";var Ho=["GPL","AGPL","LGPL","CC-BY-NC","SSPL"];function Eo(t){let e=[],n=wo(t,"package-lock.json");try{if($o(n)){let o=Co(n,"utf8");for(let r of Ho)o.includes(`"license": "${r}`)&&e.push(`Found ${r} license in npm dependencies`)}}catch{}return e}function q(t){let e=t.tool_input.command||"",n=d();if(!/npm\s+install|yarn\s+add|pip\s+install|poetry\s+add/.test(e))return a();if(/npm\s+ci|npm\s+install\s*$/.test(e))return a();let o=e.match(/(?:npm\s+install|yarn\s+add|pip\s+install|poetry\s+add)\s+(\S+)/),r=o?o[1]:null;if(!r)return a();let s=Eo(n);if(s.length>0){let c=`License compliance check:
${s.join(`
`)}

New dependency: ${r}
Consider checking its license before adding.

Use: npm view ${r} license`;return p("allow","License compliance warning",t),l("license-compliance",`Checking: ${r}`),m(c)}let i=`Installing: ${r}
Verify license compatibility before production use.
Check: npm view ${r} license`;return p("allow",`Installing package: ${r}`,t),m(i)}var Qt={bug:`## Description
<!-- Clear description of the bug -->

## Steps to Reproduce
1.
2.
3.

## Expected Behavior
<!-- What should happen -->

## Actual Behavior
<!-- What actually happens -->

## Environment
- OS:
- Version:`,feature:`## Description
<!-- Clear description of the feature -->

## Motivation
<!-- Why is this feature needed? -->

## Proposed Solution
<!-- How should this be implemented? -->

## Alternatives Considered
<!-- Other approaches considered -->`,chore:`## Description
<!-- What maintenance task needs to be done? -->

## Impact
<!-- What does this affect? -->

## Checklist
- [ ] Task 1
- [ ] Task 2`};function Io(t){return/--label.*bug|bug\s+report/i.test(t)?"bug":/--label.*feature|feature\s+request/i.test(t)?"feature":/--label.*chore|maintenance/i.test(t)?"chore":null}function K(t){let e=t.tool_input.command||"";if(!/gh\s+issue\s+create/.test(e))return a();if(/--body|--body-file|-b\s/.test(e))return a();let n=Io(e);if(n&&Qt[n]){let r=`Issue type detected: ${n}

Suggested template:
${Qt[n].slice(0,200)}...

Add --body with template or use --web for interactive creation.`;return p("allow",`Issue creation: ${n}`,t),l("gh-issue-creation-guide",`Type: ${n}`),m(r)}let o=`Creating GitHub issue. Consider:
- Clear, descriptive title
- Add appropriate labels (bug, feature, chore)
- Include reproduction steps for bugs
- Reference related issues/PRs

Use --web for interactive creation with templates.`;return p("allow","Issue creation guidance",t),m(o)}var To=`Documentation checklist for features:
- [ ] Update README.md if public API changes
- [ ] Add/update JSDoc or docstrings
- [ ] Update CHANGELOG.md
- [ ] Add usage examples
- [ ] Update API documentation`;function V(t){let e=t.tool_input.command||"";if(!/gh\s+(issue\s+close|pr\s+merge)/.test(e))return a();if(!(/--label.*feat/i.test(e)||/feat|feature/.test(e)))return a();let o=`Feature completion detected. Ensure documentation is updated.

${To}

Skip with --no-edit if docs are already complete.`;return p("allow","Feature docs reminder",t),l("issue-docs-requirement","Feature completion - docs reminder"),m(o)}import{existsSync as Zt,readFileSync as vo}from"node:fs";import{join as Yt}from"node:path";function Po(t){let e=Yt(t,".claude","coordination",".claude.db");return Zt(e)}function Do(t){let e=Yt(t,".claude","coordination","work-registry.json");try{if(Zt(e))return JSON.parse(vo(e,"utf8")).qualityGates||{}}catch{}return{}}function J(t){if(B())return a();let e=t.tool_input.command||"",n=d();if(!/gh\s+pr\s+merge|git\s+merge|deploy/.test(e))return a();if(!Po(n))return a();let o=Do(n),s=["tests","lint","typecheck"].filter(i=>!o[i]);if(s.length>0){let i=`Multi-instance quality gate check:
Failed/missing gates: ${s.join(", ")}

Run these checks before merging:
${s.map(c=>`- npm run ${c}`).join(`
`)}

Quality gates ensure consistency across instances.`;return p("allow",`Quality gates failed: ${s.join(", ")}`,t),l("multi-instance-quality-gate",`Failed: ${s.join(", ")}`),m(i)}return p("allow","All quality gates passed",t),a()}import{existsSync as Q,readFileSync as re,writeFileSync as se,mkdirSync as ie}from"node:fs";import{join as X}from"node:path";import{execSync as Ao}from"node:child_process";var R={requestsPerMinute:parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_MIN||"10",10),requestsPerHour:parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_HOUR||"100",10),burstLimit:parseInt(process.env.AGENT_BROWSER_BURST_LIMIT||"3",10)},te=parseInt(process.env.AGENT_BROWSER_ROBOTS_CACHE_TTL||"3600000",10),Oo=[/localhost.*admin/i,/127\.0\.0\.1.*admin/i,/internal\./i,/intranet\./i,/\.local\//i,/file:\/\//i,/accounts\.google\.com/i,/login\.microsoftonline\.com/i,/auth0\.com/i,/okta\.com/i,/login\.live\.com/i,/appleid\.apple\.com/i,/github\.com\/login/i,/gitlab\.com\/users\/sign_in/i],jo=["click.*delete","click.*remove","fill.*password","fill.*credit","submit.*payment"];function ce(){let t=_(),e=X(t,"agent-browser");return Q(e)||ie(e,{recursive:!0}),X(e,"rate-limits.json")}function Lo(){let t=ce();try{if(Q(t))return JSON.parse(re(t,"utf-8"))}catch{}return{domains:{}}}function No(t){let e=ce();try{se(e,JSON.stringify(t,null,2))}catch{}}function ee(t){try{return new URL(t).hostname}catch{return null}}function ne(t){let e=Date.now(),n=Lo(),o=n.domains[t]||{timestamps:[],lastUpdated:e},r=e-6e4,s=e-36e5;o.timestamps=o.timestamps.filter(g=>g>s);let i=o.timestamps.filter(g=>g>r).length,c=o.timestamps.length;if(i>=R.requestsPerMinute)return{allowed:!1,reason:`Rate limited: ${i}/${R.requestsPerMinute} requests per minute to ${t}`,remaining:0};if(c>=R.requestsPerHour)return{allowed:!1,reason:`Rate limited: ${c}/${R.requestsPerHour} requests per hour to ${t}`,remaining:0};let u=e-3e3;return o.timestamps.filter(g=>g>u).length>=R.burstLimit?{allowed:!1,reason:`Burst limited: Too many rapid requests to ${t}. Wait a moment.`,remaining:0}:(o.timestamps.push(e),o.lastUpdated=e,n.domains[t]=o,No(n),{allowed:!0,remaining:R.requestsPerMinute-i-1})}function ae(){let t=_(),e=X(t,"agent-browser");return Q(e)||ie(e,{recursive:!0}),X(e,"robots-cache.json")}function Mo(){let t=ae();try{if(Q(t))return JSON.parse(re(t,"utf-8"))}catch{}return{entries:{}}}function oe(t){let e=ae();try{se(e,JSON.stringify(t,null,2))}catch{}}function Fo(t){let e=[],n=!1,o=t.split(`
`);for(let r of o){let s=r.trim().toLowerCase();if(s.startsWith("user-agent:")&&(n=s.replace("user-agent:","").trim()==="*"),n&&s.startsWith("disallow:")){let i=r.trim().replace(/^disallow:\s*/i,"").trim();i&&e.push(i)}}return e}function Bo(t){let e=Mo(),n=Date.now(),o=e.entries[t];if(o&&o.expires>n)return o;let r=`${t}/robots.txt`;try{if(/[`$\\;"'|&<>(){}!\n\r]/.test(r))return null;let s=Ao(`curl -sL --max-time 5 "${r}"`,{encoding:"utf-8",timeout:6e3,stdio:["pipe","pipe","pipe"]}),i=Fo(s),c={rules:s.split(`
`).slice(0,50),disallowedPaths:i,expires:n+te,fetchedAt:n};return e.entries[t]=c,oe(e),c}catch{let s={rules:[],disallowedPaths:[],expires:n+te,fetchedAt:n};return e.entries[t]=s,oe(e),s}}function Wo(t){if(process.env.AGENT_BROWSER_IGNORE_ROBOTS==="true")return{allowed:!0};try{let e=new URL(t),n=e.origin,o=e.pathname,r=Bo(n);if(!r||r.disallowedPaths.length===0)return{allowed:!0};for(let s of r.disallowedPaths)if(s.includes("*")){let i=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\\\*/g,".*");if(new RegExp("^"+i).test(o))return{allowed:!1,reason:`Blocked by robots.txt: ${s}`}}else if(o.startsWith(s))return{allowed:!1,reason:`Blocked by robots.txt: ${s}`};return{allowed:!0}}catch{return{allowed:!0}}}function Go(t){let e=t.match(/(?:navigate|goto|open)\s+["']?([^"'\s]+)["']?/i);return e?e[1]:null}function Uo(t){return Oo.some(e=>e.test(t))}function zo(t){return jo.some(e=>new RegExp(e,"i").test(t))}function Z(t){let e=t.tool_input.command||"";if(!/agent-browser|ab\s/.test(e))return a();let n=Go(e);if(n&&Uo(n))return p("deny",`Blocked URL: ${n}`,t),l("agent-browser-safety",`BLOCKED: ${n}`),h(`agent-browser blocked: URL matches blocked pattern.

URL: ${n}

Blocked patterns include internal, localhost admin, and file:// URLs.
If this is intentional, use direct browser access instead.`);if(n){let o=ee(n);if(o){let r=ne(o);if(!r.allowed)return p("deny",r.reason||"Rate limited",t),l("agent-browser-safety",`RATE LIMITED: ${o}`),h(`agent-browser rate limited.

${r.reason}

Limits: ${R.requestsPerMinute}/min, ${R.requestsPerHour}/hour
Configure via AGENT_BROWSER_RATE_LIMIT_PER_MIN and AGENT_BROWSER_RATE_LIMIT_PER_HOUR env vars.

Wait a moment before retrying, or use --session <name> for isolated sessions.`)}}if(n){let o=Wo(n);if(!o.allowed)return p("deny",o.reason||"Blocked by robots.txt",t),l("agent-browser-safety",`ROBOTS BLOCKED: ${n}`),h(`agent-browser blocked by robots.txt.

URL: ${n}
${o.reason}

The website's robots.txt disallows automated access to this path.
Set AGENT_BROWSER_IGNORE_ROBOTS=true to override (not recommended).`)}if(zo(e)){let o=n?ee(n):"unknown",r=n&&o?ne(o):{remaining:"?"},s=`Sensitive browser action detected:
${e.slice(0,100)}...

This may interact with:
- Delete/remove buttons
- Password fields
- Payment forms

Rate limit remaining: ${r.remaining}/${R.requestsPerMinute} per minute

Proceed with caution. Verify target elements.`;return p("allow","Sensitive action warning",t),l("agent-browser-safety","Sensitive action detected"),m(s)}return p("allow","agent-browser command validated",t),a()}import{execSync as qo}from"node:child_process";var ht="commit-atomicity-checker",ue=10,Ko=3,Vo={"src/":"source","lib/":"source","app/":"source","docs/":"docs","doc/":"docs","test/":"tests","tests/":"tests","__tests__/":"tests","spec/":"tests","config/":"config",".github/":"config","scripts/":"config"};function Jo(t){for(let[e,n]of Object.entries(Vo))if(t.startsWith(e))return n;return"other"}function Xo(t){let e=[/-m\s+"([^"]+)"/,/-m\s+'([^']+)'/,/--message="([^"]+)"/,/--message='([^']+)'/,/--message\s+"([^"]+)"/,/--message\s+'([^']+)'/,/-m\s+([^\s"'-][^\s]*)/];for(let n of e){let o=t.match(n);if(o)return o[1]}return null}function Qo(t){try{return qo("git diff --cached --name-only",{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim().split(`
`).filter(Boolean)}catch{return l(ht,"Failed to get staged files, skipping check","warn"),null}}function Zo(t,e){let n=[];t.length>ue&&n.push(`${t.length} staged files (>${ue}) \u2014 verify all changes are related`);let o=new Set(t.map(i=>i.includes("/")?i.split("/")[0]:"(root)"));o.size>Ko&&n.push(`Changes span ${o.size} top-level dirs (${[...o].join(", ")}) \u2014 may mix concerns`);let r=new Set(t.map(Jo));r.size>=3&&n.push(`Mixed change types: ${[...r].join(", ")} \u2014 consider splitting`);let s=Xo(e);return s&&/\band\b/i.test(s)&&n.push('Commit message contains "and" \u2014 may describe multiple concerns'),n}function le(t){try{let e=t.tool_input.command||"";if(!e)return a();let n=t.project_dir||d(),o=Qo(n);if(!o||o.length===0)return a();let r=Zo(o,e);if(r.length===0)return a();let s=`Atomicity check:
${r.map(i=>`- ${i}`).join(`
`)}

Consider splitting into atomic commits if these are unrelated changes.`;return l(ht,`${r.length} warning(s) for commit`),m(s)}catch{return l(ht,"Unexpected error, falling back to silent success","warn"),a()}}function Yo(t){let e=t.match(/-m\s+(?:"([^"]*(?:\\.[^"]*)*)"|'([^']*)'|(\S+))/);return e?e[1]??e[2]??e[3]??null:null}function tr(t){let e=t.match(/(?:^|\/)(#?\d+)(?:-|$)/);return e?e[1].replace(/^#/,""):null}function er(t,e){return t.includes(`#${e}`)||t.includes(e)}function pe(t){try{let e=t.tool_input.command||"";if(!e)return a();let n=Yo(e);if(!n)return a();let o=L();if(!o||o==="unknown")return a();let r=tr(o);return r?er(n,r)?a():m(`Reminder: You're on branch \`${o}\` \u2014 include #${r} in the commit message to link it to the issue.`):a()}catch{return a()}}import{realpathSync as nr,existsSync as or}from"node:fs";import{resolve as rr,isAbsolute as sr,extname as ir,basename as cr}from"node:path";var ar=parseInt(process.env.ORCHESTKIT_MAX_FILE_LINES||"300",10),ur=parseInt(process.env.ORCHESTKIT_MAX_TEST_FILE_LINES||"500",10),lr=new Set(["py","ts","tsx","js","jsx","go","rs","java"]);function me(t){let e=cr(t);return/\.(test|spec)\.[^.]+$/.test(e)||/^test_/.test(e)||/_test\.[^.]+$/.test(e)||t.includes("__tests__/")}function pr(t){let e=[],n=t.split(`
`),o=n.filter(g=>/^export\s/.test(g.trim())).length;o>15&&e.push({name:"god-file",detected:!0,detail:`${o} exports \u2014 split by domain`});let r=n.some(g=>/^(export\s+)?(type|interface)\s/.test(g.trim())),s=n.some(g=>/^(export\s+)?(async\s+)?function\s/.test(g.trim())),i=n.some(g=>/^(export\s+)?class\s/.test(g.trim()));r&&(s||i)&&n.length>150&&e.push({name:"mixed-concerns",detected:!0,detail:"types + logic in same file \u2014 extract types to types.ts"});let c=n.filter(g=>/^import\s/.test(g.trim())).length;c>20&&e.push({name:"high-coupling",detected:!0,detail:`${c} imports \u2014 file does too much, split by responsibility`});let u=n.filter(g=>/^(export\s+)?(default\s+)?class\s/.test(g.trim())).length,f=n.filter(g=>/^(export\s+)?(default\s+)?(const|function)\s+[A-Z]/.test(g.trim())).length;return u>1&&e.push({name:"multi-class",detected:!0,detail:`${u} classes \u2014 one class per file`}),f>3&&e.push({name:"multi-component",detected:!0,detail:`${f} components \u2014 one per file`}),e.filter(g=>g.detected)}function mr(t){if(t.tool_name!=="Write")return null;let e=t.tool_input.file_path||"",n=t.tool_input.content||"";if(!e||!n)return null;let o=ir(e).toLowerCase().replace(".","");if(!lr.has(o))return null;let r=n.split(`
`).length,s=me(e)?ur:ar,i=pr(n);if(r>s){let c=me(e)?"test":"source",u=i.length>0?`

Bloat patterns detected:
`+i.map(f=>`- ${f.name}: ${f.detail}`).join(`
`):"";return h(`File too long: ${r} lines (limit: ${s} for ${c} files)${u}

Split this file into smaller modules. Override with:
  ORCHESTKIT_MAX_FILE_LINES=500 (source)
  ORCHESTKIT_MAX_TEST_FILE_LINES=800 (tests)`)}return i.length>=2&&l("file-guard",`Bloat detected in ${e}: ${i.map(c=>c.name).join(", ")}`),null}var fr=[/\.env$/,/\.env\.local$/,/\.env\.production$/,/credentials\.json$/,/secrets\.json$/,/private\.key$/,/\.pem$/,/id_rsa$/,/id_ed25519$/],dr=[/package\.json$/,/pyproject\.toml$/,/tsconfig\.json$/];function gr(t,e){try{let n=sr(t)?t:rr(e,t);return or(n)?nr(n):n}catch{return t}}function hr(t){for(let e of fr)if(e.test(t))return e;return null}function yr(t){return dr.some(e=>e.test(t))}function fe(t){let e=t.tool_input.file_path||"",n=d();if(!e)return a();l("file-guard",`File write/edit: ${e}`);let o=gr(e,n);l("file-guard",`Resolved path: ${o}`);let r=hr(o);if(r)return p("deny",`Protected file blocked: ${e} (pattern: ${r})`,t),l("file-guard",`BLOCKED: ${e} matches ${r}`),h(`Cannot modify protected file: ${e}

Resolved path: ${o}
Matched pattern: ${r}

Protected files include:
- Environment files (.env, .env.local, .env.production)
- Credential files (credentials.json, secrets.json)
- Private keys (.pem, id_rsa, id_ed25519)

If you need to modify this file, do it manually outside Claude Code.`);let s=mr(t);return s||(yr(o)&&(l("file-guard",`WARNING: Config file modification: ${o}`),p("warn",`Config file modification: ${e}`,t)),p("allow",`File write allowed: ${e}`,t),a())}import{existsSync as ge,readFileSync as kr}from"node:fs";import{join as de}from"node:path";var Sr={"api-layer":[/\/api\//,/\/routes\//,/\/endpoints\//],"service-layer":[/\/services\//],"data-layer":[/\/db\//,/\/models\//,/\/repositories\//],"workflow-layer":[/\/workflows\//,/\/agents\//],unknown:[]};function xr(t){for(let[e,n]of Object.entries(Sr))if(e!=="unknown"&&n.some(o=>o.test(t)))return e;return"unknown"}function br(t,e){let n=de(e,".claude","context","patterns"),o=de(n,`${t}.json`);try{if(ge(o)){let r=kr(o,"utf8"),s=JSON.parse(r),i=Array.isArray(s)?s.length:Object.keys(s).length;if(i>0)return` | Patterns loaded: ${i}`}}catch{}return""}function Y(t){let e=t.tool_input.file_path||"",n=t.project_dir||d();if(!e)return a();let r=Dt(t,...["**/api/**","**/services/**","**/db/**","**/models/**","**/workflows/**"]);if(r!==null)return r;let s=xr(e);if(s==="unknown")return a();let i=br(s,n),c=!ge(e),u;return c?u=`New ${s} file. Follow layer conventions: dependency injection, interface contracts${i}`:u=`Modifying ${s}. Ensure: no breaking API changes, maintain layer boundaries${i}`,p("allow",`Architectural change: ${e} (${s})`,t),l("architecture-change-detector",`ARCH_DETECT: ${e} (layer=${s})`),v(t)?S(`[Quality Gate] ${u}`):y(u)}import{existsSync as Rr,readFileSync as _r}from"node:fs";import{join as $r,extname as Cr,basename as wr}from"node:path";var $=50,he=4,Hr=10;function Er(t){return Cr(t).toLowerCase().replace(".","")}function Ir(t,e){let n=[],o=t.split(`
`);if(e==="py"){let r=!1,s="",i=0;for(let c of o){let u=c.match(/^(\s*)(?:async\s+)?def\s+([a-zA-Z_][a-zA-Z0-9_]*)/),f=c.match(/^(\s*)class\s+/);u?(r&&i>$&&n.push(`Function '${s}' is ${i} lines (max: ${$})`),r=!0,s=u[2],i=1):f?(r&&i>$&&n.push(`Function '${s}' is ${i} lines (max: ${$})`),r=!1):r&&c.trim()&&i++}r&&i>$&&n.push(`Function '${s}' is ${i} lines (max: ${$})`)}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let r=0,s=0,i=!1,c="";for(let u of o){let f=u.match(/(?:function|func|fn)\s+([a-zA-Z_][a-zA-Z0-9_]*)/),g=u.match(/const\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*=\s*(?:async\s*)?\(/);if(f?(c=f[1],i=!0,s=0,r=0):g&&(c=g[1],i=!0,s=0,r=0),i){let x=(u.match(/\{/g)||[]).length,rt=(u.match(/\}/g)||[]).length;r+=x-rt,u.trim()&&s++,r<=0&&s>0&&(s>$&&n.push(`Function '${c}' is ${s} lines (max: ${$})`),i=!1)}}}return n}function Tr(t,e){let n=[],o=t.split(`
`),r=0;if(e==="py")for(let s of o){let i=s.match(/^(\s*)(if|for|while|with|try|elif|else|except|finally)[\s:]/);if(i){let c=i[1].length,u=Math.floor(c/4);u>r&&(r=u)}}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let s=0;for(let i of o){let c=(i.match(/\{/g)||[]).length,u=(i.match(/\}/g)||[]).length;s+=c-u,/(?:if|for|while|switch|try)\s*\(/.test(i)&&s>r&&(r=s)}}return r>he&&n.push(`Deep nesting detected (depth: ${r}, max: ${he})`),n}function vr(t){let e=[],n=(t.match(/\b(if|elif|else if)\b/g)||[]).length,o=(t.match(/\b(switch|match)\b/g)||[]).length,r=(t.match(/\?[^:]+:/g)||[]).length,s=n+o+r,i=Math.max((t.match(/\b(def|function|func|fn)\b/g)||[]).length,1),c=Math.floor(s/i);return c>Hr&&e.push(`High cyclomatic complexity (~${c} conditionals/function, consider refactoring)`),e}function Pr(t,e){let n=$r(e,".claude","cache","type-errors.json");if(!Rr(n))return"";try{let o=JSON.parse(_r(n,"utf8")),r=wr(t);return o[r]||""}catch{return""}}function tt(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=t.project_dir||d(),r=T(t,I,W);if(r!==null)return r;if(!e||!n)return a();let s=Er(e),i=[];i.push(...Ir(n,s)),i.push(...Tr(n,s)),i.push(...vr(n));let c=Pr(e,o);if(c&&i.push(c),i.length>0){l("code-quality-gate",`Quality warnings for ${e}: ${i.join(", ")}`);let u=`Code quality: ${i.join(" | ")}`;return u.length>350&&(u=u.slice(0,347)+"..."),v(t)?S(`[Quality Gate] ${u}`):y(u)}return l("code-quality-gate",`No quality issues in ${e}`),a()}import{extname as Dr}from"node:path";function Ar(t){return Dr(t).toLowerCase().replace(".","")}function Or(t){return[/test/i,/spec/i,/__tests__/i,/_test\.py$/,/\.test\.ts$/,/\.spec\.ts$/].some(n=>n.test(t))}function jr(t){let e=[],n=t.split(`
`);for(let o=0;o<n.length;o++){let s=n[o].match(/^(?:\s*)(?:async\s+)?def\s+([^_][a-zA-Z0-9_]*)\s*\(/);if(s){let i=s[1],c=!1;for(let u=o+1;u<n.length;u++){let f=n[u].trim();if(f){(f.startsWith('"""')||f.startsWith("'''"))&&(c=!0);break}}if(!c&&(e.push(i),e.length>=5))break}}return e}function Lr(t){let e=[],n=t.split(`
`),o=!1;for(let r=0;r<n.length;r++){let s=n[r];(r>0?n[r-1].trim():"").endsWith("*/")&&(o=!0);let c=s.match(/^export\s+(?:async\s+)?(?:function\s+([a-zA-Z][a-zA-Z0-9_]*)|const\s+([a-zA-Z][a-zA-Z0-9_]*)\s*=)/);if(c){let u=c[1]||c[2];if(!o&&(e.push(u),e.length>=5))break;o=!1}else s.trim().endsWith("*/")||(o=!1)}return e}function et(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=T(t,I,W);if(o!==null)return o;if(!e||!n)return a();if(Or(e))return a();let r=Ar(e),s=[];if(r==="py"?s=jr(n):["ts","tsx","js","jsx"].includes(r)&&(s=Lr(n)),s.length>0){let i=s.join(", "),c;return r==="py"?c=`Documentation: ${s.length} public function(s) missing docstrings: ${i}. Consider adding """docstrings""" for better code documentation.`:c=`Documentation: ${s.length} exported function(s) missing JSDoc: ${i}. Consider adding /** JSDoc */ comments for better IDE support.`,c.length>200&&(r==="py"?c=`Documentation: ${s.length} public function(s) missing docstrings. Add """docstrings""" for better documentation.`:c=`Documentation: ${s.length} exported function(s) missing JSDoc. Add /** JSDoc */ for better IDE support.`),l("docstring-enforcer",`DOCSTRING_WARN: ${s.length} functions missing docs in ${e}`),v(t)?S(`[Quality Gate] ${c}`):y(c)}return l("docstring-enforcer",`DOCSTRING_OK: All public functions documented in ${e}`),a()}import{basename as Nr}from"node:path";var Mr=[{name:"Potential hardcoded secret detected",pattern:/(api[_-]?key|password|secret|token)\s*[=:]\s*['"][^'"]+['"]/i,severity:"high"},{name:"Potential SQL injection vulnerability",pattern:/execute\s*\(\s*['"].*\+|f['"].*SELECT.*\{/,severity:"high"},{name:"Dangerous eval/exec usage detected",pattern:/eval\s*\(|exec\s*\(/,severity:"high"},{name:"Subprocess with shell=True detected",pattern:/subprocess\.(run|call|Popen).*shell\s*=\s*True/,severity:"medium"},{name:"Potential XSS vulnerability (innerHTML)",pattern:/\.innerHTML\s*=|dangerouslySetInnerHTML/,severity:"medium"},{name:"Insecure random number generation",pattern:/Math\.random\(\).*(?:password|token|secret|key)/i,severity:"medium"},{name:"Potential command injection",pattern:/os\.system\s*\(|os\.popen\s*\(/,severity:"high"},{name:"Insecure HTTP (should use HTTPS)",pattern:/http:\/\/(?!localhost|127\.0\.0\.1)/,severity:"low"}];function Fr(t){let e=[];for(let{name:n,pattern:o}of Mr)o.test(t)&&e.push(n);return e}function nt(t){let e=t.tool_input.file_path||"",n=t.tool_input.content||"",o=T(t,I);if(o!==null)return o;if(!e)return a();let r=Fr(n);if(r.length>0){l("security-pattern-validator",`SECURITY_WARN: ${e} - ${r.join(", ")}`);let s=`Security warnings for ${Nr(e)}: ${r.join(", ")}`;return p("warn",`Security issues in ${e}: ${r.join(", ")}`,t),y(s)}return l("security-pattern-validator",`SECURITY_OK: ${e}`),p("allow",`No security issues in ${e}`,t),a()}import{existsSync as ye,readFileSync as Br,statSync as Wr,renameSync as Gr,mkdirSync as Ur}from"node:fs";import{join as zr}from"node:path";var qr=102400;function Kr(){let t=_();return zr(t,"context7-telemetry.log")}function Vr(t){try{ye(t)&&Wr(t).size>qr&&Gr(t,`${t}.old`)}catch{}}function Jr(t){if(!ye(t))return"";try{let n=Br(t,"utf8").trim().split(`
`).filter(Boolean),o=n.length;if(o===0)return"";let r=new Set;for(let c of n){let u=c.match(/library=([^| ]+)/);u&&u[1]&&u[1]!==""&&r.add(u[1])}let s=[];for(let c=n.length-1;c>=0&&s.length<3;c--){let u=n[c].match(/library=([^| ]+)/);u&&u[1]&&!s.includes(u[1])&&s.push(u[1])}let i=s.length>0?s.join(", "):"none";return`Context7: ${o} queries, ${r.size} libraries. Recent: ${i}`}catch{return""}}function ke(t){let e=t.tool_name||"";if(!e.startsWith("mcp__context7__"))return a();let n=t.tool_input.libraryId||"",o=t.tool_input.query||"",r=_();try{Ur(r,{recursive:!0})}catch{}let s=Kr();Vr(s);let c=`${new Date().toISOString()} | tool=${e} | library=${n} | query_length=${o.length}
`;try{b(s,c)}catch{}let u=Jr(s);return p("allow",`Documentation lookup: ${n}`,t),l("context7-tracker",`Query: ${e} library=${n}`),u?y(u):a()}function Se(t){let e=t.tool_name||"";if(!e.startsWith("mcp__memory__"))return a();switch(e){case"mcp__memory__delete_entities":{let n=t.tool_input.entityNames,o=Array.isArray(n)?n.length:0;if(o>5)return p("warn",`Bulk delete: ${o} entities`,t),l("memory-validator",`WARN: Bulk entity delete: ${o} entities`),S(`Deleting ${o} entities from knowledge graph`);break}case"mcp__memory__delete_relations":{let n=t.tool_input.relations,o=Array.isArray(n)?n.length:0;if(o>10)return p("warn",`Bulk relation delete: ${o} relations`,t),l("memory-validator",`WARN: Bulk relation delete: ${o} relations`),S(`Deleting ${o} relations from knowledge graph`);break}case"mcp__memory__create_entities":{let n=t.tool_input.entities;if(!Array.isArray(n))return p("allow","Creating entities (non-array input)",t),a();let o=n.length,r=n.filter(s=>!s.name||s.name===""||!s.entityType||s.entityType==="").length;if(r>0)return p("warn",`Invalid entities: ${r} missing name or entityType`,t),l("memory-validator",`WARN: ${r} entities missing required fields`),S(`${r} entities missing required fields (name, entityType)`);p("allow",`Creating ${o} valid entities`,t);break}case"mcp__memory__create_relations":{let n=t.tool_input.relations;if(!Array.isArray(n))return p("allow","Creating relations (non-array input)",t),a();let o=n.length,r=n.filter(s=>!s.from||!s.to||!s.relationType).length;if(r>0)return p("warn",`Invalid relations: ${r} missing from/to/relationType`,t),l("memory-validator",`WARN: ${r} relations missing required fields`),S(`${r} relations missing required fields`);p("allow",`Creating ${o} valid relations`,t);break}default:p("allow",`Read operation: ${e}`,t);break}return a()}import{existsSync as Xr}from"node:fs";import{extname as Qr}from"node:path";function Zr(){return new Date().toISOString().split("T")[0]}function Yr(t,e){let n=Zr();switch(t.toLowerCase()){case"py":return`# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`;case"js":case"ts":return`// Generated by OrchestKit Claude Plugin
// Created: ${n}

${e}`;case"sh":{if(e.startsWith("#!/")){let o=e.indexOf(`
`),r=e.slice(0,o),s=e.slice(o+1);return`${r}
# Generated by OrchestKit Claude Plugin
# Created: ${n}

${s}`}return`#!/bin/bash
# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`}case"sql":return`-- Generated by OrchestKit Claude Plugin
-- Created: ${n}

${e}`;case"html":case"xml":return`<!-- Generated by OrchestKit Claude Plugin - ${n} -->

${e}`;case"css":case"scss":case"sass":return`/* Generated by OrchestKit Claude Plugin - ${n} */

${e}`;case"yaml":case"yml":return`# Generated by OrchestKit Claude Plugin
# Created: ${n}

${e}`;case"json":return e;default:return e}}function ts(t,e){return E({file_path:t,content:e})}function xe(t){let e=t.tool_name||"",n=t.tool_input.file_path||"",o=t.tool_input.content||"";if(e!=="Write")return a();if(Xr(n))return a();let r=Qr(n).replace(".","");if(o.includes("OrchestKit"))return l("write-headers",`Skipping header for ${n} (already has OrchestKit marker)`),a();let s=Yr(r,o);return s!==o?(l("write-headers",`Added header to ${n}`),ts(n,s)):a()}import{existsSync as es,mkdirSync as ns}from"node:fs";import{join as be,dirname as os,basename as rs}from"node:path";function ss(t){try{es(t)||ns(t,{recursive:!0})}catch{}}function Re(t,e){try{ss(os(t)),b(t,e)}catch{}}function _e(t){let e=t.tool_input.skill||"",n=t.tool_input.args||"",o=t.project_dir||d();if(!e)return a();l("skill-tracker",`Skill invocation: ${e}${n?` (args: ${n})`:""}`);let r=be(o,".claude","logs","skill-usage.log"),s=new Date().toISOString();Re(r,`${s} | ${e} | ${n||"no args"}
`);let i=be(o,".claude","logs","skill-analytics.jsonl"),c=JSON.stringify({skill:e,args:n||"",timestamp:s,project:rs(o),phase:"start"});return Re(i,c+`
`),l("skill-tracker",`Skill usage logged for ${e}`),a()}import{existsSync as hs,readFileSync as ys,statSync as ks}from"node:fs";var $e={".ts":"typescript",".tsx":"typescript",".js":"typescript",".jsx":"typescript",".mjs":"typescript",".mts":"typescript",".py":"python",".go":"go",".rs":"rust",".sh":"shell",".bash":"shell",".md":"markdown"};function Ce(t){return t in $e}function is(t){let e=t.split(`
`),n=[],o=[],r=[],s=[],i=[];for(let c of e){let u=c.trim();if(/^import\s/.test(u)){n.push(u.replace(/;$/,""));continue}if(/^(?:export\s+)?(?:interface|type)\s+\w+/.test(u)){let f=u.match(/^(?:export\s+)?(?:interface|type)\s+(\w+[^{=]*)/);f&&s.push(f[0].replace(/\s*[{=]\s*$/,"").trim());continue}if(/^(?:export\s+)?(?:abstract\s+)?class\s+\w+/.test(u)){let f=u.match(/^(?:export\s+)?(?:abstract\s+)?class\s+\w+(?:\s+extends\s+\w+)?(?:\s+implements\s+[\w,\s]+)?/);f&&r.push(f[0].trim());continue}if(/^(?:export\s+)?(?:async\s+)?function\s+\w+/.test(u)){let f=u.match(/^(?:export\s+)?(?:async\s+)?function\s+\w+\([^)]*\)(?:\s*:\s*[^{]+)?/);f&&o.push(f[0].replace(/\s*\{?\s*$/,"").trim());continue}if(/^(?:export\s+)?const\s+\w+\s*=\s*(?:async\s+)?\(/.test(u)){let f=u.match(/^(?:export\s+)?const\s+(\w+)\s*=\s*(?:async\s+)?\([^)]*\)(?:\s*:\s*[^=]+)?(?:\s*=>)?/);f&&o.push(f[0].replace(/\s*=>\s*$/,"").trim());continue}/^export\s+(?:\{|default\s)/.test(u)&&i.push(u.replace(/;$/,""))}return{imports:n,functions:o,classes:r,types:s,exports:i,sections:[],variables:[]}}function cs(t){let e=t.split(`
`),n=[],o=[],r=[],s="";for(let i of e){let c=i.trim();if(/^(?:from\s|import\s)/.test(c)){n.push(c);continue}if(/^@\w+/.test(c)){s=c;continue}if(/^(?:async\s+)?def\s+\w+/.test(i)&&!i.startsWith(" ")&&!i.startsWith("	")){let u=i.match(/^(?:async\s+)?def\s+\w+\([^)]*\)(?:\s*->\s*[^:]+)?/);if(u){let f=s?`${s} ${u[0].trim()}`:u[0].trim();o.push(f)}s="";continue}if(/^class\s+\w+/.test(i)&&!i.startsWith(" ")&&!i.startsWith("	")){let u=i.match(/^class\s+\w+(?:\([^)]*\))?/);if(u){let f=u[0].trim();r.push(f)}s="";continue}if(/^\s+(?:async\s+)?def\s+\w+/.test(i)){let u=i.match(/^\s+(?:async\s+)?def\s+(\w+)/);u&&!u[1].startsWith("_")&&o.push(`  ${u[0].trim()}`),s="";continue}s=""}return{imports:n,functions:o,classes:r,types:[],exports:[],sections:[],variables:[]}}function as(t){let e=t.split(`
`),n=[],o=[],r=[],s=!1;for(let i of e){let c=i.trim();if(/^import\s*\(/.test(c)){s=!0;continue}if(s){c===")"?s=!1:c&&!c.startsWith("//")&&n.push(`import ${c}`);continue}if(/^import\s+"/.test(c)){n.push(c);continue}if(/^func\s/.test(c)){let u=c.match(/^func\s+(?:\([^)]+\)\s+)?\w+\([^)]*\)(?:\s*(?:\([^)]*\)|\*?\w+))?/);u&&o.push(u[0].trim());continue}if(/^type\s+\w+\s+(?:struct|interface)/.test(c)){let u=c.match(/^type\s+\w+\s+(?:struct|interface)/);u&&r.push(u[0].trim());continue}}return{imports:n,functions:o,classes:[],types:r,exports:[],sections:[],variables:[]}}function us(t){let e=t.split(`
`),n=[],o=[],r=[];for(let s of e){let i=s.trim();if(/^use\s/.test(i)){n.push(i.replace(/;$/,""));continue}if(/^(?:pub\s+)?(?:async\s+)?fn\s+\w+/.test(i)){let c=i.match(/^(?:pub\s+)?(?:async\s+)?fn\s+\w+(?:<[^>]+>)?\([^)]*\)(?:\s*->\s*[^{]+)?/);c&&o.push(c[0].replace(/\s*\{?\s*$/,"").trim());continue}if(/^(?:pub\s+)?(?:struct|enum|trait|impl)\s+\w+/.test(i)){let c=i.match(/^(?:pub\s+)?(?:struct|enum|trait|impl)\s+\w+(?:<[^>]+>)?(?:\s+for\s+\w+(?:<[^>]+>)?)?/);c&&r.push(c[0].trim());continue}}return{imports:n,functions:o,classes:[],types:r,exports:[],sections:[],variables:[]}}function ls(t){let e=t.split(`
`),n=[],o=[],r=new Set;for(let s of e){let i=s.trim();if(/^(?:function\s+)?(\w+)\s*\(\)\s*\{?/.test(i)){let c=i.match(/^(?:function\s+)?(\w+)\s*\(\)/);c&&c[1]!=="if"&&c[1]!=="while"&&c[1]!=="for"&&n.push(c[1]);continue}if(/^function\s+(\w+)\s*\{?/.test(i)){let c=i.match(/^function\s+(\w+)/);c&&n.push(c[1]);continue}if(/^[A-Z][A-Z0-9_]+=/.test(i)&&r.size<10){let c=i.match(/^([A-Z][A-Z0-9_]+)=/);c&&!r.has(c[1])&&(r.add(c[1]),o.push(c[1]))}}return{imports:[],functions:n,classes:[],types:[],exports:[],sections:[],variables:o}}function ps(t){let e=t.split(`
`),n=[];for(let o of e){let r=o.match(/^(#{1,3})\s+(.+)/);r&&n.push(`${r[1]} ${r[2].trim()}`)}return{imports:[],functions:[],classes:[],types:[],exports:[],sections:n,variables:[]}}var ms={typescript:is,python:cs,go:as,rust:us,shell:ls,markdown:ps},fs=1400;function ds(t){return{typescript:"TypeScript",python:"Python",go:"Go",rust:"Rust",shell:"Shell",markdown:"Markdown"}[t]}function w(t,e,n=""){if(e.length===0)return"";let o=`${t} (${e.length}):`,r=e.map(s=>`${n}  ${s}`).join(`
`);return`${o}
${r}`}function gs(t,e){let n="";for(let o of t){if(n.length+o.length+1>e){n+=`
  ...truncated`;break}n+=(n?`
`:"")+o}return n}function we(t,e){let n=e.lastIndexOf(".");if(n===-1)return null;let o=e.slice(n).toLowerCase(),r=$e[o];if(!r)return null;let s=ms[r],i=s(t);if(i.imports.length+i.functions.length+i.classes.length+i.types.length+i.exports.length+i.sections.length+i.variables.length===0)return null;let u=t.split(`
`).length,f=k(t),g=`[TLDR] ${e} (${u} lines, ~${f} tokens, ${ds(r)})`,x=[];i.classes.length>0&&x.push(w("Classes",i.classes)),i.types.length>0&&x.push(w("Types",i.types)),i.functions.length>0&&x.push(w("Functions",i.functions)),i.exports.length>0&&x.push(w("Exports",i.exports)),i.imports.length>0&&x.push(w("Imports",i.imports)),i.sections.length>0&&x.push(w("Sections",i.sections)),i.variables.length>0&&x.push(w("Variables",i.variables));let rt=fs-g.length-2,ze=gs(x,rt);return`${g}

${ze}`}var yt="tldr-summary",Ss=500,xs=2e3,bs=2*1024*1024;function He(t){try{let e=t.tool_input||{},n=e.file_path;if(!n)return a();if(e.offset!==void 0||e.limit!==void 0)return a();let o=n.lastIndexOf(".");if(o===-1)return a();let r=n.slice(o).toLowerCase();if(!Ce(r))return a();if(!hs(n))return a();let s=ks(n);if(s.size>bs)return l(yt,`Skipping ${n}: ${s.size} bytes > 2MB cap`),a();let i=ys(n,"utf8"),c=i.split(`
`).length,u=k(i);if(c<Ss&&u<xs)return a();let f=we(i,n);return f?(l(yt,`Injecting summary for ${n} (${c} lines, ~${u} tokens)`),m(f)):a()}catch(e){return l(yt,`Error: ${e instanceof Error?e.message:String(e)}`,"warn"),a()}}var ot=6,kt=3;function Ee(t){let e=t.tool_input||{},n=e.team_name;if(!n)return a();vt(n)&&(Pt(n),l("team-size-gate",`Auto-cleaned stale team "${n}" before TeamCreate`));let o=e.model||"",r=e.description||"",s=Tt(),i=s.length;if(l("team-size-gate",`Team "${n}": ${i} members, spawning model="${o}"`),i>=ot)return l("team-size-gate",`BLOCKED: Team size limit (${i} >= ${ot})`),h(`Team Size Limit

Team "${n}" has ${i} members (max ${ot}).

Wait for existing teammates to complete before spawning more.

Attempted: ${r}`);if(o==="opus"){let c=s.filter(u=>u.agentType.toLowerCase().includes("opus")).length;if(c>=kt)return l("team-size-gate",`BLOCKED: Opus limit (${c} >= ${kt})`),h(`Opus Model Limit

Team "${n}" already has ${c} Opus members (max ${kt}).

Use a lighter model (sonnet/haiku) or wait for Opus teammates to finish.

Attempted: ${r}`)}return l("team-size-gate",`Team spawn allowed: ${i+1}/${ot}`),a()}var H="pretool-bash-dispatcher",Ie=800,Rs=[{name:"error-pattern-warner",fn:U},{name:"issue-docs-requirement",fn:V},{name:"multi-instance-quality-gate",fn:J},{name:"gh-issue-creation-guide",fn:K},{name:"license-compliance",fn:q},{name:"affected-tests-finder",fn:z}];function ve(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function Pe(t){let e;try{let n=G(t);n.hookSpecificOutput?.updatedInput&&(e=n.hookSpecificOutput.updatedInput)}catch(n){let o=n instanceof Error?n.message:String(n);l(H,`default-timeout-setter failed: ${o}`,"warn")}try{let n=Z(t);if(!n.continue)return n;let o=ve(n);if(o)return Te(t,e,o)}catch(n){let o=n instanceof Error?n.message:String(n);l(H,`agent-browser-safety failed: ${o}`,"warn")}return Te(t,e,null)}function Te(t,e,n){let o=[],r=0;if(n){let s=k(n);o.push(n),r+=s}for(let s of Rs)try{let i=s.fn(t),c=ve(i);if(!c)continue;let u=k(c);if(r+u>Ie){l(H,`Budget limit: skipping ${s.name} (${u}t would exceed ${Ie}t cap)`);continue}o.push(c),r+=u,l(H,`${s.name}: +${u}t (total: ${r}t)`)}catch(i){let c=i instanceof Error?i.message:String(i);l(H,`${s.name} failed: ${c}`,"warn")}if(e&&o.length>0){let s=o.join(`

---

`);return l(H,`Consolidated ${o.length} hooks into ${r}t + input mod`),{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:e,additionalContext:s}}}if(e)return E(e);if(o.length>0){let s=o.join(`

---

`);return l(H,`Consolidated ${o.length} hooks into ${r}t`),m(s)}return a()}var D="pretool-write-edit-dispatcher",De=800,_s=[{name:"architecture-change-detector",fn:Y},{name:"docstring-enforcer",fn:et},{name:"code-quality-gate",fn:tt}];function Oe(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function je(t){try{let e=nt(t);if(!e.continue)return e;let n=Oe(e);if(n)return Ae(t,n)}catch(e){let n=e instanceof Error?e.message:String(e);l(D,`security-pattern-validator failed: ${n}`,"warn")}return Ae(t,null)}function Ae(t,e){let n=[],o=0;if(e){let s=k(e);n.push(e),o+=s}for(let s of _s)try{let i=s.fn(t),c=Oe(i);if(!c)continue;let u=k(c);if(o+u>De){l(D,`Budget limit: skipping ${s.name} (${u}t would exceed ${De}t cap)`);continue}n.push(c),o+=u,l(D,`${s.name}: +${u}t (total: ${o}t)`)}catch(i){let c=i instanceof Error?i.message:String(i);l(D,`${s.name} failed: ${c}`,"warn")}if(n.length===0)return a();let r=n.join(`

---

`);return l(D,`Consolidated ${n.length} hooks into ${o}t`),m(r)}function Le(t){let e=t.tool_name,n=process.env.CLAUDE_AGENT_ID||"unknown";return["Write","Edit","MultiEdit","NotebookEdit"].includes(e)?h(`BLOCKED: Agent '${n}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`):a()}var $s=[/DROP\s+TABLE/i,/DROP\s+DATABASE/i,/TRUNCATE/i,/DELETE\s+FROM.*WHERE\s+1/i,/DELETE\s+FROM\s+[^W]*$/i,/--force/i,/alembic\s+downgrade/i];function Ne(t){if(t.tool_name!=="Bash")return a();let n=t.tool_input.command||"";for(let o of $s)if(o.test(n))return h(`BLOCKED: Potentially destructive database command detected. Pattern: '${o.source}'. Please confirm this operation is intentional before proceeding.`);return a()}import{mkdirSync as Cs}from"node:fs";function Me(t){let e=process.env.CLAUDE_AGENT_ID||"unknown",n=t.tool_name,o=t.session_id||P(),r=t.project_dir||d(),s=`${r}/.claude/logs/security-audit.log`;if(n!=="Bash")return a();let i=t.tool_input.command||"",c=new Date().toISOString();if(i)try{Cs(`${r}/.claude/logs`,{recursive:!0}),b(s,`[${c}] [${o}] [${e}] CMD: ${i}
`)}catch{}return a()}var ws=[/force.*push/i,/push.*--force/i,/--force-with-lease/i,/workflow_dispatch/i,/delete.*workflow/i,/gh\s+secret\s+delete/i,/gh\s+variable\s+delete/i,/rm.*-rf.*\.github/i];function Fe(t){let e=t.tool_input.command||"";for(let n of ws)if(n.test(e))return h(`BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${n.source}'. This requires explicit user approval.`);return/deploy|release|publish/i.test(e)?y("CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place."):a()}var Hs=[/\bprod\b/i,/production/i,/--env.*prod/i,/ENV=prod/i,/ENVIRONMENT=prod/i,/deploy.*main/i,/deploy.*master/i];function Be(t){let e=t.tool_input.command||"";for(let n of Hs)if(n.test(e))return h(`BLOCKED: Production deployment detected. Pattern: '${n.source}'. Production deployments require explicit user approval and should go through proper release processes.`);return/rollback|revert|downgrade/i.test(e)?y("Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed."):/terraform|kubectl|helm|docker.*push/i.test(e)?y("Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment."):a()}var A="pretool-task-dispatcher",We=800,Es=[{name:"block-writes",fn:Le,canBlock:!0},{name:"migration-safety-check",fn:Ne,canBlock:!0},{name:"ci-safety-check",fn:Fe,canBlock:!0},{name:"deployment-safety-check",fn:Be,canBlock:!0},{name:"security-command-audit",fn:Me,canBlock:!1}];function Is(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function Ge(t){let e=[],n=0;for(let r of Es)try{let s=r.fn(t);if(!s.continue)return l(A,`${r.name} blocked operation`),s;let i=Is(s);if(!i)continue;let c=k(i);if(n+c>We){l(A,`Budget limit: skipping ${r.name} (${c}t would exceed ${We}t cap)`);continue}e.push(i),n+=c,l(A,`${r.name}: +${c}t (total: ${n}t)`)}catch(s){let i=s instanceof Error?s.message:String(s);l(A,`${r.name} failed: ${i}`,"warn")}if(e.length===0)return a();let o=e.join(`

---

`);return l(A,`Consolidated ${e.length} hooks into ${n}t`),m(o)}var Ue={"pretool/bash/dangerous-command-blocker":jt,"pretool/bash/git-validator":Nt,"pretool/bash/compound-command-validator":Mt,"pretool/bash/default-timeout-setter":G,"pretool/bash/error-pattern-warner":U,"pretool/bash/conflict-predictor":Wt,"pretool/bash/affected-tests-finder":z,"pretool/bash/ci-simulation":Gt,"pretool/bash/pre-commit-simulation":Ut,"pretool/bash/pr-merge-gate":zt,"pretool/bash/changelog-generator":qt,"pretool/bash/version-sync":Xt,"pretool/bash/license-compliance":q,"pretool/bash/gh-issue-creation-guide":K,"pretool/bash/issue-docs-requirement":V,"pretool/bash/multi-instance-quality-gate":J,"pretool/bash/agent-browser-safety":Z,"pretool/bash/commit-atomicity-checker":le,"pretool/bash/issue-reference-checker":pe,"pretool/write-edit/file-guard":fe,"pretool/Write/architecture-change-detector":Y,"pretool/Write/code-quality-gate":tt,"pretool/Write/docstring-enforcer":et,"pretool/Write/security-pattern-validator":nt,"pretool/mcp/context7-tracker":ke,"pretool/mcp/memory-validator":Se,"pretool/input-mod/write-headers":xe,"pretool/skill/skill-tracker":_e,"pretool/read/tldr-summary":He,"pretool/task/team-size-gate":Ee,"pretool/bash/unified-advisory-dispatcher":Pe,"pretool/write-edit/unified-quality-dispatcher":je,"pretool/task/unified-agent-safety-dispatcher":Ge};function nl(t){return Ue[t]}function ol(){return Object.keys(Ue)}export{Et as analyzeStagedChanges,Ci as createGuard,li as escapeRegex,k as estimateTokenCount,Tn as extractIssueNumber,L as getCachedBranch,En as getCurrentBranch,yi as getDefaultBranch,ti as getEnvFile,ui as getField,In as getGitStatus,nl as getHook,_ as getLogDir,_n as getLogLevel,Rn as getPluginRoot,d as getProjectDir,di as getRepoRoot,P as getSessionId,vn as getStagedFiles,Ti as guardBash,I as guardCodeFiles,lt as guardFileExtension,Pi as guardGitCommand,Di as guardMultiInstance,vi as guardNontrivialBash,Dt as guardPathPattern,wi as guardPythonFiles,W as guardSkipInternal,Ei as guardTestFiles,At as guardTool,Hi as guardTypescriptFiles,Ii as guardWriteEdit,hi as hasUncommittedChanges,Ue as hooks,vs as isBashInput,v as isDontAskMode,Ds as isEditInput,gi as isGitRepo,ut as isProtectedBranch,As as isReadInput,Ps as isWriteInput,ol as listHooks,l as logHook,p as logPermissionFeedback,N as normalizeCommand,ei as normalizeLineEndings,m as outputAllowWithContext,oi as outputBlock,h as outputDeny,si as outputError,Cn as outputPromptContext,ci as outputPromptContextBudgeted,ni as outputSilentAllow,a as outputSilentSuccess,ii as outputStderrWarning,S as outputWarning,y as outputWithContext,ri as outputWithNotification,E as outputWithUpdatedInput,ai as readHookInput,T as runGuards,$n as shouldLog,It as validateBranchName};
//# sourceMappingURL=pretool.mjs.map
