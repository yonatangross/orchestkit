// OrchestKit Hooks - pretool bundle
// Generated: 2026-02-12T11:17:24.979Z

var Ae=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Qr(t){return typeof t.command=="string"}function Zr(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function Xr(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Yr(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as St,existsSync as xt,statSync as eo,renameSync as oo,mkdirSync as no,readSync as ro}from"node:fs";import{execSync as so}from"node:child_process";import je from"node:os";import O from"node:path";function Le(){return process.env.HOME||process.env.USERPROFILE||je.homedir()}function ot(){return process.env.CLAUDE_PROJECT_DIR||"."}function dt(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function gt(){return process.env.CLAUDE_PLUGIN_ROOT?O.join(Le(),".claude","logs","ork"):O.join(ot(),".claude","logs")}var ns=O.join,rs=O.sep;import{execSync as Ne}from"node:child_process";import{createHash as Me}from"node:crypto";import{existsSync as ht,readFileSync as Fe,writeFileSync as Be,mkdirSync as Ge}from"node:fs";import{join as nt,basename as Ue}from"node:path";var We=20,qe=15,ze=/[^a-z0-9-]/g;function Ke(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=Ue(e);return yt(o,We)}function Ve(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let o=Ne("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),n=yt(o||"detached",qe);return process.env.ORCHESTKIT_SESSION_BRANCH=n,n}catch{return"nobranch"}}function Je(t){let e=t||new Date,o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${o}${n}`}function Qe(t){let e=t||new Date,o=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${o}${n}`}function Ze(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return Me("sha256").update(t).digest("hex").slice(0,4)}function yt(t,e){return t.toLowerCase().replace(ze,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function Xe(t,e){let o=Ke(t),n=Ve(t),s=Je(e),r=Qe(e),i=Ze();return`${o}-${n}-${s}-${r}-${i}`}function Ye(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=nt(e,".instance","session-id.json");if(ht(o))try{let n=JSON.parse(Fe(o,"utf8"));if(n.session_id&&n.created_at){let s=Date.now()-new Date(n.created_at).getTime(),r=1440*60*1e3;if(s<r)return n.session_id}}catch{}}function to(t,e){let o=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=nt(o,".instance"),s=nt(n,"session-id.json");try{ht(n)||Ge(n,{recursive:!0}),Be(s,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function kt(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=Ye(t);if(e)return e;let o=Xe(t);return to(o,t),o}function b(){return gt()}function f(){return ot()}function io(){return dt()}function gs(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${io()}/.claude/.instance_env`}function v(){return kt()}function Rt(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=so("git branch --show-current",{cwd:t||f(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function co(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function hs(t){return t.replace(/\r\n/g,`
`)}function ao(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(co())}function a(){return{continue:!0,suppressOutput:!0}}function ys(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function ks(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function h(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function uo(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function Ss(t,e){let o={continue:!0,suppressOutput:!0};return t&&(o.systemMessage=t),e&&(o.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),o}function m(t,e){let o={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?o.systemMessage=e:o.suppressOutput=!0,o}function xs(t){return{continue:!0,systemMessage:t}}function S(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function Rs(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function g(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function C(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var lo=200*1024,po=100*1024;function bt(t,e){if(xt(t))try{if(eo(t).size>e){let n=`${t}.old.${Date.now()}`;oo(t,n)}}catch{}}function $t(t){xt(t)||no(t,{recursive:!0})}function u(t,e,o="debug"){if(!ao(o))return;let n=b(),s=`${n}/hooks.log`;try{$t(n),bt(s,lo);let r=new Date().toISOString().replace("T"," ").slice(0,19);St(s,`[${r}] [${o.toUpperCase()}] [${t}] ${e}
`)}catch{}}function p(t,e,o){let n=b(),s=`${n}/permission-feedback.log`;try{$t(n),bt(s,po);let r=new Date().toISOString(),i=o?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",c=o?.session_id||v();St(s,`${r} | ${t} | ${e} | tool=${i} | session=${c}
`)}catch{}}function y(t){if(!t)return 0;let n=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/n)}function bs(t,e,o,n,s){let r=y(t);return n&&n.isOverBudget(o)?(u(e,`Budget exhausted for ${o}, suppressing ${r}t`),a()):(s&&s.trackTokenUsage(e,o,r),uo(t))}function $s(){try{let t=[],o=Buffer.allocUnsafe(256),n,s=0;for(;;)try{if(n=ro(s,o,0,256,null),n===0)break;t.push(Buffer.from(o.subarray(0,n)))}catch{break}let r=Buffer.concat(t).toString("utf8").trim();return r?JSON.parse(r):{tool_name:"",session_id:v(),tool_input:{}}}catch{return{tool_name:"",session_id:v(),tool_input:{}}}}function _s(t,e){let o=e.replace(/^\./,"").split("."),n=t;for(let s of o){if(n==null)return;n=n[s]}return n}function A(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function ws(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as H}from"node:child_process";function mo(t){let e=t||f();try{return H("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function rt(t){let e=t||mo();return["dev","main","master"].includes(e)}function Es(t){let e=t||f();try{return H("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function Ts(t){let e=t||f();try{return H("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function st(t){let e=t||f();try{return H("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function vs(t){return st(t).length>0}function Ps(t){let e=t||f();try{return H("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return H("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function fo(t){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let o of e){let n=t.match(o);if(n)return parseInt(n[1],10)}return null}function _t(t){if(rt(t))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(n=>t.startsWith(n))?t.startsWith("issue/")&&!fo(t)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}import{existsSync as j,readFileSync as go,readdirSync as As,statSync as ho,rmSync as yo}from"node:fs";import{join as L}from"node:path";function N(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function ko(){return process.env.CLAUDE_CODE_TEAM_NAME||null}function wt(){let t=ko();if(!t)return[];let e=process.env.HOME||process.env.USERPROFILE||"";if(!e)return[];let o=L(e,".claude","teams",t,"config.json");if(!j(o))return[];try{let s=JSON.parse(go(o,"utf-8")).members;return Array.isArray(s)?s.map(r=>({name:r.name||"unknown",agentType:r.agentType||"unknown"})):[]}catch{return[]}}function Ct(t,e=4){let o=process.env.HOME||process.env.USERPROFILE||"";if(!o)return!1;let n=L(o,".claude","teams",t);if(!j(n))return!1;let s=L(n,"config.json");if(!j(s))return!0;try{return Date.now()-ho(n).mtimeMs>e*36e5}catch{return!0}}function Ht(t){let e=process.env.HOME||process.env.USERPROFILE||"";if(!e)return!1;let o=!0;for(let n of["teams","tasks"]){let s=L(e,".claude",n,t);if(j(s))try{yo(s,{recursive:!0,force:!0})}catch{o=!1}}return o}function Fs(t){return e=>t(e)?null:a()}function it(t,...e){let o=t.tool_input.file_path;if(!o)return a();let n=o.split(".").pop()?.toLowerCase()||"";return e.map(r=>r.toLowerCase().replace(/^\./,"")).includes(n)?null:a()}function I(t){return it(t,"py","ts","tsx","js","jsx","go","rs","java")}function Bs(t){return it(t,"py")}function Gs(t){return it(t,"ts","tsx","js","jsx")}function Us(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(n=>n.test(e))?null:a():a()}function M(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(n=>n.test(e))?a():null}function It(t,...e){let o=t.tool_input.file_path;if(!o)return a();for(let n of e)if(typeof n=="string"){if(new RegExp(n.replace(/\*/g,".*").replace(/\?/g,".")).test(o))return null}else if(n.test(o))return null;return a()}function Et(t,...e){let o=t.tool_name;return o?e.includes(o)?null:a():a()}function Ws(t){return Et(t,"Write","Edit")}function qs(t){return Et(t,"Bash")}function zs(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(n=>n.test(e))?a():null}function Ks(t){return(t.tool_input.command||"").startsWith("git")?null:a()}function Vs(t){if(N())return a();let o=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:n}=Ae("node:fs");if(n(o))return null}catch{}return a()}function E(t,...e){for(let o of e){let n=o(t);if(n!==null)return n}return null}function T(t){return t.permissionMode==="dontAsk"}var So=["rm -rf /","rm -rf ~","rm -fr /","rm -fr ~","mv /* /dev/null","> /dev/sda","mkfs.","dd if=/dev/zero of=/dev/","dd if=/dev/random of=/dev/","chmod -R 777 /",":(){:|:&};:","git reset --hard","git clean -fd","drop database","drop schema","truncate table"],xo=/\|\s*(sh|bash|zsh|dash)\b/i,Ro=/git\s+push\s+.*(-f|--force)\b/i;function Tt(t){let e=t.tool_input.command||"";if(!e)return a();let o=A(e).toLowerCase();for(let n of So)if(o.includes(n.toLowerCase()))return u("dangerous-command-blocker",`BLOCKED: Dangerous pattern: ${n}`),p("deny",`Dangerous pattern: ${n}`,t),g(`Command matches dangerous pattern: ${n}

This command could cause severe system damage and has been blocked.`);if(xo.test(o)){let n="Piping to shell interpreter detected";return u("dangerous-command-blocker",`BLOCKED: ${n}`),p("deny",n,t),g(`${n}

Piping untrusted content to a shell interpreter is dangerous and has been blocked.`)}if(Ro.test(o)){let n="Git force-push detected (rewrites remote history)";return u("dangerous-command-blocker",`BLOCKED: ${n}`),p("deny",n,t),g(`${n}

Force-pushing can destroy remote commit history and has been blocked.`)}return a()}var ct=["feat","fix","refactor","docs","test","chore","style","perf","ci","build"],bo=10;function $o(t){let e=t.match(/-m\s+["']([^"']+)["']/);if(e)return e[1];let o=t.match(/-m\s+(\S+)/);return o?o[1]:null}function _o(t){let e=t.match(/checkout\s+-b\s+(\S+)/);if(e)return e[1];let o=t.match(/git\s+branch\s+(\S+)/);return o?o[1]:null}function wo(t,e){if(!rt(e))return null;if(/git\s+(commit|push)/.test(t)){let o=`BLOCKED: Cannot commit or push directly to '${e}' branch.

Required workflow:
1. git checkout -b issue/<number>-<description>
2. git commit -m "feat(#<number>): Description"
3. git push -u origin issue/<number>-<description>
4. gh pr create --base dev`;return p("deny",`Blocked on protected branch: ${e}`),g(o)}return h(`On protected branch '${e}'. Create feature branch for changes.`)}function Co(t){if(!/git\s+(checkout\s+-b|branch\s+)/.test(t))return null;let e=_o(t);if(!e)return null;let o=_t(e);if(o){let n=`Branch naming: ${o}

Recommended: issue/123-description, feature/xyz, fix/bug-name`;return p("allow",`Branch naming guidance: ${e}`),m(n)}return null}function Ho(t){if(!/^git\s+commit/.test(t))return null;if(/<<['"]?EOF/.test(t))return m(`Heredoc commit. Use: type(#issue): description
Types: ${ct.join(", ")}
End with: Co-Authored-By: Claude <noreply@anthropic.com>`);let e=$o(t);if(!e)return m("Interactive commit. Use: type(#issue): description");let o=ct.join("|"),n=new RegExp(`^(${o})(\\(#?[0-9]+\\)|(\\([a-z-]+\\)))?: .+`),s=new RegExp(`^(${o}): .+`);if(n.test(e)||s.test(e)){let i=e.split(`
`)[0].length;return i>72?m(`Commit title is ${i} chars (max 72 recommended)`):null}let r=`INVALID COMMIT FORMAT: "${e}"

Required: type(#issue): description
Types: ${ct.join(", ")}
Example: feat(#123): Add user authentication`;return p("deny",`Invalid commit: ${e}`),g(r)}function Io(t,e){if(!/^git\s+commit/.test(t))return null;let n=st(e).split(`
`).filter(s=>s.trim()).length;return n>bo?m(`Large commit: ${n} files. Consider splitting into smaller commits.`):null}function vt(t){let e=t.tool_input.command||"";if(!e.startsWith("git"))return a();let o=Rt(t.project_dir);u("git-validator",`Validating: ${e.slice(0,50)}...`);let n=wo(e,o);if(n?.continue===!1)return n;let s=Ho(e);if(s?.continue===!1)return s;let r=Co(e),i=Io(e,t.project_dir),c=[];return n?.hookSpecificOutput?.additionalContext&&c.push(n.hookSpecificOutput.additionalContext),s?.hookSpecificOutput?.additionalContext&&c.push(s.hookSpecificOutput.additionalContext),r?.hookSpecificOutput?.additionalContext&&c.push(r.hookSpecificOutput.additionalContext),i?.hookSpecificOutput?.additionalContext&&c.push(i.hookSpecificOutput.additionalContext),c.length>0?h(c.join(`

`)):a()}var Eo=["rm -rf /","rm -rf ~","rm -fr /","rm -fr ~","mkfs","dd if=/dev","> /dev/sd","chmod -R 777 /"];function To(t){let e=t.trim();if(!e)return!0;for(let o of Eo)if(e.includes(o))return!1;return!0}function vo(t){if(/curl.*\|.*(sh|bash)/.test(t)||/wget.*\|.*(sh|bash)/.test(t))return"pipe-to-shell execution (curl/wget piped to sh/bash)";if(!t.includes("&&")&&!t.includes("||")&&!t.includes("|")&&!t.includes(";"))return null;let e=t.split(/&&|\|\||[|;]/);for(let o of e)if(!To(o))return o.trim();return null}function Pt(t){let e=t.tool_input.command||"";if(!e)return a();let o=A(e),n=vo(o);if(n){let s=`BLOCKED: Dangerous compound command detected.

Blocked segment: ${n}

The command contains a potentially destructive operation.

Please review and modify your command to remove the dangerous operation.`;return p("deny",`Dangerous compound command: ${n}`,t),u("compound-command-validator",`BLOCKED: ${n}`),g(s)}return p("allow","Compound command validated: safe",t),a()}var Dt=12e4;function F(t){let e=t.tool_input.command||"",o=t.tool_input.timeout,n=t.tool_input.description;if(typeof o=="number"&&o>0)return{continue:!0,suppressOutput:!0};let s={command:e,timeout:Dt};return n&&typeof n=="string"&&(s.description=n),u("default-timeout-setter",`Setting default timeout: ${Dt}ms`),C(s)}import{existsSync as Po,readFileSync as Do}from"node:fs";import{join as Oo}from"node:path";function Ao(t){let e=Oo(t,".claude","rules","error_rules.json");try{if(Po(e))return JSON.parse(Do(e,"utf8")).rules||[]}catch{}return[]}function jo(t,e){let o=new Set(t.toLowerCase().split(/\s+/)),n=new Set(e.toLowerCase().split(/\s+/)),s=0;for(let r of o)n.has(r)&&r.length>2&&s++;return s}function B(t){let e=f(),o=t.tool_input.command||"";if(!o)return a();let n=Ao(e);if(n.length===0)return a();let s=[];/psql.*-U\s+(postgres|orchestkit|root)/.test(o)&&n.filter(i=>i.tool==="Bash"&&i.signature?.includes("role")).length>0&&s.push("DB role error: use docker exec -it <container> psql -U orchestkit_user"),o.includes("mcp__postgres")&&n.filter(i=>i.tool?.includes("postgres-mcp")).length>0&&s.push("MCP postgres: verify connection to correct database");for(let r of n){if(!r.pattern||(r.occurrence_count||0)<5)continue;let i=r.sample_input?.command;i&&jo(o,i)>3&&(u("error-pattern-warner",`Pattern match: ${r.signature}`),r.suggested_fix?s.push(`${r.signature} (${r.occurrence_count}x): ${r.suggested_fix}`):s.push(`${r.signature} (${r.occurrence_count}x)`))}if(s.length>0){let r="Learned error patterns | "+s.join(" | ");return r.length>200&&(r=r.slice(0,197)+"..."),h(r)}return a()}import{execSync as Ot}from"node:child_process";function Lo(t,e){try{let n=Ot(`git diff --name-only ${e}...HEAD 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim().split(`
`).filter(Boolean),s=[];for(let r of n.slice(0,20))try{Ot(`git log -1 --pretty=format:"%h" ${e} -- "${r}" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()&&s.push(r)}catch{}return s}catch{return[]}}function At(t){let e=t.tool_input.command||"",o=f();if(!/git\s+(merge|rebase|pull)/.test(e))return a();let n=null,s=e.match(/git\s+(merge|rebase)\s+(\S+)/);if(s&&(n=s[2]),e.includes("git pull")&&(n="origin/dev"),!n)return a();let r=Lo(o,n);if(r.length>0){let i=`Potential conflicts detected: ${r.length} file(s)
Files: ${r.slice(0,5).join(", ")}${r.length>5?"...":""}

Consider:
1. Review changes in these files before merging
2. Run: git diff ${n}...HEAD -- <file>
3. Prepare conflict resolution strategy`;return p("allow",`Conflict prediction: ${r.length} files`,t),u("conflict-predictor",`Potential conflicts: ${r.join(", ")}`),m(i)}return p("allow","No conflicts predicted",t),a()}import{execSync as No}from"node:child_process";import{existsSync as Mo}from"node:fs";import{join as Fo,basename as Bo,dirname as Go}from"node:path";function Uo(t,e){let o=[],n=Bo(e).replace(/\.(ts|tsx|js|jsx|py)$/,""),s=Go(e),r=[`${s}/${n}.test.ts`,`${s}/${n}.test.tsx`,`${s}/${n}.spec.ts`,`${s}/${n}.spec.tsx`,`${s}/__tests__/${n}.test.ts`,`${s}/__tests__/${n}.test.tsx`,`tests/${e.replace(/\.(ts|tsx|js|jsx)$/,".test.ts")}`,`test_${n}.py`,`tests/test_${n}.py`];for(let i of r){let c=Fo(t,i);Mo(c)&&o.push(i)}return o}function Wo(t){try{return No('git status --short 2>/dev/null || echo ""',{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(o=>o.trim()).map(o=>o.slice(3).trim()).filter(o=>/\.(ts|tsx|js|jsx|py)$/.test(o))}catch{return[]}}function G(t){let e=t.tool_input.command||"",o=f();if(!/git\s+push|npm\s+run\s+test|pytest/.test(e))return a();if(/npm\s+run\s+test|pytest/.test(e))return a();let n=Wo(o);if(n.length===0)return a();let s=[];for(let i of n.slice(0,10)){let c=Uo(o,i);s.push(...c)}let r=[...new Set(s)];if(r.length>0){let i=`Related tests for changed files:
${r.slice(0,5).join(`
`)}${r.length>5?`
...`:""}

Consider running: npm run test -- ${r[0]}`;return p("allow",`Found ${r.length} related tests`,t),u("affected-tests-finder",`Tests: ${r.join(", ")}`),m(i)}return a()}import{existsSync as at}from"node:fs";import{join as ut}from"node:path";function qo(t){let e=[];return at(ut(t,"package.json"))&&(e.push("npm run lint"),e.push("npm run typecheck"),e.push("npm run test")),at(ut(t,"pyproject.toml"))&&(e.push("ruff check ."),e.push("mypy ."),e.push("pytest")),at(ut(t,"go.mod"))&&(e.push("go vet ./..."),e.push("go test ./...")),e}function jt(t){let e=t.tool_input.command||"",o=f();if(!/git\s+push/.test(e))return a();let n=qo(o);if(n.length===0)return a();let s=`Pre-push CI simulation suggested:
${n.slice(0,3).join(`
`)}

Run these locally to catch issues before CI fails.
Or: git push --no-verify to skip (not recommended)`;return p("allow","CI simulation suggested",t),u("ci-simulation",`Suggested checks: ${n.join(", ")}`),m(s)}import{existsSync as lt}from"node:fs";import{join as pt}from"node:path";function zo(t){return lt(pt(t,".pre-commit-config.yaml"))||lt(pt(t,".pre-commit-config.yml"))}function Ko(t){return lt(pt(t,".husky"))}function Lt(t){let e=t.tool_input.command||"",o=f();if(!/git\s+commit/.test(e))return a();if(/--no-verify/.test(e)){let n=`WARNING: --no-verify will skip pre-commit hooks.
Consider removing it unless intentional.
Skipped checks may cause CI failures.`;return p("allow","Skip pre-commit detected",t),u("pre-commit-simulation","--no-verify used"),m(n)}if(zo(o)){let n=`Pre-commit hooks will run: .pre-commit-config.yaml
If hooks fail, fix issues and retry.
Run manually: pre-commit run --all-files`;return p("allow","pre-commit config found",t),m(n)}if(Ko(o)){let n=`Husky hooks will run: .husky/
If hooks fail, fix issues and retry.`;return p("allow","husky config found",t),m(n)}return a()}import{execSync as Vo}from"node:child_process";function Jo(t,e){try{let o=e?`${e}`:"",n=Vo(`gh pr view ${o} --json number,state,mergeable,statusCheckRollup,reviewDecision 2>/dev/null`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]});return JSON.parse(n)}catch{return null}}function Nt(t){let e=t.tool_input.command||"",o=f();if(!/gh\s+pr\s+merge/.test(e))return a();let n=e.match(/gh\s+pr\s+merge\s+(\d+)/),s=n?parseInt(n[1],10):void 0,r=Jo(o,s);if(!r){let c=`Could not fetch PR status. Ensure:
1. gh CLI is installed and authenticated
2. You're in a git repository
3. PR exists and is accessible`;return p("allow","PR status unavailable",t),m(c)}let i=[];if(r.state!=="OPEN"&&i.push(`PR state: ${r.state} (expected OPEN)`),r.mergeable||i.push("PR has merge conflicts"),r.statusCheckRollup!=="SUCCESS"&&r.statusCheckRollup!=="PENDING"&&i.push(`Status checks: ${r.statusCheckRollup}`),r.reviewDecision==="CHANGES_REQUESTED"&&i.push("Changes requested by reviewer"),i.length>0){let c=`PR #${r.number} has issues:
${i.join(`
`)}

Resolve these before merging.`;return p("allow",`PR issues: ${i.join(", ")}`,t),u("pr-merge-gate",`PR #${r.number} has ${i.length} issues`),m(c)}return p("allow",`PR #${r.number} ready to merge`,t),a()}import{execSync as Qo}from"node:child_process";function Zo(t,e){try{let o=e?`--since="${e}"`:"--max-count=20";return Qo(`git log ${o} --pretty=format:"%s" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(Boolean)}catch{return[]}}function Xo(t){let e={feat:[],fix:[],refactor:[],docs:[],test:[],chore:[],other:[]};for(let o of t){let n=o.match(/^(feat|fix|refactor|docs|test|chore|perf|ci|build)/);if(n){let s=n[1]==="perf"||n[1]==="ci"||n[1]==="build"?"chore":n[1];e[s].push(o)}else e.other.push(o)}return e}function Mt(t){let e=t.tool_input.command||"",o=f();if(!/npm\s+version|poetry\s+version|changelog/.test(e))return a();let n=Zo(o);if(n.length===0)return a();let s=Xo(n),r=[];if(s.feat.length>0&&r.push(`### Features
${s.feat.slice(0,5).map(c=>`- ${c}`).join(`
`)}`),s.fix.length>0&&r.push(`### Bug Fixes
${s.fix.slice(0,5).map(c=>`- ${c}`).join(`
`)}`),s.refactor.length>0||s.chore.length>0){let c=[...s.refactor,...s.chore];r.push(`### Maintenance
${c.slice(0,3).map(l=>`- ${l}`).join(`
`)}`)}if(r.length===0)return a();let i=`Suggested changelog entries:

${r.join(`

`)}

Update CHANGELOG.md before releasing.`;return p("allow","Changelog suggestions generated",t),u("changelog-generator",`Generated ${r.length} sections`),m(i)}import{existsSync as Ft,readFileSync as Bt}from"node:fs";import{join as Gt}from"node:path";function Yo(t){let e=Gt(t,"package.json");try{if(Ft(e))return JSON.parse(Bt(e,"utf8")).version||null}catch{}return null}function tn(t){let e=Gt(t,"pyproject.toml");try{if(Ft(e)){let n=Bt(e,"utf8").match(/version\s*=\s*["']([^"']+)["']/);return n?n[1]:null}}catch{}return null}function en(t){let e=[],o=Yo(t);o&&e.push({file:"package.json",version:o});let n=tn(t);return n&&e.push({file:"pyproject.toml",version:n}),e}function Ut(t){let e=t.tool_input.command||"",o=f();if(!/npm\s+version|poetry\s+version/.test(e))return a();let n=en(o);if(n.length<2)return a();let s=n.map(i=>i.version),r=[...new Set(s)];if(r.length>1){let i=`Version mismatch detected:
${n.map(c=>`${c.file}: ${c.version}`).join(`
`)}

Consider syncing versions across all files.`;return p("allow","Version mismatch detected",t),u("version-sync",`Versions: ${s.join(", ")}`),m(i)}return p("allow",`Versions in sync: ${r[0]}`,t),a()}import{existsSync as on,readFileSync as nn}from"node:fs";import{join as rn}from"node:path";var sn=["GPL","AGPL","LGPL","CC-BY-NC","SSPL"];function cn(t){let e=[],o=rn(t,"package-lock.json");try{if(on(o)){let n=nn(o,"utf8");for(let s of sn)n.includes(`"license": "${s}`)&&e.push(`Found ${s} license in npm dependencies`)}}catch{}return e}function U(t){let e=t.tool_input.command||"",o=f();if(!/npm\s+install|yarn\s+add|pip\s+install|poetry\s+add/.test(e))return a();if(/npm\s+ci|npm\s+install\s*$/.test(e))return a();let n=e.match(/(?:npm\s+install|yarn\s+add|pip\s+install|poetry\s+add)\s+(\S+)/),s=n?n[1]:null;if(!s)return a();let r=cn(o);if(r.length>0){let c=`License compliance check:
${r.join(`
`)}

New dependency: ${s}
Consider checking its license before adding.

Use: npm view ${s} license`;return p("allow","License compliance warning",t),u("license-compliance",`Checking: ${s}`),m(c)}let i=`Installing: ${s}
Verify license compatibility before production use.
Check: npm view ${s} license`;return p("allow",`Installing package: ${s}`,t),m(i)}var Wt={bug:`## Description
<!-- Clear description of the bug -->

## Steps to Reproduce
1.
2.
3.

## Expected Behavior
<!-- What should happen -->

## Actual Behavior
<!-- What actually happens -->

## Environment
- OS:
- Version:`,feature:`## Description
<!-- Clear description of the feature -->

## Motivation
<!-- Why is this feature needed? -->

## Proposed Solution
<!-- How should this be implemented? -->

## Alternatives Considered
<!-- Other approaches considered -->`,chore:`## Description
<!-- What maintenance task needs to be done? -->

## Impact
<!-- What does this affect? -->

## Checklist
- [ ] Task 1
- [ ] Task 2`};function an(t){return/--label.*bug|bug\s+report/i.test(t)?"bug":/--label.*feature|feature\s+request/i.test(t)?"feature":/--label.*chore|maintenance/i.test(t)?"chore":null}function W(t){let e=t.tool_input.command||"";if(!/gh\s+issue\s+create/.test(e))return a();if(/--body|--body-file|-b\s/.test(e))return a();let o=an(e);if(o&&Wt[o]){let s=`Issue type detected: ${o}

Suggested template:
${Wt[o].slice(0,200)}...

Add --body with template or use --web for interactive creation.`;return p("allow",`Issue creation: ${o}`,t),u("gh-issue-creation-guide",`Type: ${o}`),m(s)}let n=`Creating GitHub issue. Consider:
- Clear, descriptive title
- Add appropriate labels (bug, feature, chore)
- Include reproduction steps for bugs
- Reference related issues/PRs

Use --web for interactive creation with templates.`;return p("allow","Issue creation guidance",t),m(n)}var un=`Documentation checklist for features:
- [ ] Update README.md if public API changes
- [ ] Add/update JSDoc or docstrings
- [ ] Update CHANGELOG.md
- [ ] Add usage examples
- [ ] Update API documentation`;function q(t){let e=t.tool_input.command||"";if(!/gh\s+(issue\s+close|pr\s+merge)/.test(e))return a();if(!(/--label.*feat/i.test(e)||/feat|feature/.test(e)))return a();let n=`Feature completion detected. Ensure documentation is updated.

${un}

Skip with --no-edit if docs are already complete.`;return p("allow","Feature docs reminder",t),u("issue-docs-requirement","Feature completion - docs reminder"),m(n)}import{existsSync as qt,readFileSync as ln}from"node:fs";import{join as zt}from"node:path";function pn(t){let e=zt(t,".claude","coordination",".claude.db");return qt(e)}function mn(t){let e=zt(t,".claude","coordination","work-registry.json");try{if(qt(e))return JSON.parse(ln(e,"utf8")).qualityGates||{}}catch{}return{}}function z(t){if(N())return a();let e=t.tool_input.command||"",o=f();if(!/gh\s+pr\s+merge|git\s+merge|deploy/.test(e))return a();if(!pn(o))return a();let n=mn(o),r=["tests","lint","typecheck"].filter(i=>!n[i]);if(r.length>0){let i=`Multi-instance quality gate check:
Failed/missing gates: ${r.join(", ")}

Run these checks before merging:
${r.map(c=>`- npm run ${c}`).join(`
`)}

Quality gates ensure consistency across instances.`;return p("allow",`Quality gates failed: ${r.join(", ")}`,t),u("multi-instance-quality-gate",`Failed: ${r.join(", ")}`),m(i)}return p("allow","All quality gates passed",t),a()}import{existsSync as V,readFileSync as Zt,writeFileSync as Xt,mkdirSync as Yt}from"node:fs";import{join as K}from"node:path";import{execSync as fn}from"node:child_process";var R={requestsPerMinute:parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_MIN||"10",10),requestsPerHour:parseInt(process.env.AGENT_BROWSER_RATE_LIMIT_PER_HOUR||"100",10),burstLimit:parseInt(process.env.AGENT_BROWSER_BURST_LIMIT||"3",10)},Kt=parseInt(process.env.AGENT_BROWSER_ROBOTS_CACHE_TTL||"3600000",10),dn=[/localhost.*admin/i,/127\.0\.0\.1.*admin/i,/internal\./i,/intranet\./i,/\.local\//i,/file:\/\//i,/accounts\.google\.com/i,/login\.microsoftonline\.com/i,/auth0\.com/i,/okta\.com/i,/login\.live\.com/i,/appleid\.apple\.com/i,/github\.com\/login/i,/gitlab\.com\/users\/sign_in/i],gn=["click.*delete","click.*remove","fill.*password","fill.*credit","submit.*payment"];function te(){let t=b(),e=K(t,"agent-browser");return V(e)||Yt(e,{recursive:!0}),K(e,"rate-limits.json")}function hn(){let t=te();try{if(V(t))return JSON.parse(Zt(t,"utf-8"))}catch{}return{domains:{}}}function yn(t){let e=te();try{Xt(e,JSON.stringify(t,null,2))}catch{}}function Vt(t){try{return new URL(t).hostname}catch{return null}}function Jt(t){let e=Date.now(),o=hn(),n=o.domains[t]||{timestamps:[],lastUpdated:e},s=e-6e4,r=e-36e5;n.timestamps=n.timestamps.filter(k=>k>r);let i=n.timestamps.filter(k=>k>s).length,c=n.timestamps.length;if(i>=R.requestsPerMinute)return{allowed:!1,reason:`Rate limited: ${i}/${R.requestsPerMinute} requests per minute to ${t}`,remaining:0};if(c>=R.requestsPerHour)return{allowed:!1,reason:`Rate limited: ${c}/${R.requestsPerHour} requests per hour to ${t}`,remaining:0};let l=e-3e3;return n.timestamps.filter(k=>k>l).length>=R.burstLimit?{allowed:!1,reason:`Burst limited: Too many rapid requests to ${t}. Wait a moment.`,remaining:0}:(n.timestamps.push(e),n.lastUpdated=e,o.domains[t]=n,yn(o),{allowed:!0,remaining:R.requestsPerMinute-i-1})}function ee(){let t=b(),e=K(t,"agent-browser");return V(e)||Yt(e,{recursive:!0}),K(e,"robots-cache.json")}function kn(){let t=ee();try{if(V(t))return JSON.parse(Zt(t,"utf-8"))}catch{}return{entries:{}}}function Qt(t){let e=ee();try{Xt(e,JSON.stringify(t,null,2))}catch{}}function Sn(t){let e=[],o=!1,n=t.split(`
`);for(let s of n){let r=s.trim().toLowerCase();if(r.startsWith("user-agent:")&&(o=r.replace("user-agent:","").trim()==="*"),o&&r.startsWith("disallow:")){let i=s.trim().replace(/^disallow:\s*/i,"").trim();i&&e.push(i)}}return e}function xn(t){let e=kn(),o=Date.now(),n=e.entries[t];if(n&&n.expires>o)return n;let s=`${t}/robots.txt`;try{if(/[`$\\;"'|&<>(){}!\n\r]/.test(s))return null;let r=fn(`curl -sL --max-time 5 "${s}"`,{encoding:"utf-8",timeout:6e3,stdio:["pipe","pipe","pipe"]}),i=Sn(r),c={rules:r.split(`
`).slice(0,50),disallowedPaths:i,expires:o+Kt,fetchedAt:o};return e.entries[t]=c,Qt(e),c}catch{let r={rules:[],disallowedPaths:[],expires:o+Kt,fetchedAt:o};return e.entries[t]=r,Qt(e),r}}function Rn(t){if(process.env.AGENT_BROWSER_IGNORE_ROBOTS==="true")return{allowed:!0};try{let e=new URL(t),o=e.origin,n=e.pathname,s=xn(o);if(!s||s.disallowedPaths.length===0)return{allowed:!0};for(let r of s.disallowedPaths)if(r.includes("*")){let i=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\\\*/g,".*");if(new RegExp("^"+i).test(n))return{allowed:!1,reason:`Blocked by robots.txt: ${r}`}}else if(n.startsWith(r))return{allowed:!1,reason:`Blocked by robots.txt: ${r}`};return{allowed:!0}}catch{return{allowed:!0}}}function bn(t){let e=t.match(/(?:navigate|goto|open)\s+["']?([^"'\s]+)["']?/i);return e?e[1]:null}function $n(t){return dn.some(e=>e.test(t))}function _n(t){return gn.some(e=>new RegExp(e,"i").test(t))}function J(t){let e=t.tool_input.command||"";if(!/agent-browser|ab\s/.test(e))return a();let o=bn(e);if(o&&$n(o))return p("deny",`Blocked URL: ${o}`,t),u("agent-browser-safety",`BLOCKED: ${o}`),g(`agent-browser blocked: URL matches blocked pattern.

URL: ${o}

Blocked patterns include internal, localhost admin, and file:// URLs.
If this is intentional, use direct browser access instead.`);if(o){let n=Vt(o);if(n){let s=Jt(n);if(!s.allowed)return p("deny",s.reason||"Rate limited",t),u("agent-browser-safety",`RATE LIMITED: ${n}`),g(`agent-browser rate limited.

${s.reason}

Limits: ${R.requestsPerMinute}/min, ${R.requestsPerHour}/hour
Configure via AGENT_BROWSER_RATE_LIMIT_PER_MIN and AGENT_BROWSER_RATE_LIMIT_PER_HOUR env vars.

Wait a moment before retrying, or use --session <name> for isolated sessions.`)}}if(o){let n=Rn(o);if(!n.allowed)return p("deny",n.reason||"Blocked by robots.txt",t),u("agent-browser-safety",`ROBOTS BLOCKED: ${o}`),g(`agent-browser blocked by robots.txt.

URL: ${o}
${n.reason}

The website's robots.txt disallows automated access to this path.
Set AGENT_BROWSER_IGNORE_ROBOTS=true to override (not recommended).`)}if(_n(e)){let n=o?Vt(o):"unknown",s=o&&n?Jt(n):{remaining:"?"},r=`Sensitive browser action detected:
${e.slice(0,100)}...

This may interact with:
- Delete/remove buttons
- Password fields
- Payment forms

Rate limit remaining: ${s.remaining}/${R.requestsPerMinute} per minute

Proceed with caution. Verify target elements.`;return p("allow","Sensitive action warning",t),u("agent-browser-safety","Sensitive action detected"),m(r)}return p("allow","agent-browser command validated",t),a()}import{realpathSync as wn,existsSync as Cn}from"node:fs";import{resolve as Hn,isAbsolute as In}from"node:path";var En=[/\.env$/,/\.env\.local$/,/\.env\.production$/,/credentials\.json$/,/secrets\.json$/,/private\.key$/,/\.pem$/,/id_rsa$/,/id_ed25519$/],Tn=[/package\.json$/,/pyproject\.toml$/,/tsconfig\.json$/];function vn(t,e){try{let o=In(t)?t:Hn(e,t);return Cn(o)?wn(o):o}catch{return t}}function Pn(t){for(let e of En)if(e.test(t))return e;return null}function Dn(t){return Tn.some(e=>e.test(t))}function oe(t){let e=t.tool_input.file_path||"",o=f();if(!e)return a();u("file-guard",`File write/edit: ${e}`);let n=vn(e,o);u("file-guard",`Resolved path: ${n}`);let s=Pn(n);return s?(p("deny",`Protected file blocked: ${e} (pattern: ${s})`,t),u("file-guard",`BLOCKED: ${e} matches ${s}`),g(`Cannot modify protected file: ${e}

Resolved path: ${n}
Matched pattern: ${s}

Protected files include:
- Environment files (.env, .env.local, .env.production)
- Credential files (credentials.json, secrets.json)
- Private keys (.pem, id_rsa, id_ed25519)

If you need to modify this file, do it manually outside Claude Code.`)):(Dn(n)&&(u("file-guard",`WARNING: Config file modification: ${n}`),p("warn",`Config file modification: ${e}`,t)),p("allow",`File write allowed: ${e}`,t),a())}import{existsSync as re,readFileSync as On}from"node:fs";import{join as ne}from"node:path";var An={"api-layer":[/\/api\//,/\/routes\//,/\/endpoints\//],"service-layer":[/\/services\//],"data-layer":[/\/db\//,/\/models\//,/\/repositories\//],"workflow-layer":[/\/workflows\//,/\/agents\//],unknown:[]};function jn(t){for(let[e,o]of Object.entries(An))if(e!=="unknown"&&o.some(n=>n.test(t)))return e;return"unknown"}function Ln(t,e){let o=ne(e,".claude","context","patterns"),n=ne(o,`${t}.json`);try{if(re(n)){let s=On(n,"utf8"),r=JSON.parse(s),i=Array.isArray(r)?r.length:Object.keys(r).length;if(i>0)return` | Patterns loaded: ${i}`}}catch{}return""}function Q(t){let e=t.tool_input.file_path||"",o=t.project_dir||f();if(!e)return a();let s=It(t,...["**/api/**","**/services/**","**/db/**","**/models/**","**/workflows/**"]);if(s!==null)return s;let r=jn(e);if(r==="unknown")return a();let i=Ln(r,o),c=!re(e),l;return c?l=`New ${r} file. Follow layer conventions: dependency injection, interface contracts${i}`:l=`Modifying ${r}. Ensure: no breaking API changes, maintain layer boundaries${i}`,p("allow",`Architectural change: ${e} (${r})`,t),u("architecture-change-detector",`ARCH_DETECT: ${e} (layer=${r})`),T(t)?S(`[Quality Gate] ${l}`):h(l)}import{existsSync as Nn,readFileSync as Mn}from"node:fs";import{join as Fn,extname as Bn,basename as Gn}from"node:path";var $=50,se=4,Un=10;function Wn(t){return Bn(t).toLowerCase().replace(".","")}function qn(t,e){let o=[],n=t.split(`
`);if(e==="py"){let s=!1,r="",i=0;for(let c of n){let l=c.match(/^(\s*)(?:async\s+)?def\s+([a-zA-Z_][a-zA-Z0-9_]*)/),d=c.match(/^(\s*)class\s+/);l?(s&&i>$&&o.push(`Function '${r}' is ${i} lines (max: ${$})`),s=!0,r=l[2],i=1):d?(s&&i>$&&o.push(`Function '${r}' is ${i} lines (max: ${$})`),s=!1):s&&c.trim()&&i++}s&&i>$&&o.push(`Function '${r}' is ${i} lines (max: ${$})`)}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let s=0,r=0,i=!1,c="";for(let l of n){let d=l.match(/(?:function|func|fn)\s+([a-zA-Z_][a-zA-Z0-9_]*)/),k=l.match(/const\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*=\s*(?:async\s*)?\(/);if(d?(c=d[1],i=!0,r=0,s=0):k&&(c=k[1],i=!0,r=0,s=0),i){let x=(l.match(/\{/g)||[]).length,et=(l.match(/\}/g)||[]).length;s+=x-et,l.trim()&&r++,s<=0&&r>0&&(r>$&&o.push(`Function '${c}' is ${r} lines (max: ${$})`),i=!1)}}}return o}function zn(t,e){let o=[],n=t.split(`
`),s=0;if(e==="py")for(let r of n){let i=r.match(/^(\s*)(if|for|while|with|try|elif|else|except|finally)[\s:]/);if(i){let c=i[1].length,l=Math.floor(c/4);l>s&&(s=l)}}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let r=0;for(let i of n){let c=(i.match(/\{/g)||[]).length,l=(i.match(/\}/g)||[]).length;r+=c-l,/(?:if|for|while|switch|try)\s*\(/.test(i)&&r>s&&(s=r)}}return s>se&&o.push(`Deep nesting detected (depth: ${s}, max: ${se})`),o}function Kn(t){let e=[],o=(t.match(/\b(if|elif|else if)\b/g)||[]).length,n=(t.match(/\b(switch|match)\b/g)||[]).length,s=(t.match(/\?[^:]+:/g)||[]).length,r=o+n+s,i=Math.max((t.match(/\b(def|function|func|fn)\b/g)||[]).length,1),c=Math.floor(r/i);return c>Un&&e.push(`High cyclomatic complexity (~${c} conditionals/function, consider refactoring)`),e}function Vn(t,e){let o=Fn(e,".claude","cache","type-errors.json");if(!Nn(o))return"";try{let n=JSON.parse(Mn(o,"utf8")),s=Gn(t);return n[s]||""}catch{return""}}function Z(t){let e=t.tool_input.file_path||"",o=t.tool_input.content||"",n=t.project_dir||f(),s=E(t,I,M);if(s!==null)return s;if(!e||!o)return a();let r=Wn(e),i=[];i.push(...qn(o,r)),i.push(...zn(o,r)),i.push(...Kn(o));let c=Vn(e,n);if(c&&i.push(c),i.length>0){u("code-quality-gate",`Quality warnings for ${e}: ${i.join(", ")}`);let l=`Code quality: ${i.join(" | ")}`;return l.length>350&&(l=l.slice(0,347)+"..."),T(t)?S(`[Quality Gate] ${l}`):h(l)}return u("code-quality-gate",`No quality issues in ${e}`),a()}import{extname as Jn}from"node:path";function Qn(t){return Jn(t).toLowerCase().replace(".","")}function Zn(t){return[/test/i,/spec/i,/__tests__/i,/_test\.py$/,/\.test\.ts$/,/\.spec\.ts$/].some(o=>o.test(t))}function Xn(t){let e=[],o=t.split(`
`);for(let n=0;n<o.length;n++){let r=o[n].match(/^(?:\s*)(?:async\s+)?def\s+([^_][a-zA-Z0-9_]*)\s*\(/);if(r){let i=r[1],c=!1;for(let l=n+1;l<o.length;l++){let d=o[l].trim();if(d){(d.startsWith('"""')||d.startsWith("'''"))&&(c=!0);break}}if(!c&&(e.push(i),e.length>=5))break}}return e}function Yn(t){let e=[],o=t.split(`
`),n=!1;for(let s=0;s<o.length;s++){let r=o[s];(s>0?o[s-1].trim():"").endsWith("*/")&&(n=!0);let c=r.match(/^export\s+(?:async\s+)?(?:function\s+([a-zA-Z][a-zA-Z0-9_]*)|const\s+([a-zA-Z][a-zA-Z0-9_]*)\s*=)/);if(c){let l=c[1]||c[2];if(!n&&(e.push(l),e.length>=5))break;n=!1}else r.trim().endsWith("*/")||(n=!1)}return e}function X(t){let e=t.tool_input.file_path||"",o=t.tool_input.content||"",n=E(t,I,M);if(n!==null)return n;if(!e||!o)return a();if(Zn(e))return a();let s=Qn(e),r=[];if(s==="py"?r=Xn(o):["ts","tsx","js","jsx"].includes(s)&&(r=Yn(o)),r.length>0){let i=r.join(", "),c;return s==="py"?c=`Documentation: ${r.length} public function(s) missing docstrings: ${i}. Consider adding """docstrings""" for better code documentation.`:c=`Documentation: ${r.length} exported function(s) missing JSDoc: ${i}. Consider adding /** JSDoc */ comments for better IDE support.`,c.length>200&&(s==="py"?c=`Documentation: ${r.length} public function(s) missing docstrings. Add """docstrings""" for better documentation.`:c=`Documentation: ${r.length} exported function(s) missing JSDoc. Add /** JSDoc */ for better IDE support.`),u("docstring-enforcer",`DOCSTRING_WARN: ${r.length} functions missing docs in ${e}`),T(t)?S(`[Quality Gate] ${c}`):h(c)}return u("docstring-enforcer",`DOCSTRING_OK: All public functions documented in ${e}`),a()}import{basename as tr}from"node:path";var er=[{name:"Potential hardcoded secret detected",pattern:/(api[_-]?key|password|secret|token)\s*[=:]\s*['"][^'"]+['"]/i,severity:"high"},{name:"Potential SQL injection vulnerability",pattern:/execute\s*\(\s*['"].*\+|f['"].*SELECT.*\{/,severity:"high"},{name:"Dangerous eval/exec usage detected",pattern:/eval\s*\(|exec\s*\(/,severity:"high"},{name:"Subprocess with shell=True detected",pattern:/subprocess\.(run|call|Popen).*shell\s*=\s*True/,severity:"medium"},{name:"Potential XSS vulnerability (innerHTML)",pattern:/\.innerHTML\s*=|dangerouslySetInnerHTML/,severity:"medium"},{name:"Insecure random number generation",pattern:/Math\.random\(\).*(?:password|token|secret|key)/i,severity:"medium"},{name:"Potential command injection",pattern:/os\.system\s*\(|os\.popen\s*\(/,severity:"high"},{name:"Insecure HTTP (should use HTTPS)",pattern:/http:\/\/(?!localhost|127\.0\.0\.1)/,severity:"low"}];function or(t){let e=[];for(let{name:o,pattern:n}of er)n.test(t)&&e.push(o);return e}function Y(t){let e=t.tool_input.file_path||"",o=t.tool_input.content||"",n=E(t,I);if(n!==null)return n;if(!e)return a();let s=or(o);if(s.length>0){u("security-pattern-validator",`SECURITY_WARN: ${e} - ${s.join(", ")}`);let r=`Security warnings for ${tr(e)}: ${s.join(", ")}`;return p("warn",`Security issues in ${e}: ${s.join(", ")}`,t),h(r)}return u("security-pattern-validator",`SECURITY_OK: ${e}`),p("allow",`No security issues in ${e}`,t),a()}import{existsSync as ie,readFileSync as nr,appendFileSync as rr,statSync as sr,renameSync as ir,mkdirSync as cr}from"node:fs";import{join as ar}from"node:path";var ur=102400;function lr(){let t=b();return ar(t,"context7-telemetry.log")}function pr(t){try{ie(t)&&sr(t).size>ur&&ir(t,`${t}.old`)}catch{}}function mr(t){if(!ie(t))return"";try{let o=nr(t,"utf8").trim().split(`
`).filter(Boolean),n=o.length;if(n===0)return"";let s=new Set;for(let c of o){let l=c.match(/library=([^| ]+)/);l&&l[1]&&l[1]!==""&&s.add(l[1])}let r=[];for(let c=o.length-1;c>=0&&r.length<3;c--){let l=o[c].match(/library=([^| ]+)/);l&&l[1]&&!r.includes(l[1])&&r.push(l[1])}let i=r.length>0?r.join(", "):"none";return`Context7: ${n} queries, ${s.size} libraries. Recent: ${i}`}catch{return""}}function ce(t){let e=t.tool_name||"";if(!e.startsWith("mcp__context7__"))return a();let o=t.tool_input.libraryId||"",n=t.tool_input.query||"",s=b();try{cr(s,{recursive:!0})}catch{}let r=lr();pr(r);let c=`${new Date().toISOString()} | tool=${e} | library=${o} | query_length=${n.length}
`;try{rr(r,c)}catch{}let l=mr(r);return p("allow",`Documentation lookup: ${o}`,t),u("context7-tracker",`Query: ${e} library=${o}`),l?h(l):a()}function ae(t){let e=t.tool_name||"";if(!e.startsWith("mcp__memory__"))return a();switch(e){case"mcp__memory__delete_entities":{let o=t.tool_input.entityNames,n=Array.isArray(o)?o.length:0;if(n>5)return p("warn",`Bulk delete: ${n} entities`,t),u("memory-validator",`WARN: Bulk entity delete: ${n} entities`),S(`Deleting ${n} entities from knowledge graph`);break}case"mcp__memory__delete_relations":{let o=t.tool_input.relations,n=Array.isArray(o)?o.length:0;if(n>10)return p("warn",`Bulk relation delete: ${n} relations`,t),u("memory-validator",`WARN: Bulk relation delete: ${n} relations`),S(`Deleting ${n} relations from knowledge graph`);break}case"mcp__memory__create_entities":{let o=t.tool_input.entities;if(!Array.isArray(o))return p("allow","Creating entities (non-array input)",t),a();let n=o.length,s=o.filter(r=>!r.name||r.name===""||!r.entityType||r.entityType==="").length;if(s>0)return p("warn",`Invalid entities: ${s} missing name or entityType`,t),u("memory-validator",`WARN: ${s} entities missing required fields`),S(`${s} entities missing required fields (name, entityType)`);p("allow",`Creating ${n} valid entities`,t);break}case"mcp__memory__create_relations":{let o=t.tool_input.relations;if(!Array.isArray(o))return p("allow","Creating relations (non-array input)",t),a();let n=o.length,s=o.filter(r=>!r.from||!r.to||!r.relationType).length;if(s>0)return p("warn",`Invalid relations: ${s} missing from/to/relationType`,t),u("memory-validator",`WARN: ${s} relations missing required fields`),S(`${s} relations missing required fields`);p("allow",`Creating ${n} valid relations`,t);break}default:p("allow",`Read operation: ${e}`,t);break}return a()}import{existsSync as fr}from"node:fs";import{extname as dr}from"node:path";function gr(){return new Date().toISOString().split("T")[0]}function hr(t,e){let o=gr();switch(t.toLowerCase()){case"py":return`# Generated by OrchestKit Claude Plugin
# Created: ${o}

${e}`;case"js":case"ts":return`// Generated by OrchestKit Claude Plugin
// Created: ${o}

${e}`;case"sh":{if(e.startsWith("#!/")){let n=e.indexOf(`
`),s=e.slice(0,n),r=e.slice(n+1);return`${s}
# Generated by OrchestKit Claude Plugin
# Created: ${o}

${r}`}return`#!/bin/bash
# Generated by OrchestKit Claude Plugin
# Created: ${o}

${e}`}case"sql":return`-- Generated by OrchestKit Claude Plugin
-- Created: ${o}

${e}`;case"html":case"xml":return`<!-- Generated by OrchestKit Claude Plugin - ${o} -->

${e}`;case"css":case"scss":case"sass":return`/* Generated by OrchestKit Claude Plugin - ${o} */

${e}`;case"yaml":case"yml":return`# Generated by OrchestKit Claude Plugin
# Created: ${o}

${e}`;case"json":return e;default:return e}}function yr(t,e){return C({file_path:t,content:e})}function ue(t){let e=t.tool_name||"",o=t.tool_input.file_path||"",n=t.tool_input.content||"";if(e!=="Write")return a();if(fr(o))return a();let s=dr(o).replace(".","");if(n.includes("OrchestKit"))return u("write-headers",`Skipping header for ${o} (already has OrchestKit marker)`),a();let r=hr(s,n);return r!==n?(u("write-headers",`Added header to ${o}`),yr(o,r)):a()}import{existsSync as kr,appendFileSync as Sr,mkdirSync as xr}from"node:fs";import{join as le,dirname as Rr,basename as br}from"node:path";function $r(t){try{kr(t)||xr(t,{recursive:!0})}catch{}}function pe(t,e){try{$r(Rr(t)),Sr(t,e)}catch{}}function me(t){let e=t.tool_input.skill||"",o=t.tool_input.args||"",n=t.project_dir||f();if(!e)return a();u("skill-tracker",`Skill invocation: ${e}${o?` (args: ${o})`:""}`);let s=le(n,".claude","logs","skill-usage.log"),r=new Date().toISOString();pe(s,`${r} | ${e} | ${o||"no args"}
`);let i=le(n,".claude","logs","skill-analytics.jsonl"),c=JSON.stringify({skill:e,args:o||"",timestamp:r,project:br(n),phase:"start"});return pe(i,c+`
`),u("skill-tracker",`Skill usage logged for ${e}`),a()}import{existsSync as Or,readFileSync as Ar,statSync as jr}from"node:fs";var fe={".ts":"typescript",".tsx":"typescript",".js":"typescript",".jsx":"typescript",".mjs":"typescript",".mts":"typescript",".py":"python",".go":"go",".rs":"rust",".sh":"shell",".bash":"shell",".md":"markdown"};function de(t){return t in fe}function _r(t){let e=t.split(`
`),o=[],n=[],s=[],r=[],i=[];for(let c of e){let l=c.trim();if(/^import\s/.test(l)){o.push(l.replace(/;$/,""));continue}if(/^(?:export\s+)?(?:interface|type)\s+\w+/.test(l)){let d=l.match(/^(?:export\s+)?(?:interface|type)\s+(\w+[^{=]*)/);d&&r.push(d[0].replace(/\s*[{=]\s*$/,"").trim());continue}if(/^(?:export\s+)?(?:abstract\s+)?class\s+\w+/.test(l)){let d=l.match(/^(?:export\s+)?(?:abstract\s+)?class\s+\w+(?:\s+extends\s+\w+)?(?:\s+implements\s+[\w,\s]+)?/);d&&s.push(d[0].trim());continue}if(/^(?:export\s+)?(?:async\s+)?function\s+\w+/.test(l)){let d=l.match(/^(?:export\s+)?(?:async\s+)?function\s+\w+\([^)]*\)(?:\s*:\s*[^{]+)?/);d&&n.push(d[0].replace(/\s*\{?\s*$/,"").trim());continue}if(/^(?:export\s+)?const\s+\w+\s*=\s*(?:async\s+)?\(/.test(l)){let d=l.match(/^(?:export\s+)?const\s+(\w+)\s*=\s*(?:async\s+)?\([^)]*\)(?:\s*:\s*[^=]+)?(?:\s*=>)?/);d&&n.push(d[0].replace(/\s*=>\s*$/,"").trim());continue}/^export\s+(?:\{|default\s)/.test(l)&&i.push(l.replace(/;$/,""))}return{imports:o,functions:n,classes:s,types:r,exports:i,sections:[],variables:[]}}function wr(t){let e=t.split(`
`),o=[],n=[],s=[],r="";for(let i of e){let c=i.trim();if(/^(?:from\s|import\s)/.test(c)){o.push(c);continue}if(/^@\w+/.test(c)){r=c;continue}if(/^(?:async\s+)?def\s+\w+/.test(i)&&!i.startsWith(" ")&&!i.startsWith("	")){let l=i.match(/^(?:async\s+)?def\s+\w+\([^)]*\)(?:\s*->\s*[^:]+)?/);if(l){let d=r?`${r} ${l[0].trim()}`:l[0].trim();n.push(d)}r="";continue}if(/^class\s+\w+/.test(i)&&!i.startsWith(" ")&&!i.startsWith("	")){let l=i.match(/^class\s+\w+(?:\([^)]*\))?/);if(l){let d=l[0].trim();s.push(d)}r="";continue}if(/^\s+(?:async\s+)?def\s+\w+/.test(i)){let l=i.match(/^\s+(?:async\s+)?def\s+(\w+)/);l&&!l[1].startsWith("_")&&n.push(`  ${l[0].trim()}`),r="";continue}r=""}return{imports:o,functions:n,classes:s,types:[],exports:[],sections:[],variables:[]}}function Cr(t){let e=t.split(`
`),o=[],n=[],s=[],r=!1;for(let i of e){let c=i.trim();if(/^import\s*\(/.test(c)){r=!0;continue}if(r){c===")"?r=!1:c&&!c.startsWith("//")&&o.push(`import ${c}`);continue}if(/^import\s+"/.test(c)){o.push(c);continue}if(/^func\s/.test(c)){let l=c.match(/^func\s+(?:\([^)]+\)\s+)?\w+\([^)]*\)(?:\s*(?:\([^)]*\)|\*?\w+))?/);l&&n.push(l[0].trim());continue}if(/^type\s+\w+\s+(?:struct|interface)/.test(c)){let l=c.match(/^type\s+\w+\s+(?:struct|interface)/);l&&s.push(l[0].trim());continue}}return{imports:o,functions:n,classes:[],types:s,exports:[],sections:[],variables:[]}}function Hr(t){let e=t.split(`
`),o=[],n=[],s=[];for(let r of e){let i=r.trim();if(/^use\s/.test(i)){o.push(i.replace(/;$/,""));continue}if(/^(?:pub\s+)?(?:async\s+)?fn\s+\w+/.test(i)){let c=i.match(/^(?:pub\s+)?(?:async\s+)?fn\s+\w+(?:<[^>]+>)?\([^)]*\)(?:\s*->\s*[^{]+)?/);c&&n.push(c[0].replace(/\s*\{?\s*$/,"").trim());continue}if(/^(?:pub\s+)?(?:struct|enum|trait|impl)\s+\w+/.test(i)){let c=i.match(/^(?:pub\s+)?(?:struct|enum|trait|impl)\s+\w+(?:<[^>]+>)?(?:\s+for\s+\w+(?:<[^>]+>)?)?/);c&&s.push(c[0].trim());continue}}return{imports:o,functions:n,classes:[],types:s,exports:[],sections:[],variables:[]}}function Ir(t){let e=t.split(`
`),o=[],n=[],s=new Set;for(let r of e){let i=r.trim();if(/^(?:function\s+)?(\w+)\s*\(\)\s*\{?/.test(i)){let c=i.match(/^(?:function\s+)?(\w+)\s*\(\)/);c&&c[1]!=="if"&&c[1]!=="while"&&c[1]!=="for"&&o.push(c[1]);continue}if(/^function\s+(\w+)\s*\{?/.test(i)){let c=i.match(/^function\s+(\w+)/);c&&o.push(c[1]);continue}if(/^[A-Z][A-Z0-9_]+=/.test(i)&&s.size<10){let c=i.match(/^([A-Z][A-Z0-9_]+)=/);c&&!s.has(c[1])&&(s.add(c[1]),n.push(c[1]))}}return{imports:[],functions:o,classes:[],types:[],exports:[],sections:[],variables:n}}function Er(t){let e=t.split(`
`),o=[];for(let n of e){let s=n.match(/^(#{1,3})\s+(.+)/);s&&o.push(`${s[1]} ${s[2].trim()}`)}return{imports:[],functions:[],classes:[],types:[],exports:[],sections:o,variables:[]}}var Tr={typescript:_r,python:wr,go:Cr,rust:Hr,shell:Ir,markdown:Er},vr=1400;function Pr(t){return{typescript:"TypeScript",python:"Python",go:"Go",rust:"Rust",shell:"Shell",markdown:"Markdown"}[t]}function _(t,e,o=""){if(e.length===0)return"";let n=`${t} (${e.length}):`,s=e.map(r=>`${o}  ${r}`).join(`
`);return`${n}
${s}`}function Dr(t,e){let o="";for(let n of t){if(o.length+n.length+1>e){o+=`
  ...truncated`;break}o+=(o?`
`:"")+n}return o}function ge(t,e){let o=e.lastIndexOf(".");if(o===-1)return null;let n=e.slice(o).toLowerCase(),s=fe[n];if(!s)return null;let r=Tr[s],i=r(t);if(i.imports.length+i.functions.length+i.classes.length+i.types.length+i.exports.length+i.sections.length+i.variables.length===0)return null;let l=t.split(`
`).length,d=y(t),k=`[TLDR] ${e} (${l} lines, ~${d} tokens, ${Pr(s)})`,x=[];i.classes.length>0&&x.push(_("Classes",i.classes)),i.types.length>0&&x.push(_("Types",i.types)),i.functions.length>0&&x.push(_("Functions",i.functions)),i.exports.length>0&&x.push(_("Exports",i.exports)),i.imports.length>0&&x.push(_("Imports",i.imports)),i.sections.length>0&&x.push(_("Sections",i.sections)),i.variables.length>0&&x.push(_("Variables",i.variables));let et=vr-k.length-2,Oe=Dr(x,et);return`${k}

${Oe}`}var mt="tldr-summary",Lr=500,Nr=2e3,Mr=2*1024*1024;function he(t){try{let e=t.tool_input||{},o=e.file_path;if(!o)return a();if(e.offset!==void 0||e.limit!==void 0)return a();let n=o.lastIndexOf(".");if(n===-1)return a();let s=o.slice(n).toLowerCase();if(!de(s))return a();if(!Or(o))return a();let r=jr(o);if(r.size>Mr)return u(mt,`Skipping ${o}: ${r.size} bytes > 2MB cap`),a();let i=Ar(o,"utf8"),c=i.split(`
`).length,l=y(i);if(c<Lr&&l<Nr)return a();let d=ge(i,o);return d?(u(mt,`Injecting summary for ${o} (${c} lines, ~${l} tokens)`),m(d)):a()}catch(e){return u(mt,`Error: ${e instanceof Error?e.message:String(e)}`,"warn"),a()}}var tt=6,ft=3;function ye(t){let e=t.tool_input||{},o=e.team_name;if(!o)return a();Ct(o)&&(Ht(o),u("team-size-gate",`Auto-cleaned stale team "${o}" before TeamCreate`));let n=e.model||"",s=e.description||"",r=wt(),i=r.length;if(u("team-size-gate",`Team "${o}": ${i} members, spawning model="${n}"`),i>=tt)return u("team-size-gate",`BLOCKED: Team size limit (${i} >= ${tt})`),g(`Team Size Limit

Team "${o}" has ${i} members (max ${tt}).

Wait for existing teammates to complete before spawning more.

Attempted: ${s}`);if(n==="opus"){let c=r.filter(l=>l.agentType.toLowerCase().includes("opus")).length;if(c>=ft)return u("team-size-gate",`BLOCKED: Opus limit (${c} >= ${ft})`),g(`Opus Model Limit

Team "${o}" already has ${c} Opus members (max ${ft}).

Use a lighter model (sonnet/haiku) or wait for Opus teammates to finish.

Attempted: ${s}`)}return u("team-size-gate",`Team spawn allowed: ${i+1}/${tt}`),a()}var w="pretool-bash-dispatcher",ke=800,Fr=[{name:"error-pattern-warner",fn:B},{name:"issue-docs-requirement",fn:q},{name:"multi-instance-quality-gate",fn:z},{name:"gh-issue-creation-guide",fn:W},{name:"license-compliance",fn:U},{name:"affected-tests-finder",fn:G}];function xe(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function Re(t){let e;try{let o=F(t);o.hookSpecificOutput?.updatedInput&&(e=o.hookSpecificOutput.updatedInput)}catch(o){let n=o instanceof Error?o.message:String(o);u(w,`default-timeout-setter failed: ${n}`,"warn")}try{let o=J(t);if(!o.continue)return o;let n=xe(o);if(n)return Se(t,e,n)}catch(o){let n=o instanceof Error?o.message:String(o);u(w,`agent-browser-safety failed: ${n}`,"warn")}return Se(t,e,null)}function Se(t,e,o){let n=[],s=0;if(o){let r=y(o);n.push(o),s+=r}for(let r of Fr)try{let i=r.fn(t),c=xe(i);if(!c)continue;let l=y(c);if(s+l>ke){u(w,`Budget limit: skipping ${r.name} (${l}t would exceed ${ke}t cap)`);continue}n.push(c),s+=l,u(w,`${r.name}: +${l}t (total: ${s}t)`)}catch(i){let c=i instanceof Error?i.message:String(i);u(w,`${r.name} failed: ${c}`,"warn")}if(e&&n.length>0){let r=n.join(`

---

`);return u(w,`Consolidated ${n.length} hooks into ${s}t + input mod`),{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:e,additionalContext:r}}}if(e)return C(e);if(n.length>0){let r=n.join(`

---

`);return u(w,`Consolidated ${n.length} hooks into ${s}t`),m(r)}return a()}var P="pretool-write-edit-dispatcher",be=800,Br=[{name:"architecture-change-detector",fn:Q},{name:"docstring-enforcer",fn:X},{name:"code-quality-gate",fn:Z}];function _e(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function we(t){try{let e=Y(t);if(!e.continue)return e;let o=_e(e);if(o)return $e(t,o)}catch(e){let o=e instanceof Error?e.message:String(e);u(P,`security-pattern-validator failed: ${o}`,"warn")}return $e(t,null)}function $e(t,e){let o=[],n=0;if(e){let r=y(e);o.push(e),n+=r}for(let r of Br)try{let i=r.fn(t),c=_e(i);if(!c)continue;let l=y(c);if(n+l>be){u(P,`Budget limit: skipping ${r.name} (${l}t would exceed ${be}t cap)`);continue}o.push(c),n+=l,u(P,`${r.name}: +${l}t (total: ${n}t)`)}catch(i){let c=i instanceof Error?i.message:String(i);u(P,`${r.name} failed: ${c}`,"warn")}if(o.length===0)return a();let s=o.join(`

---

`);return u(P,`Consolidated ${o.length} hooks into ${n}t`),m(s)}function Ce(t){let e=t.tool_name,o=process.env.CLAUDE_AGENT_ID||"unknown";return["Write","Edit","MultiEdit","NotebookEdit"].includes(e)?g(`BLOCKED: Agent '${o}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`):a()}var Gr=[/DROP\s+TABLE/i,/DROP\s+DATABASE/i,/TRUNCATE/i,/DELETE\s+FROM.*WHERE\s+1/i,/DELETE\s+FROM\s+[^W]*$/i,/--force/i,/alembic\s+downgrade/i];function He(t){if(t.tool_name!=="Bash")return a();let o=t.tool_input.command||"";for(let n of Gr)if(n.test(o))return g(`BLOCKED: Potentially destructive database command detected. Pattern: '${n.source}'. Please confirm this operation is intentional before proceeding.`);return a()}import{mkdirSync as Ur,appendFileSync as Wr}from"node:fs";function Ie(t){let e=process.env.CLAUDE_AGENT_ID||"unknown",o=t.tool_name,n=t.session_id||v(),s=t.project_dir||f(),r=`${s}/.claude/logs/security-audit.log`;if(o!=="Bash")return a();let i=t.tool_input.command||"",c=new Date().toISOString();if(i)try{Ur(`${s}/.claude/logs`,{recursive:!0}),Wr(r,`[${c}] [${n}] [${e}] CMD: ${i}
`)}catch{}return a()}var qr=[/force.*push/i,/push.*--force/i,/--force-with-lease/i,/workflow_dispatch/i,/delete.*workflow/i,/gh\s+secret\s+delete/i,/gh\s+variable\s+delete/i,/rm.*-rf.*\.github/i];function Ee(t){let e=t.tool_input.command||"";for(let o of qr)if(o.test(e))return g(`BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${o.source}'. This requires explicit user approval.`);return/deploy|release|publish/i.test(e)?h("CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place."):a()}var zr=[/\bprod\b/i,/production/i,/--env.*prod/i,/ENV=prod/i,/ENVIRONMENT=prod/i,/deploy.*main/i,/deploy.*master/i];function Te(t){let e=t.tool_input.command||"";for(let o of zr)if(o.test(e))return g(`BLOCKED: Production deployment detected. Pattern: '${o.source}'. Production deployments require explicit user approval and should go through proper release processes.`);return/rollback|revert|downgrade/i.test(e)?h("Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed."):/terraform|kubectl|helm|docker.*push/i.test(e)?h("Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment."):a()}var D="pretool-task-dispatcher",ve=800,Kr=[{name:"block-writes",fn:Ce,canBlock:!0},{name:"migration-safety-check",fn:He,canBlock:!0},{name:"ci-safety-check",fn:Ee,canBlock:!0},{name:"deployment-safety-check",fn:Te,canBlock:!0},{name:"security-command-audit",fn:Ie,canBlock:!1}];function Vr(t){return t.hookSpecificOutput?.additionalContext?t.hookSpecificOutput.additionalContext:t.systemMessage&&typeof t.systemMessage=="string"?t.systemMessage:null}function Pe(t){let e=[],o=0;for(let s of Kr)try{let r=s.fn(t);if(!r.continue)return u(D,`${s.name} blocked operation`),r;let i=Vr(r);if(!i)continue;let c=y(i);if(o+c>ve){u(D,`Budget limit: skipping ${s.name} (${c}t would exceed ${ve}t cap)`);continue}e.push(i),o+=c,u(D,`${s.name}: +${c}t (total: ${o}t)`)}catch(r){let i=r instanceof Error?r.message:String(r);u(D,`${s.name} failed: ${i}`,"warn")}if(e.length===0)return a();let n=e.join(`

---

`);return u(D,`Consolidated ${e.length} hooks into ${o}t`),m(n)}var De={"pretool/bash/dangerous-command-blocker":Tt,"pretool/bash/git-validator":vt,"pretool/bash/compound-command-validator":Pt,"pretool/bash/default-timeout-setter":F,"pretool/bash/error-pattern-warner":B,"pretool/bash/conflict-predictor":At,"pretool/bash/affected-tests-finder":G,"pretool/bash/ci-simulation":jt,"pretool/bash/pre-commit-simulation":Lt,"pretool/bash/pr-merge-gate":Nt,"pretool/bash/changelog-generator":Mt,"pretool/bash/version-sync":Ut,"pretool/bash/license-compliance":U,"pretool/bash/gh-issue-creation-guide":W,"pretool/bash/issue-docs-requirement":q,"pretool/bash/multi-instance-quality-gate":z,"pretool/bash/agent-browser-safety":J,"pretool/write-edit/file-guard":oe,"pretool/Write/architecture-change-detector":Q,"pretool/Write/code-quality-gate":Z,"pretool/Write/docstring-enforcer":X,"pretool/Write/security-pattern-validator":Y,"pretool/mcp/context7-tracker":ce,"pretool/mcp/memory-validator":ae,"pretool/input-mod/write-headers":ue,"pretool/skill/skill-tracker":me,"pretool/read/tldr-summary":he,"pretool/task/team-size-gate":ye,"pretool/bash/unified-advisory-dispatcher":Re,"pretool/write-edit/unified-quality-dispatcher":we,"pretool/task/unified-agent-safety-dispatcher":Pe};function ru(t){return De[t]}function su(){return Object.keys(De)}export{Fs as createGuard,ws as escapeRegex,y as estimateTokenCount,fo as extractIssueNumber,Rt as getCachedBranch,mo as getCurrentBranch,Ps as getDefaultBranch,gs as getEnvFile,_s as getField,st as getGitStatus,ru as getHook,b as getLogDir,co as getLogLevel,io as getPluginRoot,f as getProjectDir,Es as getRepoRoot,v as getSessionId,qs as guardBash,I as guardCodeFiles,it as guardFileExtension,Ks as guardGitCommand,Vs as guardMultiInstance,zs as guardNontrivialBash,It as guardPathPattern,Bs as guardPythonFiles,M as guardSkipInternal,Us as guardTestFiles,Et as guardTool,Gs as guardTypescriptFiles,Ws as guardWriteEdit,vs as hasUncommittedChanges,De as hooks,Qr as isBashInput,T as isDontAskMode,Xr as isEditInput,Ts as isGitRepo,rt as isProtectedBranch,Yr as isReadInput,Zr as isWriteInput,su as listHooks,u as logHook,p as logPermissionFeedback,A as normalizeCommand,hs as normalizeLineEndings,m as outputAllowWithContext,ks as outputBlock,g as outputDeny,xs as outputError,uo as outputPromptContext,bs as outputPromptContextBudgeted,ys as outputSilentAllow,a as outputSilentSuccess,Rs as outputStderrWarning,S as outputWarning,h as outputWithContext,Ss as outputWithNotification,C as outputWithUpdatedInput,$s as readHookInput,E as runGuards,ao as shouldLog,_t as validateBranchName};
//# sourceMappingURL=pretool.mjs.map
