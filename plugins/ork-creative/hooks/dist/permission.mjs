// OrchestKit Hooks - permission bundle
// Generated: 2026-02-18T08:52:54.664Z

var z=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Bt(t){return typeof t.command=="string"}function Gt(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function zt(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Wt(t){return typeof t.file_path=="string"&&t.content===void 0}import{existsSync as O,statSync as mt,renameSync as dt,mkdirSync as ht,readSync as kt}from"node:fs";import{appendFileSync as W,mkdirSync as J}from"node:fs";import{dirname as K}from"node:path";var g=[],h=!1,y=!1;function x(t,e){g.push({filePath:t,content:e}),q()}function k(){if(h||g.length===0)return;h=!0;let t=new Map;for(let e of g){let n=t.get(e.filePath);n?n.push(e.content):t.set(e.filePath,[e.content])}for(let[e,n]of t)try{J(K(e),{recursive:!0}),W(e,n.join(""))}catch{}g.length=0,h=!1}function q(){y||(y=!0,process.on("exit",k),process.on("SIGTERM",()=>{k(),process.exit(0)}),process.on("SIGINT",()=>{k(),process.exit(0)}))}import{execSync as xt}from"node:child_process";import X from"node:os";import m from"node:path";function Z(){return process.env.HOME||process.env.USERPROFILE||X.homedir()}function _(){return process.env.CLAUDE_PROJECT_DIR||"."}function H(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function T(){return process.env.CLAUDE_PLUGIN_ROOT?m.join(Z(),".claude","logs","ork"):m.join(_(),".claude","logs")}var Qt=m.join,Yt=m.sep;import{execSync as V}from"node:child_process";import{createHash as Q}from"node:crypto";import{existsSync as b,readFileSync as Y,writeFileSync as tt,mkdirSync as et}from"node:fs";import{join as S,basename as nt}from"node:path";var ot=20,rt=15,st=/[^a-z0-9-]/g;function it(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=nt(e);return C(n,ot)}function ut(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=V("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=C(n||"detached",rt);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function at(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function ct(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function pt(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return Q("sha256").update(t).digest("hex").slice(0,4)}function C(t,e){return t.toLowerCase().replace(st,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function lt(t,e){let n=it(t),o=ut(t),s=at(e),i=ct(e),l=pt();return`${n}-${o}-${s}-${i}-${l}`}function ft(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=S(e,".instance","session-id.json");if(b(n))try{let o=JSON.parse(Y(n,"utf8"));if(o.session_id&&o.created_at){let s=Date.now()-new Date(o.created_at).getTime(),i=1440*60*1e3;if(s<i)return o.session_id}}catch{}}function gt(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=S(n,".instance"),s=S(o,"session-id.json");try{b(o)||et(o,{recursive:!0}),tt(s,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function P(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=ft(t);if(e)return e;let n=lt(t);return gt(n,t),n}function w(){return T()}function E(){return _()}function I(){return H()}function le(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${I()}/.claude/.instance_env`}function R(){return P()}function fe(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=xt("git branch --show-current",{cwd:t||E(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function _t(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function ge(t){return t.replace(/\r\n/g,`
`)}function St(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(_t())}function r(){return{continue:!0,suppressOutput:!0}}function a(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function me(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function de(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function Rt(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function he(t,e){let n={continue:!0,suppressOutput:!0};return t&&(n.systemMessage=t),e&&(n.hookSpecificOutput={hookEventName:"UserPromptSubmit",additionalContext:e}),n}function ke(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function xe(t){return{continue:!0,systemMessage:t}}function _e(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function Se(t){process.stderr.write(`\u26A0 ${t}
`),process.exit(2)}function Re(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function Ee(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var Et=200*1024,It=100*1024;function D(t,e){if(O(t))try{if(mt(t).size>e){let o=`${t}.old.${Date.now()}`;dt(t,o)}}catch{}}function A(t){O(t)||ht(t,{recursive:!0})}function u(t,e,n="debug"){if(!St(n))return;let o=w(),s=`${o}/hooks.log`;try{A(o),D(s,Et);let i=new Date().toISOString().replace("T"," ").slice(0,19);x(s,`[${i}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function c(t,e,n){let o=w(),s=`${o}/permission-feedback.log`;try{A(o),D(s,It);let i=new Date().toISOString(),l=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",f=n?.session_id||R();x(s,`${i} | ${t} | ${e} | tool=${l} | session=${f}
`)}catch{}}function vt(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function Ie(t,e,n,o,s){let i=vt(t);return o&&o.isOverBudget(n)?(u(e,`Budget exhausted for ${n}, suppressing ${i}t`),r()):(s&&s.trackTokenUsage(e,n,i),Rt(t))}function ve(){try{let t=[],n=Buffer.allocUnsafe(256),o,s=0;for(;;)try{if(o=kt(s,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:R(),tool_input:{}}}catch{return{tool_name:"",session_id:R(),tool_input:{}}}}function ye(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let s of n){if(o==null)return;o=o[s]}return o}function He(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function Te(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $(){return!!(process.env.CLAUDE_CODE_TEAM_NAME||process.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS==="1")}function we(t){return e=>t(e)?null:r()}function v(t,...e){let n=t.tool_input.file_path;if(!n)return r();let o=n.split(".").pop()?.toLowerCase()||"";return e.map(i=>i.toLowerCase().replace(/^\./,"")).includes(o)?null:r()}function De(t){return v(t,"py","ts","tsx","js","jsx","go","rs","java")}function Ae(t){return v(t,"py")}function $e(t){return v(t,"ts","tsx","js","jsx")}function Le(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(o=>o.test(e))?null:r():r()}function je(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(o=>o.test(e))?r():null}function Ne(t,...e){let n=t.tool_input.file_path;if(!n)return r();for(let o of e)if(typeof o=="string"){if(new RegExp(o.replace(/\*/g,".*").replace(/\?/g,".")).test(n))return null}else if(o.test(n))return null;return r()}function L(t,...e){let n=t.tool_name;return n?e.includes(n)?null:r():r()}function Ue(t){return L(t,"Write","Edit")}function Fe(t){return L(t,"Bash")}function Me(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(o=>o.test(e))?r():null}function Be(t){return(t.tool_input.command||"").startsWith("git")?null:r()}function Ge(t){if($())return r();let n=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:o}=z("node:fs");if(o(n))return null}catch{}return r()}function ze(t,...e){for(let n of e){let o=n(t);if(o!==null)return o}return null}function We(t){return t.permissionMode==="dontAsk"}function yt(t){return t.replace(/\\x([0-9a-fA-F]{2})/g,(e,n)=>String.fromCharCode(parseInt(n,16)))}function Ht(t){return t.replace(/\\([0-7]{3})/g,(e,n)=>String.fromCharCode(parseInt(n,8)))}function Tt(t){return t.replace(/\\([^\s])/g,"$1")}function bt(t){let e=t;return e=e.replace(/"([^"]*)"/g,"$1"),e=e.replace(/'([^']*)'/g,"$1"),e}function p(t){let e=t;return e=yt(e),e=Ht(e),e=Tt(e),e=bt(e),e=e.replace(/\\\s*[\r\n]+/g," "),e=e.replace(/\n/g," "),e=e.replace(/\s+/g," "),e.trim()}function d(t){let e=t.replace(/\\\s*[\r\n]+/g," ");if(/\n/.test(e))return!0;let n=p(t);return/(?:&&|\|\||[|;])/.test(n)}var Ct=[/^git\s+checkout\s+--\s+\./,/^git\s+checkout\s+\.\s*$/],Pt=[/^git (status|log|diff|branch|show|fetch|pull)/,/^git checkout/,/^npm (list|ls|outdated|audit|run|test)/,/^pnpm (list|ls|outdated|audit|run|test)/,/^yarn (list|outdated|audit|run|test)/,/^poetry (show|run|env)/,/^docker (ps|images|logs|inspect)/,/^docker-compose (ps|logs)/,/^docker compose (ps|logs)/,/^ls(\s|$)/,/^pwd$/,/^echo\s/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^find\s/,/^which\s/,/^type\s/,/^env$/,/^printenv/,/^gh (issue|pr|repo|workflow) (list|view|status)/,/^gh milestone/,/^pytest/,/^poetry run pytest/,/^npm run (test|lint|typecheck|format)/,/^ruff (check|format)/,/^ty check/,/^mypy/];function j(t){let e=t.tool_input.command||"";if(u("auto-approve-safe-bash",`Evaluating bash command: ${e.slice(0,50)}...`),e&&d(e))return u("auto-approve-safe-bash","Compound command detected, requiring manual approval"),r();let n=e?p(e):"";for(let o of Ct)if(o.test(n))return u("auto-approve-safe-bash",`Rejected: matches reject pattern ${o}`),r();for(let o of Pt)if(o.test(n))return u("auto-approve-safe-bash",`Auto-approved: matches safe pattern ${o}`),c("allow",`Matches safe pattern: ${o}`,t),a();return u("auto-approve-safe-bash","Command requires manual approval"),r()}import{resolve as Ot,isAbsolute as N,relative as wt,normalize as U,sep as F}from"node:path";var Dt=["node_modules",".git","dist","build","__pycache__",".venv","venv"];function M(t){let e=t.tool_input.file_path||"",n=E();u("auto-approve-project-writes",`Evaluating write to: ${e}`),N(e)||(e=Ot(n,e));let o=U(e),s=U(n),i=wt(s,o);if(!i.startsWith("..")&&!N(i)){for(let f of Dt)if(e.includes(`${F}${f}${F}`))return u("auto-approve-project-writes",`Write to excluded directory: ${f}`),r();return u("auto-approve-project-writes","Auto-approved: within project directory"),c("allow",`In-project write: ${e}`,t),a()}return u("auto-approve-project-writes","Write outside project directory - manual approval required"),r()}import{existsSync as At,readFileSync as $t}from"node:fs";import{join as Lt}from"node:path";var jt=[/rm\s+-rf\s+[/~]/,/sudo\s/,/chmod\s+-R\s+777/,/>\s*\/dev\/sd/,/mkfs\./,/dd\s+if=/,/:.*\(\).*\{.*\|.*&.*\}/,/curl.*\|\s*sh/,/wget.*\|\s*sh/];function Nt(t){return jt.some(e=>e.test(t))}function Ut(){let t=I(),e=Lt(t,".claude","feedback","learned-patterns.json");try{if(At(e))return JSON.parse($t(e,"utf8")).autoApprovePatterns||[]}catch{}return[]}function Ft(t){let e=Ut(),n=p(t).toLowerCase();for(let o of e)if(!(typeof o!="string"||o.length===0||o.length>200)&&n.startsWith(o.toLowerCase().trim()))return!0;return!1}function B(t){let e=t.tool_name,n=t.tool_input.command||t.tool_input.file_path||"";if(u("learning-tracker",`Processing permission for tool: ${e}, command: ${n.slice(0,50)}...`),e==="Bash"&&n){if(Nt(n))return u("learning-tracker","Command matches security blocklist, skipping"),r();if(d(n))return u("learning-tracker","Compound command detected, skipping auto-approve"),r();if(Ft(n))return u("learning-tracker","Command matches learned auto-approve pattern"),c("allow","Learned pattern match",t),a()}return r()}var G={"permission/auto-approve-safe-bash":j,"permission/auto-approve-project-writes":M,"permission/learning-tracker":B};function cn(t){return G[t]}function pn(){return Object.keys(G)}export{we as createGuard,Te as escapeRegex,vt as estimateTokenCount,fe as getCachedBranch,le as getEnvFile,ye as getField,cn as getHook,w as getLogDir,_t as getLogLevel,I as getPluginRoot,E as getProjectDir,R as getSessionId,Fe as guardBash,De as guardCodeFiles,v as guardFileExtension,Be as guardGitCommand,Ge as guardMultiInstance,Me as guardNontrivialBash,Ne as guardPathPattern,Ae as guardPythonFiles,je as guardSkipInternal,Le as guardTestFiles,L as guardTool,$e as guardTypescriptFiles,Ue as guardWriteEdit,G as hooks,Bt as isBashInput,We as isDontAskMode,zt as isEditInput,Wt as isReadInput,Gt as isWriteInput,pn as listHooks,u as logHook,c as logPermissionFeedback,He as normalizeCommand,ge as normalizeLineEndings,ke as outputAllowWithContext,me as outputBlock,Re as outputDeny,xe as outputError,Rt as outputPromptContext,Ie as outputPromptContextBudgeted,a as outputSilentAllow,r as outputSilentSuccess,Se as outputStderrWarning,_e as outputWarning,de as outputWithContext,he as outputWithNotification,Ee as outputWithUpdatedInput,ve as readHookInput,ze as runGuards,St as shouldLog};
//# sourceMappingURL=permission.mjs.map
